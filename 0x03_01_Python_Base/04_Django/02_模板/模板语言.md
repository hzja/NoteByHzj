# 模板 Templates

## 1.模板的功能

通常是在视图函数中使用模板产生html内容返回给客户端，控制页面上展示的内容。模板文件不仅仅是一个html文件。

模板文件包含两部分内容：

1. 静态内容：css，js，html。
2. 动态内容：用于动态去产生一些网页内容。通过模板语言来产生。



## 2.模板文件的使用

~~~ python
def my_render(request, template_path, context={}):
    
    # 1.加载模板文件，获取一个模板对象
    temp = loader.get_template(template_path)
    
    # 2.定义模板上下文，给模板文件传数据
    context = RequestContext(request, context)
    
    # 3.模板渲染，产生html页面内容
    res_html = temp.render(context)
    
    # 4.返回应答
    return HttpResponse(res_html)
~~~



# 模板语言

模板语言包括4种类型

- 变量
- 标签
- 过滤器
- 注释



## 变量

~~~ python
语法：{{变量}}
~~~



### 变量的解析顺序

例如：{{ book.btitle }}

1. 首先把book当成一个字典，把btitle当成键名，进行取值book['btitle']
2. 把book当成一个对象，把btitle当成属性，进行取值book.btitle
3. 把book当成一个对象，把btitle当成对象的方法，进行取值book.btitle



示例：{{book.0}}

1. 首先把book当成一个字典，把0当成键名，进行取值book[0]
2. 把book当成一个列表，把0当成下标，进行取值book[0]
3. 如果解析失败，则产生内容时用空字符串填充模板变量。



**注意**：使用模板变量时，.前面的可能是一个字典，可能是一个对象，还可能是一个列表。

~~~ python
def temp_var(request):
    '''模板变量'''
    
    my_dict = {'title':'字典键值'}
    my_list = [1,2,3]
    book = BookInfo.objects.get(id=1)
    
    # 定义模板上下文
    context = {'my_dict':my_dict, 'my_list':my_list, 'book':book}
    
    return render(request, 'booktest/temp_var.html', context)
~~~

~~~ html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>模板变量</title>
</head>
<body>
使用字典属性:{{ my_dict.title }}<br/>
使用列表元素:{{ my_list.1 }}<br/>
使用对象属性:{{ book.btitle }}
</body>
</html>
~~~

![1580559296513-6b058cb7-2f1e-40eb-877e-601bd7e402c4](D:\Note\python\Django\图片\1580559296513-6b058cb7-2f1e-40eb-877e-601bd7e402c4.png)



## 标签

~~~ python
{%代码段%}
~~~



### for标签语法

~~~ html
for循环：
	{% for x in 列表 %}
	# 列表不为空时执行
	{% empty %}
	# 列表为空时执行
	{% endfor %}
~~~

**注意：**可以通过**{{ forloop.counter }}**得到for循环遍历到了第几次



### if标签语法

~~~ html
{% if 条件 %}
{% elif 条件 %}
{% else %}
{% endif %}
~~~



### 关系比较操作符

~~~html
关系比较操作符
~~~

**注意：**进行比较操作时，比较操作符两边必须有空格



### 示例

~~~ html
<html>
<head>
    <title>标签</title>
</head>
<body>
图书列表如下：
<ul>
    {%for book in list%}
        {%if book.id <= 2%}
            <li style="background-color: red;">{{book.btitle}}</li>
        {%elif book.id <= 3%}
            <li style="background-color: blue;">{{book.btitle}}</li>
        {%else%}
            <li style="background-color: green;">{{book.btitle}}</li>
        {%endif%}
    {%empty%}
        <li>对不起，没有图书</li>
    {%endfor%}
</ul>
</body>
</html>
~~~

![1586934475271-94c64c90-abdf-43bf-9e25-2ad4406a2dfb](D:\Note\python\Django\图片\1586934475271-94c64c90-abdf-43bf-9e25-2ad4406a2dfb.png)



## 过滤器

- 使用管道符号|应用过滤器用于计算、转换操作，可使用变量、标签中；
- 若过滤器需参数则用冒号:传递参数；



### 语法

~~~ python
变量|过滤器:参数
~~~



**length：**求长度，返回字符串包含字符的个数，或列表、元组、字典的元素个数

**default：**设置模板变量的默认值

**date：**改变日期的显示格式，常用的格式化字符如下：

- Y表示年，格式为4位，y表示两位的年
- m表示月，格式为01,02,12等
- d表示日, 格式为01,02等
- j表示日，格式为1,2等
- H表示时，24进制，h表示12进制的时
- i表示分，为0-59
- s表示秒，为0-59



~~~ html
<head>
    <title>过滤器</title>
</head>
<body>
图书列表如下：
<ul>
    {%for book in list%}
        {%if book.btitle|length > 4%}
            <li style="background-color: red;">
                {{book.btitle}}
                ---默认时间格式为：
                {{book.bpub_date}}
            </li>
        {%else%}
            <li style="background-color: green;">
                {{book.btitle}}
                ---格式化时间为：
                {{book.bpub_date|date:"Y-m-j"}}
            </li>
        {%endif%}
    {%endfor%}
</ul>
</body>
</html>
~~~

![1586934545380-d59ae9de-986e-4f02-945e-d3b2007b0d02](D:\Note\python\Django\图片\1586934545380-d59ae9de-986e-4f02-945e-d3b2007b0d02.png)



### 自定义过滤器

有时默认过滤器功能不满足需求，需通过装饰器自定义过滤器，如（对数据二次计算）

1）在应用中创建templatetags目录，当前示例为"booktest/templatetags"，创建_*init_*文件，内容为空。

![1580560420508-53c1d185-6ae0-43a3-9ed9-6110b92b029e](D:\Note\python\Django\图片\1580560420508-53c1d185-6ae0-43a3-9ed9-6110b92b029e.png)



2）在"booktest/templatetags"目录下创建filters.py文件

~~~ python
# 自定义过滤器
# 过滤器其实就是python函数
from django.template import Library

# 创建一个Library类的对象
register = Library()

# 自定义的过滤器函数，至少有一个参数，最多两个
@register.filter
def mod(num):
    '''判断num是否为偶数'''
    return num%2 == 0

@register.filter
def mod_val(num, val):
    '''判断num是否能被val整除'''
    return num%val == 0
~~~



3）在templates/booktest/temp_filter.html中，使用自定义过滤器

- 首先使用load标签引入模块

~~~ html
<!DOCTYPE html>
<html lang="en">
{% load filters %}
...
{% if book.id <= 2 %}
...
~~~



## 注释

### 单行注释

~~~html
{# 注释内容 #}
~~~



### 多行注释

~~~html
{% comment %}
内容
{% endcomment %}
~~~

**注意：**注释后代码会对客户端隐藏，下面的标签注释不会隐藏



**html标签注释**

~~~ html
<!-- <h1>html注释</h1> -->
~~~

