# 字段类型

## 命名限制

1. 不能是python的保留关键字。
2. 不允许使用连续的下划线，这是由django的查询方式决定的。
3. 定义属性时需要指定字段类型，通过字段类型的参数指定选项，语法如下：

> 属性名=models.字段类型(选项)
>



## 字段类型

使用时需引入django.db.models包，字段类型如下：

| 类型                                                         | 描述                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **AutoField**                                                | 主键，自动增长的IntegerField，通常不用指定，不指定时Django会自动创建属性名为id的自动增长属性。 |
| **CharField**                                                             CharField(max_length=20, verbose_name='名称') | 字符串。参数max_length表示最大字符个数。                     |
| **ForeignKey**                                                                        ForeignKey('User', verbose_name='所属账户')；ForeignKey('self', null=True, blank=True) 可以指向自己 | 关系属性用法，建立用户和收货地址一对多关系                   |
| **BooleanField**                                                    BooleanField(default=False) | 布尔字段，值为True或False。一般用来处理男女性别属性          |
| **DateField**                                                                                       DateField() | 日期。1)参数auto_now表示每次保存对象时，自动设置该字段为当前时间，用于"最后一次修改"的时间戳，它总是使用当前日期，默认为false。2) 参数auto_now_add表示当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为false。3)参数auto_now_add和auto_now是相互排斥的，组合将会发生错误。 |
| **DateTimeField**                                                                                     DateTimeField() | 日期时间，参数同DateField。                                  |
| **FileField**                        FileField(upload_to='',storage=None,max_length=    ,**options) | 文件上传字段                                                 |
| **ImageField**                                                                       ImageField(upload_to='type', verbose_name='商品图片') | 继承于FileField，对上传的内容进行校验，确保是有效的图片（jpg、png） |
| **TextField**                                                | 大文本字段，一般超过4000个字符时使用。                       |
| **IntegerField**                                             | 主键，它同AutoField一样，唯一的差别就是不自增                |
| **SmallIntegerField**                                          SmallIntegerField(default=0, verbose_name='展示顺序') | 小整数时一般会用到                                           |
| **DecimalField**                                                                   (max_digits=None, decimal_places=None) | 十进制浮点数。参数max_digits表示总位。参数decimal_places表示小数位数。 |
| **FloatField**                                               | 浮点数。参数同上                                             |
| **NullBooleanField**                                         | 支持Null、True、False三种值。                                |
| **JSONField**                                                                                             `JSONField`(encoder=None ,decoder=None,options) | 一用于存储 JSON 编码数据的字段,；Python 中数据以其本地格式表示：字典、列表、字符串、数字、布尔值和 `None`；支持MariaDB, MySQL 5.7.8+, Oracle, PostgreSQL, and SQLite |
| **TimeField**                                                | 时间，参数同DateField。                                      |
| **EmailField**                                             EmailField(max_length=254,options) | 一个 [`CharField`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.CharField)，使用 [`EmailValidator`](https://docs.djangoproject.com/zh-hans/4.1/ref/validators/#django.core.validators.EmailValidator) 来检查该值是否为有效的电子邮件地址； |



### FileField

**FileField(upload_to='',storage=None,max_length=100,options)**

> 文件上传字段



#### upload_to

> 提供了一种设置上传目录和文件名的方式，可以有两种设置方式：
>
> 一、指定一个字符串值或一个 [`Path`](https://docs.python.org/3/library/pathlib.html#pathlib.Path)，它可能包含 [`strftime()`](https://docs.python.org/3/library/time.html#time.strftime) 格式，它将被文件上传的日期／时间所代替（这样上传的文件就不会填满指定的目录）
>
> ~~~ python
> class MyModel(models.Model):
>     # file will be uploaded to MEDIA_ROOT/uploads
>     upload = models.FileField(upload_to='uploads/')
>     # or...
>     # file will be saved to MEDIA_ROOT/uploads/2015/01/30
>     upload = models.FileField(upload_to='uploads/%Y/%m/%d/')
> ~~~
>
> 
>
> 二、使用默认 [`FileSystemStorage`](https://docs.djangoproject.com/zh-hans/4.1/ref/files/storage/#django.core.files.storage.FileSystemStorage)，这个字符串的值将被附加 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) 路径后面，形成本地文件系统中上传文件的存储位置
>
> - `location`
>
>   存放文件的目录的绝对路径。 默认为你的 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) 配置的值。
>
> - `base_url`
>
>   为存储在此位置的文件提供服务的 URL。默认为你的 [`MEDIA_URL`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_URL) 配置的值。
>
> - `file_permissions_mode`
>
>   保存文件时，文件系统将获得的权限。默认为 [`FILE_UPLOAD_PERMISSIONS`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-FILE_UPLOAD_PERMISSIONS)。
>
> - `directory_permissions_mode`
>
>   保存目录时，该目录将获得的文件系统权限，默认为 [`FILE_UPLOAD_DIRECTORY_PERMISSIONS`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-FILE_UPLOAD_DIRECTORY_PERMISSIONS)。



> `upload_to` 也可是一可调用对象，函数。此函数将被调用以获得上传路径，包括文件名。这个对象须接受两参数并返回一个 Unix 风格路径（带斜线），以便传给存储系统。
>
> | 参数       | 描述                                                         |
> | ---------- | ------------------------------------------------------------ |
> | `instance` | 定义 `FileField` 的模型实例。更具体地说，这是附加当前文件的特定实例。在大多数情况下，这个对象还没有被保存到数据库，所以如果它使用默认的 `AutoField`，*它的主键字段可能还没有一个值*。 |
> | `filename` | 最初给文件的文件名。在确定最终目标路径时，可能会考虑到，也可能不会考虑到。 |
>
> ~~~ python
> def user_directory_path(instance, filename):
>     # file will be uploaded to MEDIA_ROOT/user_<id>/<filename>
>     return 'user_{0}/{1}'.format(instance.user.id, filename)
> 
> class MyModel(models.Model):
>     upload = models.FileField(upload_to=user_directory_path)
> ~~~



#### Storage

> 一存储对象或是一返回存储对象的可调用对象，它处理文件存储和检索；
>
> 默认表单部件是一个 [`ClearableFileInput`](https://docs.djangoproject.com/zh-hans/4.1/ref/forms/widgets/#django.forms.ClearableFileInput)；



#### max_length

> [`FileField`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.FileField) 实例在数据库中被创建为 `varchar` 列，默认最大长度为 100 个字符，同样可根据max_length改变最大长度；



### 模型中使用FileField或ImageField的步骤

> 1. 在配置文件中将 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) 定义为希望 Django 存储上传文件的目录的完整路径，（为提高性能这些文件不会存储在数据库中）将 [`MEDIA_URL`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_URL) 定义为该目录的基本公共 URL同时确保这个目录可被网络服务器用户账户写入；
> 2. 将 [`FileField`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.FileField) 或 [`ImageField`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.ImageField) 添加到模型中，定义 [`upload_to`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.FileField.upload_to) 选项，指定 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) 子目录用于上传文件；
> 3. 所有这些将被存储在数据库中的是一文件路径（相对于 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) ），需使用 Django 提供的[`url`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.fields.files.FieldFile.url) 属性。如[`ImageField`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.ImageField) 叫做`mug_shot`则可在模板中使用 `{{ object.mug_shot.url }}` 获取图片绝对路径；
>
> 如 [`MEDIA_ROOT`](https://docs.djangoproject.com/zh-hans/4.1/ref/settings/#std-setting-MEDIA_ROOT) 设为 `'/home/media'`， [`upload_to`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.FileField.upload_to) 设为 `'photos/%Y/%m/%d'`；[`upload_to`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#django.db.models.FileField.upload_to) 中的 `'%Y/%m/%d'` 部分是 [`strftime()`](https://docs.python.org/3/library/time.html#time.strftime) 格式化，`'%Y'` 是四位数的年，`'%m'` 是两位数的月，`'%d'` 是两位数的日；如在 2007 年 1 月 15 日上传一文件则其将被保存在 `/home/media/photos/2007/01/15` 目录下。



## 字段选项

通过选项实现对字段的约束，选项如下：

| 选项名                                                       | 描述                                                         |
| :----------------------------------------------------------- | ------------------------------------------------------------ |
| **default**                                                                                                         default=1 | 设置默认值。                                                 |
| **verbose_name**                                                                                  verbose_name='商品名称' | 用于指定字段人类可读名称                                     |
| **primary_key**                                              | 若为True则该字段成为模型主键字段，默认值是False，一般作为AutoField选项使用。 |
| **validators**                                               | 为字段运行的验证器列表，详见 [验证器文档](https://docs.djangoproject.com/zh-hans/4.1/ref/validators/)。 |
| **[`choices`](https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/#choices)**                                                                              choices=status_choices其中status_choices等于一个元祖 | 配置字段的choices后，在admin页面上就可以看到对应的选项展示choice显示中文可以使用 "get_字段名_display()" |
| **unique **                                                                                                    unique=true | 如果为True, 这个字段在表中必须有唯一值，默认值是False。      |
| **db_index**                                                 | 若值为True, 则在表中会为此字段创建索引，默认值是False。      |
| **db_column**                                                | 字段的名称，如果未指定，则使用我们定义的Field对应数据库中的字段名称。 |
| **null**                                                     | 如果是 `True` Django 将在数据库中存储空值为 `NULL`,默认为 `False` |
| **blank**                                                                                                         blank=True | 如果为True则该字段允许为空白，默认值是False                  |



对比：null是数据库范畴的概念，blank是后台管理页面表单验证范畴的。

**注意:**当修改模型类之后，**如果影响表结构，则必须重新做迁移**，商品的选项中default和blank不影响表结构。