# 模型类关系

## 一对多关系(ForeignKey)

~~~ python
例：图书类-英雄类 
models.ForeignKey(to=UserProfile, on_delete=models.CASCADE) ：将字段定义在多的一端。
~~~



## 多对多关系(ManyToManyField)

~~~ python 
例：新闻类-新闻类型类 体育新闻 国际新闻
models.ManyToManyField(to='UserInfo',on_delete=models.CASCADE) ：将字段定义在任意一端。
~~~

+ 多对多的增删改查 https://www.cnblogs.com/zhaoyingjie/p/7799013.html



## 一对一关系(OneToOneField)

~~~ python
例：员工基本信息类-员工详细信息类 员工工号
models.OneToOneField(to='UserInfo',on_delete=models.CASCADE)： 将字段定义在任意一端。
~~~



## 应用场景

- **一对多：**当一张表中创建一行数据时，有一个单选的下拉框（可以被重复选择）
  例如：创建用户信息时候，需要选择一个用户类型【普通用户】【金牌用户】【铂金用户】等。
- **多对多：**在某表中创建一行数据是，有一个可以多选的下拉框
  例如：创建用户信息，需要为用户指定多个爱好
- **一对一：**在某表中创建一行数据时，有一个单选的下拉框（下拉框中的内容被用过一次就消失了
  例如：原有含10列数据的一张表保存相关信息，经过一段时间之后，10列无法满足需求，需要为原来的表再添加5列数据

![1580308058753-e8b6a673-07f8-4a59-9507-35e2ce6e4a18](D:\Note\python\Django\图片\1580308058753-e8b6a673-07f8-4a59-9507-35e2ce6e4a18.png)



## 关联查询(一对多)

类似于Mysql中的join查询

### 由一类(UserProfile)查询多类(Article)

**方法一：一类的对象.多类名小写_set.all()**

~~~ python
b = models.UserProfile.objects.get(username='admin')
b.article_set.all()
<QuerySet [<Article: 啊1>, <Article: 啦啦啦我是2>, <Article: 啦啦啦我是3>]>
~~~



**方法二：多类名.objects.filter(关联属性__一类属性名__条件名)**

~~~ python 
models.Article.objects.filter(user__username='admin')
<QuerySet [<Article: 啊1>, <Article: 啦啦啦我是2>, <Article: 啦啦啦我是3>]>
~~~



### 由多类（Article）查询一类（UserProfile）

**多类的对象.关联属性**

**方法一：多类的对象.主键**

~~~ python
h = models.Article.objects.get(title='啦啦啦我是3')
h.user
<UserProfile: admin>
~~~



**方法二：一类名.objects.filter(多类名小写__多类属性名__条件名)**

~~~ python
models.UserProfile.objects.filter(article__title='啦啦啦我是3')
<QuerySet [<UserProfile: admin>]>
~~~

![a](D:\Note\python\Django\图片\1580308443414-30c878f5-7f6b-4a0f-9944-bab7457f3357.png)





# 自关联 

**自关联是一种特殊的一对多（把关联属性指向了自己）**

案例：显示广州市的上级地区和下级地区

![1580446268785-03505bd1-485b-497b-b9c4-74045c6b1651](D:\Note\python\Django\图片\1580446268785-03505bd1-485b-497b-b9c4-74045c6b1651.png)

~~~ python
models.py

class AreaInfo(models.Model):
    '''地区模型类'''
    # 地区名称
    atitle = models.CharField(max_length=20)
    # 关系属性，代表当前地区的父级地区,主键指向自己，允许为空
    aParent = models.ForeignKey('self', null=True, blank=True)
~~~



~~~ python
views.py

from booktest.models import AreaInfo
def areas(request):
    '''获取广州市的上级地区和下级地图'''
    # 1.获取广州市信息
    area = AreaInfo.objects.get(atitle='广州市')
    # 2.查询广州市的上级地区
    parent = area.aParent
    # 3.查询广州市的下级地区
    children = area.areainfo_set.all()
    # 使用模板
    return render(request, 'booktest/areas.html', {'area':area,'parent':parent, 'children':children})
~~~



~~~ python
urls.py

from django.conf.urls import url
from booktest import views
urlpatterns = [
    url(r'^areas$', views.areas),
]
~~~



~~~python
areas.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自关联模板</title>
</head>
<body>
<h1>当前地区</h1>
{{ area.atitle }}<br/>
<h1>父级地区</h1>
{{ parent.atitle }}<br/>
<h1>下级地区</h1>
<ul>
    {% for child in children %}
        <li>{{ child.atitle }}</li>
    {% endfor %}
</ul>
</body>
</html>
~~~



![1580447226876-51cd6957-9879-4d40-bc5b-db09606c30f7](D:\Note\python\Django\图片\1580447226876-51cd6957-9879-4d40-bc5b-db09606c30f7.png)