# 常见问题

有的时候调用request.POST时获取不到值，但是request.body中有值



# application/x-www-form-urlencoded

ajax请求中content-type：application/x-www-form-urlencoded代表参数以键值对传递给后台，参数名需一一对应

~~~ python
# 情况一：
    # 必须是x-www-form-urlencode
    content-type：x-www-form-urlencode
    
    # 必须是&这种格式才有值
    name=alex&age=19&xx=10
    
    request.POST有值
    request.body有值
~~~

**原理：**django内部在处理获取的请求数据时，会根据以下步骤：

1. django读取Content-Type请求头，读取request.body，原始数据：username=alex&password=dsb
2. 如果请求头等于 application/x-www-form-urlencoded，那么django就会解析 request.body 中的数据，生成一个QueryDict对象（类似于字典），然后将字典赋值给 request.POST



# application/json

ajax请求中content-type：application/json代表参数以json字符串传递给后台

~~~ python
# 情况二：
	content-type:application/json
    {"name":"Alex","Age":19}

    request.POST没值
    request.body有值
~~~

**原理：**用这种方式的话，可以通过request.POST获取不到值，必须通过request.body获取原始内容后，自己转换 



**CMDB项目使用jso****n字符串传递给后台****，所以必须自己去request.body取值**

~~~ python
class ServerView(View):

    def post(self,request,*args,**kwargs):
        content = request.body.decode('utf-8')
        server_info_dict = json.loads(content)
        hostname = server_info_dict['host']
        info_dict = server_info_dict['info']

        host_object = models.Server.objects.filter(hostname=hostname).first()
        if not host_object:
            return HttpResponse('服务器不存在')
        process_disk_info(host_object, info_dict['disk'])

        host_object.last_date = datetime.date.today()
        host_object.save()
        # 获取数据之后，把他们放到数据库
        return HttpResponse('成功')
~~~

