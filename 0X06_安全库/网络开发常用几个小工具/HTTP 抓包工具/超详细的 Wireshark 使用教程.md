<a name="CgC75"></a>
## 一、Wireshark是什么？
Wireshark是非常流行的网络封包分析软件，简称小鲨鱼，功能十分强大。可以截取各种网络封包，显示网络封包的详细信息。<br />Wireshark是开源软件，可以放心使用。可以运行在Windows和Mac OS上。对应的，linux下的抓包工具是 tcpdump。使用Wireshark的人必须了解网络协议，否则就看不懂Wireshark了。<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1679272119926-dfddae9c-d214-4ff9-9f13-7f36cf075b37.png#averageHue=%233eabe8&clientId=uceaab503-c936-4&from=paste&id=hVfta&originHeight=394&originWidth=700&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u12deff49-150c-4b2f-a93e-d19949ef5db&title=)
<a name="NIhlf"></a>
## 二、Wireshark常用应用场景

1. 网络管理员会使用Wireshark来检查网络问题
2. 软件测试工程师使用Wireshark抓包，来分析自己测试的软件
3. 从事socket编程的工程师会用Wireshark来调试
4. 运维人员用于日常工作，应急响应等等

总之跟网络相关的东西，都可能会用到Wireshark
<a name="u44nZ"></a>
## 三、Wireshark抓包原理
Wireshark使用WinPCAP作为接口，直接与网卡进行数据报文交换。<br />Wireshark使用的环境大致分为两种，一种是电脑直连网络的单机环境，另外一种就是应用比较多的网络环境，即连接交换机的情况。<br />「单机情况」下，Wireshark直接抓取本机网卡的网络流量；<br />「交换机情况」下，Wireshark通过端口镜像、ARP欺骗等方式获取局域网中的网络流量。<br />端口镜像：利用交换机的接口，将局域网的网络流量转发到指定电脑的网卡上。<br />ARP欺骗：交换机根据MAC地址转发数据，伪装其他终端的MAC地址，从而获取局域网的网络流量。
<a name="vTy6S"></a>
## 四、Wireshark软件安装
软件下载路径：[https://www.wireshark.org/](https://www.wireshark.org/)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693226895429-34b4e616-4fc7-4c12-9928-2c99722df8b8.png#averageHue=%23112550&clientId=u08747114-be79-4&from=paste&height=707&id=uodRw&originHeight=1768&originWidth=3796&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=1824504&status=done&style=none&taskId=u103788a7-423f-4f79-9f2f-21cb2e3b328&title=&width=1518.4)<br />按照系统版本选择下载，下载完成后，按照软件提示一路Next安装。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693226916129-e62dfc62-39f5-4365-86c0-1c4e8f5fc3be.png#averageHue=%23081324&clientId=u08747114-be79-4&from=paste&height=707&id=ygYMU&originHeight=1768&originWidth=3793&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=313322&status=done&style=none&taskId=u769a4d9e-7580-400e-b826-d8109a7a18d&title=&width=1517.2)
<a name="D7ciw"></a>
## 五、Wireshark抓包示例
先介绍一个使用Wireshark工具抓取ping命令操作的示例，可以上手操作感受一下抓包的具体过程。<br />1、打开Wireshark，主界面如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227266438-f1d9cc3c-f4a8-4bfe-828b-b9b5f726ddb4.png#averageHue=%23f9f9f9&clientId=u08747114-be79-4&from=paste&height=814&id=nOvCf&originHeight=2036&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=405416&status=done&style=none&taskId=u237be271-76c5-4f95-8b7a-c06c09c83c6&title=&width=1536)<br />2、选择菜单栏上 捕获 -> 选项，勾选WLAN网卡。这里需要根据各自电脑网卡使用情况选择，简单的办法可以看使用的IP对应的网卡。点击Start，启动抓包。<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1679272119919-4183c1af-478b-48c5-ad64-105659dc84a7.png#averageHue=%23f6f3f2&clientId=uceaab503-c936-4&from=paste&id=x8RFb&originHeight=339&originWidth=554&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u882db31d-ed15-4705-9e42-966789196ef&title=)<br />3、Wireshark启动后，Wireshark处于抓包状态中。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227482010-63c3d18a-fefb-409e-87ab-c3a8011fc840.png#averageHue=%23cbd8af&clientId=u08747114-be79-4&from=paste&height=814&id=GM7BS&originHeight=2035&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=694847&status=done&style=none&taskId=ucc1979ab-f8ff-4ea2-a1c7-84c5f6f25f6&title=&width=1536)<br />4、执行需要抓包的操作，如在cmd窗口下执行ping www.baidu.com。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227575022-7ab81b64-8432-4dbe-b4ec-da3e420dd6ae.png#averageHue=%233b3b3b&clientId=u08747114-be79-4&from=paste&height=305&id=eAE2B&originHeight=762&originWidth=1999&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=567763&status=done&style=none&taskId=u07d8a519-ac2b-49f8-b706-77da45d303d&title=&width=799.6)<br />5、操作完成后相关数据包就抓取到了，可以点击 停止捕获分组 按钮。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229133023-a2dfe1d0-98ac-4944-9385-4acffb7eb853.png#averageHue=%23a2d288&clientId=u82186b30-9034-4&from=paste&height=474&id=Ug7XA&originHeight=1185&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=414706&status=done&style=none&taskId=u9b0d0878-48f0-4dc9-8b11-b9cf56cbd23&title=&width=1536)<br />6、为避免其他无用的数据包影响分析，可以通过在过滤栏设置过滤条件进行数据包列表过滤，获取结果如下。说明：ip.addr == 183.232.231.172 and icmp 表示只显示ICPM协议且主机IP为183.232.231.172的数据包。说明：协议名称icmp要小写。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227592255-7c56bb8a-3799-4124-92ce-9940c72c4b53.png#averageHue=%23d3bb84&clientId=u08747114-be79-4&from=paste&height=814&id=BAmyY&originHeight=2036&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=572082&status=done&style=none&taskId=ud1238933-717f-422a-aab0-3cc6df3b02e&title=&width=1536)<br />7、Wireshark抓包完成，并把本次抓包或者分析的结果进行保存，就这么简单。关于Wireshark显示过滤条件、抓包过滤条件、以及如何查看数据包中的详细内容在后面介绍。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227614037-437e05e2-fe24-4606-ac60-1a7198162810.png#averageHue=%23ccad79&clientId=u08747114-be79-4&from=paste&height=502&id=vUpCB&originHeight=1255&originWidth=1576&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=192566&status=done&style=none&taskId=u18b6e293-9c4d-46bd-aad3-baeef35c81c&title=&width=630.4)
<a name="SVYtu"></a>
## 六、Wireshakr抓包界面介绍
![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227881668-be270d07-8add-4ffe-abec-5297344aa5b7.png#averageHue=%23d0cfa5&clientId=u08747114-be79-4&from=paste&height=816&id=O2FiX&originHeight=2039&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=752119&status=done&style=none&taskId=uc84e4e44-58b2-4ef8-b08b-75c0296102f&title=&width=1536)<br />Wireshark 的主界面包含6个部分：<br />菜单栏：用于调试、配置<br />工具栏：常用功能的快捷方式<br />过滤栏：指定过滤条件，过滤数据包<br />数据包列表：核心区域，每一行就是一个数据包<br />数据包详情：数据包的详细数据<br />数据包字节：数据包对应的字节流，二进制<br />说明：数据包列表区中不同的协议使用了不同的颜色区分。协议颜色标识定位在菜单栏 视图 --> 着色规则。如下所示<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227899357-1335aadb-8ec8-4237-b49e-4f098a30fb83.png#averageHue=%23e8e6e6&clientId=u08747114-be79-4&from=paste&height=741&id=Asthx&originHeight=1853&originWidth=1576&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=317765&status=done&style=none&taskId=u0568225e-23cb-495f-bcf1-07a422d4f8d&title=&width=630.4)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227925029-9df614c5-3e6b-4a9d-a701-63eeb70fbbb3.png#averageHue=%23f5f6cc&clientId=u08747114-be79-4&from=paste&height=660&id=J5L4z&originHeight=1651&originWidth=2559&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=294091&status=done&style=none&taskId=ucb850fc7-458e-4b8b-b056-115ad4f2a25&title=&width=1023.6)<br />WireShark 主要分为这几个界面
<a name="lsfoh"></a>
### 1、Display Filter(显示过滤器)
用于设置过滤条件进行数据包列表过滤。菜单路径：分析 --> Display Filters。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227967430-25df8682-91ac-497d-acb2-1a203fdaa963.png#averageHue=%23eaeaea&clientId=u08747114-be79-4&from=paste&height=22&id=MNb9D&originHeight=54&originWidth=2298&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=10105&status=done&style=none&taskId=udd999628-f174-4ac0-afad-48db481a82b&title=&width=919.2)
<a name="X68F0"></a>
### 2、Packet List Pane(数据包列表)
显示捕获到的数据包，每个数据包包含编号，时间戳，源地址，目标地址，协议，长度，以及数据包信息。不同协议的数据包使用了不同的颜色区分显示。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693227982201-9ca77df0-2416-454d-8adf-3d8c77896fb7.png#averageHue=%2312272e&clientId=u08747114-be79-4&from=paste&height=393&id=eQwMx&originHeight=983&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=388087&status=done&style=none&taskId=u16aff34f-0bf3-485f-bbae-79dcbe07a75&title=&width=1536)
<a name="RkJBC"></a>
### 3、Packet Details Pane(数据包详细信息)
在数据包列表中选择指定数据包，在数据包详细信息中会显示数据包的所有详细信息内容。数据包详细信息面板是最重要的，用来查看协议中的每一个字段。各行信息分别为<br />（1）Frame:   物理层的数据帧概况<br />（2）Ethernet II:   数据链路层以太网帧头部信息<br />（3）Internet Protocol Version 4:   互联网层IP包头部信息<br />（4）Transmission Control Protocol:   传输层T的数据段头部信息，此处是TCP<br />（5）Hypertext Transfer Protocol:   应用层的信息，此处是HTTP协议<br />TCP包的具体内容<br />从下图可以看到Wireshark捕获到的TCP包中的每个字段。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228048660-9c095131-81bb-4a06-813e-97441e83b383.png#averageHue=%23f5f5f4&clientId=u08747114-be79-4&from=paste&height=646&id=bG8rI&originHeight=1615&originWidth=3832&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=381917&status=done&style=none&taskId=uab6a50b2-ed91-42b7-89d9-5f81aaf0779&title=&width=1532.8)<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1679272120965-faa08fdf-6ae7-4925-98dc-68f9bf303752.png#averageHue=%23d2e0f4&clientId=uceaab503-c936-4&from=paste&id=qPcsZ&originHeight=522&originWidth=463&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=ud5a1d765-1c34-499a-8214-9357ec5fa1b&title=)
<a name="ON3re"></a>
### 4、Dissector Pane(数据包字节区)
报文原始内容。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228063782-afd9d151-97b2-4382-bc0f-a4a85416356a.png#averageHue=%23faf9f9&clientId=u08747114-be79-4&from=paste&height=356&id=qas8J&originHeight=891&originWidth=1905&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=76334&status=done&style=none&taskId=ud0c160d5-ca89-4069-b837-b9bf4c7ed40&title=&width=762)
<a name="CPCqD"></a>
## 七、Wireshark过滤器设置
初学者使用Wireshark时，将会得到大量的冗余数据包列表，以至于很难找到自己需要抓取的数据包部分。<br />Wireshark工具中自带了两种类型的过滤器，学会使用这两种过滤器会帮助我们在大量的数据中迅速找到需要的信息。
<a name="Sfpa4"></a>
### 1、抓包过滤器
捕获过滤器的菜单栏路径为 捕获 --> 捕获过滤器。用于在抓取数据包前设置。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228132637-047d5593-be7c-4b9a-8acc-d0e6c45fef26.png#averageHue=%23e3e2e1&clientId=u08747114-be79-4&from=paste&height=182&id=QOJYR&originHeight=454&originWidth=570&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=45329&status=done&style=none&taskId=ue5168fde-9cb6-43af-a46b-3434eaaa8c5&title=&width=228)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228116936-ebf2d355-9c35-4af1-b365-b213701c11dc.png#averageHue=%23f7f6f6&clientId=u08747114-be79-4&from=paste&height=556&id=HlqPT&originHeight=1390&originWidth=2559&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=197920&status=done&style=none&taskId=u965864e1-4fca-4c72-8003-257f8ca0fd3&title=&width=1023.6)<br />如何使用呢？设置如下。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228251187-af35f22f-4200-42b6-aeb0-91eccd4930cd.png#averageHue=%23f0efee&clientId=u08747114-be79-4&from=paste&height=672&id=hYNu3&originHeight=1679&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=648346&status=done&style=none&taskId=u53138cf8-a316-447a-aef6-9067f4daaf2&title=&width=1536)<br />ip host 182.61.200.7表示只捕获主机IP为182.61.200.7的数据包。获取结果如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228353691-62105d43-8aa2-41b2-8bb4-5b12a4e76cc9.png#averageHue=%236da47a&clientId=u08747114-be79-4&from=paste&height=343&id=uuhLa&originHeight=858&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=269204&status=done&style=none&taskId=ua80e5246-656c-4684-81f9-ce50937ddeb&title=&width=1536)
<a name="ibY7l"></a>
### 2、显示过滤器
显示过滤器是用于在抓取数据包后设置过滤条件进行过滤数据包。<br />通常是在抓取数据包时设置条件相对宽泛或者没有设置导致抓取的数据包内容较多时使用显示过滤器设置条件过滤以方便分析。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228488101-9286f36a-79d7-4907-b263-521914ea02b1.png#averageHue=%23eeeeed&clientId=u08747114-be79-4&from=paste&height=87&id=m8Yv8&originHeight=217&originWidth=1543&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=46597&status=done&style=none&taskId=ua1e3f0bf-fcf5-4021-ad1d-53ba022ecf4&title=&width=617.2)<br />同样上述场景，在捕获时未设置抓包过滤规则直接通过网卡进行抓取所有数据包。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228545490-427b2436-b1dc-4392-89c8-a205094bde4c.png#averageHue=%23f3f3f2&clientId=u08747114-be79-4&from=paste&height=557&id=ulgqY&originHeight=1393&originWidth=2850&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=314008&status=done&style=none&taskId=ua2219153-bf52-4d60-ba71-587560eea2e&title=&width=1140)<br />执行ping www.baidu.com获取的数据包列表如下<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229336765-35b73d11-9115-4b32-bc7f-8ac32ce0ed52.png#averageHue=%2312282f&clientId=u82186b30-9034-4&from=paste&height=365&id=Wb2Yp&originHeight=912&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=412168&status=done&style=none&taskId=ufede4755-de4d-4421-9812-a2088cb8083&title=&width=1536)<br />观察上述获取的数据包列表，含有大量的无效数据。这时可以通过设置显示器过滤条件进行提取分析信息。ip.addr == 183.232.231.172，并进行过滤。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228624506-d1cea011-8646-41b5-9bb1-601352058171.png#averageHue=%236da47a&clientId=u08747114-be79-4&from=paste&height=344&id=lkR7p&originHeight=860&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=269561&status=done&style=none&taskId=u71b2e36f-dc21-4289-81ee-dac218e98b1&title=&width=1536)<br />上述介绍了抓包过滤器和显示过滤器的基本使用方法。在组网不复杂或者流量不大情况下，使用显示器过滤器进行抓包后处理就可以满足使用。下面介绍一下两者间的语法以及它们的区别。
<a name="saQY5"></a>
## 八、Wireshark过滤器表达式的规则
<a name="JxbrZ"></a>
### 1、抓包过滤器语法和实例
抓包过滤器类型Type（host、net、port）、方向Dir（src、dst）、协议Proto（ether、ip、tcp、udp、http、icmp、ftp等）、逻辑运算符（&&与、|| 或、！非）
<a name="SewHw"></a>
#### （1）协议过滤
比较简单，直接在抓包过滤框中直接输入协议名即可。<br />tcp，只显示TCP协议的数据包列表<br />http，只查看HTTP协议的数据包列表<br />icmp，只显示ICMP协议的数据包列表
<a name="DPjdc"></a>
#### （2）IP过滤
host 192.168.1.104<br />src host 192.168.1.104<br />dst host 192.168.1.104
<a name="M621R"></a>
#### （3）端口过滤
port 80<br />src port 80<br />dst port 80
<a name="OlMFa"></a>
#### （4）逻辑运算符&&与、|| 或、!非
src host 192.168.1.104 &&dst port 80 抓取主机地址为192.168.1.80、目的端口为80的数据包<br />host 192.168.1.104 || host 192.168.1.102 抓取主机为192.168.1.104或者192.168.1.102的数据包<br />!broadcast 不抓取广播数据包
<a name="Bkasg"></a>
### 2、显示过滤器语法和实例
<a name="h61Xy"></a>
#### （1）比较操作符
比较操作符有<br />== 等于、!= 不等于、> 大于、< 小于、>= 大于等于、<=小于等于
<a name="iKDEF"></a>
#### （2）协议过滤
比较简单，直接在Filter框中直接输入协议名即可。注意：协议名称需要输入小写。<br />tcp，只显示TCP协议的数据包列表<br />http，只查看HTTP协议的数据包列表<br />icmp，只显示ICMP协议的数据包列表<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693228673197-d38800a6-dad7-4faf-8dd5-f41161df064e.png#averageHue=%23294459&clientId=u08747114-be79-4&from=paste&height=345&id=J78Nz&originHeight=863&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=324424&status=done&style=none&taskId=ud4880e99-fb9a-4db2-b5ea-e00f37c0b92&title=&width=1536)
<a name="uYN6A"></a>
#### （3） ip过滤
ip.src ==112.53.42.42 显示源地址为112.53.42.42的数据包列表<br />ip.dst==112.53.42.42，显示目标地址为112.53.42.42的数据包列表<br />ip.addr == 112.53.42.42 显示源IP地址或目标IP地址为112.53.42.42的数据包列表<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229370735-e6cdf447-247d-4278-9df4-ccac692df77a.png#averageHue=%23aefeaf&clientId=u82186b30-9034-4&from=paste&height=393&id=YnqWn&originHeight=983&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=282054&status=done&style=none&taskId=u73d94a42-85a3-4a00-a6ba-a9ef57049dc&title=&width=1536)
<a name="DX6qi"></a>
#### （4）端口过滤
tcp.port ==80，显示源主机或者目的主机端口为80的数据包列表。<br />tcp.srcport == 80，只显示TCP协议的源主机端口为80的数据包列表。<br />tcp.dstport == 80，只显示TCP协议的目的主机端口为80的数据包列表。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229444859-f9d79ebf-935b-48fd-8c2e-6579d0c97395.png#averageHue=%23e0f9c2&clientId=u82186b30-9034-4&from=paste&height=396&id=L25pI&originHeight=989&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=285451&status=done&style=none&taskId=u2a6dd2fe-1bc4-48d7-b604-69957dc8823&title=&width=1536)
<a name="DpGl3"></a>
#### （5） http模式过滤
http.request.method=="GET"，只显示HTTP GET方法的。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229558898-17f24177-4bc3-470d-9613-512893c21386.png#averageHue=%23fcfcfc&clientId=u82186b30-9034-4&from=paste&height=395&id=u81b72b46&originHeight=988&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=105930&status=done&style=none&taskId=u04d45dfa-10c8-4d8c-81dc-3c1634e9219&title=&width=1536)
<a name="G5FUX"></a>
#### （6）逻辑运算符为 and/or/not
过滤多个条件组合时，使用and/or。比如获取IP地址为192.168.0.104的ICMP数据包表达式为ip.addr == 192.168.0.104 and icmp<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229651814-eb1caadf-5aa6-42e6-8990-e15b08a5e960.png#averageHue=%23aefeaf&clientId=u82186b30-9034-4&from=paste&height=395&id=u9effe851&originHeight=987&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=286639&status=done&style=none&taskId=u7056da64-3f12-4b32-9db8-72384e83bfb&title=&width=1536)
<a name="eUTQD"></a>
#### （7）按照数据包内容过滤
假设要以ICMP层中的内容进行过滤，可以单击选中界面中的码流，在下方进行选中数据。<br />右键单击选中后出现如下界面<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229861957-8d7fc69c-e217-4b33-9275-fee143afb5bd.png#averageHue=%23dfbd7f&clientId=u82186b30-9034-4&from=paste&height=734&id=ub0e900b3&originHeight=1834&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=633745&status=done&style=none&taskId=u4741ec2d-bcb4-438e-b782-62e61397afe&title=&width=1536)<br />选中后在过滤器中显示如下<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229888306-77b898ba-9c0b-470d-a70f-823a5c009399.png#averageHue=%23c0b78d&clientId=u82186b30-9034-4&from=paste&height=50&id=udd51cbd3&originHeight=125&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=23056&status=done&style=none&taskId=u2910c8d2-851f-4e1f-ae28-d85d534aa55&title=&width=1536)<br />后面条件表达式就需要自己填写。如下想过滤出data数据包中包含"abcd"内容的数据流。关键词是contains，完整条件表达式为data contains "abcd"<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693229935722-e8669bea-2cd7-4381-813a-3c2ba1979f17.png#averageHue=%23c5daeb&clientId=u82186b30-9034-4&from=paste&height=394&id=uafeac7dd&originHeight=984&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=339069&status=done&style=none&taskId=ufbdf6469-c1fa-4f4f-96f7-e31f115af38&title=&width=1536)<br />看到这， 基本上对wireshak有了初步了解。
<a name="P4f25"></a>
### 3、常见用显示过滤需求及其对应表达式
<a name="xwDNV"></a>
#### 数据链路层：
筛选mac地址为04:f9:38:ad:13:26的数据包<br />eth.src == 04:f9:38:ad:13:26<br />筛选源mac地址为04:f9:38:ad:13:26的数据包----<br />eth.src == 04:f9:38:ad:13:26
<a name="uLGNy"></a>
#### 网络层：
筛选ip地址为192.168.1.1的数据包<br />ip.addr == 192.168.1.1<br />筛选192.168.1.0网段的数据<br />ip contains "192.168.1"
<a name="msC0H"></a>
#### 传输层：
筛选端口为80的数据包<br />tcp.port == 80<br />筛选12345端口和80端口之间的数据包<br />tcp.port == 12345 &&tcp.port == 80<br />筛选从12345端口到80端口的数据包<br />tcp.srcport == 12345 &&tcp.dstport == 80
<a name="kLkGM"></a>
#### 应用层：
特别说明: http中http.request表示请求头中的第一行（如GET index.jsp HTTP/1.1） http.response表示响应头中的第一行（如HTTP/1.1 200 OK），其他头部都用http.header_name形式。<br />筛选url中包含.php的http数据包<br />http.request.uri contains ".php"<br />筛选内容包含username的http数据包<br />http contains "username"
<a name="qXNhj"></a>
## 九、Wireshark抓包分析TCP三次握手
<a name="wR9uE"></a>
### 1、TCP三次握手连接建立过程
Step1：客户端发送一个SYN=1，ACK=0标志的数据包给服务端，请求进行连接，这是第一次握手；<br />Step2：服务端收到请求并且允许连接的话，就会发送一个SYN=1，ACK=1标志的数据包给发送端，告诉它，可以通讯了，并且让客户端发送一个确认数据包，这是第二次握手；<br />Step3：服务端发送一个SYN=0，ACK=1的数据包给客户端端，告诉它连接已被确认，这就是第三次握手。TCP连接建立，开始通讯。<br />![](https://cdn.nlark.com/yuque/0/2023/jpeg/396745/1693232170882-64807d4c-348a-42f3-8d60-7ad56f2b015e.jpeg)
<a name="vhBsy"></a>
### 2、Wireshark抓包获取访问指定服务端数据包
Step1：启动Wireshark抓包，打开浏览器输入www.baidu.com。<br />Step2：使用ping www.baidu.com获取IP。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230490693-828cffab-6a34-4d93-95a7-986422ca11e2.png#averageHue=%233f3f3f&clientId=u82186b30-9034-4&from=paste&height=162&id=u4a831365&originHeight=405&originWidth=1787&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=285847&status=done&style=none&taskId=uf1710597-9b37-49c0-acb5-7a66606ab5d&title=&width=714.8)<br />Step3：输入过滤条件获取待分析数据包列表 ip.addr == 182.61.200.7<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230472204-d0b533f8-746c-48cb-8427-1bf2e864210a.png#averageHue=%23548268&clientId=u82186b30-9034-4&from=paste&height=394&id=ucb558cff&originHeight=986&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=426978&status=done&style=none&taskId=uf4aa9b3f-42df-4902-be1a-88f80e28a92&title=&width=1536)<br />图中可以看到Wireshark截获到了三次握手的三个数据包。第四个包才是HTTPS的， 这说明HTTPS的确是使用TCP建立连接的。
<a name="rt3v0"></a>
#### 第一次握手数据包
客户端发送一个TCP，标志位为SYN，序列号为0， 代表客户端请求建立连接。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230616078-dda6d5cd-e536-4c97-9bab-a8acb9c02bec.png#averageHue=%23f2f1f1&clientId=u82186b30-9034-4&from=paste&height=734&id=u8d463324&originHeight=1834&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=479734&status=done&style=none&taskId=u4af7be96-c8c1-4212-b766-652ae838317&title=&width=1536)<br />数据包的关键属性如下：<br />SYN：标志位，表示请求建立连接<br />Seq = 0：初始建立连接值为0，数据包的相对序列号从0开始，表示当前还没有发送数据<br />Ack =0：初始建立连接值为0，已经收到包的数量，表示当前没有接收到数据
<a name="iJrfB"></a>
#### 第二次握手的数据包
服务器发回确认包，标志位为 SYN，ACK。将确认序号(Acknowledgement Number)字段+1，即0+1=1。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230691997-14e5cb54-cd8e-4b4e-8d24-b7e0a82b0b75.png#averageHue=%23f1f1f0&clientId=u82186b30-9034-4&from=paste&height=735&id=u8ceba452&originHeight=1838&originWidth=3826&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=533716&status=done&style=none&taskId=u7aa1ab59-801f-4a72-9f51-ed235204a95&title=&width=1530.4)<br />数据包的关键属性如下：<br />[SYN + ACK]：标志位，同意建立连接，并回送SYN+ACK<br />Seq = 0：初始建立值为0，表示当前还没有发送数据<br />Ack = 1：表示当前端成功接收的数据位数，虽然客户端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位。（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据）
<a name="VD4y4"></a>
#### 第三次握手的数据包
客户端再次发送确认包(ACK) SYN标志位为0，ACK标志位为1。并且把服务器发来ACK的序号字段+1，放在确定字段中发送给对方，并且在Flag段写ACK的+1：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230775693-b111d336-74b2-4056-878a-ba96d3e88902.png#averageHue=%23f0efef&clientId=u82186b30-9034-4&from=paste&height=736&id=ua7839b36&originHeight=1839&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=512256&status=done&style=none&taskId=u0b8585de-5077-46bb-ac60-1441a3e7b7e&title=&width=1536)<br />数据包的关键属性如下：<br />ACK：标志位，表示已经收到记录<br />Seq = 1：表示当前已经发送1个数据<br />Ack = 1：表示当前端成功接收的数据位数，虽然服务端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据)。<br />就这样通过了TCP三次握手，建立了连接。开始进行数据交互<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230807604-55102714-6cb3-432e-a5e9-875d02a25723.png#averageHue=%231f3a46&clientId=u82186b30-9034-4&from=paste&height=403&id=u3ffa3b8e&originHeight=1008&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=419058&status=done&style=none&taskId=uadf056c8-34a2-4925-82ab-87e44d990f2&title=&width=1536)
<a name="I5HbY"></a>
## 十、Wireshark分析常用操作
调整数据包列表中时间戳显示格式。调整方法为 视图 -->时间显示格式 --> 日期和时间。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230880570-601400bc-39b5-4eb1-8344-8f7c65cd08d1.png#averageHue=%23e3e3e2&clientId=u82186b30-9034-4&from=paste&height=703&id=ud46200e2&originHeight=1757&originWidth=2391&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=452514&status=done&style=none&taskId=uecc97dd8-45f6-4ab3-905f-66ab33c9b93&title=&width=956.4)<br />调整后格式如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1693230897690-09da7ea5-27c6-4458-b31f-39f50187b732.png#averageHue=%23152a31&clientId=u82186b30-9034-4&from=paste&height=318&id=u359170fb&originHeight=795&originWidth=3840&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=344103&status=done&style=none&taskId=u8e04c844-5c44-4b7f-b90a-695f51d98c3&title=&width=1536)<br />一般Wireshark软件也可以与各主流厂家的模拟器一起使用，更适合于项目准确配置。
<a name="lyicK"></a>
## 十一、Wireshark无法识别SSL/TLS流量，如何用Wireshark打开HTTPS报文
使用Wireshark打开HTTPS流量包，在协议部分看不到SSL/TLS，出现这样的问题，可能是Wireshark配置的SSL/TLS端口和数据包实际的端口不匹配，导致Wireshark不去解析未知端口的SSL/TLS流量信息，可以按如下截图修改。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1695099219846-44f5571a-166a-4fc6-90fa-33383a9775ea.png#averageHue=%23ececeb&clientId=u0dd4da42-1be9-4&from=paste&height=634&id=u691f25f5&originHeight=1586&originWidth=1192&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=200247&status=done&style=none&taskId=udf86c29d-8739-4478-9540-645bfd05e4b&title=&width=476.8)<br />在SSL Ports上加上自定义安全端口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1695099282969-3fe1f819-6e83-4b26-bba3-6d17ec496a3b.png#averageHue=%23efefef&clientId=u0dd4da42-1be9-4&from=paste&height=598&id=ua4da8a1d&originHeight=1494&originWidth=2085&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=194429&status=done&style=none&taskId=ue8491365-edd3-44fa-b1a9-6ed5eee2eee&title=&width=834)
