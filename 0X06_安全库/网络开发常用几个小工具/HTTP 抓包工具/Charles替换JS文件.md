Charles<br />在做 js 逆向的时候，为了方便调试和分析 js 文件，一般将js请求替换为本地自己优化好的 js 文件。<br />这里使用的是比较通用方式通过抓包工具 Charles 进行，请求的替换。
<a name="u6Q1U"></a>
### 0x1 配置Charles
关于Charles的基本配置，就不详细去说了，配置路径如下 Proxy->SSL Proxying Settings->SSL Proxying 勾选 Enable SSL Proxying  点击 ADD 其中  host 填写*，port 填写443。<br />既然想要使用 charles 来对 js 文件进行替换。那么就需要 charles 能够抓到网页的请求，<br />通过下面的配置可以抓取系统中发出的请求:Proxy->macOS Proxy<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866201-94c253d3-0309-42d1-a649-a63bb84f3884.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=u0deff419&originHeight=571&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uf24921ff-3911-4e46-9f13-b71fb1269c8&title=)
<a name="HfqCx"></a>
### 0x2 定位目标js并替换成本地文件
在使用 Charles 抓取请求的过程中，发现浏览器 NetWork 的面板可以抓取到想要的请求，但是 Charles 中确搜不到，经过确认发现，当前的请求走了浏览器的缓存，所以为了避免这种现象，推荐使用谷歌浏览器的访客模式进行访问。<br />通过访客模式成功获取到了目标 js 的请求信息。筛选找到目标请求，右键该请求选择 Map Local 之后出现下面的框。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866305-4d3ab430-e99f-4a60-badb-ea501917dffd.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=uab6653fc&originHeight=608&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u3162dc6a-0424-45a9-906e-e0c8eb303b3&title=)<br />这里就是将请求替换为本地JS的地方，其中 Map From 部分是软件会自动补充完成，只需要关注Map To部分,点击 Choose 选择本地优化好的 JS 文件,然后点击OK，即替换完成。
<a name="uQuHq"></a>
### 0x3 解决跨域错误的问题
为了确认文件是否正的替换了，可以在文件的首行添加个alert(123)。<br />再次打开访客请求之后，观察是否有 123 弹出，事实发现并没有弹窗。<br />查看请求，发现目标请求红了，很明显这是一个错误信息，错误类型为CORS，很明显这个网站不支持跨域请求。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866299-d40428e0-3ae9-41d4-a755-b6c4b1588778.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=uc11b6a1f&originHeight=325&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u26c239ca-c149-4270-90b0-f70e9b38f88&title=)<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866296-13568c73-45fc-4be3-b297-a77b14fd0d18.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=u847dd3b7&originHeight=373&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u9691c56f-c9a3-4df9-982e-3b477ab2ea4&title=)<br />charles 提供的 rewrite 功能,菜单栏 的Tools 里面有个rewrite的功能，可以修改请求信息<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866228-e3571f7d-4b88-4014-a0d8-7e7a653b22bb.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=u64da5860&originHeight=254&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u0c447db2-13b5-4a4c-a0ac-1c90fa2675f&title=)<br />打击Rewrite出现如下窗口，填入的内容如下<br />☑️Enable Rewrite<br />点击 Add 输入规则名称比如这里叫 ALLOW_CORS。<br />之后填写 Location的部分，内容如下<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866622-0fd6d41e-7944-4fb1-b592-5bb725aa92d9.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=u6baaed9c&originHeight=602&originWidth=978&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ub9e30471-fb0d-45e8-b1c7-bd6cdeba34b&title=)<br />紧接着下面的内容填写<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866693-3715d34c-30db-4a78-b9e6-b288937399b8.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=u3c9b792c&originHeight=990&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u55a65764-723b-454f-99df-5ef3cf5045d&title=)<br />最后整体信息如下<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/396745/1655857866674-71b4e689-8740-43d3-8e37-9b0824dc6e47.jpeg#clientId=u028cecb0-0d59-4&from=paste&id=uc50f8f4f&originHeight=789&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u89e3501c-3af2-4772-8b32-5cd34d472bf&title=)<br />至此,整个替换过程就完成了，可以愉快调试了。
