网络安全 Window Linux
<a name="e7f3e935"></a>
## 1、Linux下常用命令
<a name="398410a4"></a>
### 1.1 查看用户信息
<a name="NpFaE"></a>
#### 查看用户信息文件——/etc/passwd   
<a name="dPeQh"></a>
#### 查看影子文件——/etc/shadow  
<a name="y6vxj"></a>
#### 查看系统是否还存在其他的特权账户，uid为0，默认系统只存在root一个特权账户
```bash
awk -F: '$3==0{print $1}' /etc/passwd
```
<a name="LzKFO"></a>
#### 查看当前登录用户（tty 本地登陆  pts 远程登录）
```bash
who
```
<a name="wQIbH"></a>
#### 查看系统信息，想知道某一时刻用户的行为
```bash
w
```
<a name="ZDQTp"></a>
#### 查看登陆多久、多少用户，负载
```bash
uptime
```
<a name="YzsFp"></a>
#### 检查用户是否存在空口令
```bash
passwd  -d username
```
<a name="fcfeb93e"></a>
#### 查看密码文件上一次修改的时间，如果最近被修改过，那就可能存在问题。
```bash
stat /etc/passwd
```
<a name="W3APi"></a>
#### 查看除了不可登录以外的用户都有哪些，有没有新增的
```bash
cat /etc/passwd | grep -v nologin
```
<a name="O6x1a"></a>
#### 查看哪些用户为root权限，有没有新增的
```bash
cat /etc/passwd | grep x:0
```
<a name="QAnuE"></a>
#### 查看哪些用户使用shell
```bash
cat /etc/passwd | grep /bin/bash
```
<a name="DWIY5"></a>
#### 查询可以远程登录的账号
```bash
awk '/\$1|\$6/{print $1}' /etc/shadow
```
<a name="vhzpF"></a>
#### 查询具有sudo权限的账号
```bash
more /etc/sudoers | grep -v  "^#\|^$" grep "ALL=(ALL)"
```
<a name="7fa3c23f"></a>
### 1.2 历史命令
很多的服务器会有存在多用户登陆情况，登陆root用户可查看其他用户的相关账户登录信息,.bash_history保存了用户的登陆所操作的命令信息<br />home/root/.bash_history
<a name="j2Dvv"></a>
#### 查看历史命令
```bash
history
```
<a name="P6FSv"></a>
#### 保存历史命令
```bash
cat .bash_history >>history.txt
```
<a name="fjrMM"></a>
### 1.3 查看端口
```bash
netstat –antp
```
<a name="kGfXC"></a>
#### 查看对应链接的文件路径
```bash
ls -l /proc/pid/exe
```
<a name="BwCXw"></a>
#### 如果知道恶意程序的启动文件大致位置，可以使用这个发现无文件的恶意进程
```bash
ls -l /proc/*/exe | grep xxx
```
<a name="Zp1fg"></a>
#### 通过可疑的ip地址获取程序pid
```bash
netstat -antlp | grep 172.16.222.198 | awk '{print $7}' | cut -f1 -d"/"
```
<a name="GZigO"></a>
### 1.4 查看进程
```bash
ps -aux
```
<a name="H5WTL"></a>
#### 查看相关pid对应程序
```bash
ps –aux | grep pid
```
<a name="IWuof"></a>
#### 监控某一应用线程数（如ssh）
```bash
ps -eLf | grep ssh| wc –l
```
<a name="7QM63"></a>
#### 监控网络客户连接数
```bash
netstat -n | grep tcp | grep 侦听端口 | wc -l
```
<a name="8s24Z"></a>
#### 查看cpu占用率前十的进程，有时候可以发现
```bash
ps aux --sort=pcpu | head -10
```
<a name="Eqrt4"></a>
### 1.5 开机启动项
启动项文件：
```bash
more /etc/rc.local
/etc/rc.d/rc[0~6].d
ls -l /etc/rc.d/rc3.d/
```
<a name="4aa36cba"></a>
### 1.6 定时任务
```bash
crontab  -l
```
<a name="cEgde"></a>
#### 编辑定时任务
```bash
crontab –e
```
<a name="ZT9VW"></a>
#### 查看root用户任务计划
```bash
crontab -u root –l
```
<a name="Jesxh"></a>
#### 查看每个用户自己的执行计划
```bash
ls /var/spool/cron/
```
<a name="FW5cd"></a>
#### 删除计划任务且控制计划任务不能写东西
```bash
sed '/gcc.sh/d' /etc/crontab && chmod 0000 /etc/crontab && chattr +i /etc/crontab
```
<a name="Vw3bf"></a>
#### 常见的定时任务文件
/var/spool/cron/*  #centos的<br />/var/spool/cron/crontabs/* #ubuntu的<br />/var/spool/anacron/*<br />/etc/crontab<br />/etc/anacrontab<br />/etc/cron.hourly/*<br />/etc/cron.daily/*<br />/etc/cron.weekly/<br />/etc/cron.monthly/*
<a name="4f88t"></a>
### 1.7 服务
查看开机启动项目
```bash
chkconfig
```
查看服务自启状态
```bash
chkconfig  --list
systemctl list-unit-files |grep enabled
```
<a name="355fbf7e"></a>
### 1.8 查找文件
<a name="GY8sz"></a>
#### find查找指定的文件
```bash
find /home1 -name *.php ! -name index.php
```
<a name="7FM0j"></a>
#### find查看最近一天修改的文件(查看修改的文件并保存到aa的txt文档)
```bash
find / -mtime -1 > /etc/aa.txt
```
<a name="Q190Q"></a>
#### 查找并删除
```bash
find . -name .svn | xargs rm –rf
```
<a name="f4a9cd81"></a>
#### 查找大于10000k的文件
```bash
find / -size +10000k -print
```
<a name="sLlLM"></a>
#### 查看文件的md5值
```bash
md5sum -b filename
```
<a name="mc0NO"></a>
### 1.9 top命令
top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器。<br />默认top是根据cpu的占用情况进行排序的<br />可通过按“b”键进行切换，可切换到按照内存使用情况进行排序
<a name="78TDz"></a>
#### 监控指定进程
```bash
top  -p pid
```
<a name="0HigY"></a>
#### 查看当前系统内存使用情况
```bash
free
```
```bash
top -b -n1 | head
```
<a name="f973227a"></a>
### 1.10 host文件
有一些挖矿程序会修改 /etc/hosts文件
<a name="AR0mC"></a>
### 1.11 日志分析
默认日志位置：var/log
<a name="WpxfM"></a>
#### 1、定位有多少IP在爆破主机的root帐号
```bash
grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
```
定位有哪些IP在爆破
```bash
grep "Failed password" /var/log/secure|grep -E -o "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"|uniq -c
```
爆破用户名字典内容
```bash
grep "Failed password" /var/log/secure|perl -e 'while($_=<>){ /for(.*?) from/; print "$1\n";}'|uniq -c|sort -nr
```
<a name="oDAN5"></a>
#### 2、登录成功的IP有哪些
```bash
grep "Accepted " /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
```
登录成功的日期、用户名、IP：
```bash
grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}'
```
Linux中的命令，Diff,可以查看两个文本文件的差异。
<a name="GBAlK"></a>
### 1.12 查看命令状态
很多情况下，存在ps、netstat等一些常见命令被替换，可利用stat查看该状态，查看其修改时间
```bash
stat /bin/netstat
```
<a name="dvb1u"></a>
### 1.13 文件清除
很多时候会遇到无法查看文件权限或是病毒在一直向某个文件写入程序，可尝试如下命令：<br />`lsattr [恶意文件绝对路径]`命令查看权限，<br />使用`chattr -i [恶意文件绝对路径]`解除文件锁定后删除。
```
chmod 0000 /lib/libudev.so && rm -rf /lib/libudev.so && chattr +i /lib/（chattr +i不让lib文件被写入删除）
```
结束某一进程：
```bash
kill -9 pid
```
<a name="XdxGD"></a>
## 2、Window下常用命令
<a name="0aD0P"></a>
### 2.1 账号安全
查看当前登录账户
```powershell
query user
```
logoff ID 注销用户id<br />net  user 查看用户<br />net user username 查看用户登录情况<br />lusrmgr.msc 打开本地用户组<br />regedit注册表查看账户，确认系统是否存在隐藏账户<br />利用LogParser.exe查看event日志，查询用户登录情况
```powershell
LogParser.exe -i:EVT "SELECT TimeGenerated,EXTRACT_TOKEN(Strings,5,'|') AS USERNAME,EXTRACT_TOKEN(Strings,5,'|') AS SERVICE_NAME,EXTRACT_TOKEN(Strings,5,'|') AS Client_IP FROM 'C:\Users\haha\Desktop\Security.evtx' WHERE EventID=4624"
```
<a name="muBes"></a>
### 2.2 检查异常端口进程
<a name="TjeJj"></a>
#### 查看目前连接
```powershell
netstat  -ano
```
<a name="ii6bV"></a>
#### 查看已经成功建立的连接
```powershell
netstat -ano | findstr "ESTABLISHED"
```
<a name="PFg2e"></a>
#### 根据pid定位程序名称
```powershell
tasklist | findstr  "pid"
```
运行中输入msinfo32，可打开系统信息，在“正在运行任务”中可获取进程详细信息，包括进程的开始时间、版本、大小等信息。
<a name="XhQ3u"></a>
#### 根据端口查看pid
```powershell
netstat -ano | findstr "8080"
```
<a name="qFAVL"></a>
#### 利用wmic查看进程执行时的命令
```powershell
Wmic process where name='irefox.exe' get name,Caption,executablepath,CommandLine ,processid,ParentProcessId  /value
```

```
Wmic process where processid='2040' get name,Caption,executablepath,CommandLine ,processid,ParentProcessId  /value
```
<a name="f9590223"></a>
### 2.3 启动项检查
msconfig查看系统启动项<br />查看注册表是否有异常启动项<br />HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run<br />HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce
<a name="lfE8X"></a>
### 2.4 查看系统定时任务
Cmd下运行`schtasks`（win7系统利用at），查看定时任务<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/396745/1614174058741-34b5e913-412a-45c7-8953-96a4fc75c5ce.png#align=left&display=inline&height=583&originHeight=1750&originWidth=3323&size=2084676&status=done&style=none&width=1107.6666666666667)<br />C:\Windows\System32\Tasks  查看任务清单<br />删除任务计划<br />建议删除任务计划时以管理员登录<br />`SchTasks /Delete /TN  任务计划名称`
<a name="GJk6e"></a>
### 2.5 查看系统服务——`Services.msc`
删除服务可从任务管理器中手动删除，也可使用命令：<br />sc stop [服务名称]停止服务后，<br />sc delete [服务名称]删除服务
<a name="Gq4yk"></a>
### 2.6 文件查看
查看最近打开的文件，文件管理器路径中输入`%UserProfile%\Recent`<br />查看C:\Documents and Settings，C:\Users下是否存在可疑用户或文件
