Kubernetes<br />Kubernetes 是一个功能强大的容器编排平台，用于自动部署、管理和扩缩容复杂的应用程序。官方提供了一款**命令行工具 Kubectl，允许用户使用 CLI （命令行界面）与 Kubernetes 集群进行交互。**<br />这些年来，Kubectl 已经与开源社区开发的其他工具深度结合，不仅改善了用户体验，也让我们的生产工作变得更加高效。下面将介绍几个方便大家使用 Kubernetes 的有力工具，供大家参考。
> 为了方便测试以下工具，建议在本机使用 kind 创建一个 Kubernetes 集群，使用 kind 可以便于安装 Kubernetes 集群，并且在结束时容易清理。

```bash
# install kind
brew install kind
# create cluster
kind create cluster --name playground --image kindest/node:v1.21.14
```
<a name="SuRcX"></a>
## 1、K9s
**K9s 是一个可以和 K8s 集群进行交互的终端 UI 。**它可以轻松浏览 namespace、services 、 deployments 等，并持续监视 Kubernetes 的变化，使得管理应用程序变得更加容易。
```bash
brew install k9s
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039196-73357a49-c33c-4fc7-8a29-c6efa55b2f78.png#clientId=u7b6bf4d7-7558-4&from=paste&id=ud1bafa48&originHeight=566&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ued009f12-7193-4bce-8bc7-4fe9734bddd&title=)
<a name="Gm0Kr"></a>
## **2、Popeye**
**Popeye 是一个开源工具，可以扫描实时的 Kubernetes 集群，并且可以报告部署过的资源及配置的潜在问题。**它根据部署的内容来清理群集。通过扫描集群检测出配置错误，并帮助我们保证最佳实践。此外，如果 Kubernetes 集群过载，它会报告分配过多/分配不足的资源，在集群容量不足时发出警告。
```bash
# Install
brew install derailed/popeye/popeye
# Run
popeye
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039212-83be2661-83d0-41a0-b86a-72898f38be76.png#clientId=u7b6bf4d7-7558-4&from=paste&id=u609d1f42&originHeight=796&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ufd919ed5-a800-418e-93a9-00bbffd738a&title=)
<a name="uDToQ"></a>
## **3、Kube-bench**
Kube-bench 也是一个方便使用的工具，**通过 CIS Kubernetes Benchmark 测试中的记录，检查 Kubernetes 集群是否安全部署。**
```bash
# Run kube-bench as a job and inspect the logs
curl https://raw.githubusercontent.com/aquasecurity/kube-bench/main/job.yaml | kubectl apply -f -
# get the logs, replace <kube-bench-95cf7> with your pod id
kubectl logs kube-bench-95cf7 -f
```
Job 运行后，只需选择容器并检查日志即可。同样的，我们在处理群集时可以使用 K9s 快速观察群集。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039207-639ce0b6-0f23-4d60-ab13-84d1976b01bf.png#clientId=u7b6bf4d7-7558-4&from=paste&id=ud4b479b8&originHeight=775&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u24132be8-1c16-447d-bb87-387e174d068&title=)
<a name="DHLo0"></a>
## **4、Kubectx Kubens and fzf**
通常情况下，可能会拥有多套集群，开发/测试/生产，本地或云集群。可以**使用 Kubectx 和 Kubens 快速地在不同的集群和 namespace 直接切换**。除此之外，** fzf 提供了交互的方式来切换上下文**，因此不必记住任何集群或 namespace。
```bash
# Install kubectx, kubens, fzf
brew install kubectx fzf
# Switch between namespaces
kubens
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039262-60e018f9-dfe9-4b42-ad75-f0836c58c888.png#clientId=u7b6bf4d7-7558-4&from=paste&id=u5be33be2&originHeight=232&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=udc163bc4-9743-441c-b82b-2361d8fe1da&title=)
<a name="E9Yw5"></a>
## **5、Stern**
**Stern 允许在 Kubernetes 上使用多个 Pod ，从不同的 Pod 收集日志，并通过颜色进行区分。**<br />该查询是一个正则表达式，不需要指定确切的 ID，也可以轻松筛选出 Pod 名称。如果一个 Pod 被删除，它就会从尾部移除，如果添加了一个新的 Pod，它会自动被拖到尾部。当一个 Pod 包含多个容器时，Stern 也可以直接查看 Pod 中所有容器的日志，而不必一个个单独查看。
```bash
# Install
brew install stern
# stern <keyword>
stern deploy
```
在此示例中有 3 个副本，可以通过选择带有关键字的 Pod，来聚合日志。如图所见，每个 Pod 对应不同的颜色。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039217-959abe27-e0f9-4046-bb7f-e00cabba3c2b.png#clientId=u7b6bf4d7-7558-4&from=paste&id=u8858faaa&originHeight=740&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u73eea650-a6f4-49b7-bda9-39c618b0400&title=)
<a name="oJDKE"></a>
## **6、Bat**
**Bat 可以为我们在 shell 环境中查看 yaml 时，提供语法高亮提示。**
```bash
# Install bat
brew install bat# Explore themes
bat --list-themes# Bat a file
bat deployment.yaml
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1666186039511-831a8269-2076-432c-b54b-294667c14816.png#clientId=u7b6bf4d7-7558-4&from=paste&id=uaa62016c&originHeight=510&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0036ad74-46e1-4f7e-a413-201f66a40f7&title=)
<a name="Q7CNg"></a>
## 参考链接
**kind (k8s.io): **[https://kind.sigs.k8s.io/](https://kind.sigs.k8s.io/)<br />**GitHub - derailed/k9s: Kubernetes CLI To Manage Your Clusters In Style!: **[https://github.com/derailed/k9s](https://github.com/derailed/k9s)<br />**GitHub - derailed/popeye: A Kubernetes cluster resource sanitizer: **[https://github.com/derailed/popeye](https://github.com/derailed/popeye)<br />**GitHub - aquasecurity/kube-bench: Checks whether Kubernetes is deployed according to security best practices as defined in the CIS Kubernetes Benchmark: **[https://github.com/aquasecurity/kube-bench](https://github.com/aquasecurity/kube-bench)<br />**GitHub - ahmetb/kubectx: Faster way to switch between clusters and namespaces in kubectl: **[https://github.com/ahmetb/kubectx](https://github.com/ahmetb/kubectx)<br />**GitHub - wercker/stern: Multi pod and container log tailing for Kubernetes:** [https://github.com/wercker/stern](https://github.com/wercker/stern)<br />**GitHub - sharkdp/bat: A cat clone with wings: **[https://github.com/sharkdp/bat](https://github.com/sharkdp/bat)
