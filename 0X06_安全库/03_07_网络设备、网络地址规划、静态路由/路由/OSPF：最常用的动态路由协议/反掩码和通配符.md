网络
<a name="EjN8b"></a>
### 网络掩码
网络掩码，大家很熟悉。格式跟 IP 地址一样，是 32 位的二进制数，网络部分用 1 表示，主机部分用 0 表示，和 IP 地址同时使用才有意义。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457098-113d5bed-f770-4634-91ae-b1a1c0e968a5.png#clientId=u6563fe83-98c4-4&from=paste&id=ud6313ee0&originHeight=91&originWidth=461&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ud1aeb1b9-488f-4721-91a6-76ac832ae01&title=)<br />可以发现，网络掩码是由 1 和 0 组成，而且 1 和 0 都是连续的。左边的 1 表示网络位，右边的 0 表示主机位。<br />如果 1 和 0 不是连续的，就是错误的网络掩码，无法正确识别网络子网。比如 255.0.255.0 和 255.170.0.0 。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457165-898a1971-2e33-4eb7-ad01-942e4bac6626.png#clientId=u6563fe83-98c4-4&from=paste&id=u19448550&originHeight=51&originWidth=351&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub249f77d-9a0d-486d-aa55-662d2fe17d5&title=)
<a name="bZrzb"></a>
### 反掩码
接口激活 OSPF 的方法之一，是在区域视图下，使用 network 命令，再加上 IP 地址和通配符掩码。关于通配符掩码，解释的比较粗略：比特位为 0 的需要匹配，比特位为 1 的不需要匹配。这里来深挖一下，查看下产品手册，network 命令说明如下：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457129-1b907a4c-bd7c-4722-8473-cefea91ec08c.png#clientId=u6563fe83-98c4-4&from=paste&id=ue983ab7e&originHeight=560&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u142b5cec-9f36-41cc-8647-36fbdc7adf0&title=)<br />再来看看设备命令行下的提示：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457159-935fe07f-bbd7-45fd-bc44-4cfc341d06d8.png#clientId=u6563fe83-98c4-4&from=paste&id=ue94930a2&originHeight=150&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u4930441d-c85a-4edf-a547-8088efba39f&title=)<br />这里就发现有意思的现象，产品手册上的 wildcard mask ，而设备提示的 wild card bits ，既可以翻译为反掩码，又可以翻译为通配符。但是，反掩码和通配符，其实是两个概念，产品手册上的解释：把 IP 地址的掩码反转（ 0 变 1 ，1 变 0 ），其实就是反掩码的意思。<br />那么这里是要填反掩码还是填通配符呢？最有效的方法，就是上设备去敲命令，分别输入反掩码和通配符，看下命令能否配置成功。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457157-bf791e66-e322-40cb-b39d-4b983e09c284.png#clientId=u6563fe83-98c4-4&from=paste&id=u7a3789a9&originHeight=299&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u7a80b5a9-88e2-408d-9e89-c8c6d0e4734&title=)<br />破案了！反掩码，配置成功。通配符，配置失败，错误提示：网络掩码无效，网络掩码必须要是连续的。<br />结论：激活接口 OSPF ，是使用反掩码，而非通配符。
<a name="HyO4r"></a>
### 通配符
那什么是通配符呢？通配符，格式跟网络掩码一样，要跟 IP 地址结合使用，也是由 0 和 1 组成，0 和 1 可以任意组合，不一定要连续的。0 是需要匹配，1 就不需要匹配。<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457434-eba19e3c-99ac-40cb-9b0e-6771fef1a2af.png#clientId=u6563fe83-98c4-4&from=paste&id=ufcdd89a4&originHeight=71&originWidth=101&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ufe50fdfe-0ea7-4417-b6f6-8b3b0d090d8&title=)<br />上面的都是通配符，来查找资料和动手实操，验证一下即可。通配符，通常用于 ACL 。先来看看产品手册上的使用说明：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457551-e2ba90c9-f007-49f8-9e3c-98861856a990.png#clientId=u6563fe83-98c4-4&from=paste&id=u037219af&originHeight=332&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u045d1e8f-a0ed-4ab6-8abc-9fd0578eb07&title=)<br />这里还特意对通配符进行了解释，以及举例说明。再看看设备命令行上的说明：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457662-15bdbfcf-97ef-44cd-88b9-1f145ec2a714.png#clientId=u6563fe83-98c4-4&from=paste&id=u59a2d315&originHeight=238&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubd968969-3830-41de-a8fa-7b78d0d321c&title=)<br />命令行提示说明，第一行表示源的通配符，第二行 0.0.0.0 表示主机地址，也就是 IP 地址全匹配。<br />对比名词解释，通配符的范围是大于反掩码的，也就是说，能使用通配符，那就一定能够使用反掩码。下面就来试试，在设备配置上面的四个通配符：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457599-dacef106-4136-4fd2-9e02-b720413c8b17.png#clientId=u6563fe83-98c4-4&from=paste&id=uc4f34355&originHeight=608&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u4b44c0ca-4290-49b3-91e7-f94149d4401&title=)<br />这时，可以发现配置命令全生效了，而且 ACL 的配置还产生了对应的变化。以 rule permit source 4.4.4.4 1.2.3.4 为例，说明下配置变化的原因：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457540-a436a919-a2a6-4dcd-b2a2-48a7326bb8d4.png#clientId=u6563fe83-98c4-4&from=paste&id=u47fe7ca2&originHeight=62&originWidth=512&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uc722d0f5-1df5-4772-92ea-4ece9adc97c&title=)<br />通配符原则：0 必须匹配，也就是值不能变，1 无需匹配，也就是值可以变化。所以 ACL 匹配的 IP 地址变为 4.4.4.0 。也因为 1 无需匹配，就有多种可能，所以也可以表示为 5.4.4.0 或 5.6.7.4 等。<br />结论：配置 ACL ，使用通配符。
<a name="IxgKo"></a>
### 总结
对比掩码、反掩码、通配符：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457814-8d0abcb5-d266-436d-9929-58e5cdd8f416.png#clientId=u6563fe83-98c4-4&from=paste&id=ub3cf42d3&originHeight=161&originWidth=541&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uda9ade86-de94-4483-a37e-ed2e846d435&title=)<br />常用的通配符：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1648347457949-60bad21d-e621-4b11-ab89-58e8f6500820.png#clientId=u6563fe83-98c4-4&from=paste&id=u088aced9&originHeight=291&originWidth=561&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub03bdb95-2b2a-4a9a-a0bc-aadfca193da&title=)
