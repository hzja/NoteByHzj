网络 MAC地址表 ARP表 路由表<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058741-24604646-1d70-46a9-8514-45235aa8081e.webp#clientId=udf2af8d3-002f-4&from=paste&id=u2e7ed645&originHeight=301&originWidth=566&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u512bc414-72e3-42d3-9bfc-f54c1783dc2&title=)
<a name="pns83"></a>
### MAC地址表
**MAC地址表**：简单的说，MAC地址表是交换机等网络设备记录MAC地址和端口的映射关系(见下图)，代表了交换机从哪个端口学习到了某个MAC地址，交换机把这个信息记录下来，后续交换机需要转发数据的时候就可以根据报文的目的MAC地址去根据MAC地址表转发数据。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058537-4858c01d-897c-43eb-a8a6-6e9aedd29646.webp#clientId=udf2af8d3-002f-4&from=paste&id=u9716fcad&originHeight=152&originWidth=362&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u10389c99-be5b-4847-abfd-5e57daa6e55&title=)<br />在华为网络设备上可以通过`**dis mac-address**`** **查看本地mac的地址表的信息，通过下图的显示可以知道mac地址 5489-98b1-79f4 是从G0/0/2端口学习到的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058662-d927fbe8-b681-4115-a7ee-ee77ba490068.webp#clientId=udf2af8d3-002f-4&from=paste&id=u25721d68&originHeight=548&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ua5561d3e-6e03-487e-b577-9755477103a&title=)
<a name="IpnEx"></a>
### ARP表
**ARP表**：简单的说，ARP表就是路由器等网络设备记录**IP地址和MAC地址对应关系的表项**（如下图）。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058521-7e34016d-f7dd-4fe2-9ca9-f891f70323d1.webp#clientId=udf2af8d3-002f-4&from=paste&id=u51750af5&originHeight=152&originWidth=482&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ud603a57f-964e-451b-a190-e749bec6405&title=)<br />当需要转发数据的时候除了**需要对方的目的IP地址，还需要知道对方的MAC地址**，那么正常情况下优先会在本地ARP表中查看是否有目的IP对应的MAC地址。<br />在华为网络设备上可以通过`**dis arp**`** **查看本地arp表的信息，通过下图的显示可以知道mac地址 5489-98b1-79f4 是对应的IP地址是192.168.1.2 ；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058808-82fccb74-05b6-4e25-95ce-37a7a83f0b75.webp#clientId=udf2af8d3-002f-4&from=paste&id=u577a2ad7&originHeight=548&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=udc8f7e4c-b354-4845-971c-1859d882c94&title=)
<a name="sRMr7"></a>
### 路由表
**路由表**：简单点说路由表就是路由器用于指导数据包如何转发的表项，记录了去往目的IP的下一跳去哪里（如下图）。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501058840-90d9748b-8dde-4947-a8e3-9412230672aa.webp#clientId=udf2af8d3-002f-4&from=paste&id=u1f410208&originHeight=101&originWidth=721&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ua2f59da3-d8d1-444c-acf4-951cb60ce8a&title=)<br />路由表的作用类似于生活中的地图，指引去往一个目的地该如何走?<br />在华为网络设备上可以通过`**display  ip routing-table**` 查看本地路由表的信息，通过下图的显示可以知道去往目的192.168.2.0/24 的下一跳是10.1.1.2 ；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059149-f34c25da-25cc-4d4c-9355-648d991b2c1b.webp#clientId=udf2af8d3-002f-4&from=paste&id=u6ad21298&originHeight=544&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u7f24d979-8bb6-43c1-bc5e-7e29047a877&title=)
<a name="yoXvo"></a>
### 案例一：PC1和PC2二层互访通信过程详解
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059092-cc9593ae-6501-433b-bc6d-0cb7f1ab6ffc.webp#clientId=udf2af8d3-002f-4&from=paste&id=ua17e7396&originHeight=366&originWidth=519&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uf134fe32-2b58-4fa5-811b-708266fce86&title=)<br />如上图的网络拓扑，PC1和PC2通过交换机SW1互联，PC1 的IP地址为192.168.1.1/24 ，PC2的IP地址为192.168.1.2/24 ，那么PC1和PC2的通信就是简单的二层通信（二层通信不涉及路由表），下面从ARP表和MAC地址表的角度详细解析下这个通信过程。<br />**下面来详细分析下：**<br />1、PC1要想访问PC2，除了需要知道目的IP 192.168.1.2 以外，还需要知道PC2 的mac地址，因为所有的数据通信都是基于TCP/IP参考模型的，需要对进行数据封装。<br />首先PC1会查找自己的ARP表项看是否有目的IP 192.168.1.2 对应的MAC地址，查看发现是空的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059296-e76452b5-03fe-44e1-b88d-c912fa7a3d1a.webp#clientId=udf2af8d3-002f-4&from=paste&id=u656f2da0&originHeight=558&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ud3a3a538-157b-4e69-867f-281b430c2cc&title=)<br />2、如果不知道对方的mac地址，PC1会发送ARP广播报文，询问谁知道目的IP 192.168.1.2 对应的MAC地址(如下图所示)。PC2收到ARP广播报文会进行回应，告诉PC1他的MAC地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059271-9b13666a-4057-49b8-93ed-f310d9ffe391.webp#clientId=udf2af8d3-002f-4&from=paste&id=ub3fc62c2&originHeight=38&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u70f21a15-10cb-48fa-b570-b88ae12b942&title=)<br />**附：**<br />在PC1发送ARP 广播报文的时候，交换机SW1收到该报文，会在MAC地址表中根据报文的源mac地址记录下PC1 的mac地址和GE0/0/1的映射关系；PC2发送回应报文的时候 交换机SW1也会记录下PC2 的mac地址和GE0/0/2的映射关系（如下图）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059318-82427970-e577-4a16-adef-581320747814.webp#clientId=udf2af8d3-002f-4&from=paste&id=u420b9c76&originHeight=554&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ub865d9db-6c0e-4cd2-8852-27b5cd54a52&title=)<br />3、可以看到PC1的本地ARP表项中学习到了PC2的mac地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059537-3bf1cb0a-1987-49fd-9646-921dc267ad60.webp#clientId=udf2af8d3-002f-4&from=paste&id=u8ef8a933&originHeight=565&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uc28bec73-86d1-4869-ad13-1fdba661da8&title=)<br />4、这样PC1就可以根据PC2的MAC地址封装数据发送给交换机SW1，交换机SW1会查找自己的MAC地址表，发现去往PC2的MAC地址的出接口为GE0/0/2，从而PC2就可以收到报文，并进行解封装；
<a name="yOwnY"></a>
### 案例二：PC3和PC4三层互访通信过程详解
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059536-e37d6c1a-940c-4753-8e30-7b8f169f30d9.webp#clientId=udf2af8d3-002f-4&from=paste&id=u24bf7d0a&originHeight=295&originWidth=615&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u919724fd-f3ca-41da-8199-41799bbcdd7&title=)<br />如上图的网络拓扑，PC3和PC4通过路由器R1、R2互联，PC3 的IP地址为192.168.1.2/24 网关192.168.1.1 ，PC4 的IP地址为192.168.2.2/24 网关192.168.2.1，那么PC1和PC2的通信就是跨网段三层通信，下面从ARP表、MAC地址表、路由表的角度详细解析下这个通信过程。<br />**下面来详细分析下：**<br />1、PC3要想访问PC4，由于是跨网段通信，PC3需要首先把数据包发送给PC3的网关。PC3会查找自己的ARP表项看是否有网关IP192.168.1.1对应的MAC地址，查看发现是空的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059804-c4e57fa3-eb56-407b-8495-4026825f0950.webp#clientId=udf2af8d3-002f-4&from=paste&id=ucdf4d2e1&originHeight=553&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u62af65f4-1c4c-45c2-a787-bf586a168f9&title=)<br />2、如果不知道对方的mac地址，PC3会发送ARP广播报文，询问谁知道目的IP 192.168.1.1 对应的MAC地址(如下图所示)。R1收到ARP广播报文会进行回应，告诉PC3 他的网关的MAC地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059893-df29b06f-49f6-46e7-ad37-a6414d2f2d70.webp#clientId=udf2af8d3-002f-4&from=paste&id=u9d9f2611&originHeight=40&originWidth=970&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u44b48027-5d9e-4fc9-b66b-3dacf2af070&title=)<br />3、可以看到PC3的本地ARP表项中学习到了网关的mac地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059862-baa22283-ff2a-4ad6-9c6e-10fa9416f4ba.webp#clientId=udf2af8d3-002f-4&from=paste&id=ued139bce&originHeight=552&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u897729eb-24e7-4f0a-a744-2e6b65b2693&title=)<br />4、这样PC3就可以根据网关MAC地址封装数据发送给R1，R1收到数据包会进行解封装，解封装发现目的IP是PC4，不是发给自己的，从而会查找自己的路由表，发现去往PC4的下一跳是10.1.1.2；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501059833-cf2ee8ba-bec8-4e6e-b6ac-34d046a14e8f.webp#clientId=udf2af8d3-002f-4&from=paste&id=u6ba1d72e&originHeight=551&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u03c7e95f-d51e-47d4-ad7f-131ee782e0b&title=)<br />5、R1需要把数据进行封装发送给R2的10.1.1.2 ，因此需要请求10.1.1.2 对应的MAC地址用于封装（可以看到R1的ARP表中已经有10.1.1.2 对应的MAC地址，因此可以直接封装）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501060377-5f46fa95-c643-4d02-9907-a23be1645ee5.webp#clientId=udf2af8d3-002f-4&from=paste&id=ua4061e33&originHeight=557&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u1b731447-ea7a-4593-be4c-506288ee436&title=)<br />6、R2收到R1的数据包，需要进行解封装，解封装发现目的IP是PC4，通过查找自己的路由表，发现去往PC4是自己的直连端口；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501060175-5a1634f7-b4cc-4766-aeae-c1dad7b156e1.webp#clientId=udf2af8d3-002f-4&from=paste&id=u7c806135&originHeight=550&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u10d68d71-c834-4bd5-815d-4e99e84b436&title=)<br />7、R2需要把数据进行封装发送给PC4 ，因此需要请求PC4 192.168.2.2  对应的MAC地址用于封装（可以看到R2的ARP表中已经有192.168.2.2对应的MAC地址，因此可以直接封装）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1638501060548-d3eed7f6-c79e-47fb-82f0-89a2e0497f9a.webp#clientId=udf2af8d3-002f-4&from=paste&id=ud8d593d5&originHeight=560&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u320f7763-4b7c-47d9-b09b-360c6d3e1c0&title=)<br />8、最后PC4收到报文进行解封装发现就是发送给自己的，通信结束；
