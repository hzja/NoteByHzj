最近看到个不错的项目<br />[https://github.com/JoyChou93/java-sec-code](https://github.com/JoyChou93/java-sec-code)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625456518995-1e381678-932f-4990-8594-1bb9e4a1a101.png#align=left&display=inline&height=616&originHeight=820&originWidth=486&size=29741&status=done&style=none&width=365)<br />话不多说直接搭建靶场
<a name="NOYX4"></a>
## 搭建
源码下来后直接maven包本地部署<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625456575583-d7e7b46e-b36b-4f81-9321-1383b09b3de3.png#align=left&display=inline&height=567&originHeight=756&originWidth=1637&size=145053&status=done&style=none&width=1228)<br />插入数据库内容。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625456692291-4591825c-5e64-4b11-ae36-941a0bdf0651.png#align=left&display=inline&height=740&originHeight=986&originWidth=672&size=74811&status=done&style=none&width=504)<br />idea运行起来，要注意端口占用的情况，需要修改端口号。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625456902601-76523a86-2e3b-4d48-a585-ac853f7f1832.png#align=left&display=inline&height=502&originHeight=669&originWidth=1234&size=60424&status=done&style=none&width=926)

<a name="T0ha7"></a>
## SQL注入
关于mybatsic需要深入学习。<br />因为是ssm框架，直接在mapper.xml文件看$符号。发现问题：<br />**select _* _from users where username like '%${_parameter}%'**<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625502624690-2d34996b-eede-4066-87f6-0181cd4ea265.png#align=left&display=inline&height=504&originHeight=672&originWidth=997&size=67741&status=done&style=none&width=748)<br />对**findByUserNameVuln02方法进行回溯找传入的参数**<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625502766977-76b0ec17-e387-486e-9cfa-90a2bcd243dc.png#align=left&display=inline&height=371&originHeight=742&originWidth=1279&size=131302&status=done&style=none&width=639.5)**<br />在UserMapper.java中，定义了**findByUserNameVuln02**方法。所以下一步需要找controller层对该方法的实现。看哪里实现了UserMapper接口。**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625502874498-a188b611-7440-4c3b-bec6-4c37c847b156.png#align=left&display=inline&height=512&originHeight=682&originWidth=978&size=56995&status=done&style=none&width=734)**<br />直接ctrl+左，查看findByUserNameVuln02方法在哪被调用。直接跳到SQLI.java(controller层) 路径是**/mybatis/vuln02 ，传入参数是username**<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625503024960-5ca20b78-8435-4c0a-99ef-a3e78acbe829.png#align=left&display=inline&height=356&originHeight=475&originWidth=1004&size=49937&status=done&style=none&width=753)**<br />**但是这个是二级路径，需要找到最开始的根路径 所以，路径是/sqli/mybatis/vuln02**<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625503177846-fa9dde95-50a2-44cc-b4f1-eea1b453b4a7.png#align=left&display=inline&height=365&originHeight=486&originWidth=697&size=29965&status=done&style=none&width=523)**<br />**sql注入审计完成。**<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625503237682-40906e42-472d-4ce8-9c44-27ba2efe28ab.png#align=left&display=inline&height=283&originHeight=377&originWidth=949&size=29118&status=done&style=none&width=712)**
<a name="B0wOh"></a>
## 任意文件读取
漏洞路径  http://172.22.1.134:8080/path_traversal/vul?filepath=<br />像这种文件读取，没有前后端交互的话，代码不会很复杂，直接看实现的文件就可以解决。<br />/controller/PathTraversal.java<br />定义了路径，filepath参数会传入getImgBase64() <br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625586220990-9e3692b6-327c-44f8-b728-550d845d60dd.png#align=left&display=inline&height=236&originHeight=315&originWidth=943&size=28228&status=done&style=none&width=707)<br />直接跟进getImgBase64()方法。logger是日志打印的东西，可以直接不用看，判断语句是如果imFile存在并且是非文件夹，就执行readAllBytes()进行读取。并且以base64加密的方式输出。<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625587172864-ea1e5e20-93d9-41e2-9611-a0fded755b87.png#align=left&display=inline&height=230&originHeight=307&originWidth=708&size=24709&status=done&style=none&width=531)**<br />进行解码，文件可以读取<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625587271680-6c5a896e-dcde-4ffc-8a3f-09568b5368a6.png#align=left&display=inline&height=105&originHeight=140&originWidth=943&size=11545&status=done&style=none&width=707)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625587286086-8421352b-d6f4-4e6c-896d-23b0f6f2c364.png#align=left&display=inline&height=68&originHeight=90&originWidth=604&size=8278&status=done&style=none&width=453)**
<a name="X4JRA"></a>
## 任意文件上传
getOriginalFilename没有被进行白名单过滤。导致任意文件上传。<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625672072194-3542bd46-2f9a-457b-8f99-6fce69c485c0.png#align=left&display=inline&height=395&originHeight=526&originWidth=1036&size=56520&status=done&style=none&width=777)**<br />**防护：**<br />对后缀进行白名单校验。如下图第二步<br />**![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1625672501612-7649733a-1e1c-4e7b-824e-ca24aab54c05.png#align=left&display=inline&height=341&originHeight=681&originWidth=1428&size=87488&status=done&style=none&width=714)**
