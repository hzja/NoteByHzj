[https://xz.aliyun.com/t/4290](https://xz.aliyun.com/t/4290)<br />[http://www.jrasp.com/](http://www.jrasp.com/)       国内技术领先的开源RASP社区  <br />[https://blog.csdn.net/weixin_45492007/article/details/118052979](https://blog.csdn.net/weixin_45492007/article/details/118052979)  使用-javaagent方式实现修改方法内容

1、在java中，字节码需要经过JVM转译成机械码之后，cpu才能读取并运行, 生成的 .class 文件中的内容，就是 JVM 可以处理运行的字节码 <br />2、java语言中的rasp是通过java agent实现的<br />3、RASP的检测和保护功能是在应用程序运行的系统上运行的  <br />4、java agent的部署方式有2种：premain方式和agentmain方式  ![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692529672801-dd2db0b2-7112-456b-9b01-38ba7c038599.png#averageHue=%23f9f7f5&clientId=u8ba66932-ee1d-4&from=paste&height=116&id=uf6d04dad&originHeight=145&originWidth=403&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=12413&status=done&style=none&taskId=u6cd5d299-13f4-46e3-bc8c-bbf16c5061c&title=&width=322.4)

premain方式<br />rasp的实现原理就是在执行程序A的时候，用java agent,其实就是在<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692526976511-b0e0395b-6f22-44d1-bac0-cd9fe8a0b0e5.png#averageHue=%23f5f5f5&clientId=uec7d1e4d-4aed-4&from=paste&height=457&id=udff90aec&originHeight=571&originWidth=797&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=77704&status=done&style=none&taskId=u251446cb-6ce2-4b68-aaf2-4352621e38c&title=&width=637.6)

1、Main.class和agent.mf生成agent.jar<br />jar cvfm agent.jar agent.mf Main.class<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692527546858-72aec4d1-03d6-4763-87ea-d8d1bcac0957.png#averageHue=%23faf9f8&clientId=uec7d1e4d-4aed-4&from=paste&height=383&id=ub1350b03&originHeight=479&originWidth=1267&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=69189&status=done&style=none&taskId=ua288472e-d35d-4ca1-81b0-de18f53eec5&title=&width=1013.6)
```
Manifest-Version: 1.0
Premain-Class: Main
```

2、hello就是模拟正常的java程序<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692527605370-a0f39263-26cc-4dc3-9132-56714f64d6f8.png#averageHue=%23faf9f6&clientId=uec7d1e4d-4aed-4&from=paste&height=158&id=u95ebebbf&originHeight=197&originWidth=635&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22438&status=done&style=none&taskId=u5065f35d-66d4-4538-8a84-effe1d81ff6&title=&width=508)
```
Manifest-Version: 1.0
Main-Class: hello
```

3、java -javaagent:agent.jar=testhello -jar hello.jar<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692528271238-daee15a7-6008-47dd-a7e8-cde833ddd836.png#averageHue=%23022658&clientId=u8ba66932-ee1d-4&from=paste&height=166&id=u2ef304ae&originHeight=207&originWidth=1018&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22537&status=done&style=none&taskId=u49b7a862-fc50-4c92-8156-7247064f0bb&title=&width=814.4)

[https://blog.csdn.net/weixin_45492007/article/details/118052979](https://blog.csdn.net/weixin_45492007/article/details/118052979)  使用-javaagent方式实现修改方法内容

[https://mp.weixin.qq.com/s/IFQJLijjfk8er7yzaNkb_A](https://mp.weixin.qq.com/s/IFQJLijjfk8er7yzaNkb_A)  这个文章，简单明了<br />需要先创建个正常程序，跑起来hello word，然后走jar的创建，再修改Main类中permain方法的内容<br />[agent.zip](https://www.yuque.com/attachments/yuque/0/2023/zip/1345801/1692636420326-373f0ca7-2dc4-4d03-b891-6fbddeacc436.zip?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2023%2Fzip%2F1345801%2F1692636420326-373f0ca7-2dc4-4d03-b891-6fbddeacc436.zip%22%2C%22name%22%3A%22agent.zip%22%2C%22size%22%3A12871%2C%22ext%22%3A%22zip%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u5855748e-61b5-4553-91da-614a4ed0e4d%22%2C%22taskType%22%3A%22upload%22%2C%22type%22%3A%22application%2Fzip%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22uad67ea77%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692636369299-1fe64946-f943-4b7c-9c79-0252f35833b1.png#averageHue=%23faf9f8&clientId=u8ba66932-ee1d-4&from=paste&height=550&id=u6a7a5005&originHeight=688&originWidth=1632&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=101751&status=done&style=none&taskId=u8fc12247-915e-46c6-a309-254fc632507&title=&width=1305.6)

利用agent去hook某个类com.hy.vmopt.User<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692636492499-9fc1f168-ed17-4652-892e-c413cd59ef63.png#averageHue=%23faf9f8&clientId=u8ba66932-ee1d-4&from=paste&height=475&id=u37c122fd&originHeight=594&originWidth=1674&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=127252&status=done&style=none&taskId=ua8b65d63-a407-42d5-a8cc-98f7d5f019b&title=&width=1339.2)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692636550248-719b3765-15f8-4aa8-9eea-20d05e2c612e.png#averageHue=%23fafaf8&clientId=u8ba66932-ee1d-4&from=paste&height=408&id=u902280f0&originHeight=510&originWidth=1363&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=79913&status=done&style=none&taskId=uea79c1b1-2110-4922-8a0b-cea21885434&title=&width=1090.4)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/1345801/1692636461626-42c67e6d-d60d-4399-9c5f-4593154e541c.png#averageHue=%2338547b&clientId=u8ba66932-ee1d-4&from=paste&height=714&id=ub4e4809a&originHeight=892&originWidth=1176&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=306030&status=done&style=none&taskId=u1edeac9e-d528-4171-9c52-08b2a3d3ae4&title=&width=940.8)
