DNS<br />DNS 解析一个地址的时候会返回多个 IP 吗？<br />答案是不会。<br />考察点其实就是 **DNS 负载均衡**。
<a name="rhlvV"></a>
## 一个域名对应多个 IP
从理论上讲，一个域名是可以对应多个 IP 的，在这种情况下，当不同的用户访问该域名时，就会访问到不同的 IP 地址。<br />要实现一个域名对应多个 IP 地址的效果，只需要在 DNS 解析操作平台，添加一条解析记录，将网站的域名指向服务器的 IP 地址。一般情况下，一个域名对应一个 IP 地址，也就只需添加一条解析记录即可。<br />如想要将 www.yuque.cn 这个域名分别指向 1.1.1.1（北京电信）、2.2.2.2（上海移动）、3.3.3.3（深圳联通）三个 IP。<br />那么就可以在 DNS 服务器中配置三个 A 记录，分别为：

- www.itmtx.cn IN A 114.100.20.201;
- www.itmtx.cn IN A 114.100.20.202;
- www.itmtx.cn IN A 114.100.20.203;

![](https://cdn.nlark.com/yuque/0/2023/png/396745/1694569197871-d42237cb-1aa5-4d75-89fe-9e3219e700b0.png#averageHue=%23d9e0f1&clientId=u20d68615-84fd-4&from=paste&id=uf9649880&originHeight=644&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u1c4f8de0-e19c-490f-9469-8a1967a1b3b&title=)<br />如果现在北京用户访问 yuque.cn 这个域名，上海用户也在访问，两个用户虽然都访问同一个域名，但访问的 IP 地址并不相同，而是会**根据 DNS 事先配置的「解析策略」将解析得到的那个 IP 地址返回给对应的访客**。<br />每次域名解析请求都会解析出一个不同的 IP 地址返回给访客，这样就构成了一个服务器集群，并实现负载均衡的效果。不同用户就近访问不同的服务器 IP 地址，访问速度大大提升，同时也减轻了单个服务器的访问压力。同时，由于有多个备选 IP，当其中一个出现问题时，可以通过宕机切换，提高业务可用性。
<a name="PzzdJ"></a>
## DNS 解析策略
常见的 DNS 解析策略包括：

- **轮询**（Round Robin）：DNS 服务器按顺序返回多个IP地址，实现请求的轮流分发到不同的服务器上。
- **权重**（Weighted）：为每个 IP 地址分配不同的权重，权重越高的服务器被选中的概率越大。
- **响应时间**（Response Time）：DNS 服务器可以通过测量服务器的响应时间来选择最快的服务器，将域名解析为对应的 IP 地址。

各个 DNS 解析产品可能采用的解析策略不一样，以 DNSPod 解析为例，它采用的就是权重 + 随机的策略：<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1694569197875-9b1fe0e7-1301-4bef-be8c-3145ed03c8c2.png#averageHue=%23f6f5f6&clientId=u20d68615-84fd-4&from=paste&id=u69be332a&originHeight=767&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=uf1dba4a1-ec92-42df-985e-aa33fe53928&title=)
<a name="I5EcA"></a>
## 基于 DNS 实现负载均衡的优缺点
基于 DNS 实现负载均衡是十分简单和有效的技术手段，它主要有以下几点优势：

1. 将负载均衡工作交给 DNS，省去了网站管理维护负载均衡服务器的麻烦；
2. 技术实现比较灵活，操作简单，成本低，适用于大多数 TCP/IP 应用；
3. 对于部署在服务器上的应用来说，不需要修改任何代码就能实现不同机器上的应用访问；
4. 很多 DNS 系统还支持基于地理位置的域名解析，可以将域名解析成距离用户地理位置最近的服务器地址，加快用户访问速度。

但基于 DNS 的负载均衡同样也存在一些弊端：

1. 目前的 DNS 系统是需要经过递归服务器、顶级服务器、权威服务器以及众多缓存等多级解析的，在每一个环节都可能存在解析记录缓存。如果服务器 IP 发生变动，即使修改了 A 记录，也需要各级缓存失效后才能生效。而在解析生效前的这段时间，用户可能就会根据缓存记录访问到已经被更换过的服务器上，从而导致访问失败。
2. 为了本地 DNS 服务器能够及时同步权威服务器上的最新记录，所以一般将 DNS 缓存刷新时间设置得比较小，这就会导致 DNS 频繁发起解析请求，从而造成额外的网络问题。
3. DNS 本身并不具备主动监测服务器负载情况或动态调整权重的能力，不能区分不同服务器之间的性能和负载差异，不能反映服务器当前的运行状态，所以一些大型网站总是使用 DNS 域名解析作为第一级负载均衡手段，然后再通过负载均衡服务器提供更高级的负载均衡算法（比如最少连接：将请求发送到拥有最少开放连接的服务器），从而完成最终请求。
