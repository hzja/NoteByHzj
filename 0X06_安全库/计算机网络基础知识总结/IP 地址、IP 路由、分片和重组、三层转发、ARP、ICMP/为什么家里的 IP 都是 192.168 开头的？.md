IP
<a name="IWDNV"></a>
## IP 地址是什么
网络通讯的本质就是收发数据包。如果说**收发数据包**就跟**收发快递**一样。<br />那**IP地址**就类似于快递上填的收件地址和发件地址一样，有了它，路由器就可以开始充当快递员的角色，在这个纷繁复杂的网络世界里找到该由谁来接收这个数据包。<br />![收发数据就像收发快递](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473176-769f3978-31d6-4d8d-a8d6-e754aa2f9f24.png#averageHue=%23eaedf0&clientId=u5102bb27-8592-4&from=paste&id=ub918ba41&originHeight=486&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u75d602d3-95ba-42b2-80d9-1a77fd8c87c&title=%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE%E5%B0%B1%E5%83%8F%E6%94%B6%E5%8F%91%E5%BF%AB%E9%80%92 "收发数据就像收发快递")<br />由于现在主流的还是IPV4地址，所以默认以IPV4为例进行讲解。<br />这个IP大概长这样。<br />![IPv4地址](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473245-58e9cc34-2ed2-4deb-a289-5f912a5c94b5.png#averageHue=%23ebeef1&clientId=u5102bb27-8592-4&from=paste&id=u6ff2846a&originHeight=450&originWidth=1050&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u792ca14a-5369-4c5e-993d-a27250c8569&title=IPv4%E5%9C%B0%E5%9D%80 "IPv4地址")<br />在控制台里执行ifconfig 就能看到。inet 边上的 192.168.31.170 就是IP地址。
```bash
$ ifconfig  
en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500  
    options=400<CHANNEL_IO>  
    ether 88:36:3d:33:a0:15  
    inet6 fe70::1009:aabf:ecc6:2d10%en0 prefixlen 64 secured scopeid 0x6  
    inet 192.168.31.170 netmask 0xffffff00 broadcast 192.168.31.255  
    nd6 options=201<PERFORMNUD,DAD>  
    media: autoselect  
    status: active
```
说白了，它就是个特殊点的**编号**，用于在互联网中唯一定位到某台机子。<br />为了表示这个编号，IP地址一共分为4个字节，一个字节8位，共32位，能用来表示最多 2 ^32，也就是 42亿个地址。<br />貌似。。。有点少？<br />2021年全球就有78亿，今年更是突破了80亿，也就是说人均一个IP都做不到。<br />![当前全球人口数](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473191-af79456a-6d0b-4eb9-b969-760d34feabcc.png#averageHue=%23fefefe&clientId=u5102bb27-8592-4&from=paste&id=u9e8a8255&originHeight=587&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u2834034a-7805-433f-8f2c-c3232fe6870&title=%E5%BD%93%E5%89%8D%E5%85%A8%E7%90%83%E4%BA%BA%E5%8F%A3%E6%95%B0 "当前全球人口数")<br />为此好多年前，就在说IPV4地址不够用，要耗尽了，于是才会有后来的IPV6地址。<br />IPv6用了更多的字节数，因此能表示更多的地址。大概长这样。<br />![IPv6地址](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473180-51ebc7db-0ca5-49f7-8251-254a770a1038.png#averageHue=%23ebeef1&clientId=u5102bb27-8592-4&from=paste&id=u5709764c&originHeight=410&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=ud6ea5712-c677-4e8a-8941-704dcaff510&title=IPv6%E5%9C%B0%E5%9D%80 "IPv6地址")<br />是不是很**陌生**，感觉没怎么见过。<br />这就对了。<br />大家有没有发现，用了这么多年，大部分人其实还在用IPV4地址，不是说要耗尽了吗？<br />为什么大家还一直在用IPV4？<br />先别急，再聊个**前置**知识点，**IP地址的分类**。
<a name="K63cl"></a>
## IP地址的分类
为了更好的管理这42亿个IP地址的用途。应该也在教科书上看过这样一张IP分类的图。<br />![IP地址的分类](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473181-88572628-3c03-45f6-911d-3b3ee943abb4.png#averageHue=%236eb1aa&clientId=u5102bb27-8592-4&from=paste&id=u5b82bc64&originHeight=450&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=udef99315-ef76-41a5-b8a3-0133bbcea2b&title=IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB "IP地址的分类")<br />大概的意思是32位地址里，开头为0的，那就是A类地址。开头为10的，就是B类，开头为110的，就是C类。在这之后，把剩下的字节数拆成两段，一段表示**网络号**，另一短表示**主机号**。<br />**网络号和主机号的关系，就像是某个停车场编号和停车位号的关系**。一个城市里有很多停车场，而停车场里又有很多个停车位。每个停车位可以停一辆车，这里的一辆车，其实就是一台电脑（主机）。<br />大型停车场少，但是能停的车巨多，对应**A类地址的网络号少，但是主机号多。**<br />小型停车场到处都是，但是一般能停的车就少，对应**C类地址的网络号多，但主机号少。**<br />大佬们一开始这么划分网络，其实也是为了**方便管理**，比如A类地址，是给大型组织机构用的，主机地址的位数高达1600w+，C类地址是给小公司用的，主机号只有200+。<br />这个差距就有点悬殊了，放在今天就不太合理了，开个网吧可能都不止200台机子对吧，用C类嫌主机号少，用A类又嫌主机号太多。**因此现在这套分类机制其实已经很少用了。**<br />取而代之的是方案是，将所谓的ABC分类直接取消，**只保留网络号和主机号**，并且网络号的位数也不像以前限制的那么死，**用一个斜杠告诉用户多少位是网络号，其余的都是主机号**。比如 172.20.61.69/20，那**网络号**的位数就是20位，主机号的位数是32-20=12位，能放4096台机子，很灵活，很够用。<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473649-f219b6ff-47b8-4562-a173-61391a14e8bc.png#averageHue=%23eaedf0&clientId=u5102bb27-8592-4&from=paste&id=u34d168fa&originHeight=450&originWidth=1050&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u32d65cf3-f1f6-4a3b-a0ea-5457b5c712f&title=)<br />这就是，所谓的**CIDR**，(Classless Inter-Domain Routing， 无类别域间路由)。
<a name="RzmmV"></a>
## IP地址不够用了吗？
但不管怎么去分类，在32位下的限制下，就算玩得再花，只要将A类+B类+C类+X类**加起来**，IP的个数也最多还是42亿个。还是不够用。<br />那既然**加法**不行，那就用**乘法**。<br />**啥意思？**<br />42亿这个数字对大家来说太大了，为了方便理解，改成6个IP。<br />假设将6拆成4+2，再让4乘以2，那结果8肯定大于6。<br />一开始，理解的网络世界**只有一层**，每人一个IP，那就只有6个人能上网。<br />![相加只能让6人上网](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473677-8dff9826-1dc3-44e9-a2df-bfa32a33f59f.png#averageHue=%23e6ecee&clientId=u5102bb27-8592-4&from=paste&id=u3d836b51&originHeight=648&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=ucec2f6ff-06a4-4b45-a154-8ef0a279203&title=%E7%9B%B8%E5%8A%A0%E5%8F%AA%E8%83%BD%E8%AE%A96%E4%BA%BA%E4%B8%8A%E7%BD%91 "相加只能让6人上网")<br />现在将网络分成两层。像下面这样。<br />![相乘能让8人上网](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473678-b4dfd835-f787-4fbf-9259-5ea37466a417.png#averageHue=%23e7ecee&clientId=u5102bb27-8592-4&from=paste&id=ud7a286bf&originHeight=648&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u11f0f6e0-5dc7-45c1-9b01-fbd506f341d&title=%E7%9B%B8%E4%B9%98%E8%83%BD%E8%AE%A98%E4%BA%BA%E4%B8%8A%E7%BD%91 "相乘能让8人上网")<br />每2个人构成一个"**小网络**"，**对外共用一个IP**，而内部每个人的IP都不一样，4个小网络共同构成一个"**大网络**"。比如小明的电脑是1号网络下的6号机子，小红的电脑是2号网络下的6号机子。这样也能做到**唯一标识某台机子**的效果。<br />像上面这样，每个2人构成的小网络，就叫做**局域网**，也就是所谓的**内网**，用的IP（上面的5，6）也叫**私有IP**或**内网IP**，而上面提到的"大网络"，则是**广域网**，用的IP则被称为**公有IP**或**公网IP**。<br />通过这种方式，原本只能让6人上网，现在却能让8人同时上网。这还是IP只有6个的情况下，如果让数字变回42亿，那就能支持远大于42亿的机子上网了。<br />![公有和私有IP的概念](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473703-4a3d64e8-bece-40b7-9e42-5d6dcb1f6cc2.png#averageHue=%23e8ecef&clientId=u5102bb27-8592-4&from=paste&id=u3d0229f2&originHeight=597&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=uaabf3627-9222-4b2f-82fc-fb7eb17c087&title=%E5%85%AC%E6%9C%89%E5%92%8C%E7%A7%81%E6%9C%89IP%E7%9A%84%E6%A6%82%E5%BF%B5 "公有和私有IP的概念")<br />按照这样的思路，回到上面的ABC类IP地址，大佬们也将它们分成了**私有和公有两部分**。<br />在rfc1918文档中定义了**私有地址的范围**。它们不会出现在广域网中，只会出现在局域网内。
```
* A类地址：10.0.0.0--10.255.255.255  
* B类地址：172.16.0.0--172.31.255.255  
* C类地址：192.168.0.0--192.168.255.255
```
这时候，再看看**C类**里的私有地址范围，眼熟不？<br />192.168.xx.xx就是这网段内的其中一个IP地址。这个范围里大概有6w+个主机号，什么家庭条件能用得完？<br />于是，就变成了一条街或者一个小区，又或者小区内的几幢楼**共用一个公网IP**，而内部就用192.168.xx.xx这样的**内网IP**。所以只要你在家，大概率会发现你的IP地址是C类的192.168.xx.xx。<br />![几幢楼共用一个公网IP](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425473908-149d63c3-3113-40f0-ae21-045b037d4b3f.png#averageHue=%23e9edef&clientId=u5102bb27-8592-4&from=paste&id=u462587ba&originHeight=597&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u56c4dfca-773f-4dd5-86dc-81520404bcf&title=%E5%87%A0%E5%B9%A2%E6%A5%BC%E5%85%B1%E7%94%A8%E4%B8%80%E4%B8%AA%E5%85%AC%E7%BD%91IP "几幢楼共用一个公网IP")<br />但其实只要你想，A类和B类的私有地址也是可以用在局域网里的。<br />到了公司里执行下ifconfig命令，很可能会发现局域网IP就不是192.168开头的了, 而是172或者10开头的。<br />这是因为在公司内网里，需要的IP数量会更大，172和10开头的IP能表示的主机更多，比如10开头的能表示1600w+个。<br />就不说别的，**光A类地址**，只拿了个10开头的网络号出来当内网IP就能表示1600w+个主机号，其余的100+个A类网络号都拿来当公网地址。<br />按上面提到算法去进行个相乘，公网IP数 * 内网IP数 = (100+ * 1600w) * 1600w，也别管算的对不对，反正就是能提供给好多设备使用，更别说还有B类和C类的还没算呢。<br />而且上面只考虑了一层局域网，其实局域网内还能再分成多层，局域网内再嵌套局域网。就像下面这样，这样能用的IP数量就更多了。<br />![局域网内还有局域网](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425474198-f8307eca-2482-4d76-b1cf-a504a9767b54.png#averageHue=%23e9edef&clientId=u5102bb27-8592-4&from=paste&id=ubfdbe277&originHeight=1080&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=uc169632c-cbe6-42cd-a4a8-f6f767872af&title=%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E8%BF%98%E6%9C%89%E5%B1%80%E5%9F%9F%E7%BD%91 "局域网内还有局域网")<br />所以说，IP地址虽然不多，但其实完全够用，这也是一直以来迟迟不切换成IPv6的原因。**够用，能跑，为什么要换？**<br />聊到这里，其实就回答了文章标题的问题，**为什么大家的IP都是192.168开头的**?<br />是因为IPv4地址有限，为了有效利用这些有限的地址，可以将网络分为**局域网和广域网**，将IP分为了**私有IP和公网IP**，一个局域网里的N多台机器都可以共用一个广域网IP，从而达到了"做乘法"的效果，大大增加了"可用IP数量"，**小区里几幢楼可以共用一个公网IP**，且因为设备数量不多，一般选用**C类**的私有地址，也就是192.168开头的地址。<br />但问题就来了，**怎么知道公网IP地址是什么？**
<a name="SY32M"></a>
## 查询自己的公网IP地址
在家里的电脑上，通过ifconfig，你能拿到自己的**内网**IP地址，比如这里的就是192.168.31.170。
```bash
$ ifconfig  
en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500  
    options=400<CHANNEL_IO>  
    ether 88:36:3d:33:a0:15  
    inet6 fe70::1009:aabf:ecc6:2d10%en0 prefixlen 64 secured scopeid 0x6  
    inet 192.168.31.170 netmask 0xffffff00 broadcast 192.168.31.255  
    nd6 options=201<PERFORMNUD,DAD>  
    media: autoselect  
    status: active
```
但如果想知道公网IP地址的话，该怎么做呢？<br />有个简单的方法。直接在baidu上搜索"**我的IP地址**"，就能看到公网IP地址。<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425474308-63ee3454-4f70-423f-82ee-c477b60f3510.png#averageHue=%23fbf9f9&clientId=u5102bb27-8592-4&from=paste&id=ud314474e&originHeight=540&originWidth=1050&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ucbd03339-b0f2-41d8-a187-770563fc3fd&title=)<br />如果用的是某里云的机子。会发现机子既有私有IP地址，也有一个公有IP地址。<br />![某里云可以同时分配公有和私有IP](https://cdn.nlark.com/yuque/0/2023/png/396745/1673425474318-458f54a0-d978-4b37-b2ce-9e0c343ead4e.png#averageHue=%23faf9f9&clientId=u5102bb27-8592-4&from=paste&id=u804786f9&originHeight=415&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=none&taskId=u33569d38-3019-4973-bcab-0c4c0365752&title=%E6%9F%90%E9%87%8C%E4%BA%91%E5%8F%AF%E4%BB%A5%E5%90%8C%E6%97%B6%E5%88%86%E9%85%8D%E5%85%AC%E6%9C%89%E5%92%8C%E7%A7%81%E6%9C%89IP "某里云可以同时分配公有和私有IP")<br />当去ping上面的**私有**地址172.21.56.59时，会发现它根本**ping不通**。
```bash
$ ping 172.21.56.59  
PING 172.21.56.59 (172.21.56.59): 56 data bytes  
Request timeout for icmp_seq 0  
Request timeout for icmp_seq 1  
Request timeout for icmp_seq 2  
^C  
--- 172.21.56.59 ping statistics ---  
4 packets transmitted, 0 packets received, 100.0% packet loss
```
而公网地址46.101.121.11却可以ping通。也就是说，在家的局域网里，只能通过**公网IP**地址去访问这台云服务器。
```bash
$ ping 46.101.121.11  
PING 46.101.121.11 (46.101.121.11): 56 data bytes  
64 bytes from 46.101.121.11: icmp_seq=0 ttl=48 time=273.481 ms  
64 bytes from 46.101.121.11: icmp_seq=1 ttl=48 time=268.018 ms  
64 bytes from 46.101.121.11: icmp_seq=2 ttl=48 time=266.606 ms  
^C  
--- 46.101.121.11 ping statistics ---  
3 packets transmitted, 3 packets received, 0.0% packet loss
```
这时候，用过他们家服务器的人可能会有个疑问。<br />只要申请一台云服务，某里云就能给你一个公网IP地址，怎么做到的？<br />**这。。。这么富的吗？**<br />其实，某里云跟管IP的机构，**租用**了的一批IP地址，在需要的时候，就能付费租给你，不用了也能回收分配给其他人。<br />而且公网IP地址下面，其实也可以挂多台云服务器，用上文提到的方式，让多台云服务器共用一个IP。<br />因此不太需要担心IP耗尽的问题。
<a name="aZ0Jy"></a>
## 总结

- IP地址就像快递里填的送件和收件地址，是一串编号，用于在纷繁复杂的网络世界中标识你的位置。
- IPv4有32位，最多能表示42亿个IP地址。为了更好的管理它们，教科书上出现过ABC这样的分类方式，并且在ABC类里还分为私有地址和公有地址。但目前流行使用CIDR的方式进行分类。
- 为了表示更多主机，可以将网络分为广域网和局域网，广域网用公有地址，局域网使用私有地址。将公有地址乘上私有地址，就能表示远大于42亿台的机子。
- 家庭网络较小，往往小区内几幢楼构成一个局域网，这几幢楼共用一个公有IP地址。局域网内选择了C类的私有地址，也就是192.168.xx开头的ip，所以你会发现家里的IP基本上都是192.168开头的。
- 在baidu上搜索"**我的IP地址**"，就能看到你的公网IP地址。
