网络 MAC地址表 ARP表 路由表
<a name="tVErL"></a>
### MAC地址表
**MAC地址表**：简单的说，MAC地址表是交换机等网络设备记录MAC地址和端口的映射关系(见下图)，代表了交换机从哪个端口学习到了某个MAC地址，交换机把这个信息记录下来，后续交换机需要转发数据的时候就可以根据报文的目的MAC地址去根据MAC地址表转发数据。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660706620-a6c578d5-3878-42d7-9dd5-e0a23e0d25c9.webp#clientId=u25e95e68-7844-4&from=paste&id=ua0a07b8b&originHeight=152&originWidth=362&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9a16cf27-285f-4320-8a90-5194a052324&title=)<br />在华为网络设备上可以通过`**dis mac-address**`** **查看本地mac的地址表的信息，通过下图的显示可以知道mac地址 5489-98b1-79f4 是从G0/0/2端口学习到的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660706513-9392738e-f2e4-4573-b0a1-f6df17a06f64.webp#clientId=u25e95e68-7844-4&from=paste&id=uf3db6a6b&originHeight=548&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u16891c3b-2bd7-4fcd-8212-1ac5fa37800&title=)
<a name="T30wj"></a>
### ARP表
**ARP表**：简单的说，ARP表就是路由器等网络设备记录**IP地址和MAC地址对应关系的表项**（如下图）。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660706733-c78e4dda-31d7-450f-9dfa-5b6b1d1f00f3.webp#clientId=u25e95e68-7844-4&from=paste&id=uc5961166&originHeight=152&originWidth=482&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u566d02b2-6074-4924-9339-feec09f631d&title=)<br />当需要转发数据的时候除了**需要对方的目的IP地址，还需要知道对方的MAC地址**，那么正常情况下优先会在本地ARP表中查看是否有目的IP对应的MAC地址。<br />在华为网络设备上可以通过`**dis arp**`** **查看本地arp表的信息，通过下图的显示可以知道mac地址 5489-98b1-79f4 是对应的IP地址是192.168.1.2 ；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660706511-f7c55cda-afd3-442d-b7fb-69ab0036d280.webp#clientId=u25e95e68-7844-4&from=paste&id=ufd9836a5&originHeight=548&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u1dd5eb34-b814-4d98-840a-f443a6ff53a&title=)
<a name="xoQED"></a>
### 路由表
**路由表**：简单点说路由表就是路由器用于指导数据包如何转发的表项，记录了去往目的IP的下一跳去哪里（如下图）。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660706390-555ed611-8ee4-4c58-a14a-673eb0b841a3.webp#clientId=u25e95e68-7844-4&from=paste&id=u7ad14050&originHeight=101&originWidth=721&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u211f4aad-c753-4964-ad16-ddce4b9d15b&title=)<br />路由表的作用类似于生活中的地图，指引我们去往一个目的地该如何走?<br />在华为网络设备上可以通过`**display  ip routing-table**` 查看本地路由表的信息，通过下图的显示可以知道去往目的192.168.2.0/24 的下一跳是10.1.1.2 ；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707139-40b412b9-0e25-4b1f-a629-edec3ef9214a.webp#clientId=u25e95e68-7844-4&from=paste&id=u4b2ab26a&originHeight=544&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u8f8e136b-b932-4276-a984-c1e7b6a4d2d&title=)
<a name="Fp9UJ"></a>
### 案例一：PC1和PC2二层互访通信过程详解
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707249-00147803-0dbb-4d36-8c42-7a89bd79138d.webp#clientId=u25e95e68-7844-4&from=paste&id=ueb9ec067&originHeight=366&originWidth=519&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u4d128c86-3764-461f-8a3b-451fef41335&title=)<br />如上图的网络拓扑，PC1和PC2通过交换机SW1互联，PC1 的IP地址为192.168.1.1/24 ，PC2的IP地址为192.168.1.2/24 ，那么PC1和PC2的通信就是简单的二层通信（二层通信不涉及路由表），下面从ARP表和MAC地址表的角度详细解析下这个通信过程。<br />**下面来详细分析下：**<br />1、PC1要想访问PC2，除了需要知道目的IP 192.168.1.2 以外，还需要知道PC2 的mac地址，因为所有的数据通信都是基于TCP/IP参考模型的，需要对进行数据封装。<br />首先PC1会查找自己的ARP表项看是否有目的IP 192.168.1.2 对应的MAC地址，查看发现是空的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707008-0497e826-5f13-4589-8971-80a578657d5b.webp#clientId=u25e95e68-7844-4&from=paste&id=u0863b84e&originHeight=558&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u2bac2c1f-d68b-4604-a65f-4d9e02b14b8&title=)<br />2、如果不知道对方的mac地址，PC1会发送ARP广播报文，询问谁知道目的IP 192.168.1.2 对应的MAC地址(如下图所示)。PC2收到ARP广播报文会进行回应，告诉PC1他的MAC地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707264-b28a4a36-a9e4-4261-a5d2-d9e1ffb01888.webp#clientId=u25e95e68-7844-4&from=paste&id=ub80b8547&originHeight=38&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1fb4bd03-95fe-4e0c-993d-3cdf2e6ccad&title=)<br />**附：**<br />在PC1发送ARP 广播报文的时候，交换机SW1收到该报文，会在MAC地址表中根据报文的源mac地址记录下PC1 的mac地址和GE0/0/1的映射关系；PC2发送回应报文的时候 交换机SW1也会记录下PC2 的mac地址和GE0/0/2的映射关系（如下图）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707483-070556b8-d443-4b15-be37-13393498b483.webp#clientId=u25e95e68-7844-4&from=paste&id=uaed71759&originHeight=554&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uc95fb29b-62d5-4d1b-8cba-e6c1c37005f&title=)<br />3、可以看到PC1的本地ARP表项中学习到了PC2的mac地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707346-b9e7b7f3-cef5-4a4f-84e6-417c08599647.webp#clientId=u25e95e68-7844-4&from=paste&id=u289b4458&originHeight=565&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u350241da-ec23-4c75-9069-f72e5f0cb46&title=)<br />4、这样PC1就可以根据PC2的MAC地址封装数据发送给交换机SW1，交换机SW1会查找自己的MAC地址表，发现去往PC2的MAC地址的出接口为GE0/0/2，从而PC2就可以收到报文，并进行解封装；
<a name="DBBga"></a>
### 案例二：PC3和PC4三层互访通信过程详解
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707601-2bda51da-37a0-4c84-9c0e-9de40d8229e2.webp#clientId=u25e95e68-7844-4&from=paste&id=ue125a11f&originHeight=295&originWidth=615&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u1ced30f0-cb6a-420d-b51d-3b746220720&title=)<br />如上图的网络拓扑，PC3和PC4通过路由器R1、R2互联，PC3 的IP地址为192.168.1.2/24 网关192.168.1.1 ，PC4 的IP地址为192.168.2.2/24 网关192.168.2.1，那么PC1和PC2的通信就是跨网段三层通信，下面从ARP表、MAC地址表、路由表的角度详细解析下这个通信过程。<br />**下面来详细分析下：**<br />1、PC3要想访问PC4，由于是跨网段通信，PC3需要首先把数据包发送给PC3的网关。PC3会查找自己的ARP表项看是否有网关IP192.168.1.1对应的MAC地址，查看发现是空的；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707834-75943e1f-d01c-4692-b747-a3eefea782c8.webp#clientId=u25e95e68-7844-4&from=paste&id=uda357261&originHeight=553&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u75196bb3-9cee-4564-bd13-d654c762e0d&title=)<br />2、如果不知道对方的mac地址，PC3会发送ARP广播报文，询问谁知道目的IP 192.168.1.1 对应的MAC地址(如下图所示)。R1收到ARP广播报文会进行回应，告诉PC3 他的网关的MAC地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660707813-1047acd6-2479-4f0f-bfc9-c0695c5cc4a7.webp#clientId=u25e95e68-7844-4&from=paste&id=u9b6e8e64&originHeight=40&originWidth=970&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uf41a9758-9d20-4830-8e60-2ba1a5d75fe&title=)<br />3、可以看到PC3的本地ARP表项中学习到了网关的mac地址；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660708234-8d23b7cc-afe5-4b5a-8673-e1096d78b7f9.webp#clientId=u25e95e68-7844-4&from=paste&id=ued4c4433&originHeight=552&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ud5522f31-13d2-4539-8ce3-367c58f0063&title=)<br />4、这样PC3就可以根据网关MAC地址封装数据发送给R1，R1收到数据包会进行解封装，解封装发现目的IP是PC4，不是发给自己的，从而会查找自己的路由表，发现去往PC4的下一跳是10.1.1.2；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660708270-5f9bff86-dd46-4dac-84b1-03dd904f339b.webp#clientId=u25e95e68-7844-4&from=paste&id=u922c4805&originHeight=551&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=udf1956f1-699d-47d8-8297-9beca49b840&title=)<br />5、R1需要把数据进行封装发送给R2的10.1.1.2 ，因此需要请求10.1.1.2 对应的MAC地址用于封装（可以看到R1的ARP表中已经有10.1.1.2 对应的MAC地址，因此可以直接封装）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660708023-5e3faa22-436b-4824-9212-1a80bcc9615b.webp#clientId=u25e95e68-7844-4&from=paste&id=ud747573b&originHeight=557&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u94f25f3d-a09a-45db-ae40-c0684cd6593&title=)<br />6、R2收到R1的数据包，需要进行解封装，解封装发现目的IP是PC4，通过查找自己的路由表，发现去往PC4是自己的直连端口；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660708717-e8a0a233-f21a-472f-b6c8-e945f3556901.webp#clientId=u25e95e68-7844-4&from=paste&id=uce5b99b8&originHeight=550&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u79f12f33-54b4-4d30-a28c-a3e7dfbe7c9&title=)<br />7、R2需要把数据进行封装发送给PC4 ，因此需要请求PC4 192.168.2.2  对应的MAC地址用于封装（可以看到R2的ARP表中已经有192.168.2.2对应的MAC地址，因此可以直接封装）；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1640660708646-f893754d-a510-405a-adfc-9501da19c87a.webp#clientId=u25e95e68-7844-4&from=paste&id=u57f26321&originHeight=560&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ud2d9b5ea-dd83-44e8-8263-7a133971006&title=)<br />8、最后PC4收到报文进行解封装发现就是发送给自己的，通信结束；
