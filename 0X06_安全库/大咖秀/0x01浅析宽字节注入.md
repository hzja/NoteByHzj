# [宽字节注入]([漏洞银行丨浅析宽字节注入丨咖面3期_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1EX4y1K7jV/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=1e325091774aa31c4dcd65d8667c69de))

## 宽字节注入原理

​	宽字节注入源于程序员设置Mysql连接时错误配置为：set character_set_client=gbk，这样配置会引发编码转换从而导致注入漏洞；具体如下：

1. 正常情况下当GPC开启或使用addslashes函数过滤GET或POST提交的参数时，黑客使用的单引号<code>’</code>会被转义为<code>\\'</code>；
2. 但如果存在宽字节注入，我们输入<code>%df%27</code>时首先经过上面提到的单引号转义变成了<code>%df%5c%27</code>（其中%df检测单引号；%5c表示反斜杠<code>\\</code>；%27表示单引号<code>’</code>），之后在数据库查询前由于使用了GBK多字节编码，即在汉字编码范围内两个字节会被编码为一个汉字，然后MySQL服务器会对查询语句进行GBK编码即<code>%df%5c</code>转换成了汉字"某"(不知道咋写，用某代替)，而单引号(即%27)逃逸出来从而造成注入漏洞;

+ GBK编码是数据库编码，与前台编码无关



## 延伸

​		这里思考下"锦"这个字，其utf-8编码是e98ca6，gbk编码是%e5%5c，而上面提到过反斜杠\\gbk编码是%5c；如果将title设置为：锦’，首先经过addlashes函数或GPC对单引号转义变为：锦\‘，然后经过icnov函数对 锦\’ 转化为gbk编码即：%e5%5c%5c%27；在这里反斜杠被转义(%5c%5c)从而单引号(即%27)逃逸出来引发注入漏洞

​		这里延申下，如果某个字的gbk编码是%??%5c，都可设置title为该字+‘，这样同样都可以使单引号(即%27)逃逸引发注入漏洞；