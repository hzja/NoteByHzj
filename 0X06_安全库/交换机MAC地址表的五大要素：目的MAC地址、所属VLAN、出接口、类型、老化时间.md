网络<br />以一个案例为例：<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800528-a2d6e25f-7305-46e7-8743-36d9b64ae576.webp#clientId=ub642b916-08e7-4&from=paste&id=ua50dcee9&originHeight=312&originWidth=511&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u8882b6b3-0844-41c4-8fa9-6284cca38d2&title=)<br />如上图：PC1和PC2通过交换机SW1直连，此时PC1想要和PC2通信。<br />1、根据**TCP/IP参考模型**，PC1想要和PC2通信，除了需要知道PC2的IP地址，还需要知道PC2的MAC地址，这个可以通过ARP广播获取PC2的目的IP地址。（PC1的ARP表项如下图）<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800134-ca158935-2b15-4905-99c6-95e9cab97289.webp#clientId=ub642b916-08e7-4&from=paste&id=u6da967b8&originHeight=87&originWidth=464&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubf9c6769-d2b2-4b2d-975f-085879b2354&title=)<br />2、PC1将报文封装好发送给交换机SW1，交换机SW1会**查找MAC地址表**，匹配到PC2的MAC地址，查找出接口为GE0/0/2。（交换机的MAC地址表如下图）<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800110-478e7e9d-dffa-417b-b9bc-4a254122a56f.webp#clientId=ub642b916-08e7-4&from=paste&id=u98d484b9&originHeight=163&originWidth=666&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u6afa5aab-4888-41e3-8e93-cd565b59e49&title=)<br />3、交换机SW1将报文发给PC2，PC2收到后**解封装**发现目的MAC和目的IP均为自己的，因此接收该报文继续处理。<br />以上就是整个案例的通信过程，可是有没有想过，就是交换机SW1的MAC地址表是怎么生成的？交换机的MAC地址表是啥样的？由哪些要素构成？
<a name="lgGFI"></a>
### MAC地址表
**MAC地址表：**简单的说，MAC地址表是交换机等网络设备记录MAC地址和端口的映射关系(见下图)，代表了交换机从哪个端口学习到了某个MAC地址，交换机把这个信息记录下来，后续交换机需要转发数据的时候就可以根据报文的目的MAC地址去根据MAC地址表转发数据。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800078-d28546da-52b6-4301-8440-161cd921ad5b.webp#clientId=ub642b916-08e7-4&from=paste&id=uc25f5bf3&originHeight=152&originWidth=362&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9b9e5a1c-f2ff-4beb-8c11-5a5fc2b83f4&title=)<br />华为交换机上可以通过命令`**display mac-address**`查看所有类型的MAC地址表项信息；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800074-e4af3f62-31d8-4a10-9b22-31440faa01cf.webp#clientId=ub642b916-08e7-4&from=paste&id=u85a2e276&originHeight=163&originWidth=666&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=udda273bb-b1a9-4e01-9162-4c8af83f606&title=)<br />**MAC地址表作用：**<br />1、用于存放交换机所学习到的其它设备的MAC地址信息。<br />2、用于交换机在转发数据时，根据以太网帧中的目的MAC地址和VLAN编号查询MAC表，快速定位设备的出接口。<br />**MAC地址表主要构成：**包括目的MAC地址、设备所属的VLAN、出接口、MAC表项类型、老化时间等。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800500-7b8d0185-b22d-4a0e-8bbc-965656f4f1b1.webp#clientId=ub642b916-08e7-4&from=paste&id=ua0203153&originHeight=416&originWidth=581&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1e42bd66-785b-43b4-9462-ff57cd1a214&title=)<br />下面就分别来讲下MAC地址表的五大要素。
<a name="nmFQj"></a>
### 目的MAC地址
<a name="QBkSy"></a>
#### 什么是MAC地址？
每个网卡或三层网口都有一个 **MAC 地址**， MAC 地址是烧录到硬件上，因此也称为**硬件地址**。MAC 地址作为数据链路设备的地址标识符，需要保证网络中的每个 MAC 地址都是**唯一**的，才能正确识别到数据链路上的设备。
<a name="RjIK0"></a>
#### MAC地址组成？
MAC 地址由 **6** 个字节组成。前 3 个字节表示**厂商识别码**，每个网卡厂商都有特定唯一的识别数字。后 3 个字节由厂商给每个网卡进行分配。厂商可以保证生产出来的网卡不会有相同 MAC 地址的网卡。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800716-280e530a-fba6-4bb5-9853-ba9b1c6e7ec1.webp#clientId=ub642b916-08e7-4&from=paste&id=u850ce7ef&originHeight=193&originWidth=484&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ua7fc6fe8-8ac7-4f72-a794-d3afe2e640a&title=)<br />MAC地址
<a name="GSo26"></a>
#### MAC地址表示方法？
为了查看方便， 6 个字节的 MAC 地址使用**十六进制**来表示。每个字节的 8 位二进制数分别用 2 个十六进制数来表示。<br />例如这里的网卡 MAC 地址是 34-F6-4B-62-B3-85。可以在自己的PC通过打开cmd通过命令**ipconfig /all** 查看<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800856-3de4a378-133f-455d-965b-a7a79d4db70a.webp#clientId=ub642b916-08e7-4&from=paste&id=ucb61d287&originHeight=318&originWidth=719&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u6eb43e26-3635-4b83-bbd6-6f7bea2197b&title=)
<a name="VZTof"></a>
#### 交换机是如何学习MAC地址的？
1、交换机在从某接口收到数据帧时会**基于源MAC地址学习**，然后在MAC地址表中添加MAC地址和接口的映射关系，生成对应的MAC地址表项<br />2、交换机在转发数据帧时是**基于目的MAC地址进行转发**。
<a name="WbnCb"></a>
### 所属VLAN
当交换机上的接口有绑定VLAN时，生成的MAC地址表项会标识接口所属的VLAN。如下图中接口10GE1/0/1的所属VLAN为100。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800586-e46d1f48-9a17-433b-87a2-c7892f5aa55f.webp#clientId=ub642b916-08e7-4&from=paste&id=u3023f135&originHeight=283&originWidth=648&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u6e8716dc-4ae6-43b8-ac86-92f204636b3&title=)<br />关于VLAN，简单看下VLAN相关的概念。
<a name="SY5bu"></a>
#### 什么是VLAN？
VLAN是为了在二层隔离广播域而提出的一个概念。<br />举个例子，我们班级一共有15个人，为了方便管理，3人1组，分成组1，组2，组3，组4，组5。那么划分VLAN就类似于分组的概念。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105800922-f61cbc3a-ad65-4a4b-a31b-568ce97ad114.webp#clientId=ub642b916-08e7-4&from=paste&id=uf990ce99&originHeight=402&originWidth=963&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u5dc9ee10-e525-4273-8656-dfb74bf3a65&title=)<br />如下图：将PC1和PC3划分为VLAN10，PC2和PC4划分为VLAN20，那么**相同的VLAN之间可以通信，不同VLAN之间二层不可以通信。**<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801014-5b6b56f0-d913-4699-a8a0-98c7d94a6dab.webp#clientId=ub642b916-08e7-4&from=paste&id=ua0d9fdc0&originHeight=321&originWidth=772&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ua9aa0886-b6b6-42c7-85ad-9bdd7923e9b&title=)
<a name="feS3O"></a>
#### 怎么区分不同的 VLAN ？
通过 VLAN ID 进行区分，例如 VLAN 10 和 VLAN 20 就是不同的 VLAN 。
<a name="uXooA"></a>
#### VLAN 技术有哪些好处？

- 增加了广播域的数量，**减小了每个广播域的规模**，也减少了每个广播域中终端设备的数量；
- **增强了网络安全性，**保障网络安全的方法增加了；
- **提高了网络设计的逻辑性**，可以规避地理、物理等因素对于网络设计的限制。
<a name="OfQsZ"></a>
#### VLAN 划分
交换机通常会使用**基于端口划分 VLAN** 的方法。在交换机上手动配置，绑定交换机端口和 VLAN ID 的关系。<br />如下图就是基于接口的方式划分VLAN。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801312-c5b7681b-5c88-4543-9608-27b9548ba552.webp#clientId=ub642b916-08e7-4&from=paste&id=u62e7f3af&originHeight=321&originWidth=772&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u864486da-2dfb-4696-b8e2-8ec1357533d&title=)<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801558-1112480c-3d38-4e66-bd14-dd0d4c514712.webp#clientId=ub642b916-08e7-4&from=paste&id=ub03dc04d&originHeight=163&originWidth=285&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ucb565001-cbaf-4a80-9bd3-d375dbc1d15&title=)<br />优点：配置简单。想要把某个端口划分到某个 VLAN 中，只需要把端口的 **PVID** （端口 VLAN ID ）配置到相应的 VLAN ID 即可。<br />缺点：当终端设备移动位置是，可能需要为终端设备连接的新端口重新划分 VLAN 。<br />除了这种方法外，还可以使用**基于** **MAC 地址划分 VLAN** 、**基于 IP 地址划分 VLAN** 、**基于协议划分 VLAN** 、**基于策略划分 VLAN** 等方法来划分 VLAN。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801319-6888f7db-18ec-4dae-b0a2-282e78ac8e0c.webp#clientId=ub642b916-08e7-4&from=paste&id=ue5f9af7c&originHeight=192&originWidth=268&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uac4a9b69-9323-4108-ba6f-6a5a7b3687e&title=)
<a name="nbzgD"></a>
### 出接口
当交换机收到一个数据包会根据数据帧的**目的MAC地址**去查找MAC地址表，如果能够匹配到，那么就会根据表项的**出接口**发送出数据帧。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801275-90d04fec-9b5d-4ecf-91b9-1048e7308e3b.webp#clientId=ub642b916-08e7-4&from=paste&id=ud2492b7b&originHeight=432&originWidth=842&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u3bdd1562-a1d2-4d31-b712-f92daaa9c64&title=)<br />如上图所示：<br />1、PC1发送一个如下图所示的数据帧给SW1，目的MAC为PC2的MAC；<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801599-59bcb5f8-de93-499b-b440-cf85db04d177.webp#clientId=ub642b916-08e7-4&from=paste&id=udab83450&originHeight=50&originWidth=310&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u82d6c31b-b5be-4d7f-a2f5-7b447bb42db&title=)<br />2、交换机SW1收到该数据帧后根据目的MAC查找MAC地址表，匹配到表项，按照表项提供的出接口将数据从G0/0/2口转发出去；

![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801810-9be66a5e-189d-492c-974b-ace4f0a5e070.webp#clientId=ub642b916-08e7-4&from=paste&id=u49c2e4cc&originHeight=121&originWidth=239&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0455ab44-bc70-49b2-b792-44d6f89edc9&title=)<br />3、PC2收到数据帧后进行解封装，通信结束。
<a name="Oynge"></a>
### MAC地址表表项类型
MAC地址表生成的方式有多种，最常见的就是**动态生成MAC地址表项。**<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801931-bb311268-9c48-44c0-a4c7-4defdce09e9e.webp#clientId=ub642b916-08e7-4&from=paste&id=u8a3115fa&originHeight=171&originWidth=700&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ua9f6e71d-a10f-4f16-bc87-ba5acda7753&title=)<br />下面一起看下MAC地址表的表项类型：<br />1、`**static**`：静态MAC地址表项。由用户手工配置，表项不会被老化。<br />2、`blackhole`：标识黑洞MAC地址表项，由用户手工配置，表项不会被老化。<br />3、`**dynamic**`：标识动态MAC地址表项，由设备通过源MAC地址学习获得，表项有老化时间，可被老化。<br />4、`security`：标识安全动态MAC表项，由接口使能端口安全功能后学习到的MAC地址表项。<br />5、`sticky`：标识Sticky MAC表项，由接口使能Sticky MAC功能后学习到的MAC地址表项。<br />6、`mux`：标识MUX MAC表项，当接口使能MUX VLAN功能后，该接口学习到的MAC地址表项会记录到mux类型的MAC地址表项中。<br />7、`snooping`：根据DHCP Snooping绑定表生成的静态MAC表项类型。<br />8、`evn`：标识EVN或EVPN网络中存在的MAC地址表项。<br />9、`authen`：用户通过MAC认证或802.1x认证后形成的MAC地址表项。<br />10、`tunnel`：通过二层隧道学到的MAC地址。<br />11、`ovsdb`：标识通过OVSDB学习到的MAC地址表项。由VMware NSX控制器下发至本端设备获得，表项不会被老化。系统复位或接口板热插拔后不丢失。
<a name="B7yw1"></a>
### 老化时间
**MAC老化时间：**动态MAC地址学习时间，单位是秒。<br />华为交换机可以通过命令 `**display mac-address aging-time**`命令用来查看MAC地址表中动态MAC地址表项的老化时间。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1639105801696-7d6e107d-cd48-4395-af74-6d15e1e14381.webp#clientId=ub642b916-08e7-4&from=paste&id=ub4c2a5a1&originHeight=50&originWidth=319&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub97e347d-ef57-464f-8c4d-d1898157170&title=)<br />使用本命令**查看动态MAC地址表项的老化时间为0秒时，说明学习到的动态MAC地址不会被老**化，可能会使MAC地址表项爆炸式增长，降低系统性能。
