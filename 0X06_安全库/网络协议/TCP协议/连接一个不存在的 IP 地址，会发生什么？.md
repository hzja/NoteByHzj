两个基于场景问的网络问题。

- Q1：**客户端连接一个不存在的 IP 地址，会发生什么？**
- Q2：**客户端连接一个存在的 IP 地址但是端口不存在，会发生什么？**

PS：这里的「连接」指的是 TCP 连接。<br />直接给出结论：
<a name="J7bD5"></a>
### Q1：客户端连接一个不存在的 IP 地址，会发生什么？
这个问题要分两种情况来思考，不同的情况得到的结论是不同的。<br />_第一个情况：目标 IP 地址和客户端的 IP 地址是同一个局域网（网络号相同）。_<br />第一种情况，客户端无法发出 SYN 报文，主要卡在数据链路层。<br />因为目标地址不存在 IP 地址，客户端的内核在发 arp 请求的时候，广播询问这个目标 IP 地址是谁的，由于网络中不存在该目标 IP 地址，所以没有设备应答客户端的 arp 请求。<br />由于**客户端无法拿到目标设备的 MAC，这样就没办法组装 MAC 头的信息，所以 SYN 报文无法发送出去**。<br />_第二个情况：目标 IP 地址和客户端的 IP 地址不在同一个局域网（网络号不同）。_<br />第二种情况，客户端会先将 SYN 报文发给路由器，然后路由器会继续转发。<br />由于目标 IP 地址是不存在的，该 SYN 报文会在网络中消亡，因此客户端是不会收到对 SYN 报文的确认报文的，接着**客户端会触发超时重传，重传 SYN 报文，直到重传的次数达到最大次数后，客户端的连接就会被释放**。<br />可能有的同学好奇，为什么这种情况客户端的 SYN 报文可以发出来？<br />因为当目标 IP 地址和客户端 IP 地址不在同一个局域网时，客户端通过路由表的判断，判断到下一步是要将网络报文发送给路由器。<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1676596041218-db255ae8-ea22-47d5-92a2-604c6cd9f718.png#averageHue=%2310121a&clientId=u2b7010b1-fc8d-4&from=paste&id=u44468ffb&originHeight=186&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u73d7cd76-6873-4110-b261-a9d8fc2a59c&title=)<br />这时候数据链路层的 arp 请求，会广播询问 IP 地址（路由器 IP 地址）是谁的，路由器发现是自己的 IP 地址，于是就会将自己的 MAC 地址告诉客户端。<br />然后客户端的网络报文中 MAC 头的「目标 MAC 地址」填入的就是路由器的 MAC 地址，于是 SYN 报文就可以发送出去了。<br />由于目标 MAC 地址是路由器的，所以就会被路由器接收，然后路由器继续通过路由表的判断，转发给下一个路由器，直到找到目标设备。
<a name="i4H3l"></a>
### Q2：客户端连接一个存在的 IP 地址但是端口不存在，会发生什么？
客户端连接的目标 IP 地址是存在的，那么 SYN 报文就能正确地抵达到目标设备。<br />目标设备收到 SYN 报文后，发现端口号并没有被进程监听，这时候目标设备的内核就会回 RST 报文。<br />客户端收到 RST 报文后，就会释放连接。<br />.......<br />至此，结论已说完。<br />第二题不难，难的是第一题，如果没有把两台电脑之间是怎么通信的搞清楚，那么是无从下手回答的，所以建立好体系化的网络知识，面对这类的场景题目，就能做到举一反三了。<br />**最后再提一个问题：客户端发送了一个目标 IP 地址存在但是端口不存在的 UDP 报文，UDP 没有像 TCP 那样的 RST 报文，此时会发生什么？**
