决策树<br />![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255661-79bf6905-3fab-45a2-848c-0e498e737eeb.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u3f3333e2&originHeight=571&originWidth=579&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u96a51c91-c472-4072-a1c0-66d172bec15&title=)<br />![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255580-738843e2-7dbc-49fe-b965-39c20a060b82.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u4aca8559&originHeight=1058&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u82abed88-54df-494d-82f6-076ad8e598e&title=)<br />直接绘制随机森林也不在话下![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255291-e31e5980-b6fa-47cd-94f3-a5f0975456ac.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u93b1e615&originHeight=1058&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u856d897b-c999-42f4-8cda-e1205c05ec5&title=)<br />下面介绍一下这个神器 —— pybaobabdt
<a name="IALBH"></a>
## 安装GraphViz
pybaobabdt依赖GraphViz。<br />1、首先下载安装包<br />[http://www.graphviz.org/download/](http://www.graphviz.org/download/)<br />![http://www.graphviz.org/download/](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255302-1d6e4ce7-83d5-49b8-a350-86aa6794dc52.webp#clientId=u5c448f25-ddc1-4&from=paste&id=uf444b05f&originHeight=224&originWidth=742&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=ufa2f6c2b-6080-40fc-b182-407c2bd868f&title=http%3A%2F%2Fwww.graphviz.org%2Fdownload%2F "http://www.graphviz.org/download/")<br />2、双击msi文件，然后一直选择next（默认安装路径为C:\Program Files (x86)\Graphviz2.38\），安装完成之后，会在windows开始菜单创建快捷信息。<br />![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255668-4090c541-88b5-4c7a-adab-f026bfce87a6.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u8fe66b57&originHeight=513&originWidth=627&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u8d453015-e3cf-4059-9125-9cc22c4584f&title=)<br />3、配置环境变量：计算机→属性→高级系统设置→高级→环境变量→系统变量→path，在path中加入路径：<br />![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255626-971c9879-f9db-40cd-af1a-f64857ef708d.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u4f9a3ad9&originHeight=676&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ud2dea8e4-d296-4bf0-bcc5-bbe3dab7afc&title=)<br />4、验证：在windows命令行界面，输入dot -version，然后按回车，如果显示如下图所示的graphviz相关版本信息，则安装配置成功。<br />![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255672-1fdfb5f1-38b4-4397-ba99-8141a313f3a2.webp#clientId=u5c448f25-ddc1-4&from=paste&id=uef01eadd&originHeight=352&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uef82fafe-1d39-4d4e-8661-19fa97658d0&title=)
<a name="MvN7z"></a>
## 安装pygraphviz和pybaobabdt
pip直接安装pygraphviz的话，大概率会报错，建议下载whl文件本地安装。<br />![https://www.lfd.uci.edu/~gohlke/pythonlibs](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232255948-b5405ef3-681d-4767-83d4-169c9fed432e.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u1bb8daf0&originHeight=442&originWidth=643&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=u9013ca70-86e6-41ef-bda7-2f402d81864&title=https%3A%2F%2Fwww.lfd.uci.edu%2F~gohlke%2Fpythonlibs "https://www.lfd.uci.edu/~gohlke/pythonlibs")<br />pybaobabdt就简单了，直接`pip install pybaobabdt` 即可
<a name="I9tFF"></a>
## pybaobabdt用法
pybaobabdt 用起来也简单到离谱，核心命令只有一个`pybaobabdt.drawTree`，下面是官方文档示例代码，建议在jupyter-notebook中运行。
```python
import pybaobabdt
import pandas as pd
from scipy.io import arff
from sklearn.tree import DecisionTreeClassifier
from matplotlib.colors import LinearSegmentedColormap
from matplotlib.colors import ListedColormap
from colour import Color
import matplotlib.pyplot as plt
import numpy as np

data = arff.loadarff('vehicle.arff')
df   = pd.DataFrame(data[0])
y = list(df['class'])
features = list(df.columns)

                   
features.remove('class')
X = df.loc[:, features]

clf = DecisionTreeClassifier().fit(X, y)

ax = pybaobabdt.drawTree(clf, size=10, dpi=72, features=features, colormap='Spectral')
```
![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232256244-1922a3e9-36c1-419c-bff6-afee3d4b5ffd.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u2c4541e3&originHeight=571&originWidth=579&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u82ff71f3-1a3e-42a6-93c5-0a4d94b0dd9&title=)<br />这个图怎么看呢？<br />不同的颜色对应不同的分类（target），每个分叉处都标记了分裂的条件，所以划分逻辑一目了然。树的深度也是工整的体现了出来。<br />树枝的直径也不是摆设，而是代表了样本的个数（比例），该划分条件下的样本越多，树干也就越粗。<br />发现最最底层的树枝太细太脆弱的时候，是不是应该考虑一下过拟合风险，比如需要调整一下最小样本数？
<a name="hCkc3"></a>
## 绘制随机森林
```python
import pybaobabdt
import pandas as pd
from scipy.io import arff
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestClassifier
data = arff.loadarff('vehicle.arff')

df = pd.DataFrame(data[0])
y = list(df['class'])
features = list(df.columns)
features.remove('class')
X = df.loc[:, features]

clf = RandomForestClassifier(n_estimators=20, n_jobs=-1, random_state=0)
clf.fit(X, y)
size = (15,15)
plt.rcParams['figure.figsize'] = size
fig = plt.figure(figsize=size, dpi=300)

for idx, tree in enumerate(clf.estimators_):
    ax1 = fig.add_subplot(5, 4, idx+1)
    pybaobabdt.drawTree(tree, model=clf, size=15, dpi=300, features=features, ax=ax1)
    
fig.savefig('random-forest.png', format='png', dpi=300, transparent=True)
```
![](https://cdn.nlark.com/yuque/0/2022/webp/396745/1642232256393-45ddc0c5-fb29-4605-8387-64f9f2a59dd9.webp#clientId=u5c448f25-ddc1-4&from=paste&id=u1282f5fd&originHeight=1058&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uea6d9d0e-fa05-4889-8071-15a4c2c3254&title=)
