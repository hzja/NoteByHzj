可视化
<a name="cym4p"></a>
## R-geomtextpath 简介
在常见的绘图过程中，一般的文本绘制都是短的、笔直的并且与轴一致。但有时弯曲的文本注释在绘图过程中也十分重要，特别是在极坐标系下的一些图表绘制。R-geomtextpath包就是R语言中实现弯曲文本注释功能的优秀第三方包，且基于ggplot2绘图体系，学习成本大大降低。
<a name="kn4PH"></a>
## R-geomtextpath 示例样式
<a name="Jyo4r"></a>
### 样例一：`geom_textpath()`
```r
t <- seq(5, -1, length.out = 1000) * pi
spiral <- data.frame(
  x = sin(t) * 1000:1,
  y = cos(t) * 1000:1
)
rhyme <- paste(
  "Like a circle in a spiral, like a wheel within a wheel,",
  "never ending or beginning on an ever spinning reel")

p <- ggplot(spiral, aes(x, y, label = rhyme)) +
  coord_equal(xlim = c(-1000, 1000), ylim = c(-1000, 1000))
p + geom_textpath(size  = 4)
```
![Example Of geom_textpath()](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767240-805c8cd8-97b3-42bd-be6e-1fd958e2518b.png#clientId=ue9b46e75-3ffb-4&from=paste&id=ue97035ba&originHeight=810&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=uad3ff525-a769-48f7-a6dd-8d7cec7c094&title=Example%20Of%20geom_textpath%28%29 "Example Of geom_textpath()")
<a name="MbDQV"></a>
###  样例二：`geom_labelpath()`
```r
p + geom_labelpath(size  = 4, textcolour = "#E41A1C", boxcolour = "#377eb8",
                   fill = "#ffff99", boxlinetype = "dotted", linewidth = 1,
                   boxlinewidth = 0.5) +
  hrbrthemes::theme_ipsum(base_family = "Roboto Condensed") 
```
![Example Of geom_labelpath()](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767252-c5eace5f-c66f-4bb3-bbf7-0200bb2e48c5.png#clientId=ue9b46e75-3ffb-4&from=paste&id=u4c75c7fb&originHeight=810&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=u70d46d68-baa2-4b47-84e5-bb2fafc2b19&title=Example%20Of%20geom_labelpath%28%29 "Example Of geom_labelpath()")
<a name="pN8Vg"></a>
### 样例三：geom_textdensity()
```r
i <- ggplot(iris, aes(x = Sepal.Length, colour = Species, label = Species)) +
  ylim(c(0, 1.3))

i + geom_textdensity(size = 5, vjust = -0.2, hjust = "ymax") +
   labs(subtitle = "hjust = \"ymax\"")+
   hrbrthemes::theme_ipsum(base_family = "Roboto Condensed") 
```
![Example Of geom_textdensity()](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767257-2fc8aa8b-8ac2-4f4a-87bf-2ee5f3842c59.png#clientId=ue9b46e75-3ffb-4&from=paste&id=uc897df0a&originHeight=810&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=u20409658-b388-4e83-af1b-ccccc26137b&title=Example%20Of%20geom_textdensity%28%29 "Example Of geom_textdensity()")
<a name="yL6BX"></a>
### 样例四：`coord_curvedpolar()`
```r
df <- data.frame(Temperature = c(4.4, 4.6, 6.3, 8.7, 11.6, 14.1, 15.9, 15.5,
                                 13.1, 9.7, 6.7, 4.3, 3.6, 3.9, 6.4, 9.7, 13.2,
                                 15.8, 18, 17.8, 15.1, 11.2, 7.2, 4.4),
                 City = rep(c("Glasgow", "Amsterdam"), each = 12),
                 Month = factor(rep(month.name, 2), month.name))

p <- ggplot(df, aes(Month, Temperature)) +
      geom_col(aes(fill = City), position = position_dodge(width = 1)) +
      geom_vline(xintercept = 1:13 - 0.5, color = "gray90") +
      geom_hline(yintercept = 0:3 * 5, color = "gray90") +
      scale_fill_manual(values = c("darkorange", "dodgerblue4")) +
      ggtitle("Average monthly temperature in Amsterdam and Glasgow") +
      theme_bw() +
      theme(panel.border = element_blank(),
            axis.text.x = element_text(size = 14),
            axis.title.x = element_blank(),
            panel.grid.major = element_blank())
p + coord_curvedpolar()
```
![Example Of coord_curvedpolar()](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767247-83108a6e-3a07-4b1e-9bbd-c323647a86fe.png#clientId=ue9b46e75-3ffb-4&from=paste&id=u0eb50e17&originHeight=810&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=ufbbf6f5e-9bec-494d-9922-8f91cee9ba1&title=Example%20Of%20coord_curvedpolar%28%29 "Example Of coord_curvedpolar()")
<a name="MgNds"></a>
### 样例五：Stat layers 绘制
```r
ggplot(iris, aes(Sepal.Width, Sepal.Length, colour = Species)) +
  geom_point(alpha = 0.3) +
  stat_ellipse(
    aes(label = Species),
    geom = "textpath", hjust = 0.25,
  ) +
  hrbrthemes::theme_ipsum(base_family = "Roboto Condensed") +
  theme(legend.position = "none")
```
![Example Of Stat layers](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767220-2f854ec9-8fca-47ed-91d7-7e1111a878a0.png#clientId=ue9b46e75-3ffb-4&from=paste&id=u86118ccb&originHeight=810&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=true&status=done&style=shadow&taskId=u98e57246-7c30-43e5-84ad-00450a229e2&title=Example%20Of%20Stat%20layers "Example Of Stat layers")
<a name="cR6zE"></a>
### 样例六：Covid effects on life activities
```r
ggplot(covidpie$df, aes(xvals, yvals)) +
  geom_col(width = 1.05, aes(fill = cols)) +
  geom_vline(colour = "white", xintercept = sep, size = 3) +
  geom_segment(data = data.frame(x = 0.5 + 1:24, y = 0, yend = 1),
               aes(x = x, y = 0, yend = 1, xend = x), colour = "white",    
               inherit.aes = FALSE) +
  geom_textpath(data = covidpie$sublabels,
                mapping = aes(x, y, label = z, group = id), size = 3.8,
                upright = FALSE, text_only = TRUE, hjust = 0, 
                color = "white", family = "Times New Roman") +

  geom_text(x = 32, y = -2, label = "Activities", check_overlap = TRUE, 
            size = 7, family = "Times New Roman") + 
  geom_text(x = 32, y = -1.4, label= "Changing time allocations\ndue to Covid",
            lineheight = 1, check_overlap = TRUE, family = "Times New Roman") +
  geom_textpath(data = covidpie$df_text, aes(x, y, label = text), 
                upright = FALSE, size = 2, rich = TRUE, text_only = TRUE, 
                halign = "left") +
  geom_text(x = 36.5, y = 1.8, label = covidpie$label1, hjust = 0,
            size = 2, check_overlap = TRUE, vjust = 1) +
  geom_text(x = 32.8, y = 0.75, label = covidpie$label2, vjust = 1, hjust = 0,
            size = 2, check_overlap = TRUE) +
  geom_text(x = 28.8, y = 1.04, label = covidpie$label3, hjust = 0,
            size = 2, check_overlap = TRUE, vjust = 1) +
  scale_y_continuous(limits = c(-2, 2.2)) +
  scale_fill_manual(values = covidpie$fills) +
  scale_x_continuous(expand = c(0.2, 1)) +
  coord_polar(start = -pi) +
  theme_void() +
  theme(legend.position = "none")
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767706-2ffc1029-7aeb-49d5-a0f3-7bea13ae6719.png#clientId=ue9b46e75-3ffb-4&from=paste&id=u9a99cbbf&originHeight=906&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uafdcff05-170e-4cc6-8e16-a8a3f6e94f6&title=)
<a name="kHQqr"></a>
### 样例七：Planetary orbits
```r
set.seed(1)
planets <- c("Jupiter", "Saturn", "Uranus", "Neptune")
t  <- seq(0, pi * 2, len = 500)
AU <- c(5.203, 9.539, 19.18, 30.06)

df <- data.frame(x = as.vector(outer(cos(t), AU)),
                 y = as.vector(outer(sin(t), AU)),
                 Planet = rep(planets, each = 500),
                 position = rep(c(0.75, 0.2, 0.4, 0.1)))

ggplot(df, aes(x, y, color = Planet)) +
  geom_point(inherit.aes = FALSE, 
             data = data.frame(x = runif(1000, -30, 30),
                               y = runif(1000, -30, 30),
                               intens = runif(1000)/2),
             mapping = aes(x, y, alpha = intens), color = "white", size = 0.2) +
  geom_textpath(aes(label = Planet), linewidth = 0.3,
                hjust = rep(c(0, 0.25, 0.75, 1), each = 500),
                vjust = 1.1, size = 5, upright = TRUE, fontface = 2) +
  geom_point(data = df[c(170, 600, 1385, 1965),], size = c(4, 3.5, 1.5, 1.5)) +
  geom_point(x = 0, y = 0, size = 5, color = "#FFFFA0", inherit.aes = FALSE) +
  scale_alpha_identity() +
  scale_color_manual(values = c(Jupiter = "orangered",
                                Uranus ="violet", 
                                Neptune = "skyblue", 
                                Saturn = "gold")) +
  coord_equal() +
  theme_void() +
  theme(plot.background = element_rect(fill = "black"),
        legend.position = "none")
```
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1646704767743-ceb01161-d1db-49b9-9819-632cc5148ad7.png#clientId=ue9b46e75-3ffb-4&from=paste&id=u72e38058&originHeight=906&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u04cb95de-cb75-4d92-95ea-c273b71bfc0&title=)
