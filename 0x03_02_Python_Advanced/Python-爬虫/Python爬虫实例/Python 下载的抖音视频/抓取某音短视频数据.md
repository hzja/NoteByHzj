Python<br />众所周知，某音短视频是没有提供下载链接的，<br />微信视频号也没下载链接，但就想下载下来，还有视频下面的评论也想拿到，那要怎么办呢？<br />其实播放链接和评论是可以拿到的
<a name="UZhVZ"></a>
### 抓包
通过 mitmproxy 进行抓包<br />在 windows 上直接使用 pip 安装即可
> 先看效果，代理配置和证书安装放到最后。

它是一个抓包工具，支持python脚本：
```bash
mitmdump -s test.py
#安装mitmproxy完就有mitmdump命令
```
通过该抓包工具，可以获取所有链接。<br />链接是有特征的，比如

- 某音视频链接一般匹配web.douyinvod.com
- 微信视频号匹配video.qq.com
- 某音视频下的评论匹配v1/web/comment/list

所以要下载哪个，替换 if 中的匹配条件就好了：
```python
#匹配某音短视频的评论
import json
def response(flow):
    if 'v1/web/comment/list' in flow.request.url:
        for comment in json.loads(flow.response.text)['comments']:
            print('nice111',comment['text'])
```
在某音发布了一个视频，一直想把它下载下来<br />![](./img/1671706332057-7f038f02-0f49-4b7e-aeb2-671e1314ad20.png)<br />那就执行脚本
```python
def response(flow):
    if 'web.douyinvod.com' in flow.request.url:
        print('nice111',flow.request.url)
```
![](./img/1671706332035-30393901-8176-4039-b137-17a5a94a0d89.png)<br />刷新视频，就会出现视频链接<br />![](./img/1671706332200-c4702448-9583-4780-8ac2-a408deb6deac.png)<br />可以使用 you-get 下载，或者通过脚本把链接写入文件，刷一个视频，脚本就自动把链接存储好。<br />这样就下载到本地了：<br />![](./img/1671706332026-9a265b89-6fa6-4ea2-a589-1e527d83efb1.png)<br />微信公众号里的视频下载方法同样如此，换个条件即可
<a name="lJrXA"></a>
### 获取评论
同理，换汤不换药，替换 if 条件
```python
import json
def response(flow):
    if 'v1/web/comment/list' in flow.request.url:
        for comment in json.loads(flow.response.text)['comments']:
            print('nice111',comment['text'])
```
选择一个短视频，打开评论，出现数据<br />![](./img/1671706332013-390c8be3-add9-4a93-8ae7-fc8aa5bccb05.png)<br />![](./img/1671706332350-f0d8d70f-574a-4822-b68a-6bf5c11b3f77.png)<br />好了，剩下的就简单了！<br />最后再介绍环境配置，证书安装和配置代理的内容
<a name="ylfpb"></a>
### 安装证书
pip 安装 MitmProxy 后，还不能拦截到数据，这是因为没有安装证书和打开对应的监听窗口。<br />windows 平台的证书其实在装 mitmproxy 的时候系统已经自动下载了。<br />安装路径在 C:\Users\用户名\ .mitmproxy 下，p12 结尾的证书就是 windows 平台下的<br />![](./img/1671706332384-7c1f7059-4b1d-4393-8a5c-9567ffc1af6b.png)<br />双击mitmproxy-ca.p12,进入证书导入向导。<br />![](./img/1671706332429-866c5553-633d-4b07-8386-8f8a13dc0b41.png)<br />傻瓜式安装，下一步就行<br />![](./img/1671706332717-156b4274-68da-4dd7-a1f9-0968626e3e9f.png)<br />注意这里的密码填空就行了。<br />下一步将证书放入下列存储选项中，选择受信任的根证书颁发机构<br />![](./img/1671706332641-c0026897-046f-4dd4-a6a5-5ea4f3c1199e.png)<br />点击完成，证书就导入到当前用户\计算机的根证书存储里面了
<a name="OK6ak"></a>
### 设置代理
![](./img/1671706332785-1c8b0fd4-9277-4aa6-a27a-c2f85b490fae.png)<br />打开代理，并且端口号为Proxy监听的端口号8080(手机端的安装配置与其类似)，这时候重启mitmweb，可以看到下图所示，抓到本机发出的请求flow(流)了<br />![](./img/1671706332836-e3f62327-3585-4380-a97c-9a1fe2c6bcc7.png)<br />![](./img/1671706332980-08f3b4b1-301f-497c-ac95-bd74d6327b00.png)
