<a name="uqgvy"></a>
## Plotly 概述
plotly 的 Python 软件包是一个开源的代码库，它基于 plot.js，而后者基于 d3.js。实际使用的则是一个对 plotly 进行封装的库，名叫 cufflinks，它能让你更方便地使用 plotly 和 Pandas 数据表协同工作。
> _*注：Plotly 本身是一个拥有多个不同产品和开源工具集的可视化技术公司。Plotly 的 Python 库是可以免费使用的，在离线模式可以创建数量不限的图表，在线模式因为用到了 Plotly 的共享服务，只能生成并分享 25 张图表。_

本文中的所有可视化图表都是在 Jupyter Notebook 中使用离线模式的 plotly + cufflinks 库完成的。在使用 `pip install cufflinks plotly` 完成安装后，可以用下面这样的代码在 Jupyter 里完成导入：<br />![](./img/1700972657085-82fb3a0e-b57b-4b9b-b0c8-440e8ada3ba7.png)<br />**单变量分布：柱状图和箱形图**<br />单变量分析图往往是开始数据分析时的标准做法，而柱状图基本上算是单变量分布分析时必备的图表之一（虽然它还有一些不足）。<br />就拿博客文章点赞总数为例做一个简单的交互式柱状图：<br />![（代码中的 df 是标准的 Pandas dataframe 对象）](./img/1700972657119-539dd07d-bce0-4024-9c31-d2c12ddc0d51.png "（代码中的 df 是标准的 Pandas dataframe 对象）")<br />![（使用 plotly+cufflinks 创建的交互式柱状图）](./img/1700972657111-249ed0de-c433-424e-b19e-f64a417df0e5.gif "（使用 plotly+cufflinks 创建的交互式柱状图）")<br />对于已经习惯 matplotlib 的同学，只需要多打一个字母（把 .plot 改成 .iplot ），就能获得看起来更加美观的交互式图表！点击图片上的元素就能显示出详细信息、随意缩放，还带有（接下来会提到的）高亮筛选某些部分等超棒功能。<br />如果想绘制堆叠柱状图，也只需要这样：<br />![](./img/1700972657095-c8fde934-533d-40c4-b167-48a9911fc224.png)<br />![](./img/1700972657131-24d6bde0-47db-444a-8c35-d6511edb32da.png)<br />对 pandas 数据表进行简单的处理，并生成条形图：<br />![](./img/1700972657584-c41421c7-988e-450e-8ae1-5ef5e1363a8f.png)<br />![](./img/1700972657542-bf6c8c60-32dd-44b9-80bb-43aea9aa5594.png)<br />就像上面展示的那样，**可以将 plotly + cufflinks 和 pandas 的能力整合在一起**。比如，可以先用 `.pivot()` 进行数据透视表分析，然后再生成条形图。<br />比如统计不同发表渠道中，每篇文章带来的新增粉丝数：<br />![](./img/1700972657641-bfaf16a1-f0d0-4fd0-8cb6-c54e2895b81d.png)<br />![](./img/1700972657675-b9a1bfba-adce-4555-b18c-42c365961a4a.gif)

交互式图表带来的好处是，可以随意探索数据、拆分子项进行分析。箱型图能提供大量的信息，但如果看不到具体数值，很可能会错过其中的一大部分！
<a name="w02dq"></a>
## 散点图
散点图是大多数分析的核心内容，它能让我们看出一个变量随着时间推移的变化情况，或是两个（或多个）变量之间的关系变化情况。
<a name="DPPis"></a>
## 时序列分析
在现实世界中，相当部分的数据都带有时间元素。幸运的是，plotly + cufflinks 天生就带有支持时间序列可视化分析的功能。<br />以在“Towards Data Science”网站上发表的文章数据为例，以发布时间为索引构建一个数据集，看看文章热度的变化情况：<br />![](./img/1700972658192-44eb34e3-d372-478d-8057-3994095d46fa.png)<br />![](./img/1700972658195-d7b40a14-878d-4c05-92d7-d5304bb9de8f.gif)<br />在上图中，用一行代码完成了几件事情：

- 自动生成美观的时间序列 X 轴
- 增加第二条 Y 轴，因为两个变量的范围并不一致
- 把文章标题放在鼠标悬停时显示的标签中

为了显示更多数据，可以方便地添加文本注释：<br />![](./img/1700972658268-bf97327e-cb37-40fd-8ac6-384f7981f89f.png)<br />![（带有文本注释的散点图）](./img/1700972658242-a4ab1822-5b85-4482-b67b-12ed0a5e89f5.png "（带有文本注释的散点图）")<br />下面的代码中，将一个双变量散点图按第三个分类变量进行着色：<br />![](./img/1700972658383-e124a647-45aa-4954-9747-bf91afadc406.png)<br />![](./img/1700972658668-698f4443-ec85-46fa-b6cf-7ca7fbda099d.png)<br />接下来要玩点复杂的：对数坐标轴。通过指定 plotly 的布局（layout）参数来实现这一点（关于不同的布局，请参考官方文档 [https://plot.ly/python/reference/](https://plot.ly/python/reference/) ），同时把点的尺寸（size参数）和一个数值变量 read_ratio （阅读比例）绑定，数字越大，泡泡的尺寸也越大。<br />![](./img/1700972658829-7e8e51c9-4a26-443c-86a7-ac9a654fa108.png)<br />![](./img/1700972658790-1b27e284-294a-4374-b5da-7f088e9d6707.png)<br />如果想要更复杂一些（详见 Github 的源代码），甚至可以在一张图里塞进 4 个变量！（然而并不推荐真的这么搞）<br />![](./img/1700972658801-0b4a7d09-10cd-4bed-b31f-0749194feeff.png)<br />和前面一样，可以将 pandas 和 plotly+cufflinks 结合起来，实现许多有用的图表：<br />![](./img/1700972659091-5faaaf14-12c5-4df7-b164-8986fad6b270.png)<br />![](./img/1700972659167-d127a11d-7a98-4f51-8f43-e4c4d9dafba5.png)<br />建议查看官方文档，或者源代码，里面有更多的范例和函数实例。只需要简单的一两行代码，就可以为图表加上文字注释，辅助线，最佳拟合线等有用的元素，并且保持原有的各种交互式功能。
<a name="fpUw1"></a>
## 高级绘图功能
接下来，要详细介绍几种特殊的图表，平时可能并不会很经常用到它们，但只要用好了它们，一定能让人刮目相看。要用到 plotly 的 figure_factory 模块，只需要一行代码，就能生成超棒的图表！
<a name="ifEmj"></a>
## 散点图矩阵
假如要探索许多不同变量之间的关系，散点图矩阵（也被称为SPLOM）就是个很棒的选择：<br />![](./img/1700972659334-b7ee8150-e3f9-4693-97eb-b2b1dfa8939c.png)<br />![](./img/1700972659296-26977a1b-0703-4837-a9a4-78ac14ab9cf5.jpeg)<br />即使是这样复杂的图形，也是完全可交互的，能更详尽地对数据进行探索。
<a name="xl7Hy"></a>
## 关系热图
为了体现多个数值变量间的关系，可以计算它们的相关性，然后用带标注热度图的形式进行可视化：<br />![](./img/1700972659690-ccf57d6f-21d0-41bd-ae5b-c4be3bf35862.png)<br />![](./img/1700972659869-96120b34-f474-469c-a35d-888d066cba3a.jpeg)
<a name="ss9qJ"></a>
## 自定义主题
除了层出不穷的各种图表外，Cufflinks 还提供了许多不同的着色主题，方便轻松切换各种不同的图表风格。下面两张图分别是“太空”主题和“ggplot”主题：<br />![](./img/1700972659895-19d39f44-6748-4bc6-bc1f-0453fe918e66.png)<br />![](./img/1700972660059-b1cdfdeb-3aeb-4b94-af56-edf64a1b59f1.png)<br />此外，还有 3D 图表（曲面和泡泡）：<br />![](./img/1700972660214-af80e22d-8bbc-47f9-89ac-af74a08a205a.png)<br />![](./img/1700972660262-c2e89eb8-749f-4968-aea8-e927584c58f0.png)<br />对有兴趣研究的用户来说，做张饼图也不是什么难事：<br />![](./img/1700972660334-8fea1f73-9b67-408b-aa04-794227feb7a2.png)
<a name="qgEp7"></a>
## 在 Plotly 图表工坊（Plotly Chart Studio）里编辑
当在 Jupyter Notebook 里生成了这些图表之后，会发现图表的右下角出现了一个小小的链接，写着“Export to plot.ly（发布到 plot.ly）”。如果点击这个链接，将会跳转到一个“图表工坊”（https://plot.ly/create/）。<br />在这里，可以在最终展示之前进一步修改和润色图表。可以添加标注，选择某些元素的颜色，把一切都整理清楚，生成一个超棒的图表。之后，还可以将它发布到网络上，生成一个供其他人查阅的链接。<br />下面两张图是在图表工坊里制作的：<br />![](./img/1700972660390-caab971b-52e6-42cc-80aa-3637e00d3501.png)<br />![](./img/1700972660695-591a3502-7caf-4768-942a-ad796c425e6f.png)<br />限于篇幅，有些更棒的图表和范例，只好请大家访问 plotly 和 cufflinks 的官方文档去一一查看。<br />![（Plotly 交互式地图，显示了美国国内的风力发电场数据。来源：plot.ly）](./img/1700972660958-8422987a-cd6f-419a-acbf-5695fecd0d00.jpeg "（Plotly 交互式地图，显示了美国国内的风力发电场数据。来源：plot.ly）")
