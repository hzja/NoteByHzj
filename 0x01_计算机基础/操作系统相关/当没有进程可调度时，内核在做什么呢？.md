内核的主要职责是进程调度，比如当一个进程阻塞时，它会调度另外一个进程来执行。<br />那当没有进程可以调度时，内核在做什么呢？<br />此时，内核会进入到idle状态，其大致逻辑是：
```c
while (1) {
    while (!need_resched()) { // 判断是否有其他进程可执行
        asm("hlt"); // 如果没有，则执行hlt指令
    }
    schedule_idle(); // 如果有，则转而执行其他进程
}
```
由上可见，当没有其他进程可执行时，idle循环里会一直执行hlt汇编指令，该指令的作用是暂停cpu的执行，直到有中断等情况发生时。<br />当有中断发生时，比如内核接收到了新的tcp包，此时某个进程会从阻塞状态转变为可执行状态。<br />当中断逻辑执行完毕后，上面的idle循环也会从halt状态退出，继续循环执行`need_resched()`函数，此时该函数返回true，表示有其他进程可执行，这样该逻辑会退出hlt循环，继续执行`schedule_idle()`函数，`schedule_idle()`函数的作用是从idle进程切换到目标进程，进而执行其对应的代码。<br />这样，内核就从idle状态，退回到了正常的进程调度状态。<br />当其他所有进程又都执行完毕，又都进入到了阻塞状态，导致内核没有进程可调度时，内核逻辑又会切换到上述idle循环代码，从`schedule_idle()`函数后继续执行，即进入下一次循环。<br />上面的idle循环在内核中也是以一个进程来表示的，它的pid是0，它的名字是swapper。
