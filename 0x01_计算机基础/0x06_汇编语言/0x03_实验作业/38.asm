.386
PRST MACRO X
    PUSH DX
    PUSH AX
    LEA DX,X
    MOV AH,9
    INT 21H
    POP AX
    POP DX
ENDM

SCAN MACRO X
    PUSH DX
    PUSH AX
    LEA DX,X
    MOV AH,0AH
    INT 21H
    POP AX
    POP DX
ENDM

PRC MACRO X
    PUSH DX
    PUSH AX
    MOV DL,X
    MOV AH,2
    INT 21H
    POP AX
    POP DX
ENDM


DATAS SEGMENT USE16
   LEN = 0
   SCANBUF DB 5
   COUNT DB 0
   CHAR DB 7 DUP(0);输入用
   COU DW 10 DUP(0);统计数据段的个数
   BUF DW 100 DUP(0);记录数据
   NUM DW 0;BUF数据的个数
   TEN DW 10
   HUNDRED DW 100
   STR1 DB 10 DUP(0);输出用字符串
   PROMPT1 DB 'please input number(0~999): ','$'
   PROMPT2 DB 'There are no number char!',13,10,'$'
   PROMPT3 DB 'There are the numbers: ',13,10,'$'
   PROMPT4 DB 'The statistics result below: ',13,10,'$'
   NUMPROMPT DB '000<=~<=099: ','$'
   CRLF DB 13,10,'$'
DATAS ENDS

STACKS SEGMENT USE16
   ;此处输入堆栈段代码
STACKS ENDS

CODES SEGMENT USE16
   ASSUME CS:CODES,DS:DATAS,SS:STACKS

START:
    MOV AX,DATAS
    MOV DS,AX

    CALL SCANF
    PRST CRLF

    PRST PROMPT3
    CALL DISP
    PRST CRLF

    PRST PROMPT4
    CALL CALUCULATE
    CALL DISPCAL

    MOV AH,4CH
    INT 21H

SCANF PROC NEAR
    PUSHA
    LEA BX,BUF;BX存放当前在BUF中的地址
STA: PRST PROMPT1
    SCAN SCANBUF
    XOR AX,AX
    MOV AL,COUNT
    LEA DI,CHAR;DI存放在CHAR末+1位字符位置
    ADD DI,AX
    XOR CX,CX
    XOR AX,AX
    LEA SI,CHAR;SI存放现在字符位置
INFOR: MOV CL,[SI]
    CMP CL,'0'
    JB SCANFEXIT
    CMP CL,'9'
    JA SCANFEXIT
    SUB CL,30H;将CX转成数据
    MUL TEN
    ADD AX,CX;AX存放一次输入的数据
    INC SI
    CMP SI,DI
    JB INFOR
    PRST CRLF
    MOV [BX],AX
    ADD BX,2
    INC NUM
    JMP STA
SCANFEXIT: PRST CRLF
    PRST PROMPT2
    POPA
    RET
SCANF ENDP

DISP PROC NEAR;显示数据
   PUSHAD
   LEA SI,BUF
L1:  XOR AX,AX
    MOV DI,0
    MOV CX,0
    MOV AX,[SI]
    CMP AX,0
    JE DISPEXIT
L5:  XOR DX,DX
   DIV TEN
   PUSH DX
   INC CX
   CMP AX,0
   JNZ L5
L6: POP AX
   ADD AL,30H
   MOV STR1[DI],AL
   INC DI
   LOOP L6
   MOV STR1[DI],'$'
   PRST STR1
   ADD SI,2
   PRC ','
   JMP L1
DISPEXIT: CALL DELETE
   POPAD
   RET
DISP ENDP

DISPTEN PROC NEAR;显示10进制无符号程序，入口为AX
   PUSHAD
   MOV DI,0
   MOV CX,0
L3:  XOR DX,DX
   DIV TEN
   PUSH DX
   INC CX
   CMP AX,0
   JNZ L3
L4: POP AX
   ADD AL,30H
   MOV STR1[DI],AL
   INC DI
   LOOP L4
   MOV STR1[DI],'$'
   PRST STR1
   POPAD
   RET
DISPTEN ENDP

DISPCAL PROC NEAR;显示统计结果
    PUSHA
    MOV CX,10
    LEA SI,COU
DIS: PRST NUMPROMPT
    XOR AX,AX
    MOV AX,[SI]
    CALL DISPTEN
    PRST CRLF
    ADD SI,2
    INC NUMPROMPT[0]
    INC NUMPROMPT[8]
    LOOP DIS
    POPA
    RET
DISPCAL ENDP

CALUCULATE PROC NEAR
    PUSHA
    LEA DI,BUF
    MOV CX,NUM
CAL:MOV AX,[DI]
    MOV DX,0
    DIV HUNDRED
    ADD AX,AX
    MOV SI,AX
    INC COU[SI]
    ADD DI,2
    LOOP CAL
    POPA
    RET
CALUCULATE ENDP    

DELETE PROC NEAR
   PUSH DX
   PUSH AX
   MOV DL,8H;退格
   MOV AH,2H
   INT 21H
   MOV DL,' ';将逗号填充成空格
   MOV AH,2H
   INT 21H
   POP AX
   POP DX
   RET
DELETE ENDP

CODES ENDS
   END START

