# C++ 异常

<a name="fsZjj"></a>

### 调用abort处理异常
```cpp
#include <iostream>

using namespace std;

// 调用abort处理异常
double hmean(double a, double b){
    if (a == -b) {
        cout << "untenable argument to hmean()\n";
        abort();
    }
    return 2.0 * a * b / (a + b);
}

void errorOne(){
    double x, y, z;
    cout << "Enter two numbers: ";
    while (cin >> x >> y) {
        z = hmean(x, y);
        cout << "Harmonic mean of " << x << " and " << y << " is " << z << endl;
        cout << "Enter next set of numbers <q to quit>: ";
    }
    cout << "Bye!\n";
}

int main() {
    errorOne();
    return 0;
}
```
<a name="mUo2S"></a>
### 返回错误码
```cpp
#include <iostream>
#include <cfloat>

using namespace std;

// 返回错误码
bool hmean(double a, double b, double *ans);

bool hmean(double a, double b, double *ans){
    if (a == -b) {
        *ans = DBL_MAX;
        return false;
    } else{
        *ans = 2.0 * a * b / (a + b);
        return true;
    }
}

void errorCode(){
    double x, y, z;
    cout << "Enter two numbers: ";
    while (cin >> x >> y) {
        if (hmean(x, y, &z))
            cout << "Harmonic mean of " << x << " and " << y << " is " << z << endl;
        else
            cout << "One value should not be the negative of the other - try again.\n";
        cout << "Enter next set of numbers <q to quit>: ";
    }
    cout << "Bye!\n";
}

int main() {
    errorCode();
    return 0;
}
```
<a name="CQEVL"></a>
### 使用throw抛出异常
```cpp
double hmean(double a, double b){
    if (a == -b) {
        throw "bad hmean() arguments: a = -b not allowed!";
    }
    return 2.0 * a * b / (a + b);
}
```
<a name="XEsmo"></a>
### 使用try catch捕获异常
```cpp
#include <iostream>
#include <cfloat>

using namespace std;

// 捕获异常
void errorTryCatch(){
    double x, y, z;
    cout << "Enter two numbers: ";
    while (cin >> x >> y) {
        try {
            z = hmean(x, y);
        }catch (const char * s) {
            cout << s << endl;
            cout << "Enter a new pair of number: ";
            continue;
        }
        cout << "Harmonic mean of " << x << " and " << y << " is " << z << endl;
        cout << "Enter next set of numbers <q to quit>: ";
    }
    cout << "Bye!\n";
}

int main() {
    errorTryCatch();
    return 0;
}
```
<a name="87ZAV"></a>
### 将对象用做异常类型
<a name="AgZfe"></a>
#### [exc_mean.h](https://github.com/Fcscanf/Pro1/commit/c1916842324cc0e68ee11c6733c773a8b185a4c6#diff-9db96d3ee5c3623bc8897b7202d1448c60b7af149dbb8acedbc7f1b7bd4f256d)
```cpp
#ifndef PRO1_EXC_MEAN_H
#define PRO1_EXC_MEAN_H

#include <iostream>

using namespace std;

class bad_hmean {
private:
    double v1;
    double v2;
public:
    bad_hmean(double a = 0, double b = 0) : v1(a), v2(b){}
    void mesg();
};

inline void bad_hmean::mesg() {
    cout << "hmean(" << v1 << ", " << v2 << "): " << "invalid argumets: a = -b\n";
}

class bad_gmean{
public:
    double v1;
    double v2;
    bad_gmean(double a = 0, double b = 0) : v1(a), v2(b){}
    const char *mesg();
};

inline const char * bad_gmean::mesg() {
    return "gmean() arguments should be >= 0\n";
}

#endif //PRO1_EXC_MEAN_H
```
<a name="Iy6DN"></a>
#### [exc_mean.cpp](https://github.com/Fcscanf/Pro1/commit/c1916842324cc0e68ee11c6733c773a8b185a4c6#diff-81801621faf063bf5700c787d695ff3f3106bd6469be0ea48326f87b78d89267)
```cpp
#include "exc_mean.h"
```
<a name="Nt93i"></a>
#### [main.cpp](https://github.com/Fcscanf/Pro1/commit/c1916842324cc0e68ee11c6733c773a8b185a4c6#diff-608d8de3fba954c50110b6d7386988f27295de845e9d7174e40095ba5efcf1bb)
```cpp
#include <iostream>
#include "module14_error/error_class/exc_mean.h"

using namespace std;

// function proptotypes
double hmeans(double a, double b) throw (bad_hmean);
double gmeans(double a, double b) throw (bad_gmean);

double hmeans(double a, double b) throw (bad_hmean){
    if (a == -b)
        throw bad_hmean(a, b);
    return 2.0 * a * b / (a + b);
}

double gmeans(double a, double b) throw (bad_gmean){
    if (a < 0 || b < 0) {
        throw bad_gmean(a, b);
    }
    return sqrt(a * b);
}

void useErrorClass(){
    double x, y, z;
    cout << "Enter two numbers: ";
    while (cin >> x >> y) {
        try {
            z = hmeans(x, y);
            cout << "Harmonic mean of " << x << " and " << y << " is " << z << endl;
            cout << "Geometric mean of " << x << " and " << y << " is " << gmeans(x, y) << endl;
            cout << "Enter next set of numbers <q to quit>: ";
        }catch (bad_hmean & bg) {
            bg.mesg();
            cout << "Try again.\n";
            continue;
        }catch (bad_gmean & hg) {
            cout << hg.mesg();
            cout << "Values used: " << hg.v1 << ", " << hg.v2 << endl;
            cout << "Sorry , you don't get to play any more.\n";
            break;
        }
    }
    cout << "Bye!\n";
}

int main() {
    useErrorClass();
    return 0;
}
```
<a name="MXoR2"></a>
### 堆栈解退
<a name="QIwmm"></a>
#### [stack_resolution.h](https://github.com/Fcscanf/Pro1/commit/0e86a0bcea8674466eabd9b42b15960d865ac25d#diff-29c5f4eff4c6de402060e98dde8544392e569c2cdaf1d96af5aefdd9ed47f446)
```cpp
#ifndef PRO1_STACK_RESOLUTION_H
#define PRO1_STACK_RESOLUTION_H

#include <iostream>
#include <cmath>
#include <cstring>
#include "../error_class/exc_mean.h"

using namespace std;

class stack_resolution {
private:
    char word[40];
public:
    stack_resolution(const char * str){
        strcpy(word, str);
        cout << "Stack resolution : " << word << " created\n";
    }
    ~stack_resolution(){
        cout << "Stack resolution : " << word << " destroyed\n";
    }
    void show()const {
        cout << "Stack resolution : " << word << " lives!\n";
    }
};

// function prototypes
double mean_h(double a, double b) throw(bad_hmean);
double mean_g(double a, double b) throw(bad_gmean);
double mean_s(double a, double b) throw(bad_hmean, bad_gmean);

double mean_h(double a, double b) throw(bad_hmean){
    if (a == -b)
        throw bad_hmean(a, b);
    return 2.0 * a * b / (a + b);
}

double mean_g(double a, double b) throw(bad_gmean){
    if (a < 0 || b < 0) {
        throw bad_gmean(a, b);
    }
    return sqrt(a * b);
}

double mean_s(double a, double b) throw(bad_hmean, bad_gmean){
    double am, hm, gm;
    stack_resolution d2("found in means()");
    am = (a + b) / 2.0;
    try {
        hm = mean_h(a, b);
        gm = mean_g(a, b);
    } catch (bad_hmean &bg) {
        bg.mesg();
        cout << "Caught in means()\n";
        throw ;
    }
    d2.show();
    return (am + hm + gm) / 3.0;

}

// 堆栈解退
void useStackResolution(){
    double x, y, z;
    stack_resolution d1("found in main()");
    cout << "Enter two numbers: ";
    while (cin >> x >> y) {
        try {
            z = mean_s(x, y);
            cout << "The mean of " << x << " and " << y << " is " << z << endl;
            cout << "Enter next pair: ";
        }catch (bad_hmean & bg) {
            bg.mesg();
            cout << "Try again.\n";
            continue;
        }catch (bad_gmean & hg) {
            cout << hg.mesg();
            cout << "Values used: " << hg.v1 << ", " << hg.v2 << endl;
            cout << "Sorry , you don't get to play any more.\n";
            break;
        }
    }
    d1.show();
    cout << "Bye!\n";
}

#endif //PRO1_STACK_RESOLUTION_H
```
<a name="pinJT"></a>
#### [stack_resolution.cpp](https://github.com/Fcscanf/Pro1/commit/0e86a0bcea8674466eabd9b42b15960d865ac25d#diff-91ea1cd3d9768f42957e0d0f10e360288f7d04c7526318617c07a1ca0eafe934)
```cpp
#include "stack_resolution.h"
```

