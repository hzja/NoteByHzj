# 视图

## 0.url匹配的过程

![1580538190172-34b562e9-f867-406d-8d70-665b505c2c3e](D:\Note\python\Django\图片\1580538190172-34b562e9-f867-406d-8d70-665b505c2c3e.png)



## 1.自定义试图函数(几乎不用)

> request参数必须有；
>
> 是一个HttpRequest类型对象；
>
> 视图须返回HttpResponse对象，HttpResponse中的参数内容会显示在浏览器页面上；
>
> 可能重定向redirect还可能返回json数据；



~~~ python
from django.shortcuts import render
from django.http import HttpResponse
from django.template import loader,RequestContext

# 视图调用模板
'''
1.找到模板
2.定义上下文
3.渲染模板
'''

def my_render(request, template_path, context_dict={}):
    # 使用模板文件
    # 1.加载模板文件，模板对象
    temp = loader.get_template(template_path)
    # 2.定义模板上下文：给模板传递数据
    context = RequestContext(request, context_dict)
    # 3.模板渲染：产生标准的Html内容
    res_html = temp.render(context)
    # 4.返回浏览器
    return HttpResponse(res_html)


# http://127.0.0.1:8000/index
def index(request):
    # 进行处理，和M和T进行交互，content是给前端传的参数
    return my_render(request, 'booktest/index.html',{'content':'hello word', 'list':list(range(1,10))})

# http://127.0.0.1:8000/index2
def index2(request):
    return HttpResponse('老铁666')
~~~



## 2. url匹配

> 应用中定义URLconf，booktest/应用下创建urls.py文件

~~~ python
from django.conf.urls import url
from booktest import views

# 通过url函数设置url路由配置项
urlpatterns = [
    # 建立/index和视图index之间的关系
    url(r'^index$', views.index),
    url(r'^index2$', views.index2),
]
~~~



> 将应用包含到项目中：打开test1/urls.py文件为urlpatterns列表增加项如下：

~~~ python
from django.conf.urls import include, url
from django.contrib import admin

urlpatterns = [
    url(r'^admin/', include(admin.site.urls)),
    url(r'^', include('booktest.urls')),
]
~~~



## 3.创建模板

> 为应用booktest下的视图index创建模板index.html，目录结构如下图：

![1580131023751-ff062056-8cc4-44f7-8433-c2eb6b4cde2f](D:\Note\python\Django\图片\1580131023751-ff062056-8cc4-44f7-8433-c2eb6b4cde2f.png)





> 设置查找模板的路径：打开test1/settings.py文件，设置TEMPLATES的DIRS值

~~~ python
# 设置模板路径
'DIRS': [os.path.join(BASE_DIR, 'templates')],
~~~



![1580131106866-6b65db08-958a-40a6-9fc1-1d1a7c3d837d](D:\Note\python\Django\图片\1580131106866-6b65db08-958a-40a6-9fc1-1d1a7c3d837d.png)



## 4.定义模板

> 修改templtes/booktest/index.html文件

~~~python
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>模板文件</title>
</head>
<body>
<h1>这是一个模板</h1>
使用模板变量<br/>
{{ content }}
<br/>
{{ list }}
</body>
</html>
~~~



## 5.访问

![1580131321808-98da97fd-b505-4489-bf08-058c6508c268](D:\Note\python\Django\图片\1580131321808-98da97fd-b505-4489-bf08-058c6508c268.png)