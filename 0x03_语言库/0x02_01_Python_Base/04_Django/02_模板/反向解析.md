# 反向解析

## 作用

当某一个url配置的地址发生变化时，页面上使用反向解析生成地址的位置不需要修改



## 示例

要实现反向解析功能，需要如下步骤：

1）在test4/urls.py中为include定义namespace属性

~~~ python
url(r'^',include('booktest.urls',namespace='booktest')),
~~~



2）booktest/urls.py中为url定义name属性并改为fan2

~~~ python
url(r'^fan2/$', views.fan2,name='fan2'),
~~~



3）模板中用url标签做超链接，此处为templates/booktest/fan1.html文件

~~~ html
<html>
<head>
    <title>反向解析</title>
</head>
<body>
普通链接：<a href="/fan2/">fan2</a>
<hr>
反向解析：<a href="{%url 'booktest:fan2'%}">fan2</a>
</body>
</html>
~~~



4）回到浏览器中，后退，刷新，查看源文件如下图，两个链接地址一样![1580645246707-7e3e82bb-8341-4448-b37a-f89e8570b9b3](D:\Note\python\Django\图片\1580645246707-7e3e82bb-8341-4448-b37a-f89e8570b9b3.png)



5）booktest/urls.py中将fan2改为fan_show

~~~ python
url(r'^fan_show/$', views.fan2,name='fan2'),
~~~



6）回到浏览器中，刷新，查看源文件如下图，两个链接地址不一样![1580645246782-e7445c9e-fcb6-49b4-b0b2-a5f7b8ed6bdc](D:\Note\python\Django\图片\1580645246782-e7445c9e-fcb6-49b4-b0b2-a5f7b8ed6bdc.png)



7）反向解析也可以应用在视图的重定向中

~~~ python
from django.shortcuts import redirect
from django.core.urlresolvers import reverse

return redirect(reverse('booktest:fan2'))
~~~

**总结：**在定义url时，需要为include定义namespace属性，为url定义name属性，使用时，在模板中使用url标签，在视图中使用reverse函数，根据正则表达式动态生成地址，减轻后期维护成本。



## URL的参数

有些url配置项正则表达式中是有参数的，接下来讲解如何传递参数。

### 情况一：位置参数

1）booktest/urls.py中修改fan2如下：

~~~ python
url(r'^fan(\d+)_(\d+)/$', views.fan3,name='fan2'),
~~~



2）booktest/views中定义视图fan3如下:

~~~ python
def fan3(request, a, b):
    return HttpResponse(a+b)
~~~



3）修改templates/booktest/fan1.html文件如下

~~~ python
<html>
<head>
    <title>反向解析</title>
</head>
<body>
普通链接：<a href="/fan2_3/">fan2</a>
<hr>
反向解析：<a href="{%url 'booktest:fan2' 2 3%}">fan2</a>
</body>
</html>
~~~



4）回到浏览器中刷新，查看源文件如下图：

![1580645246711-3bba5ae7-e4b6-4185-93c6-9102c24560bf](D:\Note\python\Django\图片\1580645246711-3bba5ae7-e4b6-4185-93c6-9102c24560bf.png)

使用重定向传递位置参数格式如下：

~~~ python
return redirect(reverse('booktest:fan2', args=(2,3)))
~~~



### 情况二：关键字参数

1）booktest/urls.py中修改fan2如下：

~~~ python
url(r'^fan(?P<id>\d+)_(?P<age>\d+)/$', views.fan4,name='fan2'),
~~~



2）booktest/views中定义视图fan4如下:

~~~ python
def fan4(request, id, age):
    return HttpResponse(id+age)
~~~



3）修改templates/booktest/fan1.html文件如下：

~~~ html
<html>
<head>
    <title>反向解析</title>
</head>
<body>
普通链接：<a href="/fan100_18/">fan2</a>
<hr>
反向解析：<a href="{%url 'booktest:fan2' id=100 age=18%}">fan2</a>
</body>
</html>
~~~



4）回到浏览器中，刷新，查看源文件如下图：

![1580645246711-76bc19df-0c57-47f7-af84-cfe5ef4fa877](D:\Note\python\Django\图片\1580645246711-76bc19df-0c57-47f7-af84-cfe5ef4fa877.png)

使用重定向传递关键字参数格式如下：

~~~ python
return redirect(reverse('booktest:fan2', kwargs={'id':100,'age':18}))
~~~

