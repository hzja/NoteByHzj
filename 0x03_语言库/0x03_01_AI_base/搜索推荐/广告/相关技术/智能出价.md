任何一个广告投放体系在商业化的过程中必须考虑的两个因素就是：投放成本和投放量。只有投放成本低于整个商业链条中可接受的成本，这个商业模式才能够成立，而投放量决定了这个模式能够有多大的规模。

成本控制是衡量广告投放能力最直观的指标。 广告主、业务人员，在使用广告投放系统(例如DSP)时，与这个产品进行交互，设定成本，能够最直接感知到的就是实际投放成本，不失一般性的，我们这里讨论一种最简单的成本，cpc(cost per click).。在实际投放过程中，由于模型预估ctr不可能非常精准，甚至会有量级的差异，再加上二价的机制，都会导致=实际投放出的cpc和目标cpc严重不一致，导致成本不可控。而出价体系就是为了保证投放cpc符合预期。出价策略对于广告投放体系，就类似于GUI对于计算机的重要性，直接影响了用户体验。
<a name="LvAqM"></a>
# PID
PID算法是控制理论中，最简单，但也是应用最广泛的一种控制方法，小到控制一个元件的温度，大到控制无人机的飞行姿态和飞行速度等等，都可以使用PID控制。这里我们从原理上来理解PID控制。

PID(Proportion Integration Differentiation)其实就是指比例，积分，微分控制，由比例单元（Proportional）、积分单元（Integral）和微分单元（Derivative）组成，如下图和公式所示。PID控制器（比例-积分-微分控制器），由比例单元(![](./img/44c29edb103a2872f519ad0c9a0fdaaa.svg))、积分单元(![](./img/dd7536794b63bf90eccfd37f9b147d7f.svg))和微分单元(![](./img/f623e75af30e62bbd73d6df5b50bb7b5.svg))组成，透过![](./img/81806344483eb0e7e7374c014a39583c.svg)，![](./img/201400d073866463c42632818d600ec1.svg)和![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)三个参数的设定。PID控制器主要适用于基本上线性，且动态特性不随时间变化的系统。<br />![Pid-feedback-nct-int-correct.png](./img/1643011763624-b2151115-14c4-4992-b517-67f5902ca072.png)<br />![](./img/43f6a1e6e7e3864ac3c9cd59a00fdeb5.svg)

- ![](./img/81806344483eb0e7e7374c014a39583c.svg)：比例增益，是调适参数
- ![](./img/201400d073866463c42632818d600ec1.svg)：积分增益，也是调适参数
- ![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)：微分增益，也是调适参数
- ![](./img/e1671797c52e15f763380b45e841ec32.svg)：误差=设定值(SP)-回授值(PV)
- ![](./img/e358efa489f58062f10dd7316b65649e.svg)：目前时间
- ![](./img/a6f317b268ae825d94f832f970af607c.svg)：积分变数，数值从![](./img/cfcd208495d565ef66e7dff9f98764da.svg)到目前时间![](./img/e358efa489f58062f10dd7316b65649e.svg)
<a name="Tv6ng"></a>
## 比例控件
我们先说PID中最简单的比例控制，抛开其他两个不谈。还是用一个经典的例子吧。假设我有一个水缸，最终的控制目的是要保证水缸里的水位永远的维持在![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)米的高度。假设初始时刻，水缸里的水位是![](./img/3d522deaf85577451c01974654b36ad3.svg)米，那么当前时刻的水位和目标水位之间是存在一个误差的![](./img/e1671797c52e15f763380b45e841ec32.svg)，且![](./img/2a896162d25c99c658fc374646405f0b.svg)。这个时候，假设旁边站着一个人，这个人通过往缸里加水的方式来控制水位。如果单纯的用比例控制算法，就是指加入的水量![](./img/7b774effe4a349c6dd82ad4f4f21d34c.svg)和误差![](./img/e1671797c52e15f763380b45e841ec32.svg)是成正比的。即

![](./img/34124d83b118b4f9c051c2ee3c8b6902.svg)<br />假设![](./img/81806344483eb0e7e7374c014a39583c.svg)设置为![](./img/d310cb367d993fb6fb584b198a2fd72c.svg)，![](./img/2a3b0083d37795fe4b6aec64c81be478.svg)<br />![](./img/b73c3280b6f85a6ac520af103083f535.svg)时（表示第1次加水，也就是第一次对系统施加控制），那么![](./img/acfbba4762eebb04e55a38da23966f71.svg)，所以这一次加入的水量会使水位在![](./img/3d522deaf85577451c01974654b36ad3.svg)的基础上上升![](./img/54fbf38cf649866815e0fefc46a1f6c7.svg)，达到![](./img/e95e1ca27d0e39aa03eb5a611ce4122f.svg)<br />![](./img/b0af76257fd334f5200fa9c2a421688a.svg)时（第2次施加控制），当前水位是![](./img/e95e1ca27d0e39aa03eb5a611ce4122f.svg)。![](./img/bf8d5375babd026dfc4cd08f3116745b.svg)，会使水位再次上升![](./img/3d522deaf85577451c01974654b36ad3.svg)，达到![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)。<br />如此这么循环下去，就是比例控制算法的运行方法。根据![](./img/81806344483eb0e7e7374c014a39583c.svg)取值不同，系统最后都会达到![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)米，只不过![](./img/81806344483eb0e7e7374c014a39583c.svg)大了到达的快，![](./img/81806344483eb0e7e7374c014a39583c.svg)小了到达的慢一些。不会有稳态误差。

**稳态误差：**考虑另外一种情况，假设这个水缸在加水的过程中，存在漏水的情况，假设每次加水的过程，都会漏掉![](./img/cb5ae17636e975f9bf71ddf5bc542075.svg)米高度的水。仍然假设![](./img/81806344483eb0e7e7374c014a39583c.svg)取![](./img/d310cb367d993fb6fb584b198a2fd72c.svg)，那么会存在着某种情况，假设经过几次加水，水缸中的水位到![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)时，水位将不会再变换！！！因为，水位为![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)，则误差![](./img/711924b3554efba39d064aee1380a5cc.svg)。 所以每次往水缸中加水的量为![](./img/6f29a06389e6ca4455c3ef571c0035d2.svg)。同时，每次加水，缸里又会流出去![](./img/cb5ae17636e975f9bf71ddf5bc542075.svg)米的水！！！加入的水和流出的水相抵消，水位将不再变化！！也就是说，我们的目标是![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)米，但是最后系统达到![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)米的水位就不再变化了，且系统已经达到稳定。由此产生的误差就是稳态误差了。

在实际情况中，这种类似水缸漏水的情况往往更加常见，比如控制汽车运动，摩擦阻力就相当于是“漏水”，控制机械臂、无人机的飞行，各类阻力和消耗都可以理解为本例中的“漏水”。所以，单独的比例控制，在很多时候并不能满足要求。
<a name="udS6z"></a>
## 积分控件
积分控制考虑过去误差，将误差值过去一段时间和（误差和）乘以一个正值的常数![](./img/201400d073866463c42632818d600ec1.svg)。![](./img/201400d073866463c42632818d600ec1.svg)从过去的平均误差值来找到系统的输出结果和预定值的平均误差。一个简单的比例系统会震荡，会在预定值的附近来回变化，因为系统无法消除多余的纠正。通过加上负的平均误差值，平均系统误差值就会渐渐减少。所以，最终这个PID回路系统会在设定值稳定下来。

![](./img/55c82cc11d8f41fe31f9e6e8764e7fac.svg)

积分控制会加速系统趋近设定值的过程，并且消除纯比例控制器会出现的稳态误差。积分增益越大，趋近设定值的速度越快，不过因为积分控制会累计过去所有的误差，可能会使回授值出现过冲的情形。

还是用上面的例子来说明，第一次的误差![](./img/3104bcc503b3b8c16ffa2940b56aaf1c.svg)是![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)，第二次的误差![](./img/54439c342588ca6494c7e821337dda53.svg)是![](./img/54fbf38cf649866815e0fefc46a1f6c7.svg)，至此![](./img/b0af76257fd334f5200fa9c2a421688a.svg)时，误差的积分(离散情况下积分其实就是做累加)，![](./img/aa2d3a08a62101c7467f3a0ee0319510.svg)。这个时候的控制量，除了比例的那一部分，还有一部分就是一个系数![](./img/201400d073866463c42632818d600ec1.svg)乘以这个积分项。由于这个积分项会将前面若干次的误差进行累计，所以可以很好的消除稳态误差（假设在仅有比例项的情况下，系统卡在稳态误差了，即上例中的![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)，由于加入了积分项的存在，会让输入增大，从而使得水缸的水位可以大于![](./img/57eeec0a6974ecb4e9fcf68fab052f7b.svg)，渐渐到达目标的![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)）这就是积分项的作用。
<a name="gI1sk"></a>
## 微分控件
微分控制考虑将来误差，计算误差的一阶导，并和一个正值的常数![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)相乘。这个导数的控制会对系统的改变作出反应。导数的结果越大，那么控制系统就对输出结果作出更快速的反应。这个![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)参数也是PID被称为可预测的控制器的原因。![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)参数对减少控制器短期的改变很有帮助。一些实际中的速度缓慢的系统可以不需要![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)参数。

![](./img/7a5bcebf6e82a792c7c6faf69e6465ab.svg)

微分控制可以提升整定时间及系统稳定性。不过因为纯微分器不是因果系统，因此在PID系统实现时，一般会为微分控制加上一个低通滤波器以限制高频增益及噪声。实际上较少用到微分控制，估计PID控制器中只有约20%用到微分控制。

换一个另外的例子，考虑刹车情况。平稳的驾驶车辆，当发现前面有红灯时，为了使得行车平稳，基本上提前几十米就放松油门并踩刹车了。当车辆离停车线非常近的时候，则使劲踩刹车，使车辆停下来。整个过程可以看做一个加入微分的控制策略。微分，说白了在离散情况下，就是error的差值，就是![](./img/e358efa489f58062f10dd7316b65649e.svg)时刻和![](./img/f3e90ce87a25538f5a4be79a0a7c0fa5.svg)时刻error的差，即

![](./img/00fe294fcd041e78e21ae01c5873d6bf.svg)

其中的![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)是一个系数项。可以看到，在刹车过程中，因为error是越来越小的，所以这个微分控制项一定是负数，在控制中加入一个负数项，他存在的作用就是为了防止汽车由于刹车不及时而闯过了线。从常识上可以理解，越是靠近停车线，越是应该注意踩刹车，不能让车过线，所以这个微分项的作用，就可以理解为刹车，当车离停车线很近并且车速还很快时，这个微分项的绝对值（实际上是一个负数）就会很大，从而表示应该用力踩刹车才能让车停下来。切换到上面给水缸加水的例子，就是当发现水缸里的水快要接近![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)的时候，加入微分项，可以防止给水缸里的水加到超过![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)米的高度，说白了就是减少控制过程中的震荡。

现在在回头看这个公式，就很清楚了

![](./img/43f6a1e6e7e3864ac3c9cd59a00fdeb5.svg)

- ![](./img/81806344483eb0e7e7374c014a39583c.svg)：比例增益，是调适参数
- ![](./img/201400d073866463c42632818d600ec1.svg)：积分增益，也是调适参数
- ![](./img/bd27c9dc0758e10ed9f4a31497f7bb6c.svg)：微分增益，也是调适参数
- ![](./img/e1671797c52e15f763380b45e841ec32.svg)：误差=设定值(SP)-回授值(PV)
- ![](./img/e358efa489f58062f10dd7316b65649e.svg)：目前时间
- ![](./img/a6f317b268ae825d94f832f970af607c.svg)：积分变数，数值从![](./img/cfcd208495d565ef66e7dff9f98764da.svg)到目前时间![](./img/e358efa489f58062f10dd7316b65649e.svg)
<a name="Dp188"></a>
## 参数调试
PID算法的参数调试是指通过调整控制参数（比例增益、积分增益/时间、微分增益/时间）让系统达到最佳的控制效果。调试中稳定性（不会有发散性的震荡）是首要条件，此外，不同系统有不同的行为，不同的应用其需求也不同，而且这些需求还可能会互相冲突。<br />![PID参数调试.gif](./img/1643015595985-71112695-a5ca-493c-a2e2-a0228246b490.gif)<br />PID算法只有三个参数，在原理上容易说明，但PID算法参数调试是一个困难的工作，因为要符合一些特别的判据，而且PID控制有其限制存在。
<a name="EW7ia"></a>
### 稳定性
若PID算法控制器的参数未挑选妥当，其控制器输出可能是不稳定的，也就是其输出发散，过程中可能有震荡，也可能没有震荡，且其输出只受饱和或是机械损坏等原因所限制。不稳定一般是因为过大增益造成，特别是针对延迟时间很长的系统。
<a name="QMtps"></a>
### 最佳性能
PID控制器的最佳性能可能和针对过程变化或是设定值变化有关，也会随应用而不同。

两个基本的需求是调整能力（regulation，干扰拒绝，使系统维持在设定值）及命令追随 （设定值变化下，控制器输出追随设定值的反应速度）。有关命令追随的一些判据包括有上升时间及整定时间。有些应用可能因为安全考量，不允许输出超过设定值，也有些应用要求在到达设定值过程中的能量可以最小化。
<a name="idstz"></a>
### 调试方法
有许多种调试PID控制器参数的方法，最有效的方式多半是建立某种程序，再依不同参数下的动态特性来调试参数。相对而言人工调试其效率较差，若是系统的响应时间到数分钟以上，更可以看出人工调试效率的不佳。

调试方法的选择和是否可以暂时将控制回路“离线”有关，也和系统的响应时间有关。离线是指一个和实际使用有些不同的条件（例如不加负载），而且控制器的输出只需考虑理论情况，不需考虑实际应用。在线调试是在实际应用的条件，控制器的输出需考虑实际的系统 。若控制回路可以离线，最好的调试方法是对系统给一个步阶输入，量测其输出对时间的关系，再用其响应来决定参数<br />![调试.png](./img/1643015768192-098555d2-e7ac-490a-8e64-649e414f53de.png)
<a name="hQEKQ"></a>
# 系统调控
<a name="zQhsa"></a>
## 微观调控
基于PID的广告智能出价，广告主设置的是投放成本，比如设置的为![](./img/f899139df5e1059396431415e770c6dd.svg)元，即上面例子水池里要达到的水深![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)米<br />(1)若现状超成本，投放成本为![](./img/da4fb5c6e93e74d3df8527599fa62642.svg)元，则系统会降低该广告出价![](./img/ea0e81cdb4acd5a0c9eb6f94c512b2b6.svg)，基于![](./img/0941905ecd282758990932d6febb54da.svg)，只有![](./img/f465d3806dce5788955908c5b8f0bc63.svg)更高时，也就是此次PV的点击转化率较高的时候，该广告才会竞得此次曝光，以达到降低成本<br />(2)同理，当欠成本时，比如当前投放成本为![](./img/f033ab37c30201f73f142449d037028d.svg)元，系统会提升该广告出价![](./img/ea0e81cdb4acd5a0c9eb6f94c512b2b6.svg)，基于![](./img/0941905ecd282758990932d6febb54da.svg)，许多稍低![](./img/f465d3806dce5788955908c5b8f0bc63.svg)的PV也有可能竞争到，增加曝光机会，帮助跑量
<a name="sv91P"></a>
## 宏观调控
<a name="PISPS"></a>
### 流量倾斜
广告系统是十分复杂的，除了基于成本单个广告的出价调整，也会有曝光倾斜等。广告分为效果广告和品牌广告

- 效果广告更看重效果，基本采用cpx(x可能为点击(click)、激活/关注/转化(action))等计费方式
- 品牌广告的目标是较长时间的回报，更看重增加影响力，要保证一定的曝光量，基本采用cpm计费方式

由于cpm只为可见的广告展示次数付费，只看展现量，按展现量收费，不管点击、下载、注册等。所以对平台来讲，最优策略是优质(点击/转化率高的)流量尽量分配给效果广告，低质流量分配给品牌广告。基于此策略，平台会进行流量倾斜调整等，比如平台分析用户使用习惯，流量预测当日晚间会有大量打工人下班登陆平台打发时间，纯为打发时间，并不会进行广告转化(低质流量)。当白天某效果广告以微弱劣势竞价不过品牌广告，平台也可能进行流量倾斜，将此次曝光机会给效果广告，品牌广告的曝光由晚间低质流量保底。
<a name="jnO5O"></a>
### 保育队列
现在绝大多数公司都采用机器学习或深度学习模型进行用户此次PV对各广告的![](./img/f465d3806dce5788955908c5b8f0bc63.svg)，但能够利用模型的前提是有足够的数据可以进行模型训练。像冷启动等情况，数据量不足，![](./img/f465d3806dce5788955908c5b8f0bc63.svg)预测不准，很容易出现为抢夺流量出价![](./img/ea0e81cdb4acd5a0c9eb6f94c512b2b6.svg)高到上天，或者投放许久压根抢不到流量的情况。保育队列的作用就是解决像冷启动数据量不足的情况，调控竞价，帮助广告计划积攒数据以可以进行较为准确的模型预估。

<a name="xsD4h"></a>
# Source
[https://zh.wikipedia.org/wiki/PID%E6%8E%A7%E5%88%B6%E5%99%A8](https://zh.wikipedia.org/wiki/PID%E6%8E%A7%E5%88%B6%E5%99%A8)<br />[一文搞懂PID控制算法](https://zhuanlan.zhihu.com/p/347372624)<br />[PID控制算法原理（抛弃公式，从本质上真正理解PID控制）](https://zhuanlan.zhihu.com/p/39573490)
