DPN（Deep Parsing Network）使用现有的CNN来完成一元问题，然后又精心设计了其他层来模拟平均场算法的二元问题。DPN的优点如下：

- 在综合使用了CNN和随机场的一般工作中，需要对随机场做多次迭代，然而DPN只做一次迭代就可以获得比较好的效果。
- DPN同时考虑了空间上下文关系如高阶关系，有能力对各种二元问题进行建模，使得很多二元问题成为DPN的特例。
- DPN使得马尔可夫场问题能够并行化解决，通过GPU来加速计算。DPN使用卷积和池化操作来近似MF，可以通过近似来加速。

二元势函数都是通过考虑任意两个像素点之间的关系来构造的。如![](./img/9f51ad7490ea183607bdf0a321346986.svg)中的![](./img/36fb389cb6ed3cedd502aad611bfb5d3.svg)表示像素点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)是否被标记为![](./img/7b774effe4a349c6dd82ad4f4f21d34c.svg)；![](./img/29eb38de1ea5fee2d669d4bb4eab405d.svg)表示像素点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)，![](./img/363b122c528f54df4a0446b6bab05515.svg)之间的关系，比如RGB像素点的距离或者空间距离；![](./img/5bcf63aefae973d8237c5cef3fa4eba5.svg)则表示![](./img/7b774effe4a349c6dd82ad4f4f21d34c.svg)，![](./img/9e3669d19b675bd57058fd4664205d2a.svg)这两个标记全局共现的惩罚。在空间上相近且看起来相似的两个点，应该更容易获得相同的标签。然而这种建模方式的两个缺点：（1）它只考虑了共现的频率，却没有考虑空间上下文关系，比如，当人和椅子一起出现的时候，人应该是坐在椅子上的，而不太可能在椅子下；（2）它只考虑了像素点之间成对（Pairwise）的关系，却没有考虑更高阶的关系。为了解决这些缺点，在二元势函数中引入了三元惩罚项：

![](./img/2e1e3a324bcf8437d6df4d698baa664f.svg)

这个式子学习了局部标记上下文的混合。![](./img/a5f3c6a11b03839d46af9fb43c97c188.svg)是混合组件的数量，![](./img/8ff9c1b69b4201fec1b23780372d5cdf.svg)取值为![](./img/cfcd208495d565ef66e7dff9f98764da.svg)或![](./img/c4ca4238a0b923820dcc509a6f75849b.svg)，表示哪个组件被激活，且![](./img/4b20ba7613a325f2e70e4b11ff4f13ba.svg)。如下图（b）所示，红色点和蓝色点描述了中心点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)和它的邻域![](./img/363b122c528f54df4a0446b6bab05515.svg)。![](./img/7e291e8fe093cfab49254fbeb4790386.svg)表示像素点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)被标记为![](./img/7b774effe4a349c6dd82ad4f4f21d34c.svg)。![](./img/7f8b3d2e58e6f81eeda131d96f7ab555.svg)表示根据![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)和![](./img/363b122c528f54df4a0446b6bab05515.svg)的相对关系，![](./img/7e291e8fe093cfab49254fbeb4790386.svg)和![](./img/d81168656e3db67ef54268d0e02df890.svg)同时存在的代价。上式的第二项就为三元惩罚项，表示像素点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)，![](./img/363b122c528f54df4a0446b6bab05515.svg)以及![](./img/363b122c528f54df4a0446b6bab05515.svg)的邻域的关系。当![](./img/7e291e8fe093cfab49254fbeb4790386.svg)和![](./img/d81168656e3db67ef54268d0e02df890.svg)相容时，![](./img/7e291e8fe093cfab49254fbeb4790386.svg)也应该相容于![](./img/cb94e20323032688e6a827c723e81b1f.svg)，其中![](./img/fbade9e36a3f36d3d676c1b808451dd7.svg)是![](./img/363b122c528f54df4a0446b6bab05515.svg)的邻域，如下图（a）所示。所以DPN的主要贡献就是把上式分两步建模成CNN。第一步如图（c）所示，用![](./img/7edfaf3835980c930617f1072b13350e.svg)的卷积核作用于每个点![](./img/363b122c528f54df4a0446b6bab05515.svg)来表示![](./img/d404e5d628e0c1c73d245f2b5aeea4ec.svg)，平滑了像素点![](./img/363b122c528f54df4a0446b6bab05515.svg)和它的邻域之间的预测。第二步使用![](./img/cf1193335575230a1a03e9457c55b6f7.svg)的卷积核作用于每个点![](./img/865c0c0b4ab0e063e5caa3387c1a8741.svg)来表示![](./img/7be6dffb9a29393a08961ddba0bca0be.svg)，如图（d）所示。

![DPN.png](./img/1598600513374-2e2a25ac-dcbd-4557-8b9a-3557257e6cb2.png)
