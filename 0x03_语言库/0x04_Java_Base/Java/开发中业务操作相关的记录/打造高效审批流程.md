<a name="UeQZ9"></a>
## 1ã€æµç¨‹æ€è·¯åˆ†æ
<a name="HSzCx"></a>
### å®¡æ‰¹æµç¨‹ğŸ±â€ğŸ’»
<a name="zChJx"></a>
#### 1.ä¸²è¡Œæµç¨‹
å½“å‰èŠ‚ç‚¹å®¡æ‰¹å®Œæˆåï¼Œä¸‹ä¸€æ¬¡èŠ‚ç‚¹æ‰èƒ½è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ç»ç†é€šè¿‡ä¹‹åï¼Œæ€»ç›‘æ‰èƒ½å®¡æ‰¹ï¼›<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225546-6e4e8a8d-abb3-4115-b4e1-cef3cbe8ae21.png#averageHue=%23f6f6f6&clientId=u488b7f3a-f1f4-4&from=paste&id=uaae09d81&originHeight=151&originWidth=952&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=uc10b65f1-7ab4-404e-83ff-8864a491dbd&title=)
<a name="qxpE4"></a>
#### 2.å¹¶è¡Œæµç¨‹
ä¸€ä¸ªå®¡æ‰¹èŠ‚ç‚¹éœ€è¦å¤šäººè”å®¡ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼šä¼šç­¾ã€æˆ–ç­¾ï¼›<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225568-c12a6385-85b1-4d9e-b020-65ac824d1c69.png#averageHue=%23f9f9f9&clientId=u488b7f3a-f1f4-4&from=paste&id=u88667629&originHeight=361&originWidth=764&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u5bb150c8-6ca9-42b3-96e9-10d88ffa153&title=)<br />**ä¼šç­¾ï¼š**<br />æ³¨æ„ï¼šåˆ«è·Ÿä¸²è¡Œå®¡æ‰¹æ··æ·†ã€‚ä¼šç­¾çš„å¤šä¸ªè§’è‰²æ˜¯å¹³è¡Œçš„ï¼Œæ²¡æœ‰ä¸Šä¸‹çº§å…³ç³»ã€å‰åé¡ºåºã€‚<br />ä¾‹å¦‚ï¼šåœ¨æŸé¡¹æ–‡ä»¶ã€åˆåŒã€å†³ç­–æˆ–å…¶ä»–é‡è¦äº‹é¡¹ä¸Šï¼Œéœ€è¦å¤šä¸ªç›¸å…³äººå‘˜è¿›è¡Œç¡®è®¤ã€æ‰¹å‡†æˆ–ç­¾ç½²çš„æƒ…å†µä¸‹ï¼Œå‚ä¸è¯¥è¿‡ç¨‹çš„äººå‘˜åŒæ—¶æ‰¹å‡†ï¼Œè¿™æ—¶ä¼šç­¾å°±èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ï¼Œé¡ºä¾¿ä¹Ÿèƒ½è§£å†³äººæƒ…ä¸–æ•…çš„é—®é¢˜ï½ï½ã€‚<br />**ä¼šç­¾æ”¯æŒå¹¶ç­¾ï¼š**<br />ä¸šåŠ¡æ¨¡å¼æ”¯æŒï¼š"å…¨éƒ¨æŠ•ç¥¨"ã€"æŒ‰æŠ•ç¥¨æ¯”ä¾‹"ã€"æŒ‰æŠ•ç¥¨é€šè¿‡æ¯”ä¾‹"ã€æ”¯æŒè®¾ç½® "ç™¾åˆ†æ¯”" å’Œ "åˆ†æ•°" ä¸¤ç§æ–¹å¼ã€‚<br />æˆ–ç­¾(ä¹Ÿæœ‰å«"ç«ç­¾"ã€"ä¸²ç­¾")ï¼šæŒ‡åŒä¸€ä¸ªå®¡æ‰¹èŠ‚ç‚¹è®¾ç½®å¤šä¸ªäººï¼Œå¦‚ABCä¸‰äººï¼Œä¸‰äººä¼šåŒæ—¶æ”¶åˆ°å®¡æ‰¹ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€äººå®¡æ‰¹å³å¯åˆ°ä¸‹ä¸€å®¡æ‰¹èŠ‚ç‚¹ï¼›
<a name="m6cyO"></a>
#### 3.æ¡ä»¶æµç¨‹
æ ¹æ®ä¸åŒè§„åˆ™ï¼Œèµ°ä¸åŒæµç¨‹<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225557-0f549110-0c59-41cb-be72-47c6cb5b1d8a.png#averageHue=%23f7f7f7&clientId=u488b7f3a-f1f4-4&from=paste&id=ua0f28ffd&originHeight=343&originWidth=837&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=udc19bf20-0d59-40da-961f-146389cdaac&title=)<br />ä¾‹å¦‚æŠ¥é”€5000ä»¥ä¸‹ç›´å±é¢†å¯¼å®¡æ‰¹å°±è¡Œï¼Œ5000~10000éœ€è¦æ€»ç›‘å®¡æ‰¹ã€‚
<a name="cuSOm"></a>
#### 4.æ··åˆæµç¨‹
å°±æ˜¯ä¸Šè¿°çš„æµç¨‹æ··åˆè¿ç”¨ï¼›<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225563-a58e0eee-f6fc-48af-aecc-02a478aa4410.png#averageHue=%23fafafa&clientId=u488b7f3a-f1f4-4&from=paste&id=u26511029&originHeight=359&originWidth=867&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u22721856-1591-41b9-bb72-3d158c360d3&title=)<br />ä¾‹å¦‚è¯·å‡çš„æ­£å¸¸æµç¨‹æ˜¯åˆ°ç›´å±é¢†å¯¼å®¡æ‰¹ï¼Œ3å¤©ä»¥ä¸Šéœ€è¦æ€»ç›‘å®¡æ‰¹ã€‚5å¤©ä»¥ä¸Šéœ€è¦æ€»è£å®¡æ‰¹ã€‚
<a name="gcvHC"></a>
### å®¡æ‰¹åŠ¨ä½œğŸ™‹â€â™€ï¸

1. **é€šè¿‡ï¼š** é€šè¿‡ç”³è¯·ï¼Œæµè½¬åˆ°ä¸‹ä¸€äººã€‚åŸå› é€‰å¡«ã€‚
2. **é©³å›ï¼š** é©³å›åˆ°å‘èµ·äººã€é©³å›åˆ°ä¸Šä¸€ç¯èŠ‚ã€é©³å›åˆ°ä¹‹å‰çš„æŸä¸€ç¯èŠ‚
3. **ä¿å­˜ï¼š** ä¿å­˜å½“å‰å¡«å†™çš„ä¿¡æ¯ã€‚
4. **è½¬äº¤ï¼š** è½¬äº¤ç»™æŸäººå®¡æ‰¹
5. **åŠ ç­¾ï¼š** å¤„ç†è€…å¯ä»¥åœ¨å®¡æ‰¹æ—¶ä¸´æ—¶å¢åŠ å®¡æ ¸äººå‘˜
6. **æŠ„é€ï¼š** æŠ„é€äººä¼šçŸ¥æ™“å®¡æ ¸è¿‡ç¨‹ï¼Œä½†ä¸è¿›è¡Œæ“ä½œ
<a name="oETGI"></a>
### æ‰§è¡ŒåŠ¨ä½œğŸ‘©â€ğŸ“
**ç”³è¯·ï¼š** é’ˆå¯¹å½“å‰ä¸šåŠ¡è¡¨å•ä¿¡æ¯å‘èµ·ç”³è¯·ï¼Œå¼€å§‹å®¡æ‰¹æµç¨‹çš„ä¼ é€’ã€‚åˆ†ä¸º2éƒ¨åˆ†ï¼šç”±ç”³è¯·æäº¤äººæ‰‹åŠ¨å‘èµ·ç”³è¯·ã€ç”±ç¨‹åºè‡ªåŠ¨åˆ¤æ–­æ»¡è¶³è§¦å‘è§„åˆ™çš„æ•°æ®è‡ªåŠ¨å‘èµ·ç”³è¯·ï¼›å¦å¤–è¿˜è¦æ³¨æ„çš„2ç‚¹ï¼šæ˜¯å¦å…è®¸æäº¤äººæ’¤é”€ï¼ˆæ˜¯ã€å¦ï¼‰ã€è®°å½•ç¼–è¾‘ï¼ˆä¸å¯ç¼–è¾‘ã€ç®¡ç†å‘˜å¯ç¼–è¾‘ã€ç®¡ç†å‘˜å’Œå®¡æ‰¹äººéƒ½å¯ç¼–è¾‘ ï¼‰ï¼›<br />**é€šè¿‡ï¼š** å½“å‰æ­¥éª¤å¤„ç†é€šè¿‡ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥éª¤ï¼Œè‹¥ä¸ºæœ«æ­¥éª¤ï¼Œåˆ™æµç¨‹å¤„ç†å®Œæˆï¼›<br />**é€€å›ï¼š** å°†æ­¥éª¤é€€å›è‡³ä¸Šä¸€æ­¥éª¤ï¼Œå³è¿”å›è‡³ä¸Šä¸€å¤„ç†äººå¤„ï¼Œè‹¥ä¸ºé¦–æ­¥éª¤ï¼Œåˆ™ä¸è¿›è¡Œé€€å›ï¼›<br />**å¦å†³ï¼š** å°†æ­¥éª¤ç›´æ¥ç»“æŸï¼Œæ‰§è¡Œç»“æŸåŠ¨ä½œæ‹’ç»æ´»åŠ¨ï¼Œä¸å†è¿›è¡Œæ“ä½œï¼Œæˆ–è€…å›é€€è‡³ç¬¬ä¸€æ­¥éª¤ï¼›<br />**æ’¤å›ï¼š** è‹¥å½“å‰æ­¥éª¤å·²å¤„ç†ï¼Œä¸‹ä¸€å¤„ç†äººæœªå¤„ç†çš„æƒ…å†µä¸‹å¯è¿›è¡Œæ’¤å›æ“ä½œã€‚<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225566-68b21fe9-73d3-4ecc-af6e-1dfec933c04f.png#averageHue=%23fbfafa&clientId=u488b7f3a-f1f4-4&from=paste&id=u53bae2a7&originHeight=252&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=ua42fe520-15d5-4a9e-8ea7-7056442092c&title=)
<a name="ER0HN"></a>
### èŠ‚ç‚¹çŠ¶æ€ğŸ•µï¸â€â™€ï¸
**æäº¤äººï¼š** æœªæäº¤ã€å·²æäº¤ã€å¤„ç†ä¸­ã€å·²ç»“æŸã€‚<br />**å¤„ç†äººï¼š** å¾…å¤„ç†ã€å·²å¤„ç†ã€‚<br />**åˆ›å»ºä¸šåŠ¡å·¥å•ï¼š** æäº¤äººç™»å½•ç³»ç»Ÿä¹‹åï¼Œé€‰æ‹©æƒ³è¦å‘èµ·çš„ä¸šåŠ¡å·¥å•ï¼Œå¡«å†™ä¸šåŠ¡å·¥å•ã€‚å¡«å†™å®Œæˆå¯ä»¥é€‰æ‹©æäº¤æˆ–è€…ä¿å­˜ï¼›<br />**æœªæäº¤ï¼š** åˆ—è¡¨ä¸­æ˜¾ç¤ºæ‰€æœ‰ä¿å­˜ä½†æœªæäº¤çš„ä¸šåŠ¡å·¥å•ï¼Œæœªæäº¤åˆ—è¡¨ä¸­çš„ä¸šåŠ¡å·¥å•éƒ½æ²¡æœ‰ä¸šåŠ¡å·¥å•ç¼–å·ï¼ˆå”¯ä¸€ï¼‰ï¼ŒçŠ¶æ€ä¸ºâ€œæœªæäº¤â€ã€‚æäº¤äººå¯ä»¥é€‰æ‹©æŸä¸ªä¸šåŠ¡å·¥å•åèƒ½æ–¹ä¾¿å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€åˆ é™¤å’Œæäº¤ï¼›<br />**å·²æäº¤ï¼š** åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰å·²ç»æäº¤çš„ä¸šåŠ¡å·¥å•ï¼Œæœ‰ä¸šåŠ¡å·¥å•ç¼–å·ï¼Œå¹¶æ˜¾ç¤ºï¼ˆæœªå¤„ç†ï¼‰ã€‚æäº¤åçš„ä¸šåŠ¡å·¥å•è¿›å…¥å¤„ç†æµç¨‹ï¼Œæäº¤äººæ— æ³•è¿›è¡Œä¿®æ”¹å’Œåˆ é™¤ï¼›<br />**å¤„ç†ä¸­ï¼š** åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰æäº¤å¹¶å·²ç»æœ‰èŠ‚ç‚¹å¤„ç†çš„ä¸šåŠ¡å·¥å•ï¼Œæäº¤äººå¯ä»¥æŸ¥è¯¢æŸä¸ªä¸šåŠ¡å·¥å•çš„å¤„ç†è¿›åº¦ï¼›<br />**å·²ç»“æŸï¼š** åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰å·²ç»å¤„ç†å®Œæˆçš„ä¸šåŠ¡å·¥å•ï¼›<br />**å¾…å¤„ç†ï¼š** åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰å¾…å¤„ç†ä¸šåŠ¡å·¥å•ï¼›<br />**å·²å¤„ç†ï¼š** åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰å½“å‰å¤„ç†äººå·²å¤„ç†çš„ä¸šåŠ¡å·¥å•ï¼Œæ—¢è¢«å½“å‰å¤„ç†äººæµè½¬åˆ°ä¸‹ä¸€ä¸ªæµç¨‹èŠ‚ç‚¹çš„ä¸šåŠ¡å·¥å•ï¼›
<a name="kar86"></a>
## 2ã€UIé¢„è§ˆğŸ›¹
![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225897-cc6a1b82-62ce-451e-8d12-c4ef7135f814.png#averageHue=%23d7e5f2&clientId=u488b7f3a-f1f4-4&from=paste&id=u33c0e379&originHeight=474&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u6596a295-3b3c-49d0-bbda-4b576351b1e&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225941-5a10a551-3b5b-4d90-95b8-a61e1eaa699f.png#averageHue=%23bdcfc3&clientId=u488b7f3a-f1f4-4&from=paste&id=ud0c68c24&originHeight=616&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u0f8b634f-8d99-4bf5-a5f2-63e3eb48b28&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225977-2eb4e605-b317-43a5-b142-f778eee89ae9.png#averageHue=%23bcccc2&clientId=u488b7f3a-f1f4-4&from=paste&id=u65bcb2ae&originHeight=588&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=ud7555d32-9d95-4da6-986c-380a2f6db4d&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125225978-73448d6c-2a0b-46c1-9ac1-a7d849fdbdba.png#averageHue=%23bcd5c5&clientId=u488b7f3a-f1f4-4&from=paste&id=u9f68c45c&originHeight=632&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u62e138b7-da53-4d90-bc9a-a5212ec3e8f&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/396745/1703125226054-c0963860-b0af-4e2c-972d-d9853e03c077.png#averageHue=%23bccbc1&clientId=u488b7f3a-f1f4-4&from=paste&id=u65ccd3b5&originHeight=675&originWidth=1080&originalType=url&ratio=2.5&rotation=0&showTitle=false&status=done&style=none&taskId=u1d65da2e-e366-4926-8aa1-6eadfc5fbbc&title=)
<a name="dthYE"></a>
## 3ã€è¡¨è®¾è®¡ğŸš§
<a name="tURhQ"></a>
### æµç¨‹é…ç½®è¡¨ğŸš—
```plsql
CREATE TABLE `approval_config` (
  `approval_config_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'é›ªèŠ±ç®—æ³•',
  `corp_id` varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'ä¼ä¸šID',
  `node_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'èŠ‚ç‚¹åç§°',
  `form_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è¡¨å•ID å±äºé‚£ä¸ªè¡¨å•çš„æµç¨‹',
  `approval_auto_pass` tinyint(1) DEFAULT '0' COMMENT 'å®¡æ‰¹èŠ‚ç‚¹äººå‘˜ç›¸åŒæ—¶è‡ªåŠ¨é€šè¿‡[1ï¼štrueï¼›0ï¼šfalse]',
  `current_node_approver_type` tinyint DEFAULT NULL COMMENT 'å®¡æ‰¹äººç±»å‹[1:å‘èµ·äººè‡ªå·±ï¼›2:æŒ‡å®šè§’è‰²ï¼›3:æŒ‡å®šäººå‘˜ï¼›4:è¡¨å•å†…äººå‘˜]ï¼›æ³¨ï¼š1/3/4å­˜useridã€2å­˜roleId',
  `current_node_approver` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'å¾…å®¡æ‰¹äººå¦‚æœæ˜¯è§’è‰²å°±æ˜¯è§’è‰²IDï¼Œå¦‚æœæ˜¯å…¶ä»–åˆ™æ˜¯userIdæ ¼å¼ï¼š[xxx,xxx]',
  `care_of` tinyint(1) DEFAULT NULL COMMENT 'å…è®¸å®¡æ‰¹äººè½¬äº¤[1ï¼štrue;2ï¼šfalse]',
  `approval_type` tinyint DEFAULT NULL COMMENT 'å®¡æ‰¹ç±»å‹[1:ä¼šç­¾ï¼š2ï¼šæˆ–ç­¾]',
  `approval_node` int DEFAULT NULL COMMENT 'å®¡æ‰¹èŠ‚ç‚¹[å–å€¼ï¼š1~N ä»å°åˆ°å¤§ï¼›0ï¼šå‘èµ·èŠ‚ç‚¹ ã€1ï¼šæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€ 2ï¼šç¬¬äºŒä¸ªèŠ‚ç‚¹ Nï¼šæ˜¯ç¬¬Nä¸ªèŠ‚ç‚¹ï¼›æœ€å¤§çš„æ˜¯ç»“æŸèŠ‚ç‚¹]',
  `carbon_copy_recipients_type` tinyint DEFAULT '1' COMMENT 'æŠ„é€äººç±»å‹[1:å‘èµ·äººè‡ªå·±ï¼›2:æŒ‡å®šè§’è‰²ï¼›3:æŒ‡å®šäººå‘˜ï¼›4:è¡¨å•å†…äººå‘˜]',
  `carbon_copy_recipients` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'æŠ„é€äººuserId æ•°ç»„æ ¼å¼',
  `create_time` datetime DEFAULT NULL COMMENT 'è§„åˆ™åˆ›å»ºæ—¶é—´ï¼›é»˜è®¤æ‹¿æœ€æ–°çš„',
  `group_id` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'åˆ†ç»„[æ ‡è¯†é‚£äº›èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªç»„çš„]',
  `visible_fields` json DEFAULT NULL COMMENT 'å¯è§å­—æ®µï¼š[{"bt": false, "kj": true, "kx": true, "field": "create_time", "children": "purchase_requisition_details"}];\r\nkj:å¯è§ï¼›kx:å¯å†™ï¼›kb:å¿…å¡«ã€‚å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹å°±éœ€è¦å•ç‹¬æ‹‰ä¸€ä¸ªé…ç½®',
  PRIMARY KEY (`approval_config_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å®¡æ‰¹æµç¨‹èŠ‚ç‚¹è§„åˆ™é…ç½®è¡¨';
```
<a name="cpVhS"></a>
### å®¡æ‰¹æµç¨‹å‘èµ·è¡¨ğŸš“
```plsql
CREATE TABLE `approval_info` (
  `approval_info_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'é›ªèŠ±ç®—æ³•',
  `corp_id` varchar(50) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'ä¼ä¸šID',
  `approval_config_group_id` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è§„åˆ™è¡¨çš„groupID',
  `form_id` varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è¡¨å•ID å±äºé‚£ä¸ªè¡¨å•',
  `founder` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å‘èµ·äºº',
  `launch_time` datetime NOT NULL COMMENT 'å‘èµ·æ—¶é—´',
  `end_state` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦ç»“æŸæµç¨‹[1æ˜¯]',
  `end_time` datetime DEFAULT NULL COMMENT 'æµç¨‹ç»“æŸæ—¶é—´',
  `object_id` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'å…³è”æŸæ¡æ•°æ®',
  `process_progress` int DEFAULT '0' COMMENT 'ç”¨æ¥è®°å½•æ•´ä¸ªæµç¨‹è¿›è¡Œåˆ°é‚£ä¸ªèŠ‚ç‚¹',
  `record_node_history` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è®°å½•å†å²ç»å†èŠ‚ç‚¹,è‹±æ–‡é€—å·åˆ†éš”0,1,2,1,2,3 æœ€åä¸€ä¸ªå€¼å’Œå½“å‰èŠ‚ç‚¹åŒæ­¥',
  PRIMARY KEY (`approval_info_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å®¡æ‰¹æµç¨‹å‘èµ·è¡¨';
```
<a name="rli6e"></a>
### å®¡æ‰¹è®°å½•è¡¨ğŸš•
```plsql
CREATE TABLE `approval_record` (
  `approval_record_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'é›ªèŠ±ç®—æ³•',
  `corp_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'ä¼ä¸šID',
  `approval_info_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å®¡æ‰¹å‘èµ·è¡¨approval_info',
  `form_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'è¡¨å•ID å±äºé‚£ä¸ªè¡¨å•çš„æµç¨‹',
  `approver_user_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å®¡æ‰¹äººor è½¬äº¤äºº userId',
  `approver_time` datetime NOT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
  `approver_opinions` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'å®¡æ‰¹æ„è§',
  `approver_result` tinyint NOT NULL COMMENT 'å®¡æ‰¹ç»“æœ[1:åŒæ„ï¼›2:æ‹’ç»ï¼š3:è½¬äº¤]',
  `transferee` varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è¢«è½¬äº¤äººuserIdï¼›approver_result=3æ—¶å¿…å¡«',
  `transferee_text` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'è½¬äº¤å¤‡æ³¨(æ­¤å­—æ®µæš‚æ—¶æ— ç”¨)',
  `accessory_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'é™„ä»¶æ•°ç»„',
  `approver_node` tinyint NOT NULL COMMENT 'å±äºä¸ªèŠ‚ç‚¹çš„å®¡æ‰¹è®°å½•',
  `approver_count` tinyint DEFAULT '1' COMMENT 'å®¡æ‰¹æ¬¡æ•°é»˜è®¤1; ä¾‹ï¼šå½“èŠ‚ç‚¹Bæ˜¯ä¼šç­¾,ä¸”æœ‰äººåŒæ„,æœ‰äººæ‹’ç»ï¼Œå½“æ‹’ç»åä¼šè¿”å›ä¸Šä¸€ä¸ªèŠ‚ç‚¹Aã€‚å½“å†æ¬¡è¿›å…¥èŠ‚ç‚¹Bæ—¶ï¼Œç”¨æ¥åŒºåˆ†,æ­¤å®¡æ‰¹è®°å½•æ˜¯ç¬¬ä¸€æ¬¡è®°å½•è¿˜æ˜¯ç¬¬äºŒæ¬¡å®¡æ‰¹è®°å½•æˆ–è€…ç¬¬Næ¬¡',
  PRIMARY KEY (`approval_record_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å®¡æ‰¹è®°å½•è¡¨';
```
<a name="i0vfK"></a>
### æŠ„é€è®°å½•è¡¨ğŸ›º
```plsql
CREATE TABLE `approval_carbon_copy` (
  `carbon_copy_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'é›ªèŠ±',
  `corp_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'ä¼ä¸šID',
  `form_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å±äºé‚£ä¸ªè¡¨å•',
  `approval_info_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'æ¨é€é‚£æ¡å®¡æ‰¹çš„ID',
  `user_id` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'æ¥æ”¶æŠ„é€äºº',
  `create_time` datetime NOT NULL COMMENT 'æŠ„é€æ—¶é—´',
  `read` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'æ˜¯å¦å·²è¯»[1:å·²è¯»ï¼›0:æœªè¯»]',
  `approval_node` tinyint NOT NULL COMMENT 'é‚£ä¸ªèŠ‚ç‚¹æŠ„é€çš„',
  PRIMARY KEY (`carbon_copy_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å®¡æ‰¹æŠ„é€è®°å½•è¡¨';
```
<a name="cSI7y"></a>
## 4ã€æ€è·¯ğŸ‘©â€ğŸ“ğŸ‘©â€ğŸ“
<a name="KNf0X"></a>
### æµç¨‹é…ç½®

1. é€šè¿‡æµç¨‹èŠ‚ç‚¹è§„åˆ™é…ç½®è¡¨ï¼Œé…ç½®æ¯ä¸ªèŠ‚ç‚¹çš„å®¡æ‰¹äººã€æŠ„é€äººã€å®¡æ‰¹è§„åˆ™ã€å¯è§ã€å¯å†™ã€å¿…å¡«å­—æ®µçš„è§„åˆ™ç­‰(å¯ä»¥ç»™ä¸åŒçš„è¡¨å•é…ç½®ä¸åŒçš„å®¡æ‰¹è§„åˆ™)ã€‚
2. é…ç½®å®Œæ¯•å³å¯ï¼Œæ¯æ¬¡æ–°å¢æ•°æ®ï¼Œè¯»å–æµç¨‹è§„åˆ™é…ç½®è¡¨ï¼Œç”Ÿæˆä¸€æ¡å®¡æ‰¹æµç¨‹å‘èµ·è®°å½•ï¼Œè®°å½•å‘èµ·äººï¼Œå‘èµ·æ—¶é—´ï¼Œå…³è”æŸæ¡æµç¨‹è§„åˆ™(æ—§æ•°æ®è¿˜æ˜¯ä½¿ç”¨æ—§æµç¨‹)ï¼Œæµç¨‹å½“å‰èŠ‚ç‚¹ç­‰ã€‚
3. æ¯ä¸ªèŠ‚ç‚¹çš„å®¡æ‰¹äººã€æŠ„é€äººã€å¯è§ã€å¯å†™ã€å¿…å¡«å­—æ®µéƒ½æ˜¯æ ¹æ®æµç¨‹è§„åˆ™é…ç½®è¡¨ä¸­åŠ¨æ€é…ç½®ã€‚
<a name="utVMU"></a>
## 5ã€ä»£ç ğŸ¥‡
<a name="aXmx1"></a>
### å®¡æ‰¹æŒ‰é’®
```java
@Transactional(rollbackFor = Exception.class)
public ResultUtils approval(String token, ApprovalDTO param) {
    String corpId = TokenUtils.getCorpId(token);
    String userId = TokenUtils.getUserId(token);
    LocalDateTime time = LocalDateTime.now();

    // æ‰¾åˆ°å½“å‰æ•°æ®å¾…å®¡æ‰¹èŠ‚ç‚¹,æ˜¯å¦éœ€è¦è‡ªå·±å®¡æ‰¹,æˆ–è€…å·²ç»å®¡æ‰¹è¿‡
    ApprovalInfo info = approvalInfoMapper.selectOne(new QueryWrapper<ApprovalInfo>().eq("corp_id", corpId).eq("object_id", param.getObjectId())
                                                     .eq("form_id", param.getFormId()).select("approval_info_id", "process_progress", "record_node_history", "end_state",
                                                                                              "approval_config_group_id","founder"));
    Assert.isFalse(info.getEndState(), ErrorMsg.msg18);
    Integer currentNode = info.getProcessProgress();// å½“å‰èŠ‚ç‚¹

    // æ¯ä¸ªèŠ‚ç‚¹çš„å®¡æ‰¹è®¾ç½®
    List<ApprovalConfig> approvalConfigs = approvalConfigMapper.selectList(new QueryWrapper<ApprovalConfig>().eq("corp_id", corpId)
                                                                           .eq("group_id", info.getApprovalConfigGroupId())
                                                                           .eq("form_id", param.getFormId()).select("approval_auto_pass", "current_node_approver_type", "visible_fields",
                                                                                                                    "current_node_approver", "care_of", "approval_type", "approval_node", "carbon_copy_recipients_type", "carbon_copy_recipients"));

    Map<Integer, ApprovalConfig> configMap = approvalConfigs.stream().collect(Collectors.toMap(ApprovalConfig::getApprovalNode, ApprovalConfig -> ApprovalConfig));
    ApprovalConfig config = configMap.get(info.getProcessProgress());

    List<String> historyNode = Lists.newArrayList(info.getRecordNodeHistory().split(","));
    // å†å²èŠ‚ç‚¹éœ€è¦å‰”é™¤æœ€åä¸€ä¸ª
    historyNode.remove(historyNode.size() - 1);
    Bag bag = new HashBag(historyNode);
    int count = bag.getCount(currentNode.toString());// è¿™ä¸ªèŠ‚ç‚¹å†å²æ˜¯å¦å‡ºç°è¿‡
    count = count == 0 ? 1 : (count + 1); // ç”¨äºæ ‡æ³¨è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦å¤šæ¬¡å®¡æ‰¹

    if (param.getType() == 3) {
        // è½¬äº¤
        ApprovalRecord record = new ApprovalRecord();
        record.setApprovalRecordId(SnowFlakeUtil.getDefaultSnowFlakeId() + "");
        record.setCorpId(corpId);
        record.setApprovalInfoId(info.getApprovalInfoId());
        record.setFormId(param.getFormId());
        record.setApproverUserId(userId);
        record.setApproverTime(time);
        record.setApproverOpinions(param.getMessage());
        record.setApproverResult(param.getType());
        record.setTransferee(param.getTransfereeUserId());
        if (ObjectUtil.isNotEmpty(param.getAccessoryUrl())) {
            record.setAccessoryUrl(JSONUtil.toJsonStr(param.getAccessoryUrl()));
        }
        record.setApproverNode(info.getProcessProgress().byteValue());
        record.setApproverCount(new Byte(count + ""));
        approvalRecordMapper.insertSelective(record);
        return ResultUtils.success();
    }

    ApprovalRecord records = approvalRecordMapper.selectOne(new QueryWrapper<ApprovalRecord>()
                                                            .eq("corp_id", corpId).eq("form_id", param.getFormId())
                                                            .eq("approver_user_id", userId).eq("approval_info_id", info.getApprovalInfoId())
                                                            .eq("approver_node", currentNode).eq("approver_count", count));
    Assert.isFalse(ObjectUtil.isNotEmpty(records) && StrUtil.isNotBlank(records.getTransferee()), ErrorMsg.msg29);

    Assert.isFalse(ObjectUtil.isNotEmpty(records), ErrorMsg.msg16);
    // æŸ¥è¯¢æ˜¯å¦æ˜¯è¢«è½¬äº¤äºº
    List<String> transferees = approvalRecordMapper.findTransferee(corpId, param.getFormId(), info.getApprovalInfoId(), currentNode, count);
    if (CollUtil.isEmpty(transferees)) {
        // 1.æ˜¯å¦éœ€è¦è‡ªå·±å®¡æ‰¹
        if (config.getCurrentNodeApproverType() == 2) {
            // æŒ‡å®šè§’è‰²
            // æŸ¥è¯¢è‡ªå·±æ‹¥æœ‰é‚£äº›è§’è‰²
            List<UserRole> userRoles = userRoleMapper.selectList(new QueryWrapper<UserRole>().eq("user_id", userId).eq("corp_id", corpId)
                    .select("role_id"));
            List<String> roleIds = userRoles.stream().map(key -> key.getRoleId()).collect(Collectors.toList());
            List<Integer> currentNodeApproverRoleId = JSONUtil.toList(config.getCurrentNodeApprover().toString(), Integer.class);
            ArrayList<String> integers = new ArrayList<>(roleIds);
            boolean b = integers.retainAll(currentNodeApproverRoleId);// å­˜åœ¨äº¤é›†åˆ™è¿”å›true
            Assert.isFalse(!b, ErrorMsg.msg17);
        } else if (config.getCurrentNodeApproverType()==3){
            // æŒ‡å®šäººå‘˜ ç”¨æˆ·ID
            List<String> currentNodeApproverUserId = JSONUtil.toList(config.getCurrentNodeApprover().toString(), String.class);
            boolean contains = currentNodeApproverUserId.contains(userId);
            Assert.isFalse(!contains, ErrorMsg.msg17);
        } else if (config.getCurrentNodeApproverType() == 1) {
           // å‘èµ·äººè‡ªå·±
            Assert.isFalse(!info.getFounder().equals(userId), ErrorMsg.msg17);
        }
    }
    if (param.getType() == 2) {
        // æ‹’ç»
        approvalRefuse(info, approvalConfigs, param, userId, corpId, count, time);
        return ResultUtils.success();
    }

    // åˆ¤æ–­äº†éœ€è¦è‡ªå·±å®¡æ‰¹ä¹‹å,å…ˆç¼–è¾‘æ•°æ®,ç„¶ååœ¨è¿›è¡Œå®¡æ‰¹æ“ä½œ
    JSONObject paramData = param.getMainData();
    approvalEditData(corpId, paramData, time, userId, param.getFormId());

    // è¿›è¡Œå®¡æ‰¹æ“ä½œ
    if (param.getType() == 1) {
        // åŒæ„
        approvalAgreeing(currentNode, info, configMap, param, userId, corpId, time, param.getObjectId());
    }
    return ResultUtils.success();
}
```
<a name="VYt36"></a>
### å®¡æ‰¹æŒ‰é’®-æ‹’ç»
```java
/**
 * å®¡æ‰¹æŒ‰é’®-æ‹’ç»
 *
 * @param info            å½“å‰æ•°æ®çš„å®¡æ‰¹è¯¦æƒ…
 * @param approvalConfigs å®¡æ‰¹è§„åˆ™
 * @param param           å‚æ•°
 * @param userId          å½“å‰å®¡æ‰¹äººid
 * @param corpId          ä¼ä¸šid
 * @param count           å®¡æ‰¹æ¬¡æ•°
 */
private void approvalRefuse(ApprovalInfo info, List<ApprovalConfig> approvalConfigs, ApprovalDTO param, String userId, String corpId, int count, LocalDateTime time) {
    // ç”Ÿæˆå®¡æ‰¹è®°å½•
    ApprovalRecord record = new ApprovalRecord();
    record.setApprovalRecordId(SnowFlakeUtil.getDefaultSnowFlakeId() + "");
    record.setCorpId(corpId);
    record.setApprovalInfoId(info.getApprovalInfoId());
    record.setFormId(param.getFormId());
    record.setApproverUserId(userId);
    record.setApproverTime(time);
    record.setApproverOpinions(param.getMessage());
    record.setApproverResult(param.getType());
    if (ObjectUtil.isNotEmpty(param.getAccessoryUrl())) {
        record.setAccessoryUrl(JSONUtil.toJsonStr(param.getAccessoryUrl()));
    }
    record.setApproverNode(info.getProcessProgress().byteValue());
    record.setApproverCount(new Byte(count + ""));
    approvalRecordMapper.insertSelective(record);

    // å›æ»šä¸Šä¸€ä¸ªèŠ‚ç‚¹
    info.setProcessProgress(info.getProcessProgress() - 1);
    info.setRecordNodeHistory(info.getRecordNodeHistory() + "," + info.getProcessProgress());
    // info.setCurrentState(1);
    approvalInfoMapper.updateByPrimaryKeySelective(info);

    if (info.getProcessProgress() == 0) {
        // å¦‚æœå›åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹,æ•°æ®çŠ¶æ€åˆ™å˜æˆåˆå§‹
        String formCode = fromConfigMapper.findFormCode(corpId, param.getFormId());
        commonMapper.updateDataState(formCode, 0, param.getObjectId(), corpId);


    }
}
```
<a name="edEgo"></a>
### å®¡æ‰¹æŒ‰é’®-åŒæ„
```java
/**
 * å®¡æ‰¹æŒ‰é’®-åŒæ„
 *
 * @param currentNode å¤„ç†çš„å½“å‰èŠ‚ç‚¹
 * @param info        æµç¨‹è¯¦æƒ…
 * @param configMap   é…ç½®é›†åˆ key=èŠ‚ç‚¹ï¼›val=é…ç½®
 * @param param       å‚æ•°
 * @param userId      å½“å‰å®¡æ‰¹äººuserId
 * @param corpId      ä¼ä¸šID
 * @param time        å½“å‰æ—¶é—´
 */
private void approvalAgreeing(Integer currentNode, ApprovalInfo info, Map<Integer, ApprovalConfig> configMap,
                              ApprovalDTO param, String userId, String corpId, LocalDateTime time, String objectId) {
    // æŸ¥è¯¢è¿™ä¸ªèŠ‚ç‚¹ä»¥å‰æ˜¯å¦å®¡æ‰¹è¿‡
    List<String> historyNode = Lists.newArrayList(info.getRecordNodeHistory().split(","));// å†å²èŠ‚ç‚¹éœ€è¦å‰”é™¤æœ€åä¸€ä¸ª
    historyNode.remove(historyNode.size() - 1);
    Bag bag = new HashBag(historyNode);
    int count = bag.getCount(currentNode.toString());// è¿™ä¸ªèŠ‚ç‚¹å†å²æ˜¯å¦å‡ºç°è¿‡
    count = count == 0 ? 1 : count + 1; // ç”¨äºæ ‡æ³¨è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦å¤šæ¬¡å®¡æ‰¹

    // ç”Ÿæˆå®¡æ‰¹è®°å½•
    ApprovalRecord record2 = new ApprovalRecord();
    record2.setApprovalRecordId(SnowFlakeUtil.getDefaultSnowFlakeId() + "");
    record2.setCorpId(corpId);
    record2.setApprovalInfoId(info.getApprovalInfoId());
    record2.setFormId(param.getFormId());
    record2.setApproverUserId(userId);
    record2.setApproverTime(time);
    record2.setApproverOpinions(param.getMessage());
    record2.setApproverResult(param.getType());
    if (ObjectUtil.isNotEmpty(param.getAccessoryUrl())) {
        record2.setAccessoryUrl(JSONUtil.toJsonStr(param.getAccessoryUrl()));
    }
    record2.setApproverNode(currentNode.byteValue());
    record2.setApproverCount(new Byte(count + ""));
    approvalRecordMapper.insertSelective(record2);
    // è·å–å½“å‰èŠ‚ç‚¹é…ç½®
    ApprovalConfig currentConfig = configMap.get(currentNode);
    if (currentConfig.getApprovalType() == 1) {// 1ä¼šç­¾
        // åˆ¤æ–­æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå®¡æ‰¹çš„,å¦‚æœä¸æ˜¯returnå‡ºå»
        List<String> userIds = null;
        if (currentConfig.getCurrentNodeApproverType() == 2) {
            // è§’è‰²id
            // æŸ¥è¯¢è‡ªå·±æ‹¥æœ‰é‚£äº›è§’è‰²
            List<UserRole> userRoles = userRoleMapper.selectList(new QueryWrapper<UserRole>().eq("user_id", userId)
                                                                 .eq("corp_id", corpId).select("user_id"));
            userIds = userRoles.stream().map(key -> key.getUserId()).collect(Collectors.toList());
        } else if (currentConfig.getCurrentNodeApproverType()==3){
            // ç”¨æˆ·ID
            userIds = JSONUtil.toList(currentConfig.getCurrentNodeApprover().toString(), String.class);
        } else if (currentConfig.getCurrentNodeApproverType() == 1) {
            // å‘èµ·äººè‡ªå·±
            userIds = Arrays.asList(info.getFounder());
        }
        // æŸ¥è¯¢å·²ç»å®¡æ‰¹çš„äºº!=å¾…å®¡æ‰¹äººæ•°åˆ™ä¸æ˜¯æœ€åä¸€ä¸ªäºº
        // 1.æŸ¥è¯¢å·²ç»å®¡æ‰¹çš„äººæ•°
        Integer count1 = approvalRecordMapper.selectCount(new QueryWrapper<ApprovalRecord>().eq("corp_id", corpId).eq("approval_info_id", info.getApprovalInfoId())
                                                          .eq("form_id", param.getFormId()).eq("approver_node", currentNode).eq("approver_count", count));
        if (userIds.size() != count1) {
            return;// ä¸æ˜¯æœ€åä¸€ä¸ªå¯ä»¥é€€å‡º
        }
    }
    Integer nextNode = currentNode + 1;
    // æ›´æ–°æµç¨‹ä¿¡æ¯
    info.setProcessProgress(nextNode);
    info.setRecordNodeHistory(info.getRecordNodeHistory() + "," + info.getProcessProgress());
    // info.setCurrentState(2);
    // åˆ°è¿™é‡Œå¦‚æœä¸æ˜¯æˆ–ç­¾,å°±æ˜¯ä¼šç­¾æ˜¯æœ€åä¸€ä¸ªäººåŒæ„å¯ä»¥åˆ¤æ–­è¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    //  åˆ¤æ–­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹,å¦‚æœæ˜¯å¯ä»¥ç»“æŸèŠ‚ç‚¹äº†,ä¸æ˜¯åˆ™ç»§ç»­å¾€ä¸‹é€’å½’
    if ((configMap.keySet().size() - 1) == nextNode) {
        info.setEndTime(time);
        info.setEndState(true);//  ç»“æŸæµç¨‹
        approvalInfoMapper.updateByPrimaryKeySelective(info);
        // æ•°æ®çŠ¶æ€å˜æˆç”Ÿæ•ˆ
        String formCode = fromConfigMapper.findFormCode(corpId, param.getFormId());
        commonMapper.updateDataState(formCode, 2, objectId, corpId);
        return;
    }
    approvalInfoMapper.updateByPrimaryKeySelective(info);


    // æ ¡éªŒä¸‹ä¸€ä¸ªé…ç½®æ˜¯å¦éœ€è¦å®¡æ‰¹
    ApprovalConfig nextConfig = configMap.get(nextNode);// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é…ç½®

    List<RuleVO> rule = JSONUtil.toList(JSONUtil.parseArray(nextConfig.getVisibleFields()), RuleVO.class);
    for (RuleVO ruleVO : rule) {
        if (ruleVO.getKx()) {
            return;// åˆ¤æ–­æ˜¯å¦å¼€äº†å¯å†™,å¦‚æœå¼€äº†å¯å†™,ä¸ç®¡æœ‰æ²¡æœ‰å¼€ç›¸åŒå®¡æ‰¹äººè‡ªåŠ¨é€šè¿‡,éƒ½ä¸èƒ½å¾€ä¸‹èµ°
        }
    }

    if (nextConfig.getApprovalAutoPass()) {
        // å¼€äº† å®¡æ‰¹äººå‘˜ç›¸åŒè‡ªåŠ¨é€šè¿‡
        // 1.æ˜¯å¦éœ€è¦è‡ªå·±å®¡æ‰¹
        if (nextConfig.getCurrentNodeApproverType() == 2) {
            // è§’è‰²id
            // æŸ¥è¯¢è‡ªå·±æ‹¥æœ‰é‚£äº›è§’è‰²
            List<UserRole> userRoles = userRoleMapper.selectList(new QueryWrapper<UserRole>().eq("user_id", userId).eq("corp_id", corpId).select("role_id"));
            List<String> roleIds = userRoles.stream().map(key -> key.getRoleId()).collect(Collectors.toList());
            List<Integer> currentNodeApproverRoleId = JSONUtil.toList(nextConfig.getCurrentNodeApprover().toString(), Integer.class);
            ArrayList<String> integers = new ArrayList<>(roleIds);
            boolean b = integers.retainAll(currentNodeApproverRoleId);// å­˜åœ¨äº¤é›†è¿”å›true
            if (!b) return;
        } else {
            // ç”¨æˆ·ID
            List<String> currentNodeApproverUserId = JSONUtil.toList(nextConfig.getCurrentNodeApprover().toString(), String.class);
            boolean contains = currentNodeApproverUserId.contains(userId);
            if (!contains) return;
        }
        // éœ€è¦è‡ªå·±å®¡æ‰¹
        approvalAgreeing(nextNode, info, configMap, param, userId, corpId, time, objectId);
    }
    // approvalRecordMapper.insertSelective(record2);

}
```
<a name="C3ggC"></a>
### åˆå¹¶æƒé™(å¦‚æœæœ€åä¸€ä¸ªèŠ‚ç‚¹å­˜åœ¨å¤šä¸ªè‡ªå®šä¹‰æƒé™ç»„ï¼Œå°±éœ€è¦åˆå¹¶)
```java
/**
 * åˆå¹¶æƒé™ç»„
 *
 * @param roleIds      å½“å‰ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²
 * @param dbPowerGroup è‡ªå®šä¹‰æƒé™ç»„
 */
private List<RuleVO> mergePowerGroup(List<String> roleIds, List<PowerGroup> dbPowerGroup) {
    List<RuleVO> result = new ArrayList<>();
    // åˆ¤æ–­å½“å‰è‡ªå®šä¹‰æƒé™ç»„æ˜¯å¦åŒ…å« å½“å‰ç”¨æˆ·çš„è§’è‰²
    for (PowerGroup power : dbPowerGroup) {
        List<Integer> dbRoleIds = JSONUtil.toList(power.getRoleId().toString(), Integer.class);
        List<String> retainAll = new ArrayList<>(roleIds);
        retainAll.retainAll(dbRoleIds);
        if (retainAll.size() != 0) {// å­˜åœ¨äº¤é›†,è¯æ˜è¿™ä¸ªè‡ªå®šä¹‰æƒé™ç»„æœ‰å½“å‰æ“ä½œç”¨æˆ·
            List<RuleVO> rule = JSONUtil.toList(JSONUtil.parseArray(power.getVisibleFields()), RuleVO.class);
            Map<String, RuleVO> tempMapDB = rule.stream().collect(Collectors.toMap(ruleVo -> ruleVo.getChildren() + ruleVo.getField(), RuleVO -> RuleVO));
            if (CollUtil.isEmpty(result)) {
                result = rule;
            } else {
                Map<String, RuleVO> tempListMap = result.stream().collect(Collectors.toMap(ruleVo -> ruleVo.getChildren() + ruleVo.getField(), RuleVO -> RuleVO));
                if (tempMapDB.keySet().size() > result.size()) {// å¦‚æœBæƒé™ç»„å­—æ®µæ¯”Aæƒé™ç»„å¤š,å°±æ‹¿å¤šçš„ä¸€æ–¹è¿›è¡Œå¾ªç¯
                    for (RuleVO item : rule) {
                        RuleVO ruleVO = tempListMap.get(item.getChildren() + item.getField());
                        if (ruleVO.getBt()) {
                            item.setBt(ruleVO.getBt());
                        }
                        if (ruleVO.getKj()) {
                            item.setKj(ruleVO.getKj());
                        }
                        if (ruleVO.getKx()) {
                            item.setKx(ruleVO.getKx());
                        }
                    }
                    result = rule;
                } else {
                    // å¦åˆ™å°±æ‹¿Aæƒé™ç»„éå†
                    for (RuleVO item : result) {
                        // åˆå¹¶ç»„æˆæ–°çš„è§„åˆ™,å¦‚æœAè§„åˆ™ä¸ºtrue,Bè§„åˆ™ä¸ºfalse,åˆ™å–trueçš„ä¸€æ–¹
                        RuleVO ruleDB = tempMapDB.get(item.getChildren() + item.getField());
                        if (ruleDB.getBt()) {
                            item.setBt(ruleDB.getBt());
                        }
                        if (ruleDB.getKj()) {
                            item.setKj(ruleDB.getKj());
                        }
                        if (ruleDB.getKx()) {
                            item.setKx(ruleDB.getKx());
                        }
                    }
                }
            }

        }
    }
    return result;
}
```
