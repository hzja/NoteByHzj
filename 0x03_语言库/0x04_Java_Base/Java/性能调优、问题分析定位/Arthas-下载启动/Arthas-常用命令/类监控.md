Java Arthas
<a name="GGNgg"></a>
### sc-查看 JVM 已加载的类信息
官方示例：[https://arthas.aliyun.com/doc/sc.html](https://arthas.aliyun.com/doc/sc.html)
<a name="1KgbR"></a>
#### `sc -h`：sc的帮助命令
```bash
[arthas@4084]$ sc -h
 USAGE:
   sc [-c <value>] [-d] [-x <value>] [-f] [-h] [-E] class-pattern

 SUMMARY:
   Search all the classes loaded by JVM

 EXAMPLES:
   sc -d org.apache.commons.lang.StringUtils
   sc -d org/apache/commons/lang/StringUtils
   sc -d *StringUtils
   sc -d -f org.apache.commons.lang.StringUtils
   sc -E org\\.apache\\.commons\\.lang\\.StringUtils

 WIKI:
   https://alibaba.github.io/arthas/sc

 OPTIONS:
 -c, --classloader <value>               The hash code of the special class's classLoader
 -d, --details                           Display the details of class 显示class的详情
 -x, --expand <value>                    Expand level of object (0 by default) 
 -f, --field                             Display all the member variables 显示字段变量
 -h, --help                              this help
 -E, --regex                             Enable regular expression to match (wildcard matching by default) 定义正则匹配
 <class-pattern>                         Class name pattern, use either '.' or '/' as separator
```
<a name="J405H"></a>
#### 参数说明
| 参数名称 | 参数说明 |
| --- | --- |
| _class-pattern_ | 类名表达式匹配 |
| _method-pattern_ | 方法名表达式匹配 |
| [d] | 输出当前类的详细信息，包括这个类所加载的原始文件来源、类的声明、加载的 ClassLoader 等详细信息。<br />如果一个类被多个 ClassLoader 所加载，则会出现多次 |
| [E] | 开启正则表达式匹配，默认为通配符匹配 |
| [f] | 输出当前类的成员变量信息（需要配合参数-d 一起使用） |
| [x:] | 指定输出静态变量时属性的遍历深度，默认为 0，即直接使用 toString 输出 |
| [c:] | 指定 class 的 ClassLoader 的 hashcode |
| [classLoaderClass:] | 指定执行表达式的 ClassLoader 的 class name |
| [n:] | 具有详细信息的匹配类的最大数量（默认为 100） |
| [cs <arg>] | 指定 class 的 `ClassLoader#toString()` 返回值。长格式[classLoaderStr <arg>] |

:::danger
class-pattern 支持全限定名，如 com.taobao.test.AAA，也支持 com/taobao/test/AAA 这样的格式，这样，从异常堆栈里面把类名拷贝过来的时候，不需要在手动把`/`替换为`.`了。<br />sc 默认开启了子类匹配功能，也就是说所有当前类的子类也会被搜索出来，想要精确的匹配，请打开`options disable-sub-class true`开关
:::
<a name="W8e0D"></a>
#### `sc -d -f <包名>.<类名>`：显示class的字段详情
```bash
[arthas@4084]$ sc -d -f com.smart.service.impl.KmsServiceImpl
 class-info        com.smart.service.impl.KmsServiceImpl
 code-source       /D:/LinkSpace/Work/WorkSpace/Code/IDEA/finchain-web/target/
 name              com.smart.service.impl.KmsServiceImpl
 isInterface       false
 isAnnotation      false
 isEnum            false
 isAnonymousClass  false
 isArray           false
 isLocalClass      false
 isMemberClass     false
 isPrimitive       false
 isSynthetic       false
 simple-name       KmsServiceImpl
 modifier          public
 annotation        org.springframework.stereotype.Service
 interfaces        com.smart.service.KmsService
 super-class       +-java.lang.Object
 class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2
                     +-sun.misc.Launcher$ExtClassLoader@6ff29830
 classLoaderHash   18b4aac2
 fields            name       baseUrl
                   type       java.lang.String
                   modifier   private
                   annotation org.springframework.beans.factory.annotation.Value

                   name       keySpec
                   type       java.lang.String
                   modifier   private
                   annotation org.springframework.beans.factory.annotation.Value

                   name     CREATE_KRY
                   type     java.lang.String
                   modifier final,private,static
                   value    createKey

                   name     CHANGE_PWD
                   type     java.lang.String
                   modifier final,private,static
                   value    changePwd


Affect(row-cnt:1) cost in 15 ms.
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595034226289-61014f58-92dd-4bf9-9933-2ff6e2ebd34a.png#averageHue=%233a3a3a&height=687&id=tYT4H&originHeight=2060&originWidth=3840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2818658&status=done&style=none&title=&width=1280)
<a name="gy9Lr"></a>
### `sm`-查看已加载类的方法信息
官方文档：[https://arthas.aliyun.com/doc/sm.html](https://arthas.aliyun.com/doc/sm.html)<br />“Search-Method” 的简写，这个命令能搜索出所有已经加载了 Class 信息的方法信息。<br />sm 命令只能看到由当前类所声明 (declaring) 的方法，父类则无法看到。
<a name="Hlq7p"></a>
## 参数说明
| 参数名称 | 参数说明 |
| --- | --- |
| class-pattern | 类名表达式匹配 |
| method-pattern | 方法名表达式匹配 |
| [d] | 展示每个方法的详细信息 |
| [E] | 开启正则表达式匹配，默认为通配符匹配 |
| [c:] | 指定 class 的 ClassLoader 的 hashcode |
| [classLoaderClass:] | 指定执行表达式的 ClassLoader 的 class name |
| [n:] | 具有详细信息的匹配类的最大数量（默认为 100） |

```bash
[arthas@4084]$ sm com.smart.service.impl.KmsServiceImpl
com.smart.service.impl.KmsServiceImpl <init>()V
com.smart.service.impl.KmsServiceImpl createKey(Lcom/smart/model/Company;)Lcom/smart/DTO/KmsResDTO;
com.smart.service.impl.KmsServiceImpl changePwd(Lcom/smart/model/Company;Ljava/lang/String;)Lcom/smart/DTO/KmsResDTO;
Affect(row-cnt:3) cost in 31 ms.
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595034551445-513db980-b54e-4e5c-8cfd-0f0c51575cb4.png#averageHue=%235e5e5e&height=123&id=SsVAQ&originHeight=370&originWidth=3840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=474193&status=done&style=none&title=&width=1280)
