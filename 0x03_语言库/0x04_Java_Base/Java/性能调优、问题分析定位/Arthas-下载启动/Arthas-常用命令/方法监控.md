Java Arthas
<a name="TmwfO"></a>
### watch-使用watch命令轻松查看输入输出参数以及异常等信息
使用 `watch`命令可以查看函数的执行信息。`watch`的参数列表

| **参数** | **参数说明** |
| --- | --- |
| class-pattern | 类名表达式匹配 |
| method-pattern | 方法名表达式匹配 |
| express | 观察表达式 |
| condition-express | 条件表达式 |
| [b] | 在方法调用之前观察 |
| [e] | 在方法异常之后观察 |
| [s] | 在方法返回之后观察 |
| [f] | 在方法结束之后(正常返回和异常返回)观察 |
| [E] | 开启正则表达式匹配，默认为通配符匹配 |
| [x:] | 指定输出结果的属性遍历深度，默认为 1 |

当遇到线上数据 `bug`时，一般处理的手段就是开发环境模拟线上数据，从生产日志中查找线索，再或者远程 `debug`。以上不管哪种排查手段，相对都是比较麻烦。这时Arthas的 `watch`可以帮助查看实时的代码执行情况。使用观察表达式可以查看函数的 `参数`, `返回值`, `异常信息`。观察表达式主要由 `OGNL`表达式组成，所以可以编写 `OGNL`表达式来执行。<br />观察表达式的变量

| **变量** | **变量说明** |
| --- | --- |
| params | 函数的入参 |
| returnObj | 函数的返回值 |
| throwExp | 异常信息 |
| target | 当前对象 |

<a name="8dLZX"></a>
#### watch -h
```bash
[arthas@9244]$ watch -h
 USAGE:
   watch [-b] [-e] [-x <value>] [-f] [-h] [-n <value>] [--listenerId <value>] [-E] [-M <value>] [-s] class-pattern met
 hod-pattern [express] [condition-express]

 SUMMARY:
   Display the input/output parameter, return object, and thrown exception of specified method invocation
   The express may be one of the following expression (evaluated dynamically):
           target : the object
            clazz : the object's class
           method : the constructor or method
           params : the parameters array of method
     params[0..n] : the element of parameters array
        returnObj : the returned object of method
         throwExp : the throw exception of method
         isReturn : the method ended by return
          isThrow : the method ended by throwing exception
            #cost : the execution time in ms of method invocation
 Examples:
   watch -b org.apache.commons.lang.StringUtils isBlank params
   watch -f org.apache.commons.lang.StringUtils isBlank returnObj
   watch org.apache.commons.lang.StringUtils isBlank '{params, target, returnObj}' -x 2
   watch -bf *StringUtils isBlank params
   watch *StringUtils isBlank params[0]
   watch *StringUtils isBlank params[0] params[0].length==1
   watch *StringUtils isBlank params '#cost>100'
   watch -E -b org\.apache\.commons\.lang\.StringUtils isBlank params[0]

 WIKI:
   https://alibaba.github.io/arthas/watch

 OPTIONS:
 -b, --before                            Watch before invocation
 -e, --exception                         Watch after throw exception
 -x, --expand <value>                    Expand level of object (1 by default)
 -f, --finish                            Watch after invocation, enable by default
 -h, --help                              this help
 -n, --limits <value>                    Threshold of execution times
     --listenerId <value>                The special listenerId
 -E, --regex                             Enable regular expression to match (wildcard matching by default)
 -M, --sizeLimit <value>                 Upper size limit in bytes for the result (10 * 1024 * 1024 by default)
 -s, --success                           Watch after successful invocation
 <class-pattern>                         The full qualified class name you want to watch
 <method-pattern>                        The method name you want to watch
 <express>                               the content you want to watch, written by ognl.
                                         Examples:
                                           params
                                           params[0]
                                           'params[0]+params[1]'
                                           '{params[0], target, returnObj}'
                                           returnObj
                                           throwExp
                                           target
                                           clazz
                                           method

 <condition-express>                     Conditional expression in ognl style, for example:
                                           TRUE  : 1==1
                                           TRUE  : true
                                           FALSE : false
                                           TRUE  : 'params.length>=0'
                                           FALSE : 1==2

```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1594879612628-e8efd462-8e2c-43b7-9756-d75594f7e70b.png#averageHue=%23414141&height=583&id=uWjOf&originHeight=1750&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2109673&status=done&style=none&title=&width=1107.6666666666667)![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1594879639910-93a96045-3235-415c-8367-946835fbff9d.png#averageHue=%233c3c3c&height=583&id=dFWu0&originHeight=1750&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2092060&status=done&style=none&title=&width=1107.6666666666667)
<a name="Byi41"></a>
#### `watch <包名.类名> 方法名 '{params[0], returnObj.toString()}'`：监听方法的参数和返回值
```bash
# 查看入参和出参
$ watch com.fcant.service.UserServiceImpl getUser '{params[0],returnObj}'
# 查看入参和出参大小
$ watch com.fcant.service.UserServiceImpl getUser '{params[0],returnObj.size}'
# 查看入参和出参中是否包含 'count10'
$ watch com.fcant.service.UserServiceImpl getUser '{params[0],returnObj.contains("count10")}'
# 查看入参和出参，出参 toString
$ watch com.fcant.service.UserServiceImpl getUser '{params[0],returnObj.toString()}'
# 查看方法的异常信息
$ watch com.fcant.service.UserServiceImpl getUser "throwExp"
# 查看入参和出参，出参 toString，以及异常信息
$ watch com.fcant.service.UserServiceImpl getUser '{params[0],returnObj.toString(), throwExp}'
```
```bash
[arthas@13704]$ watch com.fcant.fclink.service.impl.PersonServiceImpl getPerson '{params[0], returnObj.toString()}'
Press Q or Ctrl+C to abort.
Affect(class count: 1 , method count: 1) cost in 42 ms, listenerId: 2
ts=2020-07-18 17:33:48; [cost=1.585501ms] result=@ArrayList[
    @Integer[1],
    @String[Person{    name='Fcink',\n    osName='Windows 10',\n    randomNumber='30.82517539647569',\n    resourceFile='resources:application.yml',\n    url=http://www.yuque.com/fcant,\n    fcinkVlaue='Fcink',\n}],
]
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595065034048-b6f703aa-9b74-4d69-9aba-c7d6511b6c51.png#averageHue=%233f3f3f&height=150&id=aM2Jl&originHeight=450&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=631405&status=done&style=none&title=&width=1107.6666666666667)
<a name="o2Huv"></a>
#### `watch <包名.类名> 方法名 '{params[0],returnObj.toString(), throwExp}' -b` ：观察事件点模式
`watch`除了观察表达式外，还能使用 `条件表达式`，以及 `观察事件点`。**注意**使用观察事件点时，有些观察表达式的变量不一定存在，比如使用 `-b`时，返回值和异常信息都为空。
```bash
[arthas@13704]$ watch com.fcant.fclink.service.impl.PersonServiceImpl getPerson '{params[0], returnObj.toString(), throwExp}' -b
```
<a name="4YwzK"></a>
#### `watch <包名.类名> 方法名 '{params[0],returnObj.toString(), throwExp}' > /log/arthas.log` ：后台异步日志记录
有时排查某个函数，不能马上获取到函数的信息， `arthas`给提供的 `后台异步任务`可以帮助记录日志。使用方式和Linux的类似。
```bash
[arthas@13704]$ watch com.fcant.fclink.service.impl.PersonServiceImpl getPerson '{params[0], returnObj.toString(), throwExp}' > /log/arthas.log
```
<a name="HPNJX"></a>
### trace-方法内部调用路径，并输出方法路径上的每个节点上耗时
`trace`参数说明

| **参数** | **参数说明** |
| --- | --- |
| class-pattern | 类名表达式匹配 |
| method-pattern | 方法名表达式匹配 |
| condition-express | 条件表达式 |
| [E] | 开启正则表达式匹配，默认为通配符匹配 |
| [n:] | 命令执行次数 |
| #cost | 方法执行耗时 |

<a name="EUpw7"></a>
#### `trace -h`
```bash
[arthas@9244]$ trace -h
 USAGE:
   trace [-h] [-n <value>] [--listenerId <value>] [-p <value>] [-E] [--skipJDKMethod <value>] class-pattern method-pat
 tern [condition-express]

 SUMMARY:
   Trace the execution time of specified method invocation.
   The express may be one of the following expression (evaluated dynamically):
           target : the object
            clazz : the object's class
           method : the constructor or method
           params : the parameters array of method
     params[0..n] : the element of parameters array
        returnObj : the returned object of method
         throwExp : the throw exception of method
         isReturn : the method ended by return
          isThrow : the method ended by throwing exception
            #cost : the execution time in ms of method invocation
 EXAMPLES:
   trace org.apache.commons.lang.StringUtils isBlank
   trace *StringUtils isBlank
   trace *StringUtils isBlank params[0].length==1
   trace *StringUtils isBlank '#cost>100'
   trace -E org\\.apache\\.commons\\.lang\\.StringUtils isBlank
   trace -E com.test.ClassA|org.test.ClassB method1|method2|method3
   trace demo.MathGame run -n 5
   trace demo.MathGame run --skipJDKMethod false

 WIKI:
   https://alibaba.github.io/arthas/trace

 OPTIONS:
 -h, --help                              this help
 -n, --limits <value>                    Threshold of execution times
     --listenerId <value>                The special listenerId
 -p, --path <value>                      path tracing pattern
 -E, --regex                             Enable regular expression to match (wildcard matching by default)
     --skipJDKMethod <value>             skip jdk method trace, default value true.
 <class-pattern>                         Class name pattern, use either '.' or '/' as separator
 <method-pattern>                        Method name pattern
 <condition-express>                     Conditional expression in ognl style, for example:
                                           TRUE  : 1==1
                                           TRUE  : true
                                           FALSE : false
                                           TRUE  : 'params.length>=0'
                                           FALSE : 1==2
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1594879693536-8d984c85-444a-4e2f-9e8b-467d65479656.png#averageHue=%233e3e3e&height=583&id=zTWgJ&originHeight=1750&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2100807&status=done&style=none&title=&width=1107.6666666666667)![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1594879706232-a570e0ba-78ec-40c5-83cb-9fa530539757.png#averageHue=%233c3c3c&height=583&id=zD4qW&originHeight=1750&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2093790&status=done&style=none&title=&width=1107.6666666666667)
<a name="OVjuo"></a>
#### trace <包名.类名> 方法名：监测当前方法的执行时间
```bash
[arthas@4084]$ trace com.smart.dao.FinancingMapper select
Press Q or Ctrl+C to abort.
Affect(class count: 2 , method count: 1) cost in 266 ms, listenerId: 1
`---ts=2020-07-18 11:00:20;thread_name=pool-3-thread-1;id=54;is_daemon=false;priority=5;TCCL=sun.misc.Launcher$AppClassLoader@18b4aac2
    `---[18.7456ms] com.sun.proxy.$Proxy144:select()

`---ts=2020-07-18 11:00:20;thread_name=pool-3-thread-1;id=54;is_daemon=false;priority=5;TCCL=sun.misc.Launcher$AppClassLoader@18b4aac2
    `---[18.8973ms] com.sun.proxy.$Proxy144:select()
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595041664689-5959a3c4-e7b3-4e19-a0c6-0ebad69739e7.png#averageHue=%23383838&height=189&id=EKNNJ&originHeight=567&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=731378&status=done&style=none&title=&width=1107.6666666666667)
<a name="a1U2f"></a>
#### `trace <包名.类名> 方法名 '#cost > 1'`：监测当前方法的执行时间，过滤掉小于 1ms的调用
在实际使用使用排查过程中，为了减少无用信息的输出，一般会使用 `#cost`过滤耗时不长和jdk自带的函数，可以忽略的调用，减少信息的输出。例如：过滤掉小于 `1ms`的调用
```bash
[arthas@4084]$ trace com.smart.dao.FinancingMapper select '#cost > 1'
```
<a name="Tk7ja"></a>
### stack-输出当前方法被调用的调用路径
<a name="tIeXC"></a>
#### `stack -h`：stack的帮助命令
```bash
[arthas@13704]$ stack -h
 USAGE:
   stack [-h] [-n <value>] [--listenerId <value>] [-E] class-pattern [method-pattern] [condition-express]

 SUMMARY:
   Display the stack trace for the specified class and method
   The express may be one of the following expression (evaluated dynamically):
           target : the object
            clazz : the object's class
           method : the constructor or method
           params : the parameters array of method
     params[0..n] : the element of parameters array
        returnObj : the returned object of method
         throwExp : the throw exception of method
         isReturn : the method ended by return
          isThrow : the method ended by throwing exception
            #cost : the execution time in ms of method invocation
 EXAMPLES:
   stack org.apache.commons.lang.StringUtils isBlank
   stack *StringUtils isBlank
   stack *StringUtils isBlank params[0].length==1
   stack *StringUtils isBlank '#cost>100'
   stack -E org\.apache\.commons\.lang\.StringUtils isBlank

 WIKI:
   https://alibaba.github.io/arthas/stack

 OPTIONS:
 -h, --help                              this help
 -n, --limits <value>                    Threshold of execution times
     --listenerId <value>                The special listenerId
 -E, --regex                             Enable regular expression to match (wildcard matching by default)
 <class-pattern>                         Path and classname of Pattern Matching
 <method-pattern>                        Method of Pattern Matching
 <condition-express>                     Conditional expression in ognl style, for example:
                                           TRUE  : 1==1
                                           TRUE  : true
                                           FALSE : false
                                           TRUE  : 'params.length>=0'
                                           FALSE : 1==2
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595065336109-9e21e40b-fd97-4527-bb46-57bb920e1d2b.png#averageHue=%233a3a3a&height=687&id=zzWpw&originHeight=2060&originWidth=3840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2820758&status=done&style=shadow&title=&width=1280)
<a name="bI0iz"></a>
#### `stack <包名.类名>`：监控当前类下方法的调用路径
```bash
[arthas@13704]$ stack com.fcant.fclink.service.impl.PersonServiceImpl
Press Q or Ctrl+C to abort.
Affect(class count: 1 , method count: 2) cost in 32 ms, listenerId: 3
ts=2020-07-18 17:44:21;thread_name=http-nio-8001-exec-8;id=9b;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@59153932
    @com.fcant.fclink.service.impl.PersonServiceImpl.getPerson()
        at com.fcant.fclink.controller.PersonController.getPersons(PersonController.java:26)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)
        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)
        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)
        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)
        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)
        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)
        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)
        at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:634)
        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)
        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
        at java.lang.Thread.run(Thread.java:748)
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595065612739-6b8480d8-1908-420f-8a95-302db06d361e.png#averageHue=%23484848&height=583&id=QeyiG&originHeight=1750&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2233209&status=done&style=none&title=&width=1107.6666666666667)
<a name="6O9BN"></a>
### monitor-方法执行监控
| **监控项** | **说明** |
| --- | --- |
| timestamp | 时间戳 |
| class | Java类 |
| method | 方法（构造方法、普通方法） |
| total | 调用次数 |
| success | 成功次数 |
| fail | 失败次数 |
| rt | 平均RT |
| fail-rate | 失败率 |

这里面`fail`的标准是抛出异常，其中`rt`这个参数比较有意义，可以查看一下方法调用的耗时情况，比如不同参数场景下的方法耗时，这个统计仅供参考。原因下面会讲。<br />方法调用比较简单，只有一个参数`-c`表示统计周期的，默认是`120s`。文档中表示执行此命令会导致`JVM`运行该方法变慢，测验后发现，大概会提高`50%`的`rt`，结束`arthas`之后恢复原来的性能。
<a name="35YM9"></a>
#### `monitor -h`：monitor的帮助命令
```bash
[arthas@4084]$ monitor -h
 USAGE:
   monitor [-c <value>] [-h] [-n <value>] [--listenerId <value>] [-E <value>] class-pattern method-pattern

 SUMMARY:
   Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.

 Examples:
   monitor org.apache.commons.lang.StringUtils isBlank
   monitor org.apache.commons.lang.StringUtils isBlank -c 5
   monitor -E org\.apache\.commons\.lang\.StringUtils isBlank

 WIKI:
   https://alibaba.github.io/arthas/monitor

 OPTIONS:
 -c, --cycle <value>                     The monitor interval (in seconds), 60 seconds by default
 -h, --help                              this help
 -n, --limits <value>                    Threshold of execution times
     --listenerId <value>                The special listenerId
 -E, --regex <value>                     Enable regular expression to match (wildcard matching by default)
 <class-pattern>                         Path and classname of Pattern Matching
 <method-pattern>                        Method of Pattern Matching
```
<a name="7uuQl"></a>
#### `monitor -c 5 <包名.类名> 方法名`：每五秒统计一次方法的执行时间
```bash
[arthas@4084]$ monitor -c 5 com.smart.dao.FinancingMapper select
Press Q or Ctrl+C to abort.
Affect(class count: 2 , method count: 1) cost in 125 ms, listenerId: 2
 timestamp         class                       method                     total    success   fail     avg-rt(  fail-ra
                                                                                                      ms)      te
-----------------------------------------------------------------------------------------------------------------------
 2020-07-18 11:10  com.sun.proxy.$Proxy144     select                     2        2         0        19.48    0.00%
 :22

 timestamp         class                       method                     total    success   fail     avg-rt(  fail-ra
                                                                                                      ms)      te
-----------------------------------------------------------------------------------------------------------------------
 2020-07-18 11:10  com.sun.proxy.$Proxy144     select                     0        0         0        0.00     0.00%
 :27
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595061896847-2d1b0c23-8dde-49d1-b106-5dd43075dfac.png#averageHue=%233b3b3b&height=687&id=hZ85W&originHeight=2060&originWidth=3840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2770206&status=done&style=none&title=&width=1280)
<a name="8Yw2c"></a>
### tt-方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测
使用 tt 命令记录方法执行的详细情况
> tt 命令方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测 。

返回列字段说明

| **表格字段** | **字段解释** |
| --- | --- |
| INDEX | 时间片段记录编号，每一个编号代表着一次调用，后续tt还有很多命令都是基于此编号指定记录操作，非常重要。 |
| TIMESTAMP | 方法执行的本机时间，记录了这个时间片段所发生的本机时间 |
| COST(ms) | 方法执行的耗时 |
| IS-RET | 方法是否以正常返回的形式结束 |
| IS-EXP | 方法是否以抛异常的形式结束 |
| OBJECT | 执行对象的hashCode()，注意，曾经有人误认为是对象在JVM中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体 |
| CLASS | 执行的类名 |
| METHOD | 执行的方法名 |

<a name="zfAnt"></a>
#### ` tt -t <包名.类名> <方法名>`：记录方法的调用信息
  `-t`是每次调用该函数都会记录
```bash
[arthas@13704]$ tt -t com.fcant.fclink.service.impl.PersonServiceImpl getPerson
Press Q or Ctrl+C to abort.
Affect(class count: 1 , method count: 1) cost in 31 ms, listenerId: 4
 INDEX  TIMESTAMP          COST(ms  IS-RE  IS-EXP  OBJECT        CLASS                      METHOD
                           )        T
-----------------------------------------------------------------------------------------------------------------------
 1000   2020-07-18 17:57:  0.061    true   false   0x78e6745c    PersonServiceImpl          getPerson
        36
 1001   2020-07-18 17:57:  0.0405   true   false   0x78e6745c    PersonServiceImpl          getPerson
        39
 1002   2020-07-18 17:57:  0.0406   true   false   0x78e6745c    PersonServiceImpl          getPerson
        41
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595066489915-f9e62dd3-4a70-43e1-a616-381febb2a14b.png#averageHue=%23494949&height=253&id=lTmCb&originHeight=760&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=855259&status=done&style=none&title=&width=1107.6666666666667)
<a name="w0kSf"></a>
#### `tt -l`：查看保存的方法调用记录
```bash
[arthas@13704]$ tt -t com.fcant.fclink.service.impl.PersonServiceImpl getPerson
Press Q or Ctrl+C to abort.
Affect(class count: 1 , method count: 1) cost in 38 ms, listenerId: 6
 INDEX  TIMESTAMP          COST(ms  IS-RE  IS-EXP  OBJECT        CLASS                      METHOD
                           )        T
-----------------------------------------------------------------------------------------------------------------------
 1003   2020-07-18 18:03:  0.0582   true   false   0x78e6745c    PersonServiceImpl          getPerson
        19
[arthas@13704]$ tt -l
 INDEX  TIMESTAMP          COST(ms  IS-RE  IS-EXP  OBJECT        CLASS                      METHOD
                           )        T
-----------------------------------------------------------------------------------------------------------------------
 1000   2020-07-18 17:57:  0.061    true   false   0x78e6745c    PersonServiceImpl          getPerson
        36
 1001   2020-07-18 17:57:  0.0405   true   false   0x78e6745c    PersonServiceImpl          getPerson
        39
 1002   2020-07-18 17:57:  0.0406   true   false   0x78e6745c    PersonServiceImpl          getPerson
        41
 1003   2020-07-18 18:03:  0.0582   true   false   0x78e6745c    PersonServiceImpl          getPerson
        19
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595066688856-3abbaee8-c837-4d66-ad80-980d477168c4.png#averageHue=%23434343&height=397&id=RZdxo&originHeight=1191&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1387691&status=done&style=none&title=&width=1107.6666666666667)
<a name="imWjl"></a>
#### `tt -i [INDEX]`：查看调用的详细信息
```bash
[arthas@13704]$ tt -i 1000
 INDEX          1000
 GMT-CREATE     2020-07-18 17:57:36
 COST(ms)       0.061
 OBJECT         0x78e6745c
 CLASS          com.fcant.fclink.service.impl.PersonServiceImpl
 METHOD         getPerson
 IS-RETURN      true
 IS-EXCEPTION   false
 PARAMETERS[0]  @Integer[1]
 RETURN-OBJ     @Person[
                    name=@String[Fcink],
                    osName=@String[Windows 10],
                    randomNumber=@String[30.82517539647569],
                    resourceFile=@String[resources:application.yml],
                    url=@String[http://www.yuque.com/fcant],
                    fcinkVlaue=@String[Fcink],
                ]
Affect(row-cnt:1) cost in 2 ms.
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595066808793-d1cb8842-8c99-4d2a-8313-189bf7b0b9d7.png#averageHue=%23404040&height=378&id=zl10y&originHeight=1135&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1300964&status=done&style=none&title=&width=1107.6666666666667)
<a name="SASpE"></a>
#### `tt -i [INDEX] -p`：指定调用索引[INDEX]重新发起调用
```bash
[arthas@13704]$ tt -i 1001 -p
 RE-INDEX       1001
 GMT-REPLAY     2020-07-18 18:08:34
 OBJECT         0x78e6745c
 CLASS          com.fcant.fclink.service.impl.PersonServiceImpl
 METHOD         getPerson
 PARAMETERS[0]  @Integer[1]
 IS-RETURN      true
 IS-EXCEPTION   false
 COST(ms)       0.4656
 RETURN-OBJ     @Person[
                    name=@String[Fcink],
                    osName=@String[Windows 10],
                    randomNumber=@String[30.82517539647569],
                    resourceFile=@String[resources:application.yml],
                    url=@String[http://www.yuque.com/fcant],
                    fcinkVlaue=@String[Fcink],
                ]
Time fragment[1001] successfully replayed 1 times.
```
![image.png](https://cdn.nlark.com/yuque/0/2020/png/396745/1595066961587-c2313bf9-ba32-4887-b2e2-73e42dded609.png#averageHue=%23404040&height=381&id=VPNhu&originHeight=1143&originWidth=3323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1310757&status=done&style=none&title=&width=1107.6666666666667)
