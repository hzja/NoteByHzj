Java
<a name="AYC8g"></a>
## 背景
由于项目需要，需要预研下规则引擎，领导让找个合适的规则引擎框架。<br />关于这一部分，之前确实没用过，遇事不决，先问百度。<br />百度上是这么介绍规则引擎的：
> 规则引擎由推理引擎发展而来，是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则做出业务决策。

![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265622346-4f24d796-35c8-4047-b722-c753d8089aba.png#clientId=u3c32b415-82c1-4&from=paste&id=uea5da89e&originHeight=602&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=uc9e4bef4-8ea9-49b8-8e0e-f7ec91faaed&title=)
<a name="WhJXU"></a>
## 应用案例
某电商平台促销活动：活动规则是根据⽤户购买订单的金额给用户送相应的积分：

- **购买的越多送的积分越多**
- **⽤户可以使⽤积分来兑换相应的商品**

这次活动的力度很大，肯定会吸引很多的用户参加，产品经理小王兴高采烈唾液横飞的对小明讲到。<br />⽤户购买的金额和对应送多少积分的规则如下：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265622116-1184cb22-4992-4dad-9e3a-2b646a13e72a.png#clientId=u3c32b415-82c1-4&from=paste&id=u5f4e1b12&originHeight=210&originWidth=513&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u56b73ce7-c734-47c5-ae5f-6eba8194099&title=)<br />小明⼀看，这需求果然简单呀，作为⼀个工作了两三年的程序员来讲，这不就是小case，半天搞定，送积分的新代码如下：
```java
public void execute() throws Exception {
    List<Order> orderList = getInitData();
    for (int i=0; i<orderList.size(); i++){
        Order order = orderList.get(i);
        if (order.getAmout() <= 100){
            order.setScore(0);
            addScore(order);
        }else if(order.getAmout() > 100 && order.getAmout() <= 50{
            order.setScore(100);
            addScore(order);
        }else if(order.getAmout() > 500 && order.getAmout() <= 100{
            order.setScore(500);
            addScore(order);
        }else{
            order.setScore(1000);
            addScore(order);
        }
    }
}
```
上线运行了半天之后，财务部的小财突然监测到活动账户的金额大为减少，领导于是调整规则变成了这样：200元以下不给积分，1000元以 下给100积分…<br />活动效果不理想，和领导商议了一下，改为最初规则的1.5倍，及150元⼀下不给积分，750元以下给100积分…<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265622259-5891e6d9-e2a5-4f4f-bd9a-33372e5db24d.png#clientId=u3c32b415-82c1-4&from=paste&id=ue37a611f&originHeight=1162&originWidth=746&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u1f3169c9-4b6c-40cd-90cf-0feae4ab377&title=)<br />当规则在不断的变化过程中，小明想这样下去非得被他们弄死，必须要找找有什么技术可以将活动规则和代码解耦，不管规则如何变化，执行端不用动。<br />小明搜了半天还真有这样的东西，那就是规则引擎，那么规则引擎到底是什么东西呢？来看看。
<a name="Hhmqo"></a>
## 优势
关于规则的优势，大家可能看到题目就已经猜出了大概，确实，正如猜测的这样。

1. **可以提高效率，管理流程自动化，即使现代商业规则异常复杂。**
2. **市场要求业务规则经常变化，IT系统必须依据业务规则的变化快速、低成本的更新。**
3. **可快速、低成本的更新，业务人员应能直接管理IT系统中的规则，不需要程序开发人员参与。**

常见的规则引擎有：easy-rules，Drools。<br />这两个都是解决常见的业务场景，比如电商会员服务的等级、积分、权益等模块中。<br />可以简单的了解：

- **easy-rules: 更轻量，在小的需求中使用**
- **Drools：重量级选手，在金融、电信这类行业使用**

![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265622174-ed5faaeb-114a-4da6-9448-c9a5beb0c2e9.png#clientId=u3c32b415-82c1-4&from=paste&id=u33590234&originHeight=647&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=ub0de22d4-cd0a-40f1-8f6e-e0c7bb49726&title=)
<a name="XY2Pc"></a>
## Drools 是什么？
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265622195-d5292f90-e86d-4261-a2bd-49cabedf73eb.png#clientId=u3c32b415-82c1-4&from=paste&id=u6692b617&originHeight=429&originWidth=714&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=udd6a3f77-cd36-4c95-9947-fadb4642aea&title=)<br />Drools 是为 Java 量身定制的基于 Charles Forgy 的 RETE 算法的规则引擎的实现。具有了 OO 接口的 RETE，使得商业规则有了更自然的表达。<br />开发语言：Java<br />官网：[www.drools.org](https://www.drools.org)<br />开源地址：[https://github.com/kiegroup/drools](https://github.com/kiegroup/drools)
<a name="x1BuI"></a>
## easy-rules
一句话简介：用于 Java 的简单、粗暴的规则引擎。

- **轻量级库和易于学习的 API**
- **基于 POJO 的开发，带有注释编程模型**
- **用于定义业务规则并使用 Java 轻松应用它们的有用抽象**
- **从原始规则创建复合规则的能力**
- **使用表达式语言（如 MVEL、SpEL 和 JEXL）定义规则的能力**

开源地址：[https://github.com/j-easy/easy-rules](https://github.com/j-easy/easy-rules)
<a name="pvpc7"></a>
## 总结
简单对比两个规则引擎：<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1664265623850-bcd0fa1f-bb85-4dc9-8fc5-ca3fa1a754fb.png#clientId=u3c32b415-82c1-4&from=paste&id=udfa66d12&originHeight=321&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=shadow&taskId=u15e4a779-cffc-425f-97ae-c5625ba847c&title=)<br />**更新情况：**<br />easy-rules更新记录还在两年前，而Drools在本周内还在更新。在选用框架的时候，根据项目需要，看是简单业务还是复杂应用，选择合适的框架。<br />显然，Drools 目前表现的更活跃，功能更强大，同时意味着更高的学习维护成本。
