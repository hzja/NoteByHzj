JavaSpringBoot<br />![](https://cdn.nlark.com/yuque/0/2022/png/396745/1668737593817-35c07163-0106-48de-bce1-0de1b127ebb7.png#averageHue=%23252628&clientId=u04e61db4-4ddd-4&from=paste&id=ucdc87a1d&originHeight=404&originWidth=984&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u7175fd0f-f593-45b9-a2d7-acb6f66d5f5&title=)
<a name="fRkPB"></a>
### TLog简介
1、TLog通过对日志打标签完成企业级微服务的日志追踪。它不收集日志，使用简单， 产生全局唯一的追踪码。除了追踪码以外，TLog还支持SpanId和上下游服务信息 标签的追加。<br />2、为用户使用方便而设计，提供完全零侵入式接入方式，自动探测项目中使用的RPC框架和日志框架， 进行字节码的注入完成系统级日志标签的追加。<br />3、TLog适配了市面上主流的RPC框架：dubbo，dubbox，spring cloud的open feign。<br />4、TLog提供Javaagent，字节码注入，日志框架适配三种接入模式，无论是哪一种，都保证了无性能损耗。支持在业务异步线程，线程池， 日志异步输出这几种场景下追踪不中断。
<a name="Fe8ol"></a>
### 项目特性
1、通过对日志打标签完成轻量级微服务日志追踪<br />2、提供三种接入方式：javaagent完全无侵入接入，字节码一行代码接入，基于配置文件的接入<br />3、支持常见的log4j，log4j2，logback三大日志框架，并提供自动检测，完成适配<br />4、支持Spring Cloud Gateway和Soul网关<br />5、适配HttpClient和Okhttp的http调用标签传递<br />6、支持三种任务框架，JDK的TimerTask，Quartz，XXL-JOB<br />7、支持日志标签的自定义模板的配置，提供多个系统级埋点标签的选择<br />8、支持异步线程的追踪，包括线程池，多级异步线程等场景<br />9、几乎无性能损耗，快速稳定，经过压测，损耗在0.01%
<a name="HmJOk"></a>
### 安装TLog
TLog对springboot和spring native提供了2种不同的依赖，此种方式只需依赖一个包，必须的包会传递依赖进来。<br />**springboot依赖**
```xml
<dependency>  
  <groupId>com.yomahub</groupId>  
  <artifactId>tlog-all-spring-boot-starter</artifactId>  
  <version>1.3.4</version>  
</dependency>
```
**spring native依赖**
```xml
<dependency>  
  <groupId>com.yomahub</groupId>  
  <artifactId>tlog-all</artifactId>  
  <version>1.3.4</version>  
</dependency>
```
<a name="gUc4H"></a>
### 日志框架适配方式(举例Log4j框架适配器)
**同步日志：只需要把layout的实现类换掉就可以了**
```xml
<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">  
<log4j:configuration>  
    <appender name="stdout" class="org.apache.log4j.ConsoleAppender">  
        <!--替换成AspectLog4jPatternLayout-->  
        <layout class="com.yomahub.tlog.core.enhance.log4j.AspectLog4jPatternLayout">  
            <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss,SSS} [%p] %m  >> %c:%L%n"/>  
        </layout>  
    </appender>  
    <appender name="fileout" class="org.apache.log4j.DailyRollingFileAppender">  
        <param name="File" value="./logs/test.log"/>  
        <!--替换成AspectLog4jPatternLayout-->  
        <layout class="com.yomahub.tlog.core.enhance.log4j.AspectLog4jPatternLayout">  
            <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss,SSS} [%p] %m  >> %c:%L%n"/>  
        </layout>  
    </appender>  
    <root>  
        <priority value="info" />  
        <appender-ref ref="stdout"/>  
        <appender-ref ref="fileout"/>  
    </root>  
</log4j:configuration>
```
**异步日志：只要把appender的实现类替换掉就行了**
```xml
<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">  
<log4j:configuration>  
    <appender name="stdout" class="org.apache.log4j.ConsoleAppender">  
        <layout class="org.apache.log4j.PatternLayout">  
            <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss,SSS} [%p] %m  >> %c:%L%n"/>  
        </layout>  
    </appender>  
    <appender name="fileout" class="org.apache.log4j.DailyRollingFileAppender">  
        <param name="File" value="./logs/log4j-dubbo-provider.log"/>  
        <layout class="org.apache.log4j.PatternLayout">  
            <param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss,SSS} [%p] %m  >> %c:%L%n"/>  
        </layout>  
    </appender>  
  
    <!--这里替换成AspectLog4jAsyncAppender-->  
    <appender name="asyncFileout" class="com.yomahub.tlog.core.enhance.log4j.async.AspectLog4jAsyncAppender">  
        <appender-ref ref="fileout"/>  
    </appender>  
  
    <root>  
        <priority value="info" />  
        <appender-ref ref="stdout"/>  
        <appender-ref ref="asyncFileout"/>
```
<a name="z2OBY"></a>
### 任务框架支持(举例XXL-JOB框架)
从1.3.0版本开始，TLog对开源框架XXL-JOB作了支持。<br />在springboot环境下，无需作任何改动。只需引入依赖包即可生效。<br />而在spring native环境下，需要额外配置一行
```xml
<bean class="com.yomahub.tlog.springboot.lifecircle.TLogXxljobEnhanceInit"/>
```
<a name="q86gh"></a>
### TLog架构图
![](https://cdn.nlark.com/yuque/0/2022/png/396745/1668737594828-216e20a4-adad-47dc-91a5-24ae664d9a14.png#averageHue=%23836b38&clientId=u04e61db4-4ddd-4&from=paste&id=u3fc0b6e1&originHeight=826&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u153eb607-6b15-49a2-becb-456ee4f0404&title=)<br />开源地址：[**_https://gitee.com/dromara/TLog_**](https://gitee.com/dromara/TLog)
